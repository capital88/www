
                        if (!('LUME' in window)) {
                            __LUME__ = window.__LUME__ || {}
                            Object.defineProperty(window, 'LUME', {
                                get() { return __LUME__ },
                                set(val) { Object.assign(__LUME__, val) },
                            });
                        }
                        LUME=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"d",(function(){return i})),n.d(e,"k",(function(){return s})),n.d(e,"h",(function(){return l})),n.d(e,"e",(function(){return u})),n.d(e,"f",(function(){return h})),n.d(e,"a",(function(){return d})),n.d(e,"g",(function(){return p})),n.d(e,"c",(function(){return f})),n.d(e,"i",(function(){return m})),n.d(e,"j",(function(){return g}));class r{constructor(){this.m=new WeakMap}set(t,e){this.m.set(t,e),this.m.set(e,t)}get(t){return this.m.get(t)}has(t){return this.m.has(t)}}function i(t){const e=t.toString().split("\n");return e.shift(),e.pop(),e.join("\n")}const o={enumerable:!0,configurable:!0};function s(t,e,n,r=!1){n=c(r?u(t,e):Object.getOwnPropertyDescriptor(t,e),n),Object.defineProperty(t,e,n)}function a(t,e){let n,r;const i=Object.getOwnPropertyDescriptors(t);for(const t in e)n=e[t],r=i[t],e[t]=c(r,n);Object.defineProperties(t,e)}function c(t,e){if(("get"in e||"set"in e)&&("value"in e||"writable"in e))throw new TypeError("cannot specify both accessors and a value or writable attribute");return t&&("get"in e||"set"in e?(delete t.value,delete t.writable):("value"in e||"writable"in e)&&(delete t.get,delete t.set)),{...o,...t,...e}}function l(t,e,n=!0){let r,i=!1;return r=1===arguments.length?t:n?u(t,e):Object.getOwnPropertyDescriptor(t,e),r&&(r.get||r.set)&&(i=!0),i}function u(t,e){let n,r=t;for(;r;){if(n=Object.getOwnPropertyDescriptor(r,e),n)return n.owner=r,n;r=r.__proto__}}function h(t){let e=t,n=[];for(;e;)n=n.concat(Object.getOwnPropertyNames(e)),e=e.__proto__;return n=Array.from(new Set(n)),n}function d(t){return t}function p(t,e){let n=t.__proto__;do{if(e===n)return!0;n=n.__proto__}while(n);return!1}function f(t,e,n){const r=Object.getOwnPropertyNames(t);let i=r.length;for(;i--;){const o=r[i],s=Object.getOwnPropertyDescriptor(t,o);n&&n(s),Object.defineProperty(e,o,s)}}function m(t,{defaultClassDescriptor:{writable:e,enumerable:n,configurable:r}}){const i=Object.getOwnPropertyDescriptors(t);let o;for(const t in i)o=i[t],("value"in o||"writable"in o)&&(o.writable=e),o.enumerable=n,o.configurable=r;a(t,i)}function g(t,{defaultClassDescriptor:{writable:e,enumerable:n,configurable:r}},i){const o=Object.getOwnPropertyDescriptors(t);let s;for(const t in o)i&&i.includes(t)?delete o[t]:(s=o[t],("value"in s||"writable"in s)&&(s.writable=e),s.enumerable=n,s.configurable=r);a(t,o)}},function(t,e,n){"use strict";(function(t){function r(t){return Promise.resolve().then(t)}function i(t,...e){let n="";for(let r=0;r<e.length;r++)n+=t[r]+String(e[r]);return n+t[t.length-1]}function o(t){return t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}function s(t,e,n){Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0,enumerable:!0})}n.d(e,"b",(function(){return r})),n.d(e,"d",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return s}))}).call(this,n(3))},function(t,e,n){"use strict";(function(t){function r(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:Function("return this")()}n.d(e,"a",(function(){return r}))}).call(this,n(3))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(t){function r(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:Function("return this")()}n.d(e,"a",(function(){return r}))}).call(this,n(3))},function(module,__webpack_exports__,__webpack_require__){"use strict";var _utils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_unused_webpack_default_export=newless,supportsSpread=isSyntaxSupported("Object(...[{}])"),supportsClass=isSyntaxSupported("class Test {}"),supportsNewTarget=isSyntaxSupported("new.target"),TRUE_CONSTRUCTOR=Symbol?Symbol("trueConstructor"):"__newlessTrueConstructor__",setPrototype=Object.setPrototypeOf||function(t,e){t.__proto__=e},construct=Reflect&&Reflect.construct||function(){if(supportsClass)return Function("constructor, args, target",`\n                'use strict';\n\n                if (arguments.length === 3 && typeof target !== 'function')\n                    throw new TypeError(target + ' is not a constructor');\n\n                target = target || constructor;\n\n                // extend target so the right prototype is constructed (or nearly the\n                // right one; ideally we'd do instantiator.prototype = target.prototype,\n                // but a class's prototype property is not writable)\n                class instantiator extends target {};\n                // but ensure the *logic* is 'constructor' for ES2015-compliant engines\n                Object.setPrototypeOf(instantiator, constructor);\n                // ...and for Safari 9\n                instantiator.prototype.constructor = constructor;\n\n                // The spread operator is *dramatically faster, so use it if we can:\n                // http://jsperf.com/new-via-spread-vs-dynamic-function/4\n                ${supportsSpread?"\n\n                    var value = new instantiator(...([].slice.call(args)));\n\n                ":"\n\n                    // otherwise, create a dynamic function in order to use 'new'\n                    // Note using 'function.bind' would be simpler, but is much slower:\n                    // http://jsperf.com/new-operator-with-dynamic-function-vs-bind\n                    var argList = '';\n                    for (var i = 0, len = args.length; i < len; i++) {\n                    if (i > 0) argList += ',';\n                    argList += 'args[' + i + ']';\n                    }\n                    var constructCall = Function('constructor, args',\n                    'return new constructor( ' + argList + ' );'\n                    );\n                    var value = constructCall(constructor, args);\n\n                    args = Array.prototype.slice.call(args);\n                    args = [null].concat(args);\n                    var value = new constructor.bind.apply(constructor, args);\n\n                "}\n\n                // fix up the prototype so it matches the intended one, not one who's\n                // prototype is the intended one :P\n                Object.setPrototypeOf(value, target.prototype);\n                return value;\n            `);var t=function(){};return function(e,n,r){if(3===arguments.length&&"function"!=typeof r)throw new TypeError(r+" is not a constructor");t.prototype=(r||e).prototype;var i=new t,o=e.apply(i,n);return"object"==typeof o&&o?(o.__proto__=(r||e).prototype,o):i}}(),SKIP_PROPERTIES=["arguments","caller","length","name","prototype"];function copyProperties(t,e){if(Object.getOwnPropertyNames&&Object.defineProperty){var n=Object.getOwnPropertyNames(t);Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t)));for(var r=n.length-1;r>=0;r--)-1===SKIP_PROPERTIES.indexOf(n[r])&&Object.defineProperty(e,n[r],Object.getOwnPropertyDescriptor(t,n[r]))}else for(var i in t)e[i]=t[i]}function newless(constructor){var name=constructor.name,usesClassSyntax="class"===constructor.toString().substr(0,5),requiresNew=!!usesClassSyntax||null,newlessConstructor=(()=>function(){if(!requiresNew&&this instanceof newlessConstructor){if(!1===requiresNew){const t=constructor.apply(this,arguments);return"object"==typeof t&&t||this}try{requiresNew=!1;const t=constructor.apply(this,arguments);return"object"==typeof t&&t||this}catch(t){if(!(t instanceof TypeError&&(/class constructor/i.test(t.message)||/use the 'new' operator/i.test(t.message))))throw/Illegal constructor/i.test(t.message)&&Object.create(constructor.prototype)instanceof Node&&console.error(`The following error can happen if a Custom Element is called\nwith 'new' before being defined. The constructor was ${constructor.name}: `,constructor),t;requiresNew=!0}}var newTarget,hasNewTarget=!1;supportsNewTarget&&(eval("newTarget = new.target"),newTarget&&(hasNewTarget=!0)),supportsNewTarget&&hasNewTarget||(newTarget=this instanceof newlessConstructor?this.constructor:constructor);const returnValue=construct(constructor,arguments,newTarget);return this instanceof newlessConstructor&&setPrototype(this,returnValue),returnValue})();if(name){const t=Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.d)(newlessConstructor);newlessConstructor=Function("constructor, construct, setPrototype, requiresNew, supportsNewTarget",`\n      var newlessConstructor = function ${name}() { ${t} };\n      return newlessConstructor\n    `)(constructor,construct,setPrototype,requiresNew,supportsNewTarget)}return constructor.length&&Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__.k)(newlessConstructor,"length",{value:constructor.length}),newlessConstructor.prototype=Object.create(constructor.prototype),newlessConstructor.prototype.constructor=newlessConstructor,constructor.prototype.constructor=constructor,newlessConstructor[TRUE_CONSTRUCTOR]=constructor,copyProperties(constructor,newlessConstructor),setPrototype(newlessConstructor,constructor),newlessConstructor}function isSyntaxSupported(t,e=!0){try{return!!Function("",(e?"'use strict';":"")+t)}catch(t){return!1}}},function(t,e,n){"use strict";(function(t){var n=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var n=-1;return t.some((function(t,r){return t[0]===e&&(n=r,!0)})),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var n=t(this.__entries__,e),r=this.__entries__[n];return r&&r[1]},e.prototype.set=function(e,n){var r=t(this.__entries__,e);~r?this.__entries__[r][1]=n:this.__entries__.push([e,n])},e.prototype.delete=function(e){var n=this.__entries__,r=t(n,e);~r&&n.splice(r,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var n=0,r=this.__entries__;n<r.length;n++){var i=r[n];t.call(e,i[1],i[0])}},e}()}(),r="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,i=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),o="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(i):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var s=["top","right","bottom","left","width","height","size","weight"],a="undefined"!=typeof MutationObserver,c=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var n=!1,r=!1,i=0;function s(){n&&(n=!1,t()),r&&c()}function a(){o(s)}function c(){var t=Date.now();if(n){if(t-i<2)return;r=!0}else n=!0,r=!1,setTimeout(a,e);i=t}return c}(this.refresh.bind(this),20)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){r&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),a?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){r&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,n=void 0===e?"":e;s.some((function(t){return!!~n.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),l=function(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];Object.defineProperty(t,i,{value:e[i],enumerable:!1,writable:!1,configurable:!0})}return t},u=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||i},h=v(0,0,0,0);function d(t){return parseFloat(t)||0}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.reduce((function(e,n){return e+d(t["border-"+n+"-width"])}),0)}function f(t){var e=t.clientWidth,n=t.clientHeight;if(!e&&!n)return h;var r=u(t).getComputedStyle(t),i=function(t){for(var e={},n=0,r=["top","right","bottom","left"];n<r.length;n++){var i=r[n],o=t["padding-"+i];e[i]=d(o)}return e}(r),o=i.left+i.right,s=i.top+i.bottom,a=d(r.width),c=d(r.height);if("border-box"===r.boxSizing&&(Math.round(a+o)!==e&&(a-=p(r,"left","right")+o),Math.round(c+s)!==n&&(c-=p(r,"top","bottom")+s)),!function(t){return t===u(t).document.documentElement}(t)){var l=Math.round(a+o)-e,f=Math.round(c+s)-n;1!==Math.abs(l)&&(a-=l),1!==Math.abs(f)&&(c-=f)}return v(i.left,i.top,a,c)}var m="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof u(t).SVGGraphicsElement}:function(t){return t instanceof u(t).SVGElement&&"function"==typeof t.getBBox};function g(t){return r?m(t)?function(t){var e=t.getBBox();return v(0,0,e.width,e.height)}(t):f(t):h}function v(t,e,n,r){return{x:t,y:e,width:n,height:r}}var y=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=g(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),b=function(t,e){var n,r,i,o,s,a,c,u=(r=(n=e).x,i=n.y,o=n.width,s=n.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,c=Object.create(a.prototype),l(c,{x:r,y:i,width:o,height:s,top:i,right:r+o,bottom:s+i,left:r}),c);l(this,{target:t,contentRect:u})},x=function(){function t(t,e,r){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=r}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof u(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new y(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof u(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new b(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),_="undefined"!=typeof WeakMap?new WeakMap:new n,w=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=c.getInstance(),r=new x(e,n,this);_.set(this,r)};["observe","unobserve","disconnect"].forEach((function(t){w.prototype[t]=function(){var e;return(e=_.get(this))[t].apply(e,arguments)}}));var M=void 0!==i.ResizeObserver?i.ResizeObserver:w;e.a=M}).call(this,n(3))},function(t,e,n){"use strict";n.r(e),n.d(e,"Class",(function(){return M})),n.d(e,"Mixin",(function(){return V})),n.d(e,"Eventful",(function(){return Y})),n.d(e,"emits",(function(){return J})),n.d(e,"Element",(function(){return Br})),n.d(e,"variable",(function(){return Yr})),n.d(e,"autorun",(function(){return Zr})),n.d(e,"reactive",(function(){return Jr})),n.d(e,"_trackReactiveProperty",(function(){return $r})),n.d(e,"reactify",(function(){return ei})),n.d(e,"untrack",(function(){return ri})),n.d(e,"circular",(function(){return ii})),n.d(e,"attribute",(function(){return oi})),n.d(e,"_attribute",(function(){return si})),n.d(e,"stringAttribute",(function(){return ai})),n.d(e,"numberAttribute",(function(){return ci})),n.d(e,"booleanAttribute",(function(){return li})),n.d(e,"element",(function(){return ui})),n.d(e,"css",(function(){return hi})),n.d(e,"Aliases",(function(){return Jn})),n.d(e,"Properties",(function(){return $n})),n.d(e,"ChildProperties",(function(){return Kn})),n.d(e,"DelegatedEvents",(function(){return Qn})),n.d(e,"SVGElements",(function(){return tr})),n.d(e,"SVGNamespace",(function(){return er})),n.d(e,"render",(function(){return nr})),n.d(e,"template",(function(){return rr})),n.d(e,"effect",(function(){return ir})),n.d(e,"memo",(function(){return or})),n.d(e,"insert",(function(){return sr})),n.d(e,"createComponent",(function(){return ar})),n.d(e,"delegateEvents",(function(){return cr})),n.d(e,"clearDelegatedEvents",(function(){return lr})),n.d(e,"spread",(function(){return ur})),n.d(e,"assign",(function(){return hr})),n.d(e,"setAttribute",(function(){return dr})),n.d(e,"setAttributeNS",(function(){return pr})),n.d(e,"addEventListener",(function(){return fr})),n.d(e,"classList",(function(){return mr})),n.d(e,"style",(function(){return gr})),n.d(e,"getOwner",(function(){return vr})),n.d(e,"dynamicProperty",(function(){return yr})),n.d(e,"hydrate",(function(){return br})),n.d(e,"gatherHydratable",(function(){return xr})),n.d(e,"getHydrationKey",(function(){return _r})),n.d(e,"getNextElement",(function(){return wr})),n.d(e,"getNextMarker",(function(){return Mr})),n.d(e,"For",(function(){return Er})),n.d(e,"Show",(function(){return Sr})),n.d(e,"Suspense",(function(){return Tr})),n.d(e,"SuspenseList",(function(){return Ar})),n.d(e,"Switch",(function(){return Rr})),n.d(e,"Match",(function(){return Lr})),n.d(e,"Index",(function(){return Cr})),n.d(e,"ErrorBoundary",(function(){return Pr})),n.d(e,"mergeProps",(function(){return Or})),n.d(e,"isServer",(function(){return Nr})),n.d(e,"Portal",(function(){return Ir})),n.d(e,"Dynamic",(function(){return Dr})),n.d(e,"html",(function(){return Di})),n.d(e,"Behavior",(function(){return _o})),n.d(e,"RenderableBehavior",(function(){return vd})),n.d(e,"MeshBehavior",(function(){return Af})),n.d(e,"ForwardProps",(function(){return Ki})),n.d(e,"DefaultBehaviors",(function(){return Ss})),n.d(e,"BoxGeometryBehavior",(function(){return Lf})),n.d(e,"MixedPlaneGeometryBehavior",(function(){return Cf})),n.d(e,"GeometryBehavior",(function(){return Rf})),n.d(e,"PlyGeometryBehavior",(function(){return cE})),n.d(e,"PlaneGeometryBehavior",(function(){return hE})),n.d(e,"RoundedRectangleGeometryBehavior",(function(){return yS})),n.d(e,"SphereGeometryBehavior",(function(){return wS})),n.d(e,"BasicMaterialBehavior",(function(){return VS})),n.d(e,"MixedPlaneMaterialBehavior",(function(){return WS})),n.d(e,"MaterialBehavior",(function(){return RS})),n.d(e,"MaterialTexture",(function(){return jS})),n.d(e,"PhongMaterialBehavior",(function(){return qS})),n.d(e,"LambertMaterialBehavior",(function(){return YS})),n.d(e,"PointsMaterialBehavior",(function(){return $S})),n.d(e,"ShaderMaterialBehavior",(function(){return lT})),n.d(e,"ColladaModelBehavior",(function(){return MT})),n.d(e,"FbxModelBehavior",(function(){return _A})),n.d(e,"GltfModelBehavior",(function(){return FA})),n.d(e,"ObjModelBehavior",(function(){return $A})),n.d(e,"CameraRig",(function(){return vR})),n.d(e,"PerspectiveCamera",(function(){return AR})),n.d(e,"DeclarativeBase",(function(){return Rs})),n.d(e,"ElementOperations",(function(){return Ia})),n.d(e,"EventTypes",(function(){return wo})),n.d(e,"Events",(function(){return Mo})),n.d(e,"makeEnumFromClassProperties",(function(){return Eo})),n.d(e,"HtmlNode",(function(){return pd})),n.d(e,"HtmlScene",(function(){return RR})),n.d(e,"ImperativeBase",(function(){return dd})),n.d(e,"Motor",(function(){return $s})),n.d(e,"Node",(function(){return gd})),n.d(e,"Object3DWithPivot",(function(){return Da})),n.d(e,"possiblyPolyfillResizeObserver",(function(){return PR})),n.d(e,"Scene",(function(){return eO})),n.d(e,"Sizeable",(function(){return pa})),n.d(e,"Transformable",(function(){return Ma})),n.d(e,"TreeNode",(function(){return Os})),n.d(e,"WithChildren",(function(){return Ms})),n.d(e,"epsilon",(function(){return Qi})),n.d(e,"observeChildren",(function(){return to})),n.d(e,"createChildObserver",(function(){return eo})),n.d(e,"documentBody",(function(){return no})),n.d(e,"toRadians",(function(){return ro})),n.d(e,"defer",(function(){return io})),n.d(e,"thro",(function(){return oo})),n.d(e,"trim",(function(){return so})),n.d(e,"dashCase",(function(){return ao})),n.d(e,"empty",(function(){return co})),n.d(e,"unique",(function(){return lo})),n.d(e,"pick",(function(){return uo})),n.d(e,"identity",(function(){return ho})),n.d(e,"FlickeringOrb",(function(){return iO})),n.d(e,"FlickeringOrbs",(function(){return aO})),n.d(e,"LoadingIcon",(function(){return uO})),n.d(e,"FlingRotation",(function(){return sR})),n.d(e,"ScrollFling",(function(){return fR})),n.d(e,"AutoLayout",(function(){return oN})),n.d(e,"AutoLayoutNode",(function(){return uN})),n.d(e,"CubeLayout",(function(){return hN})),n.d(e,"PushPaneLayout",(function(){return dN})),n.d(e,"AmbientLight",(function(){return yN})),n.d(e,"Light",(function(){return gN})),n.d(e,"PointLight",(function(){return EN})),n.d(e,"DirectionalLight",(function(){return LN})),n.d(e,"clamp",(function(){return KA})),n.d(e,"Box",(function(){return CN})),n.d(e,"MixedPlane",(function(){return PN})),n.d(e,"Mesh",(function(){return cf})),n.d(e,"Plane",(function(){return ON})),n.d(e,"Points",(function(){return xf})),n.d(e,"RoundedRectangle",(function(){return NN})),n.d(e,"Sphere",(function(){return IN})),n.d(e,"ColladaModel",(function(){return DN})),n.d(e,"FbxModel",(function(){return UN})),n.d(e,"GltfModel",(function(){return BN})),n.d(e,"ObjModel",(function(){return kN})),n.d(e,"Css3dRendererThree",(function(){return NP})),n.d(e,"releaseCSS3DRendererThree",(function(){return IP})),n.d(e,"WebglRendererThree",(function(){return RP})),n.d(e,"releaseWebGLRendererThree",(function(){return LP})),n.d(e,"getGlobal",(function(){return CR.a})),n.d(e,"Settable",(function(){return ed})),n.d(e,"isRenderItem",(function(){return Sh})),n.d(e,"disposeMaterial",(function(){return Th})),n.d(e,"disposeObject",(function(){return Ah})),n.d(e,"disposeObjectTree",(function(){return Rh})),n.d(e,"quaternionApproximateEquals",(function(){return Lh})),n.d(e,"applyMaterial",(function(){return Ch})),n.d(e,"setRandomColorPhongMaterial",(function(){return Ph})),n.d(e,"setColorPhongMaterial",(function(){return Oh})),n.d(e,"isPerspectiveCamera",(function(){return Nh})),n.d(e,"isOrthographicCamera",(function(){return Ih})),n.d(e,"isDisposable",(function(){return Dh})),n.d(e,"XYZAnyValues",(function(){return zN})),n.d(e,"XYZNonNegativeValues",(function(){return Ds})),n.d(e,"XYZNumberValues",(function(){return xs})),n.d(e,"XYZSizeModeValues",(function(){return Is})),n.d(e,"XYZStringValues",(function(){return Ns})),n.d(e,"XYZValues",(function(){return bs})),n.d(e,"defineElements",(function(){return HN})),n.d(e,"useDefaultNames",(function(){return GN})),n.d(e,"THREE",(function(){return FB})),n.d(e,"version",(function(){return UB}));var r={};n.r(r),n.d(r,"$RAW",(function(){return de})),n.d(r,"ErrorBoundary",(function(){return qe})),n.d(r,"For",(function(){return He})),n.d(r,"Index",(function(){return Ge})),n.d(r,"Match",(function(){return We})),n.d(r,"Show",(function(){return je})),n.d(r,"Suspense",(function(){return Ze})),n.d(r,"SuspenseList",(function(){return Ye})),n.d(r,"Switch",(function(){return Ve})),n.d(r,"awaitSuspense",(function(){return Je})),n.d(r,"batch",(function(){return Dt})),n.d(r,"cancelCallback",(function(){return at})),n.d(r,"children",(function(){return Yt})),n.d(r,"createComponent",(function(){return De})),n.d(r,"createComputed",(function(){return Lt})),n.d(r,"createContext",(function(){return qt})),n.d(r,"createDeferred",(function(){return Nt})),n.d(r,"createEffect",(function(){return Pt})),n.d(r,"createMemo",(function(){return Ot})),n.d(r,"createMutable",(function(){return Re})),n.d(r,"createRenderEffect",(function(){return Ct})),n.d(r,"createResource",(function(){return Jt})),n.d(r,"createRoot",(function(){return At})),n.d(r,"createSelector",(function(){return It})),n.d(r,"createSignal",(function(){return Rt})),n.d(r,"createState",(function(){return Se})),n.d(r,"equalFn",(function(){return ht})),n.d(r,"getListener",(function(){return Gt})),n.d(r,"getOwner",(function(){return jt})),n.d(r,"indexArray",(function(){return Ie})),n.d(r,"lazy",(function(){return ze})),n.d(r,"mapArray",(function(){return Ne})),n.d(r,"mergeProps",(function(){return Be})),n.d(r,"on",(function(){return Bt})),n.d(r,"onCleanup",(function(){return zt})),n.d(r,"onError",(function(){return Ht})),n.d(r,"onMount",(function(){return kt})),n.d(r,"produce",(function(){return Pe})),n.d(r,"reconcile",(function(){return Le})),n.d(r,"requestCallback",(function(){return st})),n.d(r,"runWithOwner",(function(){return Vt})),n.d(r,"serializeGraph",(function(){return Wt})),n.d(r,"sharedConfig",(function(){return lt})),n.d(r,"splitProps",(function(){return ke})),n.d(r,"untrack",(function(){return Ut})),n.d(r,"unwrap",(function(){return ye})),n.d(r,"useContext",(function(){return Xt})),n.d(r,"useTransition",(function(){return Ft}));var i={};n.r(i),n.d(i,"ErrorBoundary",(function(){return qe})),n.d(i,"For",(function(){return He})),n.d(i,"Index",(function(){return Ge})),n.d(i,"Match",(function(){return We})),n.d(i,"Show",(function(){return je})),n.d(i,"Suspense",(function(){return Ze})),n.d(i,"SuspenseList",(function(){return Ye})),n.d(i,"Switch",(function(){return Ve})),n.d(i,"createComponent",(function(){return De})),n.d(i,"effect",(function(){return Ct})),n.d(i,"getOwner",(function(){return jt})),n.d(i,"mergeProps",(function(){return Be})),n.d(i,"Aliases",(function(){return Qe})),n.d(i,"ChildProperties",(function(){return Ke})),n.d(i,"DelegatedEvents",(function(){return tn})),n.d(i,"Dynamic",(function(){return Wn})),n.d(i,"Portal",(function(){return Vn})),n.d(i,"Properties",(function(){return $e})),n.d(i,"SVGElements",(function(){return en})),n.d(i,"SVGNamespace",(function(){return nn})),n.d(i,"addEventListener",(function(){return pn})),n.d(i,"assign",(function(){return bn})),n.d(i,"classList",(function(){return fn})),n.d(i,"clearDelegatedEvents",(function(){return un})),n.d(i,"delegateEvents",(function(){return ln})),n.d(i,"dynamicProperty",(function(){return vn})),n.d(i,"escape",(function(){return Hn})),n.d(i,"gatherHydratable",(function(){return _n})),n.d(i,"getHydrationKey",(function(){return Cn})),n.d(i,"getNextElement",(function(){return wn})),n.d(i,"getNextMarker",(function(){return Mn})),n.d(i,"hydrate",(function(){return xn})),n.d(i,"insert",(function(){return yn})),n.d(i,"isServer",(function(){return Gn})),n.d(i,"memo",(function(){return rn})),n.d(i,"render",(function(){return an})),n.d(i,"renderToNodeStream",(function(){return Nn})),n.d(i,"renderToString",(function(){return Pn})),n.d(i,"renderToStringAsync",(function(){return On})),n.d(i,"renderToWebStream",(function(){return In})),n.d(i,"resolveSSRNode",(function(){return Fn})),n.d(i,"runHydrationEvents",(function(){return En})),n.d(i,"setAttribute",(function(){return hn})),n.d(i,"setAttributeNS",(function(){return dn})),n.d(i,"spread",(function(){return gn})),n.d(i,"ssr",(function(){return Dn})),n.d(i,"ssrBoolean",(function(){return zn})),n.d(i,"ssrClassList",(function(){return Un})),n.d(i,"ssrSpread",(function(){return kn})),n.d(i,"ssrStyle",(function(){return Bn})),n.d(i,"style",(function(){return mn})),n.d(i,"template",(function(){return cn}));var o={};n.r(o),n.d(o,"ArcCurve",(function(){return fE})),n.d(o,"CatmullRomCurve3",(function(){return xE})),n.d(o,"CubicBezierCurve",(function(){return EE})),n.d(o,"CubicBezierCurve3",(function(){return SE})),n.d(o,"EllipseCurve",(function(){return pE})),n.d(o,"LineCurve",(function(){return TE})),n.d(o,"LineCurve3",(function(){return AE})),n.d(o,"QuadraticBezierCurve",(function(){return RE})),n.d(o,"QuadraticBezierCurve3",(function(){return LE})),n.d(o,"SplineCurve",(function(){return CE}));var s={};n.r(s),n.d(s,"BoxGeometry",(function(){return fp})),n.d(s,"BoxBufferGeometry",(function(){return pp})),n.d(s,"CircleGeometry",(function(){return VI})),n.d(s,"CircleBufferGeometry",(function(){return jI})),n.d(s,"ConeGeometry",(function(){return XI})),n.d(s,"ConeBufferGeometry",(function(){return YI})),n.d(s,"CylinderGeometry",(function(){return qI})),n.d(s,"CylinderBufferGeometry",(function(){return WI})),n.d(s,"DodecahedronGeometry",(function(){return $I})),n.d(s,"DodecahedronBufferGeometry",(function(){return JI})),n.d(s,"EdgesGeometry",(function(){return nD})),n.d(s,"ExtrudeGeometry",(function(){return uS})),n.d(s,"ExtrudeBufferGeometry",(function(){return cS})),n.d(s,"IcosahedronGeometry",(function(){return iD})),n.d(s,"IcosahedronBufferGeometry",(function(){return rD})),n.d(s,"LatheGeometry",(function(){return sD})),n.d(s,"LatheBufferGeometry",(function(){return oD})),n.d(s,"OctahedronGeometry",(function(){return cD})),n.d(s,"OctahedronBufferGeometry",(function(){return aD})),n.d(s,"ParametricGeometry",(function(){return uD})),n.d(s,"ParametricBufferGeometry",(function(){return lD})),n.d(s,"PlaneGeometry",(function(){return uE})),n.d(s,"PlaneBufferGeometry",(function(){return lE})),n.d(s,"PolyhedronGeometry",(function(){return hD})),n.d(s,"PolyhedronBufferGeometry",(function(){return ZI})),n.d(s,"RingGeometry",(function(){return pD})),n.d(s,"RingBufferGeometry",(function(){return dD})),n.d(s,"ShapeGeometry",(function(){return dS})),n.d(s,"ShapeBufferGeometry",(function(){return hS})),n.d(s,"SphereGeometry",(function(){return _S})),n.d(s,"SphereBufferGeometry",(function(){return xS})),n.d(s,"TetrahedronGeometry",(function(){return mD})),n.d(s,"TetrahedronBufferGeometry",(function(){return fD})),n.d(s,"TextGeometry",(function(){return vD})),n.d(s,"TextBufferGeometry",(function(){return gD})),n.d(s,"TorusGeometry",(function(){return bD})),n.d(s,"TorusBufferGeometry",(function(){return yD})),n.d(s,"TorusKnotGeometry",(function(){return _D})),n.d(s,"TorusKnotBufferGeometry",(function(){return xD})),n.d(s,"TubeGeometry",(function(){return MD})),n.d(s,"TubeBufferGeometry",(function(){return wD})),n.d(s,"WireframeGeometry",(function(){return ED}));var a={};n.r(a),n.d(a,"ShadowMaterial",(function(){return SD})),n.d(a,"SpriteMaterial",(function(){return YN})),n.d(a,"RawShaderMaterial",(function(){return ZC})),n.d(a,"ShaderMaterial",(function(){return rT})),n.d(a,"PointsMaterial",(function(){return lf})),n.d(a,"MeshPhysicalMaterial",(function(){return AD})),n.d(a,"MeshStandardMaterial",(function(){return TD})),n.d(a,"MeshPhongMaterial",(function(){return Eh})),n.d(a,"MeshToonMaterial",(function(){return RD})),n.d(a,"MeshNormalMaterial",(function(){return LD})),n.d(a,"MeshLambertMaterial",(function(){return XS})),n.d(a,"MeshDepthMaterial",(function(){return FC})),n.d(a,"MeshDistanceMaterial",(function(){return UC})),n.d(a,"MeshBasicMaterial",(function(){return Bp})),n.d(a,"MeshMatcapMaterial",(function(){return CD})),n.d(a,"LineDashedMaterial",(function(){return PD})),n.d(a,"LineBasicMaterial",(function(){return RI})),n.d(a,"Material",(function(){return mh}));var c={};n.r(c),n.d(c,"WebGLMultisampleRenderTarget",(function(){return jN})),n.d(c,"WebGLCubeRenderTarget",(function(){return $R})),n.d(c,"WebGLRenderTarget",(function(){return YR})),n.d(c,"WebGLRenderer",(function(){return XC})),n.d(c,"WebGL1Renderer",(function(){return VN})),n.d(c,"ShaderLib",(function(){return GR})),n.d(c,"UniformsLib",(function(){return HR})),n.d(c,"UniformsUtils",(function(){return tT})),n.d(c,"ShaderChunk",(function(){return zR})),n.d(c,"FogExp2",(function(){return NR})),n.d(c,"Fog",(function(){return OR})),n.d(c,"Scene",(function(){return wA})),n.d(c,"Sprite",(function(){return cI})),n.d(c,"LOD",(function(){return dI})),n.d(c,"SkinnedMesh",(function(){return yI})),n.d(c,"Skeleton",(function(){return wI})),n.d(c,"Bone",(function(){return bI})),n.d(c,"Mesh",(function(){return nf})),n.d(c,"InstancedMesh",(function(){return AI})),n.d(c,"LineSegments",(function(){return UI})),n.d(c,"LineLoop",(function(){return BI})),n.d(c,"Line",(function(){return II})),n.d(c,"Points",(function(){return ff})),n.d(c,"Group",(function(){return jC})),n.d(c,"VideoTexture",(function(){return kI})),n.d(c,"DataTexture",(function(){return IR})),n.d(c,"DataTexture2DArray",(function(){return aL})),n.d(c,"DataTexture3D",(function(){return cL})),n.d(c,"CompressedTexture",(function(){return zI})),n.d(c,"CubeTexture",(function(){return JR})),n.d(c,"CanvasTexture",(function(){return HI})),n.d(c,"DepthTexture",(function(){return GI})),n.d(c,"Texture",(function(){return US})),n.d(c,"BoxGeometry",(function(){return fp})),n.d(c,"BoxBufferGeometry",(function(){return pp})),n.d(c,"CircleGeometry",(function(){return VI})),n.d(c,"CircleBufferGeometry",(function(){return jI})),n.d(c,"ConeGeometry",(function(){return XI})),n.d(c,"ConeBufferGeometry",(function(){return YI})),n.d(c,"CylinderGeometry",(function(){return qI})),n.d(c,"CylinderBufferGeometry",(function(){return WI})),n.d(c,"DodecahedronGeometry",(function(){return $I})),n.d(c,"DodecahedronBufferGeometry",(function(){return JI})),n.d(c,"EdgesGeometry",(function(){return nD})),n.d(c,"ExtrudeGeometry",(function(){return uS})),n.d(c,"ExtrudeBufferGeometry",(function(){return cS})),n.d(c,"IcosahedronGeometry",(function(){return iD})),n.d(c,"IcosahedronBufferGeometry",(function(){return rD})),n.d(c,"LatheGeometry",(function(){return sD})),n.d(c,"LatheBufferGeometry",(function(){return oD})),n.d(c,"OctahedronGeometry",(function(){return cD})),n.d(c,"OctahedronBufferGeometry",(function(){return aD})),n.d(c,"ParametricGeometry",(function(){return uD})),n.d(c,"ParametricBufferGeometry",(function(){return lD})),n.d(c,"PlaneGeometry",(function(){return uE})),n.d(c,"PlaneBufferGeometry",(function(){return lE})),n.d(c,"PolyhedronGeometry",(function(){return hD})),n.d(c,"PolyhedronBufferGeometry",(function(){return ZI})),n.d(c,"RingGeometry",(function(){return pD})),n.d(c,"RingBufferGeometry",(function(){return dD})),n.d(c,"ShapeGeometry",(function(){return dS})),n.d(c,"ShapeBufferGeometry",(function(){return hS})),n.d(c,"SphereGeometry",(function(){return _S})),n.d(c,"SphereBufferGeometry",(function(){return xS})),n.d(c,"TetrahedronGeometry",(function(){return mD})),n.d(c,"TetrahedronBufferGeometry",(function(){return fD})),n.d(c,"TextGeometry",(function(){return vD})),n.d(c,"TextBufferGeometry",(function(){return gD})),n.d(c,"TorusGeometry",(function(){return bD})),n.d(c,"TorusBufferGeometry",(function(){return yD})),n.d(c,"TorusKnotGeometry",(function(){return _D})),n.d(c,"TorusKnotBufferGeometry",(function(){return xD})),n.d(c,"TubeGeometry",(function(){return MD})),n.d(c,"TubeBufferGeometry",(function(){return wD})),n.d(c,"WireframeGeometry",(function(){return ED})),n.d(c,"ShadowMaterial",(function(){return SD})),n.d(c,"SpriteMaterial",(function(){return YN})),n.d(c,"RawShaderMaterial",(function(){return ZC})),n.d(c,"ShaderMaterial",(function(){return rT})),n.d(c,"PointsMaterial",(function(){return lf})),n.d(c,"MeshPhysicalMaterial",(function(){return AD})),n.d(c,"MeshStandardMaterial",(function(){return TD})),n.d(c,"MeshPhongMaterial",(function(){return Eh})),n.d(c,"MeshToonMaterial",(function(){return RD})),n.d(c,"MeshNormalMaterial",(function(){return LD})),n.d(c,"MeshLambertMaterial",(function(){return XS})),n.d(c,"MeshDepthMaterial",(function(){return FC})),n.d(c,"MeshDistanceMaterial",(function(){return UC})),n.d(c,"MeshBasicMaterial",(function(){return Bp})),n.d(c,"MeshMatcapMaterial",(function(){return CD})),n.d(c,"LineDashedMaterial",(function(){return PD})),n.d(c,"LineBasicMaterial",(function(){return RI})),n.d(c,"Material",(function(){return mh})),n.d(c,"AnimationLoader",(function(){return ZD})),n.d(c,"CompressedTextureLoader",(function(){return JD})),n.d(c,"CubeTextureLoader",(function(){return $D})),n.d(c,"DataTextureLoader",(function(){return KD})),n.d(c,"TextureLoader",(function(){return kS})),n.d(c,"ObjectLoader",(function(){return uF})),n.d(c,"MaterialLoader",(function(){return oF})),n.d(c,"BufferGeometryLoader",(function(){return lF})),n.d(c,"DefaultLoadingManager",(function(){return PS})),n.d(c,"LoadingManager",(function(){return CS})),n.d(c,"ImageLoader",(function(){return NS})),n.d(c,"ImageBitmapLoader",(function(){return fF})),n.d(c,"FontLoader",(function(){return yF})),n.d(c,"FileLoader",(function(){return YD})),n.d(c,"Loader",(function(){return OS})),n.d(c,"LoaderUtils",(function(){return sF})),n.d(c,"Cache",(function(){return LS})),n.d(c,"AudioLoader",(function(){return _F})),n.d(c,"SpotLight",(function(){return eF})),n.d(c,"PointLight",(function(){return _N})),n.d(c,"RectAreaLight",(function(){return nF})),n.d(c,"HemisphereLight",(function(){return QD})),n.d(c,"HemisphereLightProbe",(function(){return wF})),n.d(c,"DirectionalLight",(function(){return TN})),n.d(c,"AmbientLight",(function(){return vN})),n.d(c,"AmbientLightProbe",(function(){return MF})),n.d(c,"Light",(function(){return pN})),n.d(c,"LightProbe",(function(){return iF})),n.d(c,"StereoCamera",(function(){return TF})),n.d(c,"PerspectiveCamera",(function(){return bR})),n.d(c,"OrthographicCamera",(function(){return YC})),n.d(c,"CubeCamera",(function(){return ZR})),n.d(c,"ArrayCamera",(function(){return GC})),n.d(c,"Camera",(function(){return yR})),n.d(c,"AudioListener",(function(){return NF})),n.d(c,"PositionalAudio",(function(){return kF})),n.d(c,"AudioContext",(function(){return xF})),n.d(c,"AudioAnalyser",(function(){return zF})),n.d(c,"Audio",(function(){return IF})),n.d(c,"VectorKeyframeTrack",(function(){return VD})),n.d(c,"StringKeyframeTrack",(function(){return jD})),n.d(c,"QuaternionKeyframeTrack",(function(){return GD})),n.d(c,"NumberKeyframeTrack",(function(){return zD})),n.d(c,"ColorKeyframeTrack",(function(){return kD})),n.d(c,"BooleanKeyframeTrack",(function(){return BD})),n.d(c,"PropertyMixer",(function(){return HF})),n.d(c,"PropertyBinding",(function(){return $F})),n.d(c,"KeyframeTrack",(function(){return UD})),n.d(c,"AnimationUtils",(function(){return OD})),n.d(c,"AnimationObjectGroup",(function(){return KF})),n.d(c,"AnimationMixer",(function(){return tU})),n.d(c,"AnimationClip",(function(){return WD})),n.d(c,"Uniform",(function(){return eU})),n.d(c,"InstancedBufferGeometry",(function(){return aF})),n.d(c,"BufferGeometry",(function(){return dp})),n.d(c,"Geometry",(function(){return zd})),n.d(c,"InterleavedBufferAttribute",(function(){return XN})),n.d(c,"InstancedInterleavedBuffer",(function(){return nU})),n.d(c,"InterleavedBuffer",(function(){return WN})),n.d(c,"InstancedBufferAttribute",(function(){return cF})),n.d(c,"GLBufferAttribute",(function(){return rU})),n.d(c,"Float64BufferAttribute",(function(){return tp})),n.d(c,"Float32BufferAttribute",(function(){return Qd})),n.d(c,"Float16BufferAttribute",(function(){return Kd})),n.d(c,"Uint32BufferAttribute",(function(){return $d})),n.d(c,"Int32BufferAttribute",(function(){return Jd})),n.d(c,"Uint16BufferAttribute",(function(){return Zd})),n.d(c,"Int16BufferAttribute",(function(){return Yd})),n.d(c,"Uint8ClampedBufferAttribute",(function(){return Xd})),n.d(c,"Uint8BufferAttribute",(function(){return qd})),n.d(c,"Int8BufferAttribute",(function(){return Wd})),n.d(c,"BufferAttribute",(function(){return Vd})),n.d(c,"Face3",(function(){return yd})),n.d(c,"Object3D",(function(){return os})),n.d(c,"Raycaster",(function(){return iU})),n.d(c,"Layers",(function(){return Vo})),n.d(c,"EventDispatcher",(function(){return zo})),n.d(c,"Clock",(function(){return AF})),n.d(c,"QuaternionLinearInterpolant",(function(){return HD})),n.d(c,"LinearInterpolant",(function(){return DD})),n.d(c,"DiscreteInterpolant",(function(){return FD})),n.d(c,"CubicInterpolant",(function(){return ID})),n.d(c,"Interpolant",(function(){return ND})),n.d(c,"Triangle",(function(){return Up})),n.d(c,"MathUtils",(function(){return Ao})),n.d(c,"Spherical",(function(){return aU})),n.d(c,"Cylindrical",(function(){return cU})),n.d(c,"Plane",(function(){return Tp})),n.d(c,"Frustum",(function(){return UR})),n.d(c,"Sphere",(function(){return Dd})),n.d(c,"Ray",(function(){return wp})),n.d(c,"Matrix4",(function(){return Oo})),n.d(c,"Matrix3",(function(){return Wo})),n.d(c,"Box3",(function(){return bd})),n.d(c,"Box2",(function(){return uU})),n.d(c,"Line3",(function(){return pU})),n.d(c,"Euler",(function(){return Ho})),n.d(c,"Vector4",(function(){return Hd})),n.d(c,"Vector3",(function(){return Lo})),n.d(c,"Vector2",(function(){return gh})),n.d(c,"Quaternion",(function(){return Ro})),n.d(c,"Color",(function(){return Mh})),n.d(c,"SphericalHarmonics3",(function(){return rF})),n.d(c,"ImmediateRenderObject",(function(){return fU})),n.d(c,"SpotLightHelper",(function(){return gU})),n.d(c,"SkeletonHelper",(function(){return xU})),n.d(c,"PointLightHelper",(function(){return _U})),n.d(c,"HemisphereLightHelper",(function(){return SU})),n.d(c,"GridHelper",(function(){return TU})),n.d(c,"PolarGridHelper",(function(){return AU})),n.d(c,"DirectionalLightHelper",(function(){return PU})),n.d(c,"CameraHelper",(function(){return IU})),n.d(c,"BoxHelper",(function(){return UU})),n.d(c,"Box3Helper",(function(){return BU})),n.d(c,"PlaneHelper",(function(){return kU})),n.d(c,"ArrowHelper",(function(){return jU})),n.d(c,"AxesHelper",(function(){return VU})),n.d(c,"ArcCurve",(function(){return fE})),n.d(c,"CatmullRomCurve3",(function(){return xE})),n.d(c,"CubicBezierCurve",(function(){return EE})),n.d(c,"CubicBezierCurve3",(function(){return SE})),n.d(c,"EllipseCurve",(function(){return pE})),n.d(c,"LineCurve",(function(){return TE})),n.d(c,"LineCurve3",(function(){return AE})),n.d(c,"QuadraticBezierCurve",(function(){return RE})),n.d(c,"QuadraticBezierCurve3",(function(){return LE})),n.d(c,"SplineCurve",(function(){return CE})),n.d(c,"Shape",(function(){return NE})),n.d(c,"Path",(function(){return OE})),n.d(c,"ShapePath",(function(){return mF})),n.d(c,"Font",(function(){return gF})),n.d(c,"CurvePath",(function(){return PE})),n.d(c,"Curve",(function(){return dE})),n.d(c,"DataUtils",(function(){return XU})),n.d(c,"ImageUtils",(function(){return DS})),n.d(c,"ShapeUtils",(function(){return oS})),n.d(c,"PMREMGenerator",(function(){return lP})),n.d(c,"WebGLUtils",(function(){return HC})),n.d(c,"REVISION",(function(){return Fa})),n.d(c,"MOUSE",(function(){return Ua})),n.d(c,"TOUCH",(function(){return Ba})),n.d(c,"CullFaceNone",(function(){return ka})),n.d(c,"CullFaceBack",(function(){return za})),n.d(c,"CullFaceFront",(function(){return Ha})),n.d(c,"CullFaceFrontBack",(function(){return Ga})),n.d(c,"BasicShadowMap",(function(){return ja})),n.d(c,"PCFShadowMap",(function(){return Va})),n.d(c,"PCFSoftShadowMap",(function(){return Wa})),n.d(c,"VSMShadowMap",(function(){return qa})),n.d(c,"FrontSide",(function(){return Xa})),n.d(c,"BackSide",(function(){return Ya})),n.d(c,"DoubleSide",(function(){return Za})),n.d(c,"FlatShading",(function(){return Ja})),n.d(c,"SmoothShading",(function(){return $a})),n.d(c,"NoBlending",(function(){return Ka})),n.d(c,"NormalBlending",(function(){return Qa})),n.d(c,"AdditiveBlending",(function(){return tc})),n.d(c,"SubtractiveBlending",(function(){return ec})),n.d(c,"MultiplyBlending",(function(){return nc})),n.d(c,"CustomBlending",(function(){return rc})),n.d(c,"AddEquation",(function(){return ic})),n.d(c,"SubtractEquation",(function(){return oc})),n.d(c,"ReverseSubtractEquation",(function(){return sc})),n.d(c,"MinEquation",(function(){return ac})),n.d(c,"MaxEquation",(function(){return cc})),n.d(c,"ZeroFactor",(function(){return lc})),n.d(c,"OneFactor",(function(){return uc})),n.d(c,"SrcColorFactor",(function(){return hc})),n.d(c,"OneMinusSrcColorFactor",(function(){return dc})),n.d(c,"SrcAlphaFactor",(function(){return pc})),n.d(c,"OneMinusSrcAlphaFactor",(function(){return fc})),n.d(c,"DstAlphaFactor",(function(){return mc})),n.d(c,"OneMinusDstAlphaFactor",(function(){return gc})),n.d(c,"DstColorFactor",(function(){return vc})),n.d(c,"OneMinusDstColorFactor",(function(){return yc})),n.d(c,"SrcAlphaSaturateFactor",(function(){return bc})),n.d(c,"NeverDepth",(function(){return xc})),n.d(c,"AlwaysDepth",(function(){return _c})),n.d(c,"LessDepth",(function(){return wc})),n.d(c,"LessEqualDepth",(function(){return Mc})),n.d(c,"EqualDepth",(function(){return Ec})),n.d(c,"GreaterEqualDepth",(function(){return Sc})),n.d(c,"GreaterDepth",(function(){return Tc})),n.d(c,"NotEqualDepth",(function(){return Ac})),n.d(c,"MultiplyOperation",(function(){return Rc})),n.d(c,"MixOperation",(function(){return Lc})),n.d(c,"AddOperation",(function(){return Cc})),n.d(c,"NoToneMapping",(function(){return Pc})),n.d(c,"LinearToneMapping",(function(){return Oc})),n.d(c,"ReinhardToneMapping",(function(){return Nc})),n.d(c,"CineonToneMapping",(function(){return Ic})),n.d(c,"ACESFilmicToneMapping",(function(){return Dc})),n.d(c,"CustomToneMapping",(function(){return Fc})),n.d(c,"UVMapping",(function(){return Uc})),n.d(c,"CubeReflectionMapping",(function(){return Bc})),n.d(c,"CubeRefractionMapping",(function(){return kc})),n.d(c,"EquirectangularReflectionMapping",(function(){return zc})),n.d(c,"EquirectangularRefractionMapping",(function(){return Hc})),n.d(c,"CubeUVReflectionMapping",(function(){return Gc})),n.d(c,"CubeUVRefractionMapping",(function(){return jc})),n.d(c,"RepeatWrapping",(function(){return Vc})),n.d(c,"ClampToEdgeWrapping",(function(){return Wc})),n.d(c,"MirroredRepeatWrapping",(function(){return qc})),n.d(c,"NearestFilter",(function(){return Xc})),n.d(c,"NearestMipmapNearestFilter",(function(){return Yc})),n.d(c,"NearestMipMapNearestFilter",(function(){return Zc})),n.d(c,"NearestMipmapLinearFilter",(function(){return Jc})),n.d(c,"NearestMipMapLinearFilter",(function(){return $c})),n.d(c,"LinearFilter",(function(){return Kc})),n.d(c,"LinearMipmapNearestFilter",(function(){return Qc})),n.d(c,"LinearMipMapNearestFilter",(function(){return tl})),n.d(c,"LinearMipmapLinearFilter",(function(){return el})),n.d(c,"LinearMipMapLinearFilter",(function(){return nl})),n.d(c,"UnsignedByteType",(function(){return rl})),n.d(c,"ByteType",(function(){return il})),n.d(c,"ShortType",(function(){return ol})),n.d(c,"UnsignedShortType",(function(){return sl})),n.d(c,"IntType",(function(){return al})),n.d(c,"UnsignedIntType",(function(){return cl})),n.d(c,"FloatType",(function(){return ll})),n.d(c,"HalfFloatType",(function(){return ul})),n.d(c,"UnsignedShort4444Type",(function(){return hl})),n.d(c,"UnsignedShort5551Type",(function(){return dl})),n.d(c,"UnsignedShort565Type",(function(){return pl})),n.d(c,"UnsignedInt248Type",(function(){return fl})),n.d(c,"AlphaFormat",(function(){return ml})),n.d(c,"RGBFormat",(function(){return gl})),n.d(c,"RGBAFormat",(function(){return vl})),n.d(c,"LuminanceFormat",(function(){return yl})),n.d(c,"LuminanceAlphaFormat",(function(){return bl})),n.d(c,"RGBEFormat",(function(){return xl})),n.d(c,"DepthFormat",(function(){return _l})),n.d(c,"DepthStencilFormat",(function(){return wl})),n.d(c,"RedFormat",(function(){return Ml})),n.d(c,"RedIntegerFormat",(function(){return El})),n.d(c,"RGFormat",(function(){return Sl})),n.d(c,"RGIntegerFormat",(function(){return Tl})),n.d(c,"RGBIntegerFormat",(function(){return Al})),n.d(c,"RGBAIntegerFormat",(function(){return Rl})),n.d(c,"RGB_S3TC_DXT1_Format",(function(){return Ll})),n.d(c,"RGBA_S3TC_DXT1_Format",(function(){return Cl})),n.d(c,"RGBA_S3TC_DXT3_Format",(function(){return Pl})),n.d(c,"RGBA_S3TC_DXT5_Format",(function(){return Ol})),n.d(c,"RGB_PVRTC_4BPPV1_Format",(function(){return Nl})),n.d(c,"RGB_PVRTC_2BPPV1_Format",(function(){return Il})),n.d(c,"RGBA_PVRTC_4BPPV1_Format",(function(){return Dl})),n.d(c,"RGBA_PVRTC_2BPPV1_Format",(function(){return Fl})),n.d(c,"RGB_ETC1_Format",(function(){return Ul})),n.d(c,"RGB_ETC2_Format",(function(){return Bl})),n.d(c,"RGBA_ETC2_EAC_Format",(function(){return kl})),n.d(c,"RGBA_ASTC_4x4_Format",(function(){return zl})),n.d(c,"RGBA_ASTC_5x4_Format",(function(){return Hl})),n.d(c,"RGBA_ASTC_5x5_Format",(function(){return Gl})),n.d(c,"RGBA_ASTC_6x5_Format",(function(){return jl})),n.d(c,"RGBA_ASTC_6x6_Format",(function(){return Vl})),n.d(c,"RGBA_ASTC_8x5_Format",(function(){return Wl})),n.d(c,"RGBA_ASTC_8x6_Format",(function(){return ql})),n.d(c,"RGBA_ASTC_8x8_Format",(function(){return Xl})),n.d(c,"RGBA_ASTC_10x5_Format",(function(){return Yl})),n.d(c,"RGBA_ASTC_10x6_Format",(function(){return Zl})),n.d(c,"RGBA_ASTC_10x8_Format",(function(){return Jl})),n.d(c,"RGBA_ASTC_10x10_Format",(function(){return $l})),n.d(c,"RGBA_ASTC_12x10_Format",(function(){return Kl})),n.d(c,"RGBA_ASTC_12x12_Format",(function(){return Ql})),n.d(c,"RGBA_BPTC_Format",(function(){return tu})),n.d(c,"SRGB8_ALPHA8_ASTC_4x4_Format",(function(){return eu})),n.d(c,"SRGB8_ALPHA8_ASTC_5x4_Format",(function(){return nu})),n.d(c,"SRGB8_ALPHA8_ASTC_5x5_Format",(function(){return ru})),n.d(c,"SRGB8_ALPHA8_ASTC_6x5_Format",(function(){return iu})),n.d(c,"SRGB8_ALPHA8_ASTC_6x6_Format",(function(){return ou})),n.d(c,"SRGB8_ALPHA8_ASTC_8x5_Format",(function(){return su})),n.d(c,"SRGB8_ALPHA8_ASTC_8x6_Format",(function(){return au})),n.d(c,"SRGB8_ALPHA8_ASTC_8x8_Format",(function(){return cu})),n.d(c,"SRGB8_ALPHA8_ASTC_10x5_Format",(function(){return lu})),n.d(c,"SRGB8_ALPHA8_ASTC_10x6_Format",(function(){return uu})),n.d(c,"SRGB8_ALPHA8_ASTC_10x8_Format",(function(){return hu})),n.d(c,"SRGB8_ALPHA8_ASTC_10x10_Format",(function(){return du})),n.d(c,"SRGB8_ALPHA8_ASTC_12x10_Format",(function(){return pu})),n.d(c,"SRGB8_ALPHA8_ASTC_12x12_Format",(function(){return fu})),n.d(c,"LoopOnce",(function(){return mu})),n.d(c,"LoopRepeat",(function(){return gu})),n.d(c,"LoopPingPong",(function(){return vu})),n.d(c,"InterpolateDiscrete",(function(){return yu})),n.d(c,"InterpolateLinear",(function(){return bu})),n.d(c,"InterpolateSmooth",(function(){return xu})),n.d(c,"ZeroCurvatureEnding",(function(){return _u})),n.d(c,"ZeroSlopeEnding",(function(){return wu})),n.d(c,"WrapAroundEnding",(function(){return Mu})),n.d(c,"NormalAnimationBlendMode",(function(){return Eu})),n.d(c,"AdditiveAnimationBlendMode",(function(){return Su})),n.d(c,"TrianglesDrawMode",(function(){return Tu})),n.d(c,"TriangleStripDrawMode",(function(){return Au})),n.d(c,"TriangleFanDrawMode",(function(){return Ru})),n.d(c,"LinearEncoding",(function(){return Lu})),n.d(c,"sRGBEncoding",(function(){return Cu})),n.d(c,"GammaEncoding",(function(){return Pu})),n.d(c,"RGBEEncoding",(function(){return Ou})),n.d(c,"LogLuvEncoding",(function(){return Nu})),n.d(c,"RGBM7Encoding",(function(){return Iu})),n.d(c,"RGBM16Encoding",(function(){return Du})),n.d(c,"RGBDEncoding",(function(){return Fu})),n.d(c,"BasicDepthPacking",(function(){return Uu})),n.d(c,"RGBADepthPacking",(function(){return Bu})),n.d(c,"TangentSpaceNormalMap",(function(){return ku})),n.d(c,"ObjectSpaceNormalMap",(function(){return zu})),n.d(c,"ZeroStencilOp",(function(){return Hu})),n.d(c,"KeepStencilOp",(function(){return Gu})),n.d(c,"ReplaceStencilOp",(function(){return ju})),n.d(c,"IncrementStencilOp",(function(){return Vu})),n.d(c,"DecrementStencilOp",(function(){return Wu})),n.d(c,"IncrementWrapStencilOp",(function(){return qu})),n.d(c,"DecrementWrapStencilOp",(function(){return Xu})),n.d(c,"InvertStencilOp",(function(){return Yu})),n.d(c,"NeverStencilFunc",(function(){return Zu})),n.d(c,"LessStencilFunc",(function(){return Ju})),n.d(c,"EqualStencilFunc",(function(){return $u})),n.d(c,"LessEqualStencilFunc",(function(){return Ku})),n.d(c,"GreaterStencilFunc",(function(){return Qu})),n.d(c,"NotEqualStencilFunc",(function(){return th})),n.d(c,"GreaterEqualStencilFunc",(function(){return eh})),n.d(c,"AlwaysStencilFunc",(function(){return nh})),n.d(c,"StaticDrawUsage",(function(){return rh})),n.d(c,"DynamicDrawUsage",(function(){return ih})),n.d(c,"StreamDrawUsage",(function(){return oh})),n.d(c,"StaticReadUsage",(function(){return sh})),n.d(c,"DynamicReadUsage",(function(){return ah})),n.d(c,"StreamReadUsage",(function(){return ch})),n.d(c,"StaticCopyUsage",(function(){return lh})),n.d(c,"DynamicCopyUsage",(function(){return uh})),n.d(c,"StreamCopyUsage",(function(){return hh})),n.d(c,"GLSL1",(function(){return dh})),n.d(c,"GLSL3",(function(){return ph})),n.d(c,"CubeGeometry",(function(){return fp})),n.d(c,"Math",(function(){return Ao})),n.d(c,"Face4",(function(){return YU})),n.d(c,"LineStrip",(function(){return ZU})),n.d(c,"LinePieces",(function(){return JU})),n.d(c,"NoColors",(function(){return $U})),n.d(c,"FaceColors",(function(){return KU})),n.d(c,"VertexColors",(function(){return QU})),n.d(c,"MeshFaceMaterial",(function(){return tB})),n.d(c,"MultiMaterial",(function(){return eB})),n.d(c,"PointCloud",(function(){return nB})),n.d(c,"Particle",(function(){return rB})),n.d(c,"ParticleSystem",(function(){return iB})),n.d(c,"PointCloudMaterial",(function(){return oB})),n.d(c,"ParticleBasicMaterial",(function(){return sB})),n.d(c,"ParticleSystemMaterial",(function(){return aB})),n.d(c,"Vertex",(function(){return cB})),n.d(c,"DynamicBufferAttribute",(function(){return lB})),n.d(c,"Int8Attribute",(function(){return uB})),n.d(c,"Uint8Attribute",(function(){return hB})),n.d(c,"Uint8ClampedAttribute",(function(){return dB})),n.d(c,"Int16Attribute",(function(){return pB})),n.d(c,"Uint16Attribute",(function(){return fB})),n.d(c,"Int32Attribute",(function(){return mB})),n.d(c,"Uint32Attribute",(function(){return gB})),n.d(c,"Float32Attribute",(function(){return vB})),n.d(c,"Float64Attribute",(function(){return yB})),n.d(c,"ClosedSplineCurve3",(function(){return bB})),n.d(c,"SplineCurve3",(function(){return xB})),n.d(c,"Spline",(function(){return _B})),n.d(c,"AxisHelper",(function(){return wB})),n.d(c,"BoundingBoxHelper",(function(){return MB})),n.d(c,"EdgesHelper",(function(){return EB})),n.d(c,"WireframeHelper",(function(){return SB})),n.d(c,"XHRLoader",(function(){return TB})),n.d(c,"BinaryTextureLoader",(function(){return AB})),n.d(c,"WebGLRenderTargetCube",(function(){return RB})),n.d(c,"GeometryUtils",(function(){return LB})),n.d(c,"CanvasRenderer",(function(){return CB})),n.d(c,"JSONLoader",(function(){return PB})),n.d(c,"SceneUtils",(function(){return OB})),n.d(c,"LensFlare",(function(){return NB}));var l={};n.r(l),n.d(l,"Class",(function(){return M})),n.d(l,"Mixin",(function(){return V})),n.d(l,"Eventful",(function(){return Y})),n.d(l,"emits",(function(){return J})),n.d(l,"Element",(function(){return Br})),n.d(l,"variable",(function(){return Yr})),n.d(l,"autorun",(function(){return Zr})),n.d(l,"reactive",(function(){return Jr})),n.d(l,"_trackReactiveProperty",(function(){return $r})),n.d(l,"reactify",(function(){return ei})),n.d(l,"untrack",(function(){return ri})),n.d(l,"circular",(function(){return ii})),n.d(l,"attribute",(function(){return oi})),n.d(l,"_attribute",(function(){return si})),n.d(l,"stringAttribute",(function(){return ai})),n.d(l,"numberAttribute",(function(){return ci})),n.d(l,"booleanAttribute",(function(){return li})),n.d(l,"element",(function(){return ui})),n.d(l,"css",(function(){return hi})),n.d(l,"Aliases",(function(){return Jn})),n.d(l,"Properties",(function(){return $n})),n.d(l,"ChildProperties",(function(){return Kn})),n.d(l,"DelegatedEvents",(function(){return Qn})),n.d(l,"SVGElements",(function(){return tr})),n.d(l,"SVGNamespace",(function(){return er})),n.d(l,"render",(function(){return nr})),n.d(l,"template",(function(){return rr})),n.d(l,"effect",(function(){return ir})),n.d(l,"memo",(function(){return or})),n.d(l,"insert",(function(){return sr})),n.d(l,"createComponent",(function(){return ar})),n.d(l,"delegateEvents",(function(){return cr})),n.d(l,"clearDelegatedEvents",(function(){return lr})),n.d(l,"spread",(function(){return ur})),n.d(l,"assign",(function(){return hr})),n.d(l,"setAttribute",(function(){return dr})),n.d(l,"setAttributeNS",(function(){return pr})),n.d(l,"addEventListener",(function(){return fr})),n.d(l,"classList",(function(){return mr})),n.d(l,"style",(function(){return gr})),n.d(l,"getOwner",(function(){return vr})),n.d(l,"dynamicProperty",(function(){return yr})),n.d(l,"hydrate",(function(){return br})),n.d(l,"gatherHydratable",(function(){return xr})),n.d(l,"getHydrationKey",(function(){return _r})),n.d(l,"getNextElement",(function(){return wr})),n.d(l,"getNextMarker",(function(){return Mr})),n.d(l,"For",(function(){return Er})),n.d(l,"Show",(function(){return Sr})),n.d(l,"Suspense",(function(){return Tr})),n.d(l,"SuspenseList",(function(){return Ar})),n.d(l,"Switch",(function(){return Rr})),n.d(l,"Match",(function(){return Lr})),n.d(l,"Index",(function(){return Cr})),n.d(l,"ErrorBoundary",(function(){return Pr})),n.d(l,"mergeProps",(function(){return Or})),n.d(l,"isServer",(function(){return Nr})),n.d(l,"Portal",(function(){return Ir})),n.d(l,"Dynamic",(function(){return Dr})),n.d(l,"html",(function(){return Di})),n.d(l,"Behavior",(function(){return _o})),n.d(l,"RenderableBehavior",(function(){return vd})),n.d(l,"MeshBehavior",(function(){return Af})),n.d(l,"ForwardProps",(function(){return Ki})),n.d(l,"DefaultBehaviors",(function(){return Ss})),n.d(l,"BoxGeometryBehavior",(function(){return Lf})),n.d(l,"MixedPlaneGeometryBehavior",(function(){return Cf})),n.d(l,"GeometryBehavior",(function(){return Rf})),n.d(l,"PlyGeometryBehavior",(function(){return cE})),n.d(l,"PlaneGeometryBehavior",(function(){return hE})),n.d(l,"RoundedRectangleGeometryBehavior",(function(){return yS})),n.d(l,"SphereGeometryBehavior",(function(){return wS})),n.d(l,"BasicMaterialBehavior",(function(){return VS})),n.d(l,"MixedPlaneMaterialBehavior",(function(){return WS})),n.d(l,"MaterialBehavior",(function(){return RS})),n.d(l,"MaterialTexture",(function(){return jS})),n.d(l,"PhongMaterialBehavior",(function(){return qS})),n.d(l,"LambertMaterialBehavior",(function(){return YS})),n.d(l,"PointsMaterialBehavior",(function(){return $S})),n.d(l,"ShaderMaterialBehavior",(function(){return lT})),n.d(l,"ColladaModelBehavior",(function(){return MT})),n.d(l,"FbxModelBehavior",(function(){return _A})),n.d(l,"GltfModelBehavior",(function(){return FA})),n.d(l,"ObjModelBehavior",(function(){return $A})),n.d(l,"CameraRig",(function(){return vR})),n.d(l,"PerspectiveCamera",(function(){return AR})),n.d(l,"DeclarativeBase",(function(){return Rs})),n.d(l,"ElementOperations",(function(){return Ia})),n.d(l,"EventTypes",(function(){return wo})),n.d(l,"Events",(function(){return Mo})),n.d(l,"makeEnumFromClassProperties",(function(){return Eo})),n.d(l,"HtmlNode",(function(){return pd})),n.d(l,"HtmlScene",(function(){return RR})),n.d(l,"ImperativeBase",(function(){return dd})),n.d(l,"Motor",(function(){return $s})),n.d(l,"Node",(function(){return gd})),n.d(l,"Object3DWithPivot",(function(){return Da})),n.d(l,"possiblyPolyfillResizeObserver",(function(){return PR})),n.d(l,"Scene",(function(){return eO})),n.d(l,"Sizeable",(function(){return pa})),n.d(l,"Transformable",(function(){return Ma})),n.d(l,"TreeNode",(function(){return Os})),n.d(l,"WithChildren",(function(){return Ms})),n.d(l,"epsilon",(function(){return Qi})),n.d(l,"observeChildren",(function(){return to})),n.d(l,"createChildObserver",(function(){return eo})),n.d(l,"documentBody",(function(){return no})),n.d(l,"toRadians",(function(){return ro})),n.d(l,"defer",(function(){return io})),n.d(l,"thro",(function(){return oo})),n.d(l,"trim",(function(){return so})),n.d(l,"dashCase",(function(){return ao})),n.d(l,"empty",(function(){return co})),n.d(l,"unique",(function(){return lo})),n.d(l,"pick",(function(){return uo})),n.d(l,"identity",(function(){return ho})),n.d(l,"FlickeringOrb",(function(){return iO})),n.d(l,"FlickeringOrbs",(function(){return aO})),n.d(l,"LoadingIcon",(function(){return uO})),n.d(l,"FlingRotation",(function(){return sR})),n.d(l,"ScrollFling",(function(){return fR})),n.d(l,"AutoLayout",(function(){return oN})),n.d(l,"AutoLayoutNode",(function(){return uN})),n.d(l,"CubeLayout",(function(){return hN})),n.d(l,"PushPaneLayout",(function(){return dN})),n.d(l,"AmbientLight",(function(){return yN})),n.d(l,"Light",(function(){return gN})),n.d(l,"PointLight",(function(){return EN})),n.d(l,"DirectionalLight",(function(){return LN})),n.d(l,"clamp",(function(){return KA})),n.d(l,"Box",(function(){return CN})),n.d(l,"MixedPlane",(function(){return PN})),n.d(l,"Mesh",(function(){return cf})),n.d(l,"Plane",(function(){return ON})),n.d(l,"Points",(function(){return xf})),n.d(l,"RoundedRectangle",(function(){return NN})),n.d(l,"Sphere",(function(){return IN})),n.d(l,"ColladaModel",(function(){return DN})),n.d(l,"FbxModel",(function(){return UN})),n.d(l,"GltfModel",(function(){return BN})),n.d(l,"ObjModel",(function(){return kN})),n.d(l,"Css3dRendererThree",(function(){return NP})),n.d(l,"releaseCSS3DRendererThree",(function(){return IP})),n.d(l,"WebglRendererThree",(function(){return RP})),n.d(l,"releaseWebGLRendererThree",(function(){return LP})),n.d(l,"getGlobal",(function(){return CR.a})),n.d(l,"Settable",(function(){return ed})),n.d(l,"isRenderItem",(function(){return Sh})),n.d(l,"disposeMaterial",(function(){return Th})),n.d(l,"disposeObject",(function(){return Ah})),n.d(l,"disposeObjectTree",(function(){return Rh})),n.d(l,"quaternionApproximateEquals",(function(){return Lh})),n.d(l,"applyMaterial",(function(){return Ch})),n.d(l,"setRandomColorPhongMaterial",(function(){return Ph})),n.d(l,"setColorPhongMaterial",(function(){return Oh})),n.d(l,"isPerspectiveCamera",(function(){return Nh})),n.d(l,"isOrthographicCamera",(function(){return Ih})),n.d(l,"isDisposable",(function(){return Dh})),n.d(l,"XYZAnyValues",(function(){return zN})),n.d(l,"XYZNonNegativeValues",(function(){return Ds})),n.d(l,"XYZNumberValues",(function(){return xs})),n.d(l,"XYZSizeModeValues",(function(){return Is})),n.d(l,"XYZStringValues",(function(){return Ns})),n.d(l,"XYZValues",(function(){return bs})),n.d(l,"defineElements",(function(){return HN})),n.d(l,"useDefaultNames",(function(){return GN})),n.d(l,"THREE",(function(){return FB})),n.d(l,"version",(function(){return UB}));var u=n(0);const h=["subclass","extends",...Object.getOwnPropertyNames(new Function)],d=new WeakMap,p=new WeakMap,f=new u.b,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,b=new WeakMap,x={mode:"es5",nativeNaming:!1,prototypeWritable:!1,defaultClassDescriptor:{writable:!0,enumerable:!1,configurable:!0},setClassDescriptors:!0};class _ extends Error{}class w extends Error{}const M=function(t){(t=t?{...x,...t}:x).defaultClassDescriptor={...x.defaultClassDescriptor,...t.defaultClassDescriptor};const{mode:e,prototypeWritable:n,setClassDescriptors:r,nativeNaming:i}=t;function o(...t){let e=!1;if("function"==typeof this&&(e=!0),t.length<=3){let n="",r=null,i=null;"string"==typeof t[0]?n=t[0]:"function"!=typeof t[0]&&"object"!=typeof t[0]||(r=t[0],i=t[1]),"function"!=typeof t[1]&&"object"!=typeof t[1]||(r=t[1],i=t[2]);const o=e?s.call(this,n,r,i):s(n,r,i);return o.extends=function(t,e,o){return e=e||r,o=o||i,s.call(t,n,e,o)},o}throw new TypeError("invalid args")}return o;function s(s,a,c){let l=this;if("string"!=typeof s)throw new TypeError("\n                You must specify a string for the 'className' argument.\n            ");let f=null;if(a&&"object"==typeof a)f=a;else if(!l&&(!a||"function"!=typeof a&&"object"!=typeof a)){let t;return i&&s?t=new Function(`return function ${s}() {}`)():(t=function(){},s&&Object(u.k)(t,"name",{value:s})),t.prototype={__proto__:Object.prototype,constructor:t},Object(u.k)(t,"subclass",{value:o,writable:!0,enumerable:!1,configurable:!1}),t}const m=c?void 0:new u.b;c&&(b.get(c)||b.set(c,new u.b));const x={className:s,get publicToPrivate(){return m||b.get(c)},classBrand:c=c||{brand:"lexical"},cachedPublicAccesses:new WeakMap,cachedProtectedAccesses:new WeakMap,cachedPrivateAccesses:new WeakMap},_=new WeakMap,w=N.bind(null,_,x),M=E.bind(null,x),T=S.bind(null,x),A=R.bind(null,x);if(M.prototype={},T.prototype={},A.prototype={},M.Public=M,M.Protected=T,M.Private=A,M.Super=w,T.Public=M,T.Protected=T,T.Private=A,T.Super=w,f=f||a&&a(M,T,A,w),f&&"object"!=typeof f&&"function"!=typeof f)throw new TypeError("\n                The return value of a class definer function, if any, should be\n                an object, or a class constructor.\n            ");let L,C=null;"function"==typeof f&&(C=f,f=f.prototype,l=C.prototype.__proto__.constructor),f&&(L=f.static,delete f.static,"function"==typeof f.public&&(f.public=f.public(T,A)),"function"==typeof f.protected&&(f.protected=f.protected(M,A)),"function"==typeof f.private&&(f.private=f.private(M,T))),l=l||Object;const P=l.prototype,O=f&&f.public||f||Object.create(P);O.__proto__!==P&&(O.__proto__=P);const I=function(t){let e,n=t;for(;n&&!e;)e=d.get(n),n=n.__proto__;return e||{}}(P),D=f&&f.protected||Object.create(I);D.__proto__!==I&&(D.__proto__=I),d.set(O,D);const F=function(t){let e,n=t;for(;n&&!e;)e=p.get(n),n=n.__proto__;return e||{}}(P),U=f&&f.private||Object.create(F);if(U.__proto__!==F&&(U.__proto__=F),p.set(O,U),g.get(c)||g.set(c,new Set),v.get(c)||v.set(c,new Set),y.get(c)||y.set(c,new Set),g.get(c).add(O),v.get(c).add(D),y.get(c).add(U),x.publicPrototype=O,x.privatePrototype=U,x.protectedPrototype=D,x.parentPublicPrototype=P,x.parentProtectedPrototype=I,x.parentPrivatePrototype=F,Object(u.c)(M.prototype,O),Object(u.c)(T.prototype,D),Object(u.c)(A.prototype,U),f&&(delete f.public,delete f.protected,delete f.private,f!==O&&Object(u.c)(f,O)),C)return L&&Object(u.c)(L,C),C;const B=O.hasOwnProperty("constructor")?O.constructor:null;let k=null,z=null;if("es5"!==e)throw new TypeError("\n                The lowclass \"mode\" option can only be 'es5' for now.\n            ");if(k=function(){let t=null,e=null;return e=B||l,e!==Object&&(t=e.apply(this,arguments)),!t||"object"!=typeof t&&"function"!=typeof t?this:t},z=O,s)if(i){const t=Object(u.d)(k),e=k.prototype;k=new Function(" userConstructor, ParentClass ",`\n                    return function ${s}() { ${t} }\n                `)(B,l),k.prototype=e}else Object(u.k)(k,"name",{value:s});return B&&B.length&&Object(u.k)(k,"length",{value:B.length}),k.__proto__=l,L&&Object(u.c)(L,k),Object(u.k)(k,"subclass",{value:o,writable:!0,enumerable:!1,configurable:!1}),k.prototype=z,k.prototype.constructor=k,r&&(Object(u.j)(k,t,h),Object(u.k)(k,"prototype",{writable:n}),Object(u.i)(k.prototype,t),Object(u.i)(D,t),Object(u.i)(U,t)),x.constructor=k,k}}();function E(t,e){let n=t.cachedPublicAccesses.get(e);return n||(O(t,e)?t.cachedPublicAccesses.set(e,n=T(e).publicToPrivate.get(e)):P(t,e)?t.cachedPublicAccesses.set(e,n=f.get(e)):t.cachedPublicAccesses.set(e,n=e),n)}function S(t,e){let n=t.cachedProtectedAccesses.get(e);if(n)return n;if(C(t,e))t.cachedProtectedAccesses.set(e,n=f.get(e)||A(e));else if(O(t,e)){const r=T(e).publicToPrivate.get(e);t.cachedProtectedAccesses.set(e,n=f.get(r)||A(r))}else P(t,e)&&t.cachedProtectedAccesses.set(e,n=e);if(!n)throw new w("invalid access of protected member");return n}function T(t){return m.get(t)}function A(t){const e=function(t){let e=null,n=t.__proto__;for(;n;){if(e=d.get(n),e)return e;n=n.__proto__}return e}(t),n=Object.create(e);return f.set(t,n),n}function R(t,e){let n=t.cachedPrivateAccesses.get(e);if(n)return n;if(C(t,e))t.cachedPrivateAccesses.set(e,n=t.publicToPrivate.get(e)||L(t,e));else if(P(t,e)){const r=f.get(e);t.cachedPrivateAccesses.set(e,n=t.publicToPrivate.get(r)||L(t,r))}else O(t,e)&&t.cachedPrivateAccesses.set(e,n=e);if(!n)throw new w("invalid access of private member");return n}function L(t,e){const n=Object.create(t.privatePrototype);return t.publicToPrivate.set(e,n),m.set(n,t),n}function C(t,e,n=!0){if(!n)return Object(u.g)(e,t.publicPrototype);for(const n of Array.from(g.get(t.classBrand)))if(Object(u.g)(e,n))return!0;return!1}function P(t,e,n=!0){if(!n)return Object(u.g)(e,t.protectedPrototype);for(const n of Array.from(v.get(t.classBrand)))if(Object(u.g)(e,n))return!0;return!1}function O(t,e,n=!0){if(!n)return Object(u.g)(e,t.privatePrototype);for(const n of Array.from(y.get(t.classBrand)))if(Object(u.g)(e,n))return!0;return!1}function N(t,e,n){const{parentPublicPrototype:r,parentProtectedPrototype:i,parentPrivatePrototype:o}=e;if(C(e,n,!1))return I(n,r,t);if(P(e,n,!1))return I(n,i,t);if(O(e,n,!1))return I(n,o,t);throw new _("invalid super access")}function I(t,e,n){let r=n.get(t);if(!r){n.set(t,r=Object.create(e));const i=Object(u.f)(e);let o=i.length;for(;o--;){const n=i[o];Object(u.k)(r,n,{get:function(){let r=void 0;const i=Object(u.e)(e,n);if(i&&Object(u.h)(i)){const e=i.get;e&&(r=e.call(t))}else r=e[n];return r&&r.call&&"function"==typeof r&&(r=r.bind(t)),r},set:function(r){const i=Object(u.e)(e,n);if(i&&Object(u.h)(i)){const e=i.set;e&&(r=e.call(t,r))}else t[n]=r}},!0)}}return r}var D,F=M;!function(t){t.PROXIES_ON_INSTANCE_AND_PROTOTYPE="PROXIES_ON_INSTANCE_AND_PROTOTYPE",t.PROXIES_ON_PROTOTYPE="PROXIES_ON_PROTOTYPE",t.PROXY_AFTER_INSTANCE_AND_PROTOTYPE="PROXY_AFTER_INSTANCE_AND_PROTOTYPE"}(D||(D={}));U={method:D.PROXIES_ON_INSTANCE_AND_PROTOTYPE};var U;let B=[];const k=new WeakMap,z=t=>{let e=k.get(t);return e||k.set(t,e=[]),e},H={has:!1,value:void 0};let G=!1,j=null;function V(t,e){var n,r;return t=function(t){const e=new WeakMap;return W(t.name,n=>{if(function(t,e,n){for(;t;){if(n.get(t)===e)return!0;t=t.__proto__}return!1}(n,t,e))return n;const r=t(n);return e.set(r,t),r})}(t=function(t){let e;return W(t.name,n=>{const r=t(n);return"undefined"!=typeof Symbol&&Symbol.hasInstance?(Object.getOwnPropertySymbols(r).includes(Symbol.hasInstance)||(e||(e=Symbol("instanceofSymbol")),r[e]=!0,Object.defineProperty(r,Symbol.hasInstance,{value:function(t){if(this!==r)return r.__proto__[Symbol.hasInstance].call(this,t);let n=t;for(;n;){const t=Object.getOwnPropertyDescriptor(n,"constructor");if(t&&t.value&&t.value.hasOwnProperty(e))return!0;n=n.__proto__}return!1}})),r):r})}(t=function(t){const e=new WeakMap;return W(t.name,n=>{let r=e.get(n);return r||e.set(n,r=t(n)),r})}(t))),n=t,r=e||F(),(t=function(t){return t().mixin=t,t}(t=W(n.name,t=>n(t=t||r))))()}function W(t,e){try{Object.defineProperty(e,"name",{...Object.getOwnPropertyDescriptor(e,"name"),value:t})}catch(t){}return e}n(5);var q=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},X=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};function Y(t=Object){var e,n;class r extends t{constructor(){super(...arguments),this[n]=Z,e.set(this,null)}on(t,n,r){let i=q(this,e,"f");if("function"!=typeof n)throw new Error("Expected a function in callback argument of Eventful#on.");i||(i=X(this,e,new Map,"f"));let o=i.get(t);o||i.set(t,o=[]),o.push([n,r])}off(t,n,r){const i=q(this,e,"f");if(!i)return;const o=i.get(t);if(!o)return;const s=o.findIndex(t=>t[0]===n&&t[1]===r);-1!==s&&(o.splice(s,1),0===o.length&&i.delete(t),0===i.size&&X(this,e,null,"f"))}emit(t,n){const r=q(this,e,"f");if(!r)return;const i=r.get(t);if(!i)return;let o,s,a;for(let t=0,e=i.length;t<e;t+=1)o=i[t],s=o[0],a=o[1],s.call(a,n)}}return e=new WeakMap,n=Z,r.prototype[Z]=Z,r}const Z=Symbol("isEventful");function J(t){return(e,n,r)=>function(t,e,n,r){if(!(t instanceof Y))throw new TypeError("The @emits decorator in only for use on properties of classes that extend from Eventful.");const i=Symbol("@emits: "+e);let o=!1;n||(o=!0,n=Object.getOwnPropertyDescriptor(t,e));let s,a,c,l,u=!1;if(n)if(n.get||n.set){if(u=!0,s=n.get,a=n.set,!a)return void console.warn('The `@emits` decorator was used on an accessor named "'+e+"\" which did not have a setter. This means an event will never be emitted because the value can not be set. In this case the decorator doesn't do anything.");delete n.get,delete n.set}else{if(c=n.value,l=n.writable,!l)return void console.warn('The `@emits` decorator was used on a property named "'+e+'" that is not writable. An event can not be emitted because the property can not be modified. In this case the decorator does not do anything.');delete n.value,delete n.writable}let h=!1;function d(){this.emit(r,e)}if(n={...n,configurable:!0,...u?s?{get(){return s.call(this)}}:{}:{get(){return h?this[i]:(h=!0,this[i]=c)}},...u?{set(t){a.call(this,t),Promise.resolve().then(d.bind(this))}}:{set(t){h||(h=!0),this[i]=t,Promise.resolve().then(d.bind(this))}}},!o)return n;Object.defineProperty(t,e,n)}(e,n,null!=r?r:void 0,t)}Object.defineProperty(Y,Symbol.hasInstance,{value:t=>!!t&&!!t[Z]});let $=1,K=!1,Q=!1,tt=[],et=null,nt=null,rt=0,it=null,ot=null;function st(t,e){it||function(){if(window&&window.MessageChannel){const t=new MessageChannel,e=t.port2;it=()=>e.postMessage(null),t.port1.onmessage=()=>{if(null!==ot){const t=performance.now();rt=t+5;const n=!0;try{ot(n,t)?e.postMessage(null):ot=null}catch(t){throw e.postMessage(null),t}}}}else{let t;it=()=>{t||(t=ot,setTimeout(()=>{const e=performance.now();rt=e+5;const n=t(!0,e);t=null,n&&it()},0))}}if(navigator&&navigator.scheduling&&navigator.scheduling.isInputPending){const t=navigator.scheduling;nt=()=>{const e=performance.now();return e>=rt&&(!!t.isInputPending()||e>=300)}}else nt=()=>performance.now()>=rt}();let n=performance.now(),r=1073741823;e&&e.timeout&&(r=e.timeout);const i={id:$++,fn:t,startTime:n,expirationTime:n+r};return function(t,e){t.splice(function(){let n=0,r=t.length-1;for(;n<=r;){let i=r+n>>1,o=e.expirationTime-t[i].expirationTime;if(o>0)n=i+1;else{if(!(o<0))return i;r=i-1}}return n}(),0,e)}(tt,i),K||Q||(K=!0,ot=ct,it()),i}function at(t){t.fn=null}function ct(t,e){K=!1,Q=!0;try{return function(t,e){let n=e;et=tt[0]||null;for(;null!==et&&(!(et.expirationTime>n)||t&&!nt());){const t=et.fn;if(null!==t){et.fn=null;const e=et.expirationTime<=n;t(e),n=performance.now(),et===tt[0]&&tt.shift()}else tt.shift();et=tt[0]||null}return null!==et}(t,e)}finally{et=null,Q=!1}}const lt={};function ut(t){lt.context=t}const ht=(t,e)=>t===e;let dt=null,pt=ie;const ft={},mt={owned:null,cleanups:null,context:null,owner:null},gt=Symbol("lazy"),[vt,yt]=Rt(!1,!0);var bt=null,xt=null;let _t,wt=null,Mt=null,Et=null,St=null,Tt=0;function At(t,e){e&&(bt=e);const n=xt,r=bt,i=0===t.length?mt:{owned:null,cleanups:null,context:null,owner:r,attached:!!e};let o;bt=i,xt=null;try{re(()=>o=t(()=>ce(i)),!0)}finally{xt=n,bt=r}return o}function Rt(t,e,n){const r={value:t,observers:null,observerSlots:null,pending:ft,comparator:e?"function"==typeof e?e:ht:void 0};return[$t.bind(r),Kt.bind(r)]}function Lt(t,e){Qt(ee(t,e,!0))}function Ct(t,e){Qt(ee(t,e,!1))}function Pt(t,e){pt=oe;const n=ee(t,e,!1),r=_t&&ue(bt,_t.id);r&&(n.suspense=r),n.user=!0,Et&&Et.push(n)}function Ot(t,e,n){const r=ee(t,e,!0);return r.pending=ft,r.observers=null,r.observerSlots=null,r.state=0,r.comparator=n?"function"==typeof n?n:ht:void 0,Qt(r),$t.bind(r)}function Nt(t,e){let n,r=e?e.timeoutMs:void 0;const[i,o]=Rt(),s=ee(()=>(n&&n.fn||(n=st(()=>o(s.value),void 0!==r?{timeout:r}:void 0)),t()),void 0,!0);return Qt(s),o(s.value),i}function It(t,e=ht){let n=new Map;const r=ee(r=>{const i=t();for(const t of n.keys())if(e(t,i)||void 0!==r&&e(t,r)){const e=n.get(t);for(const t of e.values())t.state=1,t.pure?Mt.push(t):Et.push(t)}return i},void 0,!0);return Qt(r),t=>{let i;if(i=xt){let e;(e=n.get(t))?e.add(i):n.set(t,e=new Set([i])),zt(()=>{e.size>1?e.delete(i):n.delete(t)})}return e(t,r.value)}}function Dt(t){if(wt)return t();const e=wt=[],n=t();return wt=null,re(()=>{for(let t=0;t<e.length;t+=1){const n=e[t];if(n.pending!==ft){const t=n.pending;n.pending=ft,Kt.call(n,t)}}},!1),n}function Ft(){return[vt,(t,e)=>{_t&&(St||(St={sources:new Set,effects:[],promises:new Set,disposed:new Set,running:!0,cb:[]}),e&&St.cb.push(e),St.running=!0),Dt(t),!_t&&e&&e()}]}function Ut(t){let e,n=xt;return xt=null,e=t(),xt=n,e}function Bt(...t){const e=t.pop();let n,r,i=!0;return t.length<2?(n=t[0],i=!1):n=t,t=>{let o;if(i){o=[],r||(r=[]);for(let t=0;t<n.length;t++)o.push(n[t]())}else o=n();const s=Ut(()=>e(o,r,t));return r=o,s}}function kt(t){Pt(()=>Ut(t))}function zt(t){return null===bt||(null===bt.cleanups?bt.cleanups=[t]:bt.cleanups.push(t)),t}function Ht(t){dt||(dt=Symbol("error")),null===bt||(null===bt.context?bt.context={[dt]:[t]}:bt.context[dt]?bt.context[dt].push(t):bt.context[dt]=[t])}function Gt(){return xt}function jt(){return bt}function Vt(t,e){const n=bt;bt=t;try{return e()}finally{bt=n}}function Wt(t){return{}}function qt(t){const e=Symbol("context");return{id:e,Provider:he(e),defaultValue:t}}function Xt(t){return ue(bt,t.id)||t.defaultValue}function Yt(t){const e=Ot(t);return Ot(()=>function t(e){if("function"==typeof e&&!e.length)return t(e());if(Array.isArray(e)){const n=[];for(let r=0;r<e.length;r++){let i=t(e[r]);Array.isArray(i)?n.push.apply(n,i):n.push(i)}return n}return e}(e()))}function Zt(){return _t||(_t=qt({}))}function Jt(t,e,n){const r=new Set,[i,o]=Rt(n,!0),[s,a]=Rt(),[c,l]=Rt(!1,!0);let u=null,h=null,d=null,p=null,f=!1,m="function"==typeof t;function g(t,e,n){return h===t&&(u=n,h=null,St&&t&&f?(St.promises.delete(t),f=!1,re(()=>{St.running=!0,St.promises.size||(Et.push.apply(Et,St.effects),St.effects=[]),v(e)},!1)):v(e)),e}function v(t){Dt(()=>{o(t),l(!1);for(let t of r.keys())t.decrement();r.clear()})}function y(){const t=_t&&ue(bt,_t.id),e=i();if(u)throw u;return xt&&!xt.user&&t&&Lt(()=>{s(),h&&(t.resolved&&St?St.promises.add(h):r.has(t)||(t.increment(),r.add(t)))}),e}function b(){u=null;let n=m?t():t;if(f=St&&St.running,null==n||!1===n)return void g(h,Ut(i));St&&h&&St.promises.delete(h);const r=d||e(n,i);d=null,"object"==typeof r&&"then"in r?(h=r,Dt(()=>{l(!0),a()}),r.then(t=>g(r,t),t=>g(r,t,t))):g(h,r)}return lt.context&&(p=`${lt.context.id}${lt.context.count++}`,lt.context.loadResource?d=lt.context.loadResource(p):lt.resources&&p&&p in lt.resources&&(d=lt.resources[p],delete lt.resources[p])),Object.defineProperty(y,"loading",{get:()=>c()}),m?Lt(b):b(),[y,{refetch:b,mutate:o}]}function $t(){if(this.state&&this.sources){const t=Mt;Mt=null,1===this.state?Qt(this):se(this),Mt=t}if(xt){const t=this.observers?this.observers.length:0;xt.sources?(xt.sources.push(this),xt.sourceSlots.push(t)):(xt.sources=[this],xt.sourceSlots=[t]),this.observers?(this.observers.push(xt),this.observerSlots.push(xt.sources.length-1)):(this.observers=[xt],this.observerSlots=[xt.sources.length-1])}return St&&St.running&&St.sources.has(this)?this.tValue:this.value}function Kt(t,e){if(this.comparator)if(St&&St.running&&St.sources.has(this)){if(this.comparator(this.tValue,t))return t}else if(this.comparator(this.value,t))return t;return wt?(this.pending===ft&&wt.push(this),this.pending=t,t):(St?((St.running||!e&&St.sources.has(this))&&(St.sources.add(this),this.tValue=t),St.running||(this.value=t)):this.value=t,!this.observers||Mt&&!this.observers.length||re(()=>{for(let t=0;t<this.observers.length;t+=1){const e=this.observers[t];St&&St.running&&St.disposed.has(e)||(e.observers&&2!==e.state&&ae(e),e.state=1,e.pure?Mt.push(e):Et.push(e))}if(Mt.length>1e6)throw Mt=[],new Error("Potential Infinite Loop Detected.")},!1),t)}function Qt(t){if(!t.fn)return;ce(t);const e=bt,n=xt,r=Tt;xt=bt=t,te(t,t.value,r),St&&!St.running&&St.sources.has(t)&&(St.running=!0,te(t,t.tValue,r),St.running=!1),xt=n,bt=e}function te(t,e,n){let r;try{r=t.fn(e)}catch(t){le(t)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?Kt.call(t,r,!0):St&&St.running&&t.pure?(St.sources.add(t),t.tValue=r):t.value=r,t.updatedAt=n)}function ee(t,e,n){const r={fn:t,state:1,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:bt,context:null,pure:n};return null===bt||bt!==mt&&(St&&St.running&&bt.pure?bt.tOwned?bt.tOwned.push(r):bt.tOwned=[r]:bt.owned?bt.owned.push(r):bt.owned=[r]),r}function ne(t){let e,n=1===t.state&&t;if(t.suspense&&Ut(t.suspense.inFallback))return t.suspense.effects.push(t);const r=St&&St.running;for(;(t.fn||r&&t.attached)&&(t=t.owner);){if(r&&St.disposed.has(t))return;2===t.state?e=t:1===t.state&&(n=t,e=void 0)}if(e){const i=Mt;if(Mt=null,se(e),Mt=i,!n||1!==n.state)return;if(r)for(t=n;(t.fn||t.attached)&&(t=t.owner);)if(St.disposed.has(t))return}n&&Qt(n)}function re(t,e){if(Mt)return t();let n=!1;e||(Mt=[]),Et?n=!0:Et=[],Tt++;try{t()}catch(t){le(t)}finally{!function(t){Mt&&(ie(Mt),Mt=null);if(t)return;let e;if(St&&St.running){if(St.promises.size)return St.running=!1,St.effects.push.apply(St.effects,Et),Et=null,void yt(!0);const t=St.sources;e=St.cb,St=null,Dt(()=>{t.forEach(t=>{if(t.value=t.tValue,t.owned)for(let e=0,n=t.owned.length;e<n;e++)ce(t.owned[e]);t.tOwned&&(t.owned=t.tOwned),delete t.tValue,delete t.tOwned}),yt(!1)})}Et.length?Dt(()=>{pt(Et),Et=null}):Et=null;e&&e.forEach(t=>t())}(n)}}function ie(t){for(let e=0;e<t.length;e++)ne(t[e])}function oe(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:ne(r)}const r=t.length;for(e=0;e<n;e++)ne(t[e]);for(e=r;e<t.length;e++)ne(t[e])}function se(t){t.state=0;for(let e=0;e<t.sources.length;e+=1){const n=t.sources[e];n.sources&&(1===n.state?ne(n):2===n.state&&se(n))}}function ae(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=2,n.observers&&ae(n))}}function ce(t){let e;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),n=t.sourceSlots.pop(),r=e.observers;if(r&&r.length){const t=r.pop(),i=e.observerSlots.pop();n<r.length&&(t.sourceSlots[i]=n,r[n]=t,e.observerSlots[n]=i)}}if(St&&St.running&&t.pure){if(t.tOwned){for(e=0;e<t.tOwned.length;e++)ce(t.tOwned[e]);delete t.tOwned}!function t(e,n){n||(e.state=0,St.disposed.add(e));if(e.owned)for(let n=0;n<e.owned.length;n++)t(e.owned[n])}(t,!0)}else if(t.owned){for(e=0;e<t.owned.length;e++)ce(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function le(t){const e=dt&&ue(bt,dt);if(!e)throw t;e.forEach(e=>e(t))}function ue(t,e){return t&&(t.context&&t.context[e]||t.owner&&ue(t.owner,e))}function he(t){return function(e){return Ot(()=>(bt.context={[t]:e.value},Yt(()=>e.children)))}}const de=Symbol("state-raw"),pe=Symbol("state-node"),fe=Symbol("state-proxy"),me=Symbol("state-name");function ge(t,e){let n=t[fe];if(!n){Object.defineProperty(t,fe,{value:n=new Proxy(t,we)});let e=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let i=0,o=e.length;i<o;i++){const o=e[i];if(r[o].get){const e=r[o].get.bind(n);Object.defineProperty(t,o,{get:e})}}}return n}function ve(t){return null!=t&&"object"==typeof t&&(!t.__proto__||t.__proto__===Object.prototype||Array.isArray(t))}function ye(t){let e,n,r,i;if(e=null!=t&&t[de])return e;if(!ve(t))return t;if(Array.isArray(t)){Object.isFrozen(t)&&(t=t.slice(0));for(let e=0,i=t.length;e<i;e++)r=t[e],(n=ye(r))!==r&&(t[e]=n)}else{Object.isFrozen(t)&&(t=Object.assign({},t));let e=Object.keys(t),o=Object.getOwnPropertyDescriptors(t);for(let s=0,a=e.length;s<a;s++)i=e[s],o[i].get||(r=t[i],(n=ye(r))!==r&&(t[i]=n))}return t}function be(t){let e=t[pe];return e||Object.defineProperty(t,pe,{value:e={}}),e}function xe(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||e===fe||e===pe||e===me||(delete n.value,delete n.writable,n.get=()=>t[fe][e]),n}function _e(){const[t,e]=Rt();return t.set=e,t}const we={get(t,e,n){if(e===de)return t;if(e===fe)return n;const r=t[e];if(e===pe||"__proto__"===e)return r;const i=ve(r);if(xt&&("function"!=typeof r||t.hasOwnProperty(e))){let n,o;i&&(n=be(r))&&(o=n._||(n._=_e()),o()),n=be(t),o=n[e]||(n[e]=_e()),o()}return i?ge(r):r},set:()=>!0,deleteProperty:()=>!0,getOwnPropertyDescriptor:xe};function Me(t,e,n){if(t[e]===n)return;const r=Array.isArray(t)||!(e in t);void 0===n?delete t[e]:t[e]=n;let i,o=be(t);(i=o[e])&&i.set(),r&&(i=o._)&&i.set()}function Ee(t,e,n=[]){let r,i=t;if(e.length>1){r=e.shift();const o=typeof r,s=Array.isArray(t);if(Array.isArray(r)){for(let i=0;i<r.length;i++)Ee(t,[r[i]].concat(e),[r[i]].concat(n));return}if(s&&"function"===o){for(let i=0;i<t.length;i++)r(t[i],i)&&Ee(t,[i].concat(e),[i].concat(n));return}if(s&&"object"===o){const{from:i=0,to:o=t.length-1,by:s=1}=r;for(let r=i;r<=o;r+=s)Ee(t,[r].concat(e),[r].concat(n));return}if(e.length>1)return void Ee(t[r],e,[r].concat(n));i=t[r],n=[r].concat(n)}let o=e[0];"function"==typeof o&&(o=o(i,n),o===i)||void 0===r&&null==o||(o=ye(o),void 0===r||ve(i)&&ve(o)&&!Array.isArray(o)?function(t,e){const n=Object.keys(e);for(let r=0;r<n.length;r+=1){const i=n[r];Me(t,i,e[i])}}(i,o):Me(t,r,o))}function Se(t,e){const n=ye(t||{});return[ge(n),function(...t){Dt(()=>Ee(n,t))}]}const Te={get(t,e,n){if(e===de)return t;if(e===fe)return n;const r=t[e];if(e===pe||"__proto__"===e)return r;const i=ve(r);if(xt&&("function"!=typeof r||t.hasOwnProperty(e))){let n,o;i&&(n=be(r))&&(o=n._||(n._=_e()),o()),n=be(t),o=n[e]||(n[e]=_e()),o()}return i?Ae(r):r},set:(t,e,n)=>(Me(t,e,ye(n)),!0),deleteProperty:(t,e)=>(Me(t,e,void 0),!0),getOwnPropertyDescriptor:xe};function Ae(t,e){let n=t[fe];if(!n){Object.defineProperty(t,fe,{value:n=new Proxy(t,Te)});let e=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let i=0,o=e.length;i<o;i++){const o=e[i];if(r[o].get){const e=r[o].get.bind(n);Object.defineProperty(t,o,{get:e})}if(r[o].set){const e=r[o].set,i=t=>Dt(()=>e.call(n,t));Object.defineProperty(t,o,{set:i})}}}return n}function Re(t,e){return Ae(ye(t||{}))}function Le(t,e={}){const{merge:n,key:r="id"}=e,i=ye(t);return t=>ve(t)&&ve(i)?(function t(e,n,r,i,o){let s=n[r];if(e===s)return;if(!ve(e)||!ve(s)||o&&e[o]!==s[o])return void(e!==s&&Me(n,r,e));if(Array.isArray(e)){if(e.length&&s.length&&(!i||o&&null!=e[0][o])){let n,r,a,c,l,u,h,d;for(a=0,c=Math.min(s.length,e.length);a<c&&(s[a]===e[a]||o&&s[a][o]===e[a][o]);a++)t(e[a],s,a,i,o);const p=new Array(e.length),f=new Map;for(c=s.length-1,l=e.length-1;c>=a&&l>=a&&(s[c]===e[l]||o&&s[c][o]===e[l][o]);c--,l--)p[l]=s[c];if(a>l||a>c){for(r=a;r<=l;r++)Me(s,r,e[r]);for(;r<e.length;r++)Me(s,r,p[r]),t(e[r],s,r,i,o);return void(s.length>e.length&&Me(s,"length",e.length))}for(h=new Array(l+1),r=l;r>=a;r--)u=e[r],d=o?u[o]:u,n=f.get(d),h[r]=void 0===n?-1:n,f.set(d,r);for(n=a;n<=c;n++)u=s[n],d=o?u[o]:u,r=f.get(d),void 0!==r&&-1!==r&&(p[r]=s[n],r=h[r],f.set(d,r));for(r=a;r<e.length;r++)r in p?(Me(s,r,p[r]),t(e[r],s,r,i,o)):Me(s,r,e[r])}else for(let n=0,r=e.length;n<r;n++)t(e[n],s,n,i,o);return void(s.length>e.length&&Me(s,"length",e.length))}const a=Object.keys(e);for(let n=0,r=a.length;n<r;n++)t(e[a[n]],s,a[n],i,o);const c=Object.keys(s);for(let t=0,n=c.length;t<n;t++)void 0===e[c[t]]&&Me(s,c[t],void 0)}(i,{state:t},"state",n,r),t):i}const Ce={get(t,e){if(e===de)return t;const n=t[e];return ve(n)?new Proxy(n,Ce):n},set:(t,e,n)=>(Me(t,e,ye(n)),!0),deleteProperty:(t,e)=>(Me(t,e,void 0),!0)};function Pe(t){return e=>(ve(e)&&t(new Proxy(e,Ce)),e)}const Oe=Symbol("fallback");function Ne(t,e,n={}){let r=[],i=[],o=[],s=0,a=e.length>1?[]:null,c=bt;return zt(()=>{for(let t=0,e=o.length;t<e;t++)o[t]()}),()=>{let l,u,h=t()||[];return Ut(()=>{let t,e,p,f,m,g,v,y,b,x=h.length;if(0===x){if(0!==s){for(l=0;l<s;l++)o[l]();o=[],r=[],i=[],s=0,a&&(a=[])}n.fallback&&(r=[Oe],i[0]=At(t=>(o[0]=t,n.fallback()),c),s=1)}else if(0===s){for(u=0;u<x;u++)r[u]=h[u],i[u]=At(d,c);s=x}else{for(p=new Array(x),f=new Array(x),a&&(m=new Array(x)),g=0,v=Math.min(s,x);g<v&&r[g]===h[g];g++);for(v=s-1,y=x-1;v>=g&&y>=g&&r[v]===h[y];v--,y--)p[y]=i[v],f[y]=o[v],a&&(m[y]=a[v]);for(t=new Map,e=new Array(y+1),u=y;u>=g;u--)b=h[u],l=t.get(b),e[u]=void 0===l?-1:l,t.set(b,u);for(l=g;l<=v;l++)b=r[l],u=t.get(b),void 0!==u&&-1!==u?(p[u]=i[l],f[u]=o[l],a&&(m[u]=a[l]),u=e[u],t.set(b,u)):o[l]();for(u=g;u<x;u++)u in p?(i[u]=p[u],o[u]=f[u],a&&(a[u]=m[u],a[u](u))):i[u]=At(d,c);s=i.length=x,r=h.slice(0)}return i});function d(t){if(o[u]=t,a){const[t,n]=Rt(u,!0);return a[u]=n,e(h[u],t)}return e(h[u])}}}function Ie(t,e,n={}){let r,i=[],o=[],s=[],a=[],c=0,l=bt;return zt(()=>{for(let t=0,e=s.length;t<e;t++)s[t]()}),()=>{const u=t()||[];return Ut(()=>{if(0===u.length){if(0!==c){for(r=0;r<c;r++)s[r]();s=[],i=[],o=[],c=0,a=[]}return n.fallback&&(i=[Oe],o[0]=At(t=>(s[0]=t,n.fallback()),l),c=1),o}for(i[0]===Oe&&(s[0](),s=[],i=[],o=[],c=0),r=0;r<u.length;r++)r<i.length&&i[r]!==u[r]?a[r](u[r]):r>=i.length&&(o[r]=At(h,l));for(;r<i.length;r++)s[r]();return c=o.length=a.length=s.length=u.length,i=u.slice(0),o});function h(t){s[r]=t;const[n,i]=Rt(u[r]);return a[r]=i,e(n,r)}}}function De(t,e){if(lt.context){const n=lt.context;ut({...lt.context,id:`${lt.context.id}${lt.context.count++}.`,count:0});const r=Ut(()=>t(e));return ut(n),r}return Ut(()=>t(e))}function Fe(){return!0}const Ue={get:(t,e,n)=>e===fe?n:t.get(e),has:(t,e)=>t.has(e),set:Fe,deleteProperty:Fe,getOwnPropertyDescriptor:(t,e)=>({configurable:!0,enumerable:!0,get:()=>t.get(e),set:Fe,deleteProperty:Fe}),ownKeys:t=>t.keys()};function Be(...t){return new Proxy({get(e){for(let n=t.length-1;n>=0;n--){const r=t[n][e];if(void 0!==r)return r}},has(e){for(let n=t.length-1;n>=0;n--)if(e in t[n])return!0;return!1},keys(){const e=[];for(let n=0;n<t.length;n++)e.push(...Object.keys(t[n]));return[...new Set(e)]}},Ue)}function ke(t,...e){const n=new Set(e.flat()),r=Object.getOwnPropertyDescriptors(t),i=e.map(t=>{const e={};for(let n=0;n<t.length;n++){const i=t[n];r[i]&&Object.defineProperty(e,i,r[i])}return e});return i.push(new Proxy({get:e=>n.has(e)?void 0:t[e],has:e=>!n.has(e)&&e in t,keys:()=>Object.keys(t).filter(t=>!n.has(t))},Ue)),i}function ze(t){let e;const n=n=>{const r=lt.context;let i,o;if(r&&lt.resources){r.count++;const[n,o]=Rt();(e||(e=t())).then(t=>{ut(r),o(t.default),ut(void 0)}),i=n}else{const[n]=Jt(gt,()=>(e||(e=t())).then(t=>t.default));i=n}return Ot(()=>(o=i())&&Ut(()=>{if(!r)return o(n);const t=lt.context;ut(r);const e=o(n);return ut(t),e}))};return n.preload=()=>(e||(e=t())).then(t=>t.default),n}function He(t){const e="fallback"in t&&{fallback:()=>t.fallback};return Ot(Ne(()=>t.each,t.children,e||void 0))}function Ge(t){const e="fallback"in t&&{fallback:()=>t.fallback};return Ot(Ie(()=>t.each,t.children,e||void 0))}function je(t){let e=!1;const n=Ot(()=>t.when,void 0,(t,n)=>e?t===n:!t==!n);return Ot(()=>{const r=n();if(r){const n=t.children;return(e="function"==typeof n&&n.length>0)?Ut(()=>n(r)):n}return t.fallback})}function Ve(t){let e=!1;const n=Yt(()=>t.children),r=Ot(()=>{let t=n();Array.isArray(t)||(t=[t]);for(let e=0;e<t.length;e++){const n=t[e].when;if(n)return[e,n,t[e]]}return[-1]},void 0,(t,n)=>t&&t[0]===n[0]&&(e?t[1]===n[1]:!t[1]==!n[1])&&t[2]===n[2]);return Ot(()=>{const[n,i,o]=r();if(n<0)return t.fallback;const s=o.children;return(e="function"==typeof s&&s.length>0)?Ut(()=>s(i)):s})}function We(t){return t}function qe(t){const[e,n]=Rt();let r;return Ht(n),Ot(()=>{if(null!=(r=e())){const e=t.fallback;return"function"==typeof e&&e.length?Ut(()=>e(r,()=>n(null))):e}return t.children})}const Xe=qt();function Ye(t){let e,n,r,i=0;const o=Xt(Xe);if(o){const[t,i]=Rt(!1,!0);e=i,[n,r]=o.register(t)}const s=[],a=De(Xe.Provider,{value:{register:t=>{const[e,n]=Rt(!1,!0),[r,o]=Rt(!1,!0);return s[i++]={inFallback:t,showContent:n,showFallback:o},[e,r]}},get children(){return t.children}});return Lt(()=>{const i=t.revealOrder,o=t.tail,a=!n||n(),c=!r||r(),l="backwards"===i;if("together"===i){const t=s.every(t=>!t.inFallback());return e&&e(!t),void s.forEach(e=>{e.showContent(t&&a),e.showFallback(c)})}let u=!1;for(let t=0,n=s.length;t<n;t++){const r=l?n-t-1:t,i=s[r].inFallback();if(u||i){const t=!u;t&&e&&e(!0),!o||t&&"collapsed"===o?s[r].showFallback(c):s[r].showFallback(!1),u=!0,s[r].showContent(t)}else s[r].showContent(a),s[r].showFallback(c)}!u&&e&&e(!1)}),a}function Ze(t){let e,n,r=0;const[i,o]=Rt(!1),s=Zt(),a={increment:()=>{1==++r&&o(!0)},decrement:()=>{0==--r&&o(!1)},inFallback:i,effects:[],resolved:!1},c=Xt(Xe);return c&&([e,n]=c.register(a.inFallback)),De(s.Provider,{value:a,get children(){const r=Ut(()=>t.children);return Ot(()=>{const i=a.inFallback(),o=!e||e(),s=!n||n();return!i&&o?(a.resolved=!0,c=a.effects,St&&(St.running=!0),Et.push.apply(Et,c),c.length=0,r):s?t.fallback:void 0;var c})}})}function Je(){}const $e=new Set(["className","indeterminate","value","allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected","truespeed"]),Ke=new Set(["innerHTML","textContent","innerText","children"]),Qe={className:"class",htmlFor:"for"},tn=new Set(["beforeinput","click","dblclick","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),en=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),nn={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function rn(t,e){return Ot(t,void 0,e)}function on(t,e,n){let r=n.length,i=e.length,o=r,s=0,a=0,c=e[i-1].nextSibling,l=null;for(;s<i||a<o;)if(i===s){const e=o<r?a?n[a-1].nextSibling:n[o-a]:c;for(;a<o;)t.insertBefore(n[a++],e)}else if(o===a)for(;s<i;)l&&l.has(e[s])||t.removeChild(e[s]),s++;else if(e[s]===n[a])s++,a++;else if(e[i-1]===n[o-1])i--,o--;else if(e[s]===n[o-1]&&n[a]===e[i-1]){const r=e[--i].nextSibling;t.insertBefore(n[a++],e[s++].nextSibling),t.insertBefore(n[--o],r),e[i]=n[o]}else{if(!l){l=new Map;let t=a;for(;t<o;)l.set(n[t],t++)}const r=l.get(e[s]);if(null!=r)if(a<r&&r<o){let c,u=s,h=1;for(;++u<i&&u<o&&null!=(c=l.get(e[u]))&&c===r+h;)h++;if(h>r-a){const i=e[s];for(;a<r;)t.insertBefore(n[a++],i)}else t.replaceChild(n[a++],e[s++])}else s++;else t.removeChild(e[s++])}}const sn=Symbol("delegated-events");function an(t,e,n){let r;return At(i=>{r=i,yn(e,t(),e.firstChild?null:void 0,n)}),()=>{r(),e.textContent=""}}function cn(t,e,n){const r=document.createElement("template");if(r.innerHTML=t,e&&r.innerHTML.split("<").length-1!==e)throw`Template html does not match input:\n${r.innerHTML}\n\n${t}`;let i=r.content.firstChild;return n&&(i=i.firstChild),i}function ln(t){const e=document[sn]||(document[sn]=new Set);for(let n=0,r=t.length;n<r;n++){const r=t[n];e.has(r)||(e.add(r),document.addEventListener(r,Sn))}}function un(){if(document[sn]){for(let t of document[sn].keys())document.removeEventListener(t,Sn);delete document[sn]}}function hn(t,e,n){!1===n||null==n?t.removeAttribute(e):t.setAttribute(e,n)}function dn(t,e,n,r){!1===r||null==r?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function pn(t,e,n,r){r?Array.isArray(n)?(t["$$"+e]=n[0],t[`$$${e}Data`]=n[1]):t["$$"+e]=n:Array.isArray(n)?t.addEventListener(e,t=>n[0](n[1],t)):t.addEventListener(e,n)}function fn(t,e,n){const r=Object.keys(e);for(let i=0,o=r.length;i<o;i++){const o=r[i],s=!!e[o],a=o.split(/\s+/);if(o&&(!n||n[o]!==s))for(let e=0,n=a.length;e<n;e++)t.classList.toggle(a[e],s)}return e}function mn(t,e,n={}){const r=t.style;if("string"==typeof e)return r.cssText=e;let i,o;for(o in"string"==typeof n&&(n={}),n)null==e[o]&&r.removeProperty(o),delete n[o];for(o in e)i=e[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function gn(t,e,n,r){"function"==typeof e?Ct(i=>Tn(t,e(),i,n,r)):Tn(t,e,void 0,n,r)}function vn(t,e){const n=t[e];return Object.defineProperty(t,e,{get:()=>n(),enumerable:!0}),t}function yn(t,e,n,r){if(void 0===n||r||(r=[]),"function"!=typeof e)return An(t,e,r,n);Ct(r=>An(t,e(),r,n),r)}function bn(t,e,n,r,i={}){let o,s,a;for(const l in e){if("children"===l){r||An(t,e.children);continue}const u=e[l];if(u!==i[l]){if("style"===l)mn(t,u,i[l]);else if("class"!==l||n)if("classList"===l)fn(t,u,i[l]);else if("ref"===l)u(t);else if("on"===l)for(const e in u)t.addEventListener(e,u[e]);else if("onCapture"===l)for(const e in u)t.addEventListener(e,u[e],!0);else if("on"===l.slice(0,2)){const e=l.slice(2).toLowerCase(),n=tn.has(e);pn(t,e,u,n),n&&ln([e])}else if((a=Ke.has(l))||!n&&(s=$e.has(l))||(o=t.nodeName.includes("-")))!o||s||a?t[l]=u:t[(c=l,c.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase()))]=u;else{const e=n&&l.indexOf(":")>-1&&nn[l.split(":")[0]];e?dn(t,e,l,u):hn(t,Qe[l]||l,u)}else t.className=u;i[l]=u}}var c}function xn(t,e){lt.resources=globalThis._$HYDRATION.resources,lt.completed=globalThis._$HYDRATION.completed,lt.events=globalThis._$HYDRATION.events,lt.context={id:"",count:0,loadResource:globalThis._$HYDRATION.loadResource},lt.registry=new Map,_n(e);const n=an(t,e,[...e.childNodes]);return lt.context=null,n}function _n(t){const e=t.querySelectorAll("*[data-hk]");for(let t=0;t<e.length;t++){const n=e[t];lt.registry.set(n.getAttribute("data-hk"),n)}}function wn(t){let e,n;return lt.context&&(e=lt.registry.get(n=Cn()))?(lt.completed&&lt.completed.add(e),lt.registry.delete(n),e):t.cloneNode(!0)}function Mn(t){let e=t,n=0,r=[];if(lt.context)for(;e;){if(8===e.nodeType){const t=e.nodeValue;if("#"===t)n++;else if("/"===t){if(0===n)return[e,r];n--}}r.push(e),e=e.nextSibling}return[e,r]}function En(){lt.events&&!lt.events.queued&&(queueMicrotask(()=>{const{completed:t,events:e}=lt;for(e.queued=!1;e.length;){const[n,r]=e[0];if(!t.has(n))return;Sn(r),e.shift()}}),lt.events.queued=!0)}function Sn(t){const e="$$"+t.type;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get:()=>n});null!==n;){const r=n[e];if(r){const i=n[e+"Data"];if(void 0!==i?r(i,t):r(t),t.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function Tn(t,e,n={},r,i){return!i&&"children"in e&&Ct(()=>n.children=An(t,e.children,n.children)),Ct(()=>bn(t,e,r,!0,n)),n}function An(t,e,n,r,i){for(;"function"==typeof n;)n=n();if(e===n)return n;const o=typeof e,s=void 0!==r;if(t=s&&n[0]&&n[0].parentNode||t,"string"===o||"number"===o)if("number"===o&&(e=e.toString()),s){let i=n[0];i&&3===i.nodeType?i.data=e:i=document.createTextNode(e),n=Ln(t,n,r,i)}else n=""!==n&&"string"==typeof n?t.firstChild.data=e:t.textContent=e;else if(null==e||"boolean"===o){if(lt.context)return n;n=Ln(t,n,r)}else{if("function"===o)return Ct(()=>{let i=e();for(;"function"==typeof i;)i=i();n=An(t,i,n,r)}),()=>n;if(Array.isArray(e)){const o=[];if(function t(e,n,r){let i=!1;for(let o=0,s=n.length;o<s;o++){let s,a=n[o];if(a instanceof Node)e.push(a);else if(null==a||!0===a||!1===a);else if(Array.isArray(a))i=t(e,a)||i;else if("string"==(s=typeof a))e.push(document.createTextNode(a));else if("function"===s)if(r){for(;"function"==typeof a;)a=a();i=t(e,Array.isArray(a)?a:[a])||i}else e.push(a),i=!0;else e.push(document.createTextNode(a.toString()))}return i}(o,e,i))return Ct(()=>n=An(t,o,n,r,!0)),()=>n;if(lt.context&&n.length)return n;if(0===o.length){if(n=Ln(t,n,r),s)return n}else Array.isArray(n)?0===n.length?Rn(t,o,r):on(t,n,o):null==n||""===n?Rn(t,o):on(t,s&&n||[t.firstChild],o);n=o}else if(e instanceof Node){if(Array.isArray(n)){if(s)return n=Ln(t,n,r,e);Ln(t,n,null,e)}else null!=n&&""!==n&&t.firstChild?t.replaceChild(e,t.firstChild):t.appendChild(e);n=e}else console.warn("Skipped inserting",e)}return n}function Rn(t,e,n){for(let r=0,i=e.length;r<i;r++)t.insertBefore(e[r],n)}function Ln(t,e,n,r){if(void 0===n)return t.textContent="";const i=r||document.createTextNode("");if(e.length){let r=!1;for(let o=e.length-1;o>=0;o--){const s=e[o];if(i!==s){const e=s.parentNode===t;r||o?e&&t.removeChild(s):e?t.replaceChild(i,s):t.insertBefore(i,n)}else r=!0}}else t.insertBefore(i,n);return[i]}function Cn(){const t=lt.context;return`${t.id}${t.count++}`}function Pn(t,e){}function On(t,e){}function Nn(t,e){}function In(t,e){}function Dn(t,...e){}function Fn(t){}function Un(t){}function Bn(t){}function kn(t){}function zn(t,e){}function Hn(t){}const Gn=!1;function jn(t,e=!1){return e?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t)}function Vn(t){const{useShadow:e}=t,n=document.createTextNode(""),r=t.mount||document.body;function i(){if(lt.context){const[e,n]=Rt(!1);return queueMicrotask(()=>n(!0)),()=>e()&&t.children}return()=>t.children}if(r instanceof HTMLHeadElement){const[t,e]=Rt(!1),n=()=>e(!0);At(e=>yn(r,()=>t()?e():i()(),null)),zt(()=>{lt.context?queueMicrotask(n):n()})}else{const o=jn(t.isSVG?"g":"div",t.isSVG),s=e&&o.attachShadow?o.attachShadow({mode:"open"}):o;Object.defineProperty(o,"host",{get:()=>n.parentNode}),yn(s,i()),r.appendChild(o),t.ref&&t.ref(o),zt(()=>r.removeChild(o))}return n}function Wn(t){const[e,n]=ke(t,["component"]);return Ot(()=>{const t=e.component;switch(typeof t){case"function":return Ut(()=>t(n));case"string":const e=en.has(t),r=jn(t,e);return gn(r,n,e),r}})}var qn,Xn=n(2);const Yn=Object(Xn.a)();Yn.SOLID_DOM&&console.warn("\n        Duplicates of a LUME library or dependency detected, conflict avoided.\n        Having duplicates means things may not work as expected if different\n        parts of the application are using different instances of something\n        that should be a singleton.\n    ");const Zn=null!==(qn=Yn.SOLID_DOM)&&void 0!==qn?qn:Yn.SOLID_DOM=i,Jn=Zn.Aliases,$n=Zn.Properties,Kn=Zn.ChildProperties,Qn=Zn.DelegatedEvents,tr=Zn.SVGElements,er=Zn.SVGNamespace,nr=Zn.render,rr=Zn.template,ir=Zn.effect,or=Zn.memo,sr=Zn.insert,ar=Zn.createComponent,cr=Zn.delegateEvents,lr=Zn.clearDelegatedEvents,ur=Zn.spread,hr=Zn.assign,dr=Zn.setAttribute,pr=Zn.setAttributeNS,fr=Zn.addEventListener,mr=Zn.classList,gr=Zn.style,vr=Zn.getOwner,yr=Zn.dynamicProperty,br=Zn.hydrate,xr=Zn.gatherHydratable,_r=Zn.getHydrationKey,wr=Zn.getNextElement,Mr=Zn.getNextMarker,Er=Zn.For,Sr=Zn.Show,Tr=Zn.Suspense,Ar=Zn.SuspenseList,Rr=Zn.Switch,Lr=Zn.Match,Cr=Zn.Index,Pr=Zn.ErrorBoundary,Or=Zn.mergeProps,Nr=Zn.isServer,Ir=Zn.Portal,Dr=Zn.Dynamic;var Fr=n(1);let Ur;if(!("customElements"in window))throw new Error("\n\t\tYour browser does not support the Custom Elements v1 API. You'll\n\t\tneed to install a Custom Elements v1 polyfill.\n\t");class Br extends HTMLElement{constructor(){super(...arguments),this.___init___=(()=>{this.__handleInitialPropertyValuesIfAny()})(),this.__root=null,this.__hasShadow=!0,this.__styleRootNode=null,this.__id=Br.__elementId++,this.__dynamicStyle=null}static defineElement(t){customElements.define(t||this.elementName,this)}__handleInitialPropertyValuesIfAny(){const t=Object.keys(this);this._preUpgradeValues=new Map;for(const e of t){const t=Object.getOwnPropertyDescriptor(this,e);"value"in t&&(delete this[e],this._preUpgradeValues.set(e,t.value),Object(Fr.b)(()=>{var n,r;if(null===(n=this.__propsSetAtLeastOnce__)||void 0===n?void 0:n.has(e))return;const i=e in this.__proto__,o=null===(r=this.__reactifiedProps__)||void 0===r?void 0:r.has(e);(i||o)&&(this[e]=t.value)}))}}get root(){return this.__root?this.__root:this.shadowRoot?this.__root=this.shadowRoot:this.__root=this.attachShadow({mode:"open"})}set root(t){if(this.__root||this.shadowRoot)throw new Error("Element root can only be set once if there is no ShadowRoot.");this.__root=t}attachShadow(t){return this.__root&&console.warn("Element already has a root defined."),this.__root=super.attachShadow(t)}connectedCallback(){this.__hasShadow=this.root instanceof ShadowRoot,this.__setStyle();const t=this.template;t&&(this.__dispose=nr("function"==typeof t?t.bind(this):()=>t,this.root))}disconnectedCallback(){this.__dispose&&this.__dispose(),this.__cleanupStyle()}__setStyle(){Ur=this.constructor;const t="function"==typeof Ur.css?Ur.css=Ur.css():Ur.css||"",e="function"==typeof this.css?this.css():this.css||"";if(this.__hasShadow){const n=":host",r=document.createElement("style");r.innerHTML=`\n\t\t\t\t${n} { display: block; }\n\t\t\t\t${t}\n\t\t\t\t${e}\n\t\t\t`,this.root.appendChild(r)}else{const n=this.getRootNode();this.__styleRootNode=n===document?document.head:n;let r=Br.__styleRootNodeRefCountPerTagName.get(this.__styleRootNode);r||Br.__styleRootNodeRefCountPerTagName.set(this.__styleRootNode,r={});const i=r[this.tagName]||0;if(r[this.tagName]=i+1,0===i){const e=this.tagName.toLowerCase(),n=document.createElement("style");n.innerHTML=`\n\t\t\t\t\t${e} { display: block; }\n\t\t\t\t\t${t?t.replace(":host",e):t}\n\t\t\t\t`,n.id=this.tagName.toLowerCase(),this.__styleRootNode.appendChild(n)}if(e){const t=this.tagName.toLowerCase()+"-"+this.__id;this.setAttribute(t,"");const n=this.__dynamicStyle=document.createElement("style");n.id=t,n.innerHTML=e.replace(":host",`[${t}]`);const r=this.getRootNode();this.__styleRootNode=r===document?document.head:r,this.__styleRootNode.appendChild(n)}}}__cleanupStyle(){do{if(this.__hasShadow)break;const t=Br.__styleRootNodeRefCountPerTagName.get(this.__styleRootNode);if(!t)break;let e=t[this.tagName];if(void 0===e)break;if(t[this.tagName]=--e,0===e){delete t[this.tagName];const e=this.__styleRootNode.querySelector("#"+this.tagName);null==e||e.remove()}}while(0);this.__dynamicStyle&&this.__dynamicStyle.remove()}adoptedCallback(){}}var kr;Br.elementName="",Br.__styleRootNodeRefCountPerTagName=new WeakMap,Br.__elementId=0;const zr=Object(Xn.a)(),Hr=null!==(kr=zr.SOLID)&&void 0!==kr?kr:zr.SOLID=r,{createSignal:Gr,createEffect:jr,createRoot:Vr,untrack:Wr}=Hr;function qr(){return this()}function Xr(t){return this(t)}function Yr(t){const[e,n]=Gr(t),r=t=>void 0===t?e():(n(t),t),i=qr.bind(r),o=Xr.bind(r);return r.get=i,r.set=o,r[0]=i,r[1]=o,r[Symbol.iterator]=function*(){yield r[0],yield r[1]},r}function Zr(t){let e;return Vr(n=>{e=n,jr(t)}),e}function Jr(t,e,n){const r=1===arguments.length&&"kind"in t;if(r){const e=t;return"class"===e.kind?{...e,finisher:Kr}:{...e,finisher(t){var n,r;return $r(t,e.key),null!==(r=null===(n=e.finisher)||void 0===n?void 0:n.call(e,t))&&void 0!==r?r:t}}}if(1===arguments.length&&"function"==typeof t){return Kr(t)}const i=t.constructor;$r(i,e)}function $r(t,e){t.reactiveProperties&&t.hasOwnProperty("reactiveProperties")||(t.reactiveProperties=[]),t.reactiveProperties.includes(e)||t.reactiveProperties.push(e)}function Kr(t){var e;return t.hasOwnProperty("__isReactive__")?t:((e=class extends t{constructor(...e){super(...e),ei(this,t)}}).__isReactive__=!0,e)}function Qr(t,e){const n="v_"+e;let r,i,o,s=Object(u.e)(t,e);if(s)if(r=s.get,i=s.set,r||i){if(!r||!i)return void console.warn('The `@reactive` decorator was used on an accessor named "'+e+'" which had a getter or a setter, but not both. Reactivity on accessors works only when accessors have both get and set. In this case the decorator does not do anything.');delete s.get,delete s.set}else{if(o=s.value,!s.writable)return void console.warn("The `@reactive` decorator was used on a property named "+e+" that is not writable. Reactivity is not enabled for non-writable properties.");delete s.value,delete s.writable}s={configurable:!0,enumerable:!0,...s,get:r?function(){return ti(this,n,o)(),r.call(this)}:function(){return ti(this,n,o)()},set:i?function(t){i.call(this,t);ti(this,n)(t),this.__propsSetAtLeastOnce__||(this.__propsSetAtLeastOnce__=new Set),this.__propsSetAtLeastOnce__.add(e)}:function(t){ti(this,n)(t),this.__propsSetAtLeastOnce__||(this.__propsSetAtLeastOnce__=new Set),this.__propsSetAtLeastOnce__.add(e)}},t.__reactifiedProps__||(t.__reactifiedProps__=new Set),t.__reactifiedProps__.add(e),Object.defineProperty(t,e,s)}function ti(t,e,n){let r=t[e];return r||(t[e]=r=Yr(n),r)}function ei(t,e){if(function(t){return"function"==typeof t}(e)){const n=e.reactiveProperties;Array.isArray(n)&&ni(t,n)}else{ni(t,e)}return t}function ni(t,e){var n;for(const r of e){if(null===(n=t.__reactifiedProps__)||void 0===n?void 0:n.has(r))continue;const e=t[r];Qr(t,r),t[r]=e}}const ri=Wr;function ii(t,e,n,r){let i=!0;const o=Zr(()=>{const e=t();i&&!(i=!1)?r(e):i=!0}),s=Zr(()=>{const t=n();i&&!(i=!1)?e(t):i=!0});return function(){o(),s()}}function oi(t,e,n){if(t&&"kind"in t){const e=t;return{...e,finisher(t){var n;return si(t.prototype,e.key),null!==(n=e.finisher&&e.finisher(t))&&void 0!==n?n:t}}}if(t&&e){return si(t,e,n)}const r=t;return(t,e,n)=>{if(t&&"kind"in t){const e=t;return{...e,finisher(t){var n;return si(t.prototype,e.key,void 0,r),null!==(n=e.finisher&&e.finisher(t))&&void 0!==n?n:t}}}return si(t,e,n,r)}}function si(t,e,n,r){const i=t.constructor;if(!i.observedAttributes||!i.hasOwnProperty("observedAttributes")){const t=i.__proto__.observedAttributes;if(t&&!Array.isArray(t))throw new TypeError("observedAttributes is in the wrong format. Maybe you forgot to decorate your custom element class with the `element` decorator.");Object(Fr.c)(i,"observedAttributes",[...t||[]])}if(!Array.isArray(i.observedAttributes))throw new TypeError("observedAttributes is in the wrong format. Maybe you forgot to decorate your custom element class with the `element` decorator.");const o=Object(Fr.a)(e);if(i.observedAttributes.includes(o)||i.observedAttributes.push(o),i.reactiveProperties&&i.hasOwnProperty("reactiveProperties")||Object(Fr.c)(i,"reactiveProperties",[...i.reactiveProperties||[]]),i.reactiveProperties.includes(e)||i.reactiveProperties.push(e),function(t,e,n,r){if(!t.__hasAttributeChangedCallback){t.__hasAttributeChangedCallback=!0;const e=t.attributeChangedCallback;t.attributeChangedCallback=function(n,r,i){var o,s;e?e.call(this,n,r,i):null===(s=null===(o=t.__proto__)||void 0===o?void 0:o.attributeChangedCallback)||void 0===s||s.call(this,n,r,i);const a=this.__attributesToProps&&this.__attributesToProps[n];if(a){const t=a.attributeHandler;this[a.name]=t&&t.from?t.from(i):i}}}t.hasOwnProperty("__attributesToProps")||Object.defineProperty(t,"__attributesToProps",{value:{__proto__:t.__attributesToProps||Object.prototype}});t.__attributesToProps[e]&&console.warn('The `@attribute` decorator is overriding an already-existing attribute-to-property mapping for the "'+e+'" attribute.');t.__attributesToProps[e]={name:n,attributeHandler:r}}(t,o,e,r),n)return n}function ai(t=""){return oi(oi.string(t))}function ci(t=0){return oi(oi.number(t))}function li(t=!1){return oi(oi.boolean(t))}function ui(t,e=!0){let n="";if("function"==typeof t){e=!1;return r(t)}return n=t,r;function r(t){if("kind"in t){return{...t,finisher:i}}return i(t)}function i(t){const r=t.observedAttributes;if(t.hasOwnProperty("elementName")?n=t.elementName||n:t.elementName=n,Array.isArray(r));else if(r&&"object"==typeof r){t.observedAttributes=void 0;for(const e in r)si(t.prototype,e,void 0,r[e])}const i=Jr(t);class o extends i{constructor(...t){if(super(...t),this instanceof Br)for(const[t,e]of this._preUpgradeValues){if(!(t in this))continue;this._preUpgradeValues.delete(t);const n=Object.getOwnPropertyDescriptor(this,t);n&&"value"in n&&delete this[t],this[t]=e}}}return n&&e&&customElements.define(n,o),o}}oi.string=(t="")=>({default:t,from(t){return null==t?this.default:t}}),oi.number=(t=0)=>({default:t,from(t){return null==t?this.default:+t}}),oi.boolean=(t=!1)=>({default:t,from(t){return null==t?this.default:"false"!==t}});const hi=Fr.d;var di,pi,fi,mi,gi,vi,yi,bi;vi=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,di=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,pi={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},fi=function(t){var e;e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]};const n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(e.name=n[1],(pi[n[1].toLowerCase()]||"/"===t.charAt(t.length-2))&&(e.voidElement=!0),e.name.startsWith("!--"))){const e=t.indexOf("--\x3e");return{type:"comment",comment:-1!==e?t.slice(4,e):""}}const r=new RegExp(di);let i=null;for(;i=r.exec(t),null!==i;)if(i[0].trim())if(i[1]){const t=i[1].trim();let n=[t,""];t.indexOf("=")>-1&&(n=t.split("=")),e.attrs[n[0]]=n[1],r.lastIndex--}else i[2]&&(e.attrs[i[2]]=i[3].trim().substring(1,i[3].length-1));return e},gi=function(t,e,n){var r,i;i=e.indexOf("<",n),r=e.slice(n,-1===i?void 0:i),/^\s*$/.test(r)||t.push({type:"text",content:r})},mi=function(t,e){var n;n=e.replace("\x3c!--","").replace("--\x3e",""),/^\s*$/.test(n)||t.push({type:"comment",content:n})},yi=function(t){var e,n;for(n in e=[],t)e.push(n+'="'+t[n]+'"');return e.length?" "+e.join(" "):""},bi=function(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?yi(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(bi,"")+"</"+e.name+">";case"comment":return t+"\x3c!--"+e.content+"--\x3e"}};const xi=new Map,_i=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,wi=" \\f\\n\\r\\t",Mi="[ "+wi+"]+[^  \\f\\n\\r\\t\\/>\"'=]+",Ei="(?:\\s*=\\s*(?:'[^']*?'|\"[^\"]*?\"|\\([^)]*?\\)|<[^>]*?>|[^  \\f\\n\\r\\t\\/>\"'=]+))?)",Si=new RegExp("<([A-Za-z$#]+[A-Za-z0-9:_-]*)((?:"+Mi+Ei+"+)([ "+wi+"]*/?>)","g"),Ti=new RegExp("("+Mi+"\\s*=\\s*)(['\"(]?)\x3c!--#--\x3e(['\")]?)","gi"),Ai=new RegExp("<([A-Za-z$#]+[A-Za-z0-9:_-]*)((?:"+Mi+Ei+"*)([ "+wi+"]*/>)","g"),Ri=new Set(["class","on","style","use","prop","attr"]);function Li(t,e,n,r){return"<"+e+n.replace(Ti,Ci)+r}function Ci(t,e,n,r){return e+(n||'"')+"###"+(r||'"')}function Pi(t,e,n){return _i.test(e)?t:"<"+e+n+"></"+e+">"}var Oi,Ni=function(t,{delegateEvents:e=!0}={}){let n=1;function r(e){let r=0,i="";for(;r<e.length-1;r++)i=i+e[r]+"\x3c!--#--\x3e";i+=e[r],i=i.replace(Ai,Pi).replace(/<(<!--#-->)/g,"<###").replace(Si,Li).replace(/>\n+\s*/g,">").replace(/\n+\s*</g,"<").replace(/\s+</g," <").replace(/>\s+/g,"> ");const[a,c]=function(e){const r={path:"",decl:[],exprs:[],delegatedEvents:new Set,counter:0,first:!0,multi:!1,templateId:0,templateNodes:[]},i=n,a=e;let c;e.length>1&&(e=[{type:"fragment",children:e}]);"###"===e[0].name?(c=!0,o(e[0],r)):s(e[0],r);t.delegateEvents(Array.from(r.delegatedEvents));return[[a].concat(r.templateNodes).map(t=>t.reduce((function(t,e){return t+bi("",e)}),"")),new Function("tmpls","exprs","r",r.decl.join(",\n")+";\n"+r.exprs.join(";\n")+(c?"":`;\nreturn _$el${i};\n`))]}(function(t){var e,n,r,i,o;return o=[],r=void 0,i=-1,e=[],n={},t.replace(vi,(function(s,a){var c,l,u,h,d;l="/"!==s.charAt(1),c="\x3c!--"===s.slice(0,4),d=a+s.length,u=t.charAt(d),h=void 0,l&&!c&&(i++,!(r=fi(s)).voidElement&&u&&"<"!==u&&gi(r.children,t,d),n[r.tagName]=r,0===i&&o.push(r),(h=e[i-1])&&h.children.push(r),e[i]=r),c&&mi(i<0?o:e[i].children,s),(c||!l||r.voidElement)&&(c||i--,"<"!==u&&u&&(h=-1===i?o:e[i].children,gi(h,t,d)))})),o}(i)),l=[];for(let t=0;t<a.length;t++){l.push(document.createElement("template")),l[t].innerHTML=a[t];const e=l[t].content.querySelectorAll("script,style");for(let n=0;n<e.length;n++){const r=e[n].firstChild.data||"";if(r.indexOf("\x3c!--#--\x3e")>-1){const n=r.split("\x3c!--#--\x3e").reduce((t,e,n)=>(n&&t.push(""),t.push(e),t),[]);e[t].firstChild.replaceWith(...n)}}}return l[0].create=c,xi.set(e,l),l}function i(r,i,o,s,a){if("on"===i.slice(0,2)&&"on"!==i&&"onCapture"!==i){const n=i.slice(2).toLowerCase(),o=e&&t.DelegatedEvents.has(n);a.exprs.push(`r.addEventListener(${r},"${n}",exprs[${a.counter++}],${o})`),o&&a.delegatedEvents.add(n)}else if("ref"===i)a.exprs.push(`exprs[${a.counter++}](${r})`);else{const e=Object.assign({},a,{exprs:[]}),c=a.counter;!function(e,r,i,o,s){let a,c,l=s.counter++,u=`!doNotWrap ? exprs[${l}]() : exprs[${l}]`;(a=r.split(":"))&&a[1]&&Ri.has(a[0])&&(r=a[1],c=a[0]);const h=t.ChildProperties.has(r),d=t.Properties.has(r);if("style"===r)s.exprs.push(`r.style(${e}, ${u})`);else if("classList"===r)s.exprs.push(`r.classList(${e}, ${u})`);else if("on"===r||"onCapture"===r){const t=n++;s.exprs.push(`const v${t} = ${u}`,`for (const e in v${t}) ${e}.addEventListener(e,v${t}[e]${"onCapture"===r?",true":""})`)}else if("attr"!==c&&(h||!i&&d||o||"prop"===c))!o||h||d||"prop"===c||(r=function(t){return t.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}(r)),s.exprs.push(`${e}.${r} = ${u}`);else{const n=i&&r.indexOf(":")>-1&&t.SVGNamespace[r.split(":")[0]];n?s.exprs.push(`r.setAttributeNS(${e},"${n}","${r}",${u})`):s.exprs.push(`r.setAttribute(${e},"${t.Aliases[r]||r}",${u})`)}}(r,i,o,s,e),a.decl.push(`_fn${c} = doNotWrap => {\n${e.exprs.join(";\n")};\n}`),a.exprs.push(`typeof exprs[${c}] === "function" ? r.effect(_fn${c}) : _fn${c}(true)`),a.counter=e.counter,a.wrap=!1}}function o(t,e){const r=Object.keys(t.attrs),i=[],o=e.counter++;for(let n=0;n<r.length;n++){const o=r[n],s=t.attrs[o];if("###"===s){let t=e.counter++;i.push(`${o}: exprs[${t}]`)}else i.push(`${o}: "${s}"`)}if(1===t.children.length&&"comment"===t.children[0].type&&"#"===t.children[0].content)i.push(`children: () => exprs[${e.counter++}]`);else if(t.children.length){const n={type:"fragment",children:t.children},r=Object.assign({},e,{first:!0,decl:[],exprs:[]});s(n,r),i.push(`children: () => { ${r.exprs.join(";\n")}}`),e.templateId=r.templateId,e.counter=r.counter}let a;e.multi&&(a="_$el"+n++,e.decl.push(`${a} = ${e.path}.${e.first?"firstChild":"nextSibling"}`)),e.parent?e.exprs.push(`r.insert(${e.parent}, r.createComponent(exprs[${o}], r.wrapProps({${i.join(", ")||""}}))${a?", "+a:""})`):e.exprs.push(`${e.fragment?"":"return "}r.createComponent(exprs[${o}], r.wrapProps({${i.join(", ")||""}}))`),e.path=a,e.first=!1}function s(e,r){if("fragment"===e.type){const t=[];e.children.forEach(e=>{if("tag"===e.type){if("###"===e.name){const n=Object.assign({},r,{first:!0,fragment:!0,decl:[],exprs:[]});return o(e,n),t.push(n.exprs[0]),r.counter=n.counter,void(r.templateId=n.templateId)}r.templateId++;const i=n,a=Object.assign({},r,{first:!0,decl:[],exprs:[]});s(e,a),r.templateNodes.push([e]),t.push(`function() { ${a.decl.join(",\n")+";\n"+a.exprs.join(";\n")+`;\nreturn _$el${i};\n`}}()`),r.counter=a.counter,r.templateId=a.templateId}else"text"===e.type?t.push(`"${e.content}"`):"comment"===e.type&&"#"===e.content&&t.push(`exprs[${r.counter++}]`)}),r.exprs.push(`return [${t.join(", \n")}]`)}else if("tag"===e.type){const a="_$el"+n++;r.decl.push(r.decl.length?`${a} = ${r.path}.${r.first?"firstChild":"nextSibling"}`:`const ${a} = tmpls[${r.templateId}].content.firstChild.cloneNode(true)`);const c=Object.keys(e.attrs),l=t.SVGElements.has(e.name),u=e.name.includes("-");for(let t=0;t<c.length;t++){const n=c[t];"###"===e.attrs[n]&&(delete e.attrs[n],i(a,n,l,u,r))}r.path=a,r.first=!1,function(t,e){const n=Object.assign({},e,{first:!0,multi:!1,parent:e.path});if(t.children.length>1)for(let e=0;e<t.children.length;e++){const r=t.children[e];if("comment"===r.type&&"#"===r.content||"tag"===r.type&&"###"===r.name){n.multi=!0;break}}let r=0;for(;r<t.children.length;){const e=t.children[r];"###"!==e.name?(s(e,n),r++):(n.multi?(t.children[r]={type:"comment",content:"#"},r++):t.children.splice(r,1),o(e,n))}e.counter=n.counter,e.templateId=n.templateId}(e,r)}else if("text"===e.type){const t="_$el"+n++;r.decl.push(`${t} = ${r.path}.${r.first?"firstChild":"nextSibling"}`),r.path=t,r.first=!1}else if("comment"===e.type&&"#"===e.content){const t="_$el"+n++;r.decl.push(`${t} = ${r.path}.${r.first?"firstChild":"nextSibling"}`),r.multi?r.exprs.push(`r.insert(${r.parent}, exprs[${r.counter++}], ${t})`):r.exprs.push(`r.insert(${r.parent}, exprs[${r.counter++}])`),r.path=t,r.first=!1}}return t.wrapProps=e=>{for(const n in e)"function"!=typeof e[n]||e[n].length||t.dynamicProperty(e,n);return e},function(e,...n){const i=xi.get(e)||r(e);return i[0].create(i,n,t)}}({effect:Ct,style:mn,insert:yn,createComponent:De,delegateEvents:ln,classList:fn,dynamicProperty:vn,setAttribute:hn,setAttributeNS:dn,addEventListener:pn,Aliases:Qe,Properties:$e,ChildProperties:Ke,DelegatedEvents:tn,SVGElements:en,SVGNamespace:nn});const Ii=Object(Xn.a)();Ii.SOLID_HTML&&console.warn("\n        Duplicates of a LUME library or dependency detected, conflict avoided.\n        Having duplicates means things may not work as expected if different\n        parts of the application are using different instances of something\n        that should be a singleton.\n    ");const Di=null!==(Oi=Ii.SOLID_HTML)&&void 0!==Oi?Oi:Ii.SOLID_HTML=Ni,Fi=Array.prototype.forEach;class Ui{constructor(t){if(this.ownerDocument=t,this._attrMap=new Map,this._elementMap=new WeakMap,!t)throw new Error("Must be given a document");this._observe()}define(t,e){this._attrMap.set(t,e),this._upgradeAttr(t)}get(t,e){const n=this._elementMap.get(t);if(n)return n.get(e)}_getConstructor(t){return this._attrMap.get(t)}_observe(){const t=this.ownerDocument,e=this._elementDisconnected.bind(this),n=this._elementConnected.bind(this);this._observer=new MutationObserver(t=>{Fi.call(t,t=>{if("attributes"===t.type){this._getConstructor(t.attributeName)&&this._handleChange(t.attributeName,t.target,t.oldValue)}else Fi.call(t.removedNodes,e),Fi.call(t.addedNodes,n)})}),this._observer.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0})}_upgradeAttr(t,e=this.ownerDocument){const n=e.querySelectorAll("["+t+"]");Fi.call(n,e=>this._handleChange(t,e,null))}_elementConnected(t){1===t.nodeType&&(Fi.call(t.attributes,e=>{this._getConstructor(e.name)&&this._handleChange(e.name,t,null)}),this._attrMap.forEach((e,n)=>this._upgradeAttr(n,t)))}_elementDisconnected(t){const e=this._elementMap.get(t);e&&(e.forEach(t=>{var e;return null===(e=t.disconnectedCallback)||void 0===e?void 0:e.call(t)},this),this._elementMap.delete(t))}_handleChange(t,e,n){var r,i,o;let s=this._elementMap.get(e);s||this._elementMap.set(e,s=new Map);let a=s.get(t);const c=e.getAttribute(t);if(!a){if(a=new(this._getConstructor(t)),s.set(t,a),a.ownerElement=e,a.name=t,null==c)throw new Error("Not possible!");return a.value=c,void(null===(r=a.connectedCallback)||void 0===r||r.call(a))}if(null==c)null===(i=a.disconnectedCallback)||void 0===i||i.call(a),s.delete(t);else if(c!==a.value){if(a.value=c,null==n)throw new Error("Not possible!");null===(o=a.changedCallback)||void 0===o||o.call(a,n,c)}}}var Bi;const ki=window;let zi;(null===(Bi=ki.$customAttributes)||void 0===Bi?void 0:Bi.skipPolyfill)||(zi=new Ui(document),ki.customAttributes=zi);const Hi=window.elementBehaviors=new class{constructor(){this._definedBehaviors=new Map}define(t,e){if(this._definedBehaviors.has(t))throw new Error(`Behavior ${t} is already defined.`);this._definedBehaviors.set(t,e)}get(t){return this._definedBehaviors.get(t)}has(t){return this._definedBehaviors.has(t)}};class Gi extends Map{}const ji=new WeakMap;Object.defineProperty(Element.prototype,"behaviors",{get(){let t=null;return ji.has(this)?t=ji.get(this):ji.set(this,t=new Gi),t}});class Vi{constructor(){this.observers=new Map,this.connectedBehaviors=new Set,this.definePromises=new Map}connectedCallback(){this.behaviors=this.ownerElement.behaviors,this.changedCallback("",this.value)}disconnectedCallback(){this.changedCallback(this.value,""),this.observers.clear(),this.connectedBehaviors.clear();for(const[,t]of this.definePromises)t.cancel();this.definePromises.clear(),delete this.behaviors}changedCallback(t,e){const n=this.getBehaviorNames(e),r=Array.from(this.behaviors.keys());if(0==n.length&&0==r.length)return;const{removed:i,added:o}=this.getDiff(r,n);this.handleDiff(i,o)}getBehaviorNames(t){return""==t.trim()?[]:t.split(/\s+/)}getDiff(t,e){const n={removed:[],added:e};for(let e=0,r=t.length;e<r;e+=1){const r=t[e];n.added.includes(r)?n.added.splice(n.added.indexOf(r),1):n.removed.push(r)}return n}handleDiff(t,e){for(const e of t)this.disconnectBehavior(e);for(const t of e)this.connectBehavior(t)}connectBehavior(t){const e=Hi.get(t);if(!e)return;const n=new e(this.ownerElement);this.behaviors.set(t,n);const r=n.constructor.observedAttributes;if(this.ownerElement.isConnected){const e=this.ownerElement.tagName;if(n.awaitElementDefined&&e.includes("-")){const r=t+"_"+e;let i=this.definePromises.get(r);i||(i=new qi(customElements.whenDefined(e.toLowerCase()),{rejectOnCancel:!1}),this.definePromises.set(r,i)),i.then(()=>{this.definePromises.delete(r),this.connectedBehaviors.add(n),n.connectedCallback&&n.connectedCallback()})}else this.connectedBehaviors.add(n),n.connectedCallback&&n.connectedCallback()}Array.isArray(r)&&r.length&&(this.fireInitialAttributeChangedCallbacks(n,r),this.createAttributeObserver(n))}disconnectBehavior(t){const e=this.behaviors.get(t);if(e){{this.connectedBehaviors.has(e)&&(e.disconnectedCallback&&e.disconnectedCallback(),this.connectedBehaviors.delete(e));const n=t+"_"+this.ownerElement.tagName,r=this.definePromises.get(n);r&&(r.cancel(),this.definePromises.delete(n))}this.destroyAttributeObserver(e),this.behaviors.delete(t)}}destroyAttributeObserver(t){const e=this.observers.get(t);e&&(e.disconnect(),this.observers.delete(t))}createAttributeObserver(t){const e=this.ownerElement,n=new MutationObserver(n=>{if(!t.attributeChangedCallback)return;let r,i={},o="";for(const e of n)"attributes"===e.type&&(o=e.attributeName,void 0!==i[o]?(t.attributeChangedCallback(o,i[o],e.oldValue),i[o]=e.oldValue):i[o]=e.oldValue);for(const n in i)r=e.attributes.getNamedItem(n),t.attributeChangedCallback(n,i[n],null===r?null:r.value)});n.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:t.constructor.observedAttributes}),this.observers.set(t,n)}fireInitialAttributeChangedCallbacks(t,e){if(t.attributeChangedCallback)for(const n of e)this.ownerElement.hasAttribute(n)&&t.attributeChangedCallback(n,null,this.ownerElement.attributes.getNamedItem(n).value)}}const Wi=function(){const t=new WeakMap;return e=>{let n=t.get(e);return n||t.set(e,n={}),n}}();class qi extends Promise{constructor(t,e){const n=!!e&&e.rejectOnCancel;let r;if(t instanceof Promise){const e=t;super((t,n)=>{r=n,e.then(e=>{this.canceled||t(e)}).catch(t=>{this.canceled||n(t)})})}else super((e,n)=>{r=n,t(t=>{this.canceled||e(t)},t=>{this.canceled||n(t)})});this.canceled=!1,Wi(this).originalReject=r,Wi(this).rejectOnCancel=n}cancel(){this.canceled=!0,Wi(this).rejectOnCancel&&Wi(this).originalReject(new Xi("canceled"))}}class Xi extends Error{}if(zi.define("has",Vi),Element.prototype.attachShadow){const t=Element.prototype.attachShadow;Element.prototype.attachShadow=function(...e){const n=t.call(this,...e);return new Ui(n).define("has",Vi),n}}const Yi=new WeakMap;const Zi=new WeakMap;function Ji(t,e,n){let r;const i=n.inherited;if(!i)if(r=Zi.get(t),r){if(r.has(e))return}else Zi.set(t,r=new Set);const o=Object(u.e)(t,e)||{value:void 0,writable:!0,configurable:!0,enumerable:!0},s=n.inherited&&o.owner||t;if(i)if(r=Zi.get(s),r){if(r.has(e))return}else Zi.set(s,r=new Set);let a,c;if(o.get||o.set){const e=o.get,n=o.set;a=e?()=>e.call(t):void 0,c=n?e=>n.call(t,e):void 0}else{let n=o.value;if(!o.writable)throw console.error(`Can not observe readonly property "${e}" with descriptor`,o,"of object:",t),new Error(`Can not observe readonly property "${e}" of object: ${t} (see above)`);delete o.value,delete o.writable,a=()=>n,c=t=>n=t}if(!c)throw new Error("Can not observe read-only property.");if(!a)throw new Error("Can not observe write-only property.");Object.defineProperty(s,e,{...o,get:a,set(n){c(n),function(t,e,n){const r=Yi.get(t).get(e);if(!r)return;for(const t of r)t(e,n)}(t,e,a())}}),r.add(e)}var $i=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};function Ki(t=Object){var e,n,r,i;return i=class extends t{constructor(...t){super(...t),e.add(this),this._propChangedCallback=this._propChangedCallback.bind(this)}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this._forwardInitialProps(),$i(this,e,"m",n).call(this)}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),$i(this,e,"m",r).call(this)}get _observedObject(){throw new TypeError("\n                The subclass using ForwardProps must define a protected\n                _observedObject property defining the object from which props\n                are forwarded.\n            ")}_propChangedCallback(t,e){this[t]=e}_forwardedProps(){const t=this.constructor._observedProperties||[];if(!Array.isArray(t))throw new TypeError("Expected protected static _observedProperties to be an array.");return t}_forwardInitialProps(){const t=this._observedObject;for(const e of this._forwardedProps())e in t&&this._propChangedCallback(e,t[e])}},e=new WeakSet,n=function(){!function(t,e,n,r={}){r.async=r.async||!1,r.inherited=r.inherited||!1;for(const i of e){let e=Yi.get(t);!e&&Yi.set(t,e=new Map);let o=e.get(i);o?o.includes(n)||o.push(n):(e.set(i,o=[]),o.push(n),Ji(t,i,r))}}(this._observedObject,this._forwardedProps(),this._propChangedCallback,{})},r=function(){!function(t,e,n){const r=Yi.get(t);if(r){if("function"==typeof e&&(n=e,e=Array.from(r.keys())),!n)throw new TypeError("callback not supplied");for(const t of e){const e=r.get(t);e.includes(n)&&(e.splice(e.indexOf(n),1),e.length||r.delete(t))}}else console.warn("the object is not observed, no need to unobserve:",t)}(this._observedObject,this._forwardedProps(),this._propChangedCallback)},i}function Qi(t){return Math.abs(t)<1e-6?0:t}function to(t,e,n,r){const i=eo(e,n,r);return i.observe(t,{childList:!0}),i}function eo(t,e,n=!1){return new MutationObserver(r=>{const i=new Map;for(let t=0,e=r.length;t<e;t+=1){const e=r[t];if("childList"!=e.type)continue;let n=i.get(e.target);n||i.set(e.target,n=new Map);const{addedNodes:o}=e;for(let t=o.length,e=0;e<t;e+=1)n.set(o[e],(n.get(o[e])||0)+1);const{removedNodes:s}=e;for(let t=s.length,e=0;e<t;e+=1)n.set(s[e],(n.get(s[e])||0)-1)}for(const r of Array.from(i)){const[i,o]=r;for(const r of Array.from(o)){const[o,s]=r;n&&(o instanceof Text||o instanceof Comment)||(s>0&&"function"==typeof t?t.call(i,o):s<0&&"function"==typeof e&&e.call(i,o))}}})}function no(){return new Promise(t=>{if(document.body)return t();const e=new MutationObserver(()=>{document.body&&(t(),e.disconnect())});e.observe(document.documentElement,{childList:!0})})}function ro(t){return t/180*Math.PI}function io(t){return Promise.resolve().then(t)}function oo(t){throw new Error(t)}function so(t){return t.split("\n").map(t=>t.trim()).join("\n")}function ao(t){return"string"==typeof t?t.split(/([_A-Z])/).reduce((t,e,n)=>`${t}${t&&n%2!=0?"-":""}${(e="_"===e?"":e).toLowerCase()}`):t}function co(t){return null==t}function lo(t){return Array.from(new Set(t))}function uo(t,e){let n={};return e.forEach(e=>{n[e]=t[e]}),n}function ho(t){return t}var po,fo,mo,go,vo,yo,bo=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},xo=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};class _o extends(Ki()){constructor(t){super(),po.add(this),this.awaitElementDefined=!0,fo.set(this,null),mo.set(this,!1),go.set(this,!1),bo(this,po,"m",yo).call(this,t),this.element=t}requiredElementType(){return[Element]}get _observedObject(){return this.element}_forwardInitialProps(){super._forwardInitialProps(),bo(this,po,"m",vo).call(this)}}fo=new WeakMap,mo=new WeakMap,go=new WeakMap,po=new WeakSet,vo=function(){if(bo(this,go,"f"))return;const t=this._observedObject;if(function(t){return"_preUpgradeValues"in t}(t)){xo(this,go,!0,"f");for(const e of this._forwardedProps()){const n=t._preUpgradeValues.get(e);void 0!==n&&this._propChangedCallback(e,n)}}},yo=async function(t){const e=this.requiredElementType();if(!t.nodeName.includes("-")){const n=`\n\t\t\t\tThe element you're using the mesh behavior on (<${t.tagName.toLowerCase()}>)\n\t\t\t\tis not an instance of one of the following classes:\n\t\t\t`;throw io(()=>console.error(n,e)),new Error(`${n}\n\n\t\t\t\t${e}\n\t\t\t`)}if(xo(this,fo,customElements.whenDefined(t.nodeName.toLowerCase()),"f"),bo(this,fo,"f").then(()=>{xo(this,mo,e.some(e=>t instanceof e),"f"),bo(this,po,"m",vo).call(this)}),await Promise.race([bo(this,fo,"f"),new Promise(t=>setTimeout(t,1e3))]),!bo(this,mo,"f")){const n=`\n\t\t\t\t\tEither the element you're using the behavior on\n\t\t\t\t\t(<${t.tagName.toLowerCase()}>) is not an instance of one\n\t\t\t\t\tof the allowed classes, or there was a 1-second timeout waiting\n\t\t\t\t\tfor the element to be defined. Please make sure all elements\n\t\t\t\t\tyou intend to use are defined. The allowed classes are:\n\t\t\t\t`;throw io(()=>console.error(n,e)),new Error(`${n}\n\n\t\t\t\t\t${e}\n\t\t\t\t`)}};class wo{constructor(t,e,n,r,i,o,s,a,c){this.GL_LOAD=t,this.GL_UNLOAD=e,this.CSS_LOAD=n,this.CSS_UNLOAD=r,this.BEHAVIOR_GL_LOAD=i,this.BEHAVIOR_GL_UNLOAD=o,this.MODEL_LOAD=s,this.MODEL_ERROR=a,this.PROGRESS=c}}const Mo=Eo(wo);function Eo(t){const e={};for(const n in new t)e[n]=n;return Object.freeze(e)}const So=[];for(let t=0;t<256;t++)So[t]=(t<16?"0":"")+t.toString(16);let To=1234567;const Ao={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(So[255&t]+So[t>>8&255]+So[t>>16&255]+So[t>>24&255]+"-"+So[255&e]+So[e>>8&255]+"-"+So[e>>16&15|64]+So[e>>24&255]+"-"+So[63&n|128]+So[n>>8&255]+"-"+So[n>>16&255]+So[n>>24&255]+So[255&r]+So[r>>8&255]+So[r>>16&255]+So[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(To=t%2147483647),To=16807*To%2147483647,(To-1)/2147483646},degToRad:function(t){return t*Ao.DEG2RAD},radToDeg:function(t){return t*Ao.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),l=o((e+r)/2),u=s((e+r)/2),h=o((e-r)/2),d=s((e-r)/2),p=o((r-e)/2),f=s((r-e)/2);switch(i){case"XYX":t.set(a*u,c*h,c*d,a*l);break;case"YZY":t.set(c*d,a*u,c*h,a*l);break;case"ZXZ":t.set(c*h,c*d,a*u,a*l);break;case"XZX":t.set(a*u,c*f,c*p,a*l);break;case"YXY":t.set(c*p,a*u,c*f,a*l);break;case"ZYZ":t.set(c*f,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class Ro{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return n.copy(t).slerp(e,r)}static slerpFlat(t,e,n,r,i,o,s){let a=n[r+0],c=n[r+1],l=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||c!==d||l!==p){let t=1-s;const e=a*h+c*d+l*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,e*n);t=Math.sin(t*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*t+h*i,c=c*t+d*i,l=l*t+p*i,u=u*t+f*i,t===1-s){const t=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=t,c*=t,l*=t,u*=t}}t[e]=a,t[e+1]=c,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,o){const s=n[r],a=n[r+1],c=n[r+2],l=n[r+3],u=i[o],h=i[o+1],d=i[o+2],p=i[o+3];return t[e]=s*p+l*u+a*d-c*h,t[e+1]=a*p+l*h+c*u-s*d,t[e+2]=c*p+l*d+s*h-a*u,t[e+3]=l*p-s*u-a*h-c*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,o=t._order,s=Math.cos,a=Math.sin,c=s(n/2),l=s(r/2),u=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(o){case"XYZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"YXZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"ZXY":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"ZYX":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"YZX":this._x=h*l*u+c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u-h*d*p;break;case"XZY":this._x=h*l*u-c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],s=e[5],a=e[9],c=e[2],l=e[6],u=e[10],h=n+s+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(l-a)*t,this._y=(i-c)*t,this._z=(o-r)*t}else if(n>s&&n>u){const t=2*Math.sqrt(1+n-s-u);this._w=(l-a)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(i+c)/t}else if(s>u){const t=2*Math.sqrt(1+s-n-u);this._w=(i-c)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+u-n-s);this._w=(o-r)/t,this._x=(i+c)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ao.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,o=t._w,s=e._x,a=e._y,c=e._z,l=e._w;return this._x=n*l+o*s+r*c-i*a,this._y=r*l+o*a+i*s-n*c,this._z=i*l+o*c+n*a-r*s,this._w=o*l-n*s-r*a-i*c,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*t._w+n*t._x+r*t._y+i*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),u=Math.sin((1-e)*l)/c,h=Math.sin(e*l)/c;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Lo{constructor(t=0,e=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Po.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Po.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,s=t.z,a=t.w,c=a*e+o*r-s*n,l=a*n+s*e-i*r,u=a*r+i*n-o*e,h=-i*e-o*n-s*r;return this.x=c*a+h*-i+l*-s-u*-o,this.y=l*a+h*-o+u*-i-c*-s,this.z=u*a+h*-s+c*-o-l*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,o=e.x,s=e.y,a=e.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Co.copy(this).projectOnVector(t),this.sub(Co)}reflect(t){return this.sub(Co.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ao.clamp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Co=new Lo,Po=new Ro;class Oo{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Oo).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/No.setFromMatrixColumn(t,0).length(),i=1/No.setFromMatrixColumn(t,1).length(),o=1/No.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),c=Math.sin(r),l=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){const t=o*l,n=o*u,r=s*l,i=s*u;e[0]=a*l,e[4]=-a*u,e[8]=c,e[1]=n+r*c,e[5]=t-i*c,e[9]=-s*a,e[2]=i-t*c,e[6]=r+n*c,e[10]=o*a}else if("YXZ"===t.order){const t=a*l,n=a*u,r=c*l,i=c*u;e[0]=t+i*s,e[4]=r*s-n,e[8]=o*c,e[1]=o*u,e[5]=o*l,e[9]=-s,e[2]=n*s-r,e[6]=i+t*s,e[10]=o*a}else if("ZXY"===t.order){const t=a*l,n=a*u,r=c*l,i=c*u;e[0]=t-i*s,e[4]=-o*u,e[8]=r+n*s,e[1]=n+r*s,e[5]=o*l,e[9]=i-t*s,e[2]=-o*c,e[6]=s,e[10]=o*a}else if("ZYX"===t.order){const t=o*l,n=o*u,r=s*l,i=s*u;e[0]=a*l,e[4]=r*c-n,e[8]=t*c+i,e[1]=a*u,e[5]=i*c+t,e[9]=n*c-r,e[2]=-c,e[6]=s*a,e[10]=o*a}else if("YZX"===t.order){const t=o*a,n=o*c,r=s*a,i=s*c;e[0]=a*l,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=o*l,e[9]=-s*l,e[2]=-c*l,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){const t=o*a,n=o*c,r=s*a,i=s*c;e[0]=a*l,e[4]=-u,e[8]=c*l,e[1]=t*u+i,e[5]=o*l,e[9]=n*u-r,e[2]=r*u-n,e[6]=s*l,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Do,t,Fo)}lookAt(t,e,n){const r=this.elements;return ko.subVectors(t,e),0===ko.lengthSq()&&(ko.z=1),ko.normalize(),Uo.crossVectors(n,ko),0===Uo.lengthSq()&&(1===Math.abs(n.z)?ko.x+=1e-4:ko.z+=1e-4,ko.normalize(),Uo.crossVectors(n,ko)),Uo.normalize(),Bo.crossVectors(ko,Uo),r[0]=Uo.x,r[4]=Bo.x,r[8]=ko.x,r[1]=Uo.y,r[5]=Bo.y,r[9]=ko.y,r[2]=Uo.z,r[6]=Bo.z,r[10]=ko.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],l=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=r[0],w=r[4],M=r[8],E=r[12],S=r[1],T=r[5],A=r[9],R=r[13],L=r[2],C=r[6],P=r[10],O=r[14],N=r[3],I=r[7],D=r[11],F=r[15];return i[0]=o*_+s*S+a*L+c*N,i[4]=o*w+s*T+a*C+c*I,i[8]=o*M+s*A+a*P+c*D,i[12]=o*E+s*R+a*O+c*F,i[1]=l*_+u*S+h*L+d*N,i[5]=l*w+u*T+h*C+d*I,i[9]=l*M+u*A+h*P+d*D,i[13]=l*E+u*R+h*O+d*F,i[2]=p*_+f*S+m*L+g*N,i[6]=p*w+f*T+m*C+g*I,i[10]=p*M+f*A+m*P+g*D,i[14]=p*E+f*R+m*O+g*F,i[3]=v*_+y*S+b*L+x*N,i[7]=v*w+y*T+b*C+x*I,i[11]=v*M+y*A+b*P+x*D,i[15]=v*E+y*R+b*O+x*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],s=t[5],a=t[9],c=t[13],l=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-r*c*u-i*s*h+n*c*h+r*s*d-n*a*d)+t[7]*(+e*a*d-e*c*h+i*o*h-r*o*d+r*c*l-i*a*l)+t[11]*(+e*c*u-e*s*d-i*o*u+n*o*d+i*s*l-n*c*l)+t[15]*(-r*s*l-e*a*u+e*s*h+r*o*u-n*o*h+n*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=u*m*c-f*h*c+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*c-l*m*c-p*a*d+o*m*d+l*a*g-o*h*g,b=l*f*c-p*u*c+p*s*d-o*f*d-l*s*g+o*u*g,x=p*u*a-l*f*a-p*s*h+o*f*h+l*s*m-o*u*m,_=e*v+n*y+r*b+i*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return t[0]=v*w,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,t[2]=(s*m*i-f*a*i+f*r*c-n*m*c-s*r*g+n*a*g)*w,t[3]=(u*a*i-s*h*i-u*r*c+n*h*c+s*r*d-n*a*d)*w,t[4]=y*w,t[5]=(l*m*i-p*h*i+p*r*d-e*m*d-l*r*g+e*h*g)*w,t[6]=(p*a*i-o*m*i-p*r*c+e*m*c+o*r*g-e*a*g)*w,t[7]=(o*h*i-l*a*i+l*r*c-e*h*c-o*r*d+e*a*d)*w,t[8]=b*w,t[9]=(p*u*i-l*f*i-p*n*d+e*f*d+l*n*g-e*u*g)*w,t[10]=(o*f*i-p*s*i+p*n*c-e*f*c-o*n*g+e*s*g)*w,t[11]=(l*s*i-o*u*i-l*n*c+e*u*c+o*n*d-e*s*d)*w,t[12]=x*w,t[13]=(l*f*r-p*u*r+p*n*h-e*f*h-l*n*m+e*u*m)*w,t[14]=(p*s*r-o*f*r-p*n*a+e*f*a+o*n*m-e*s*m)*w,t[15]=(o*u*r-l*s*r+l*n*a-e*u*a-o*n*h+e*s*h)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,s=t.y,a=t.z,c=i*o,l=i*s;return this.set(c*o+n,c*s-r*a,c*a+r*s,0,c*s+r*a,l*s+n,l*a-r*o,0,c*a-r*s,l*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,o=e._y,s=e._z,a=e._w,c=i+i,l=o+o,u=s+s,h=i*c,d=i*l,p=i*u,f=o*l,m=o*u,g=s*u,v=a*c,y=a*l,b=a*u,x=n.x,_=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-b)*_,r[5]=(1-(h+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=No.set(r[0],r[1],r[2]).length();const o=No.set(r[4],r[5],r[6]).length(),s=No.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Io.copy(this);const a=1/i,c=1/o,l=1/s;return Io.elements[0]*=a,Io.elements[1]*=a,Io.elements[2]*=a,Io.elements[4]*=c,Io.elements[5]*=c,Io.elements[6]*=c,Io.elements[8]*=l,Io.elements[9]*=l,Io.elements[10]*=l,e.setFromRotationMatrix(Io),n.x=i,n.y=o,n.z=s,this}makePerspective(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*i/(e-t),c=2*i/(n-r),l=(e+t)/(e-t),u=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,n,r,i,o){const s=this.elements,a=1/(e-t),c=1/(n-r),l=1/(o-i),u=(e+t)*a,h=(n+r)*c,d=(o+i)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const No=new Lo,Io=new Oo,Do=new Lo(0,0,0),Fo=new Lo(1,1,1),Uo=new Lo,Bo=new Lo,ko=new Lo;function zo(){}Object.assign(zo.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t)}}});class Ho{constructor(t=0,e=0,n=0,r=Ho.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,n){const r=Ao.clamp,i=t.elements,o=i[0],s=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Go.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Go,e,n)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return jo.setFromEuler(this),this.setFromQuaternion(jo,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Lo(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Ho.DefaultOrder="XYZ",Ho.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Go=new Oo,jo=new Ro;class Vo{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}class Wo{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,s,a,c){const l=this.elements;return l[0]=t,l[1]=r,l[2]=s,l[3]=e,l[4]=i,l[5]=a,l[6]=n,l[7]=o,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],l=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],_=r[5],w=r[8];return i[0]=o*f+s*v+a*x,i[3]=o*m+s*y+a*_,i[6]=o*g+s*b+a*w,i[1]=c*f+l*v+u*x,i[4]=c*m+l*y+u*_,i[7]=c*g+l*b+u*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*_,i[8]=h*g+d*b+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8];return e*o*l-e*s*c-n*i*l+n*s*a+r*i*c-r*o*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8],u=l*o-s*c,h=s*a-l*i,d=c*i-o*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(r*c-l*n)*f,t[2]=(s*n-r*o)*f,t[3]=h*f,t[4]=(l*e-r*a)*f,t[5]=(r*i-s*e)*f,t[6]=d*f,t[7]=(n*a-c*e)*f,t[8]=(o*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,o,s){const a=Math.cos(i),c=Math.sin(i);return this.set(n*a,n*c,-n*(a*o+c*s)+o+t,-r*c,r*a,-r*(-c*o+a*s)+s+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],c=r[4],l=r[7];return r[0]=e*i+n*a,r[3]=e*o+n*c,r[6]=e*s+n*l,r[1]=-n*i+e*a,r[4]=-n*o+e*c,r[7]=-n*s+e*l,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}let qo=0;const Xo=new Lo,Yo=new Ro,Zo=new Oo,Jo=new Lo,$o=new Lo,Ko=new Lo,Qo=new Ro,ts=new Lo(1,0,0),es=new Lo(0,1,0),ns=new Lo(0,0,1),rs={type:"added"},is={type:"removed"};function os(){Object.defineProperty(this,"id",{value:qo++}),this.uuid=Ao.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=os.DefaultUp.clone();const t=new Lo,e=new Ho,n=new Ro,r=new Lo(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Oo},normalMatrix:{value:new Wo}}),this.matrix=new Oo,this.matrixWorld=new Oo,this.matrixAutoUpdate=os.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Vo,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}function ss(t,...e){let n="",r="";const i=(t=[].slice.call(t.raw,0)).length-1;t[0].match(/^\//)&&(t[0]=t[0].replace(/^\//,""),r=t[i].match(/\/[gimuy]*$/),r=r[0].replace(/\//,""),t[i]=t[i].replace(/\/[gimuy]*$/,""));for(let r=0;r<e.length;r++)n+=t[r],n+=e[r]instanceof RegExp?e[r].source:e[r]?e[r].toString():"";return n+=t[i],new RegExp(n,r)}os.DefaultUp=new Lo(0,1,0),os.DefaultMatrixAutoUpdate=!0,os.prototype=Object.assign(Object.create(zo.prototype),{constructor:os,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Yo.setFromAxisAngle(t,e),this.quaternion.multiply(Yo),this},rotateOnWorldAxis:function(t,e){return Yo.setFromAxisAngle(t,e),this.quaternion.premultiply(Yo),this},rotateX:function(t){return this.rotateOnAxis(ts,t)},rotateY:function(t){return this.rotateOnAxis(es,t)},rotateZ:function(t){return this.rotateOnAxis(ns,t)},translateOnAxis:function(t,e){return Xo.copy(t).applyQuaternion(this.quaternion),this.position.add(Xo.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(ts,t)},translateY:function(t){return this.translateOnAxis(es,t)},translateZ:function(t){return this.translateOnAxis(ns,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Zo.copy(this.matrixWorld).invert())},lookAt:function(t,e,n){t.isVector3?Jo.copy(t):Jo.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),$o.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Zo.lookAt($o,Jo,this.up):Zo.lookAt(Jo,$o,this.up),this.quaternion.setFromRotationMatrix(Zo),r&&(Zo.extractRotation(r.matrixWorld),Yo.setFromRotationMatrix(Zo),this.quaternion.premultiply(Yo.invert()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(rs)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(is)),this},clear:function(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(is)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),Zo.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Zo.multiply(t.parent.matrixWorld)),t.applyMatrix4(Zo),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Lo),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Ro),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($o,t,Ko),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Lo),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($o,Qo,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Lo),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=o(t.geometries),r=o(t.materials),i=o(t.textures),s=o(t.images),a=o(t.shapes),c=o(t.skeletons),l=o(t.animations);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l)}return n.object=r,n;function o(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}});const as=ss;as.identifier=/(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*/,as.identifierList=as`(?:(${as.identifier})+\s*,\s*)*(?:(${as.identifier})+)?`,as.functionHeader=as`\bfunction\s*(${as.identifier})?\s*\(\s*${as.identifierList}\s*\)\s*{`,as.classMethodHeader=as`\s*(${as.identifier})\s*\(\s*${as.identifierList}\s*\)\s*{`,as.digit=/\d/,as.integer=as`/${as.digit}+/`,as.number=as`/(?:${as.digit}*\.${as.integer}|${as.integer}\.${as.digit}*|${as.integer})/`,as.escape=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");var cs,ls,us,hs,ds,ps,fs=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},ms=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},gs=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},vs=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};const ys={x:void 0,y:void 0,z:void 0};let bs=class extends(Y()){constructor(t,e,n){super(),cs.add(this),ls.set(this,void 0),us.set(this,void 0),hs.set(this,void 0),gs(this,cs,"m",ps).call(this,t,e,n)}from(t,e,n){return gs(this,cs,"m",ps).call(this,t,e,n)}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}fromArray(t){return this.set(t[0],t[1],t[2]),this}toArray(){return[this.x,this.y,this.z]}fromObject(t){return this.set(t.x,t.y,t.z),this}toObject(){return{x:this.x,y:this.y,z:this.z}}fromString(t,e=""){return this.fromArray(this.stringToArray(t,e)),this}toString(t=""){return t?`${this.x}${t} ${this.y}${t} ${this.z}`:`${this.x} ${this.y} ${this.z}`}deserializeValue(t,e){return e}stringToArray(t,e=","){e=e||",";let n=this.constructor.__stringArrayRegexCache[e];n||(n=ss`/(?:\s*${ss.escape(e)}\s*)|(?:\s+)/g`,this.constructor.__stringArrayRegexCache[e]=n);const r=t.trim().split(n),i=[],o=r.length;return o>0&&(i[0]=this.deserializeValue("x",r[0])),o>1&&(i[1]=this.deserializeValue("y",r[1])),o>2&&(i[2]=this.deserializeValue("z",r[2])),i}fromDefault(){return this.set(gs(this,cs,"a",ds).x,gs(this,cs,"a",ds).y,gs(this,cs,"a",ds).z),this}checkValue(t,e){return!0}set x(t){this.checkValue("x",t)&&(vs(this,ls,t,"f"),this.emit("valuechanged","x"))}get x(){return gs(this,ls,"f")}set y(t){this.checkValue("y",t)&&(vs(this,us,t,"f"),this.emit("valuechanged","y"))}get y(){return gs(this,us,"f")}set z(t){this.checkValue("z",t)&&(vs(this,hs,t,"f"),this.emit("valuechanged","z"))}get z(){return gs(this,hs,"f")}};ls=new WeakMap,us=new WeakMap,hs=new WeakMap,cs=new WeakSet,ds=function(){return this.default||ys},ps=function(t,e,n){if(void 0===t&&void 0===e&&void 0===n)this.fromDefault();else if(Array.isArray(t))this.fromArray(t);else if("object"==typeof t&&null!==t){if(t===this)return this;this.fromObject(t)}else"string"==typeof t&&void 0===e&&void 0===n?this.fromString(t):this.set(t,e,n);return this},bs.__stringArrayRegexCache={},fs([Jr,ms("design:type",Object),ms("design:paramtypes",[Object])],bs.prototype,"x",null),fs([Jr,ms("design:type",Object),ms("design:paramtypes",[Object])],bs.prototype,"y",null),fs([Jr,ms("design:type",Object),ms("design:paramtypes",[Object])],bs.prototype,"z",null),bs=fs([Jr,ms("design:paramtypes",[Object,Object,Object])],bs);class xs extends bs{get default(){return{x:0,y:0,z:0}}deserializeValue(t,e){return Number(e)}checkValue(t,e){if(!super.checkValue(t,e))return!1;if(void 0===e)return!1;if("number"!=typeof e&&"string"!=typeof e||isNaN(e)||!isFinite(e))throw new TypeError(`Expected ${t} to be a finite number. Received: ${e}`);return!0}}var _s=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},ws=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};function Ms(t){var e,n,r,i,o,s,a,c;return c=class extends(Object(u.a)(t)){constructor(...t){super(...t),e.add(this),n.set(this,!1),r.set(this,null),_s(this,e,"m",i).call(this),this.isConnected?_s(this,e,"m",s).call(this):ws(this,n,!0,"f")}connectedCallback(){var t;null===(t=super.connectedCallback)||void 0===t||t.call(this),_s(this,n,"f")&&_s(this,e,"m",s).call(this),_s(this,e,"m",i).call(this)}disconnectedCallback(){var t;null===(t=super.disconnectedCallback)||void 0===t||t.call(this),_s(this,e,"m",o).call(this),ws(this,n,!0,"f")}},n=new WeakMap,r=new WeakMap,e=new WeakSet,i=function(){_s(this,r,"f")||ws(this,r,to(this,t=>{this.isConnected&&this.childConnectedCallback&&this.childConnectedCallback(t)},t=>{this.isConnected&&this.childDisconnectedCallback&&this.childDisconnectedCallback(t)},!0),"f")},o=function(){_s(this,r,"f")&&(_s(this,r,"f").disconnect(),ws(this,r,null,"f"))},s=function(){if(this.isConnected)for(let t=this.firstElementChild;t;t=t.nextElementSibling)_s(this,e,"m",a).call(this,t)},a=function(t){var e;t.matches(":defined")?null===(e=this.childConnectedCallback)||void 0===e||e.call(this,t):customElements.whenDefined(t.tagName.toLowerCase()).then(()=>{var e;null===(e=this.childConnectedCallback)||void 0===e||e.call(this,t)})},c}var Es=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};function Ss(t){var e,n,r;return r=class extends(Object(u.a)(t)){constructor(){super(...arguments),e.add(this)}connectedCallback(){super.connectedCallback&&super.connectedCallback(),Es(this,e,"m",n).call(this)}},e=new WeakSet,n=function(){let t=this.constructor.defaultBehaviors;if(!t)return;if(0==Object.keys(t).length)return;const e=this.getAttribute("has"),n=e&&e.split(" ")||[];if(0===n.length)t instanceof Array||(t=Object.keys(t)),this.setAttribute("has",`${this.getAttribute("has")||""} ${t.join(" ")}`);else{let e="";if(t instanceof Array)for(const r of t){let t=!1;for(const e of n)if(r==e){t=!0;break}t||(e&&(e+=" "),e+=r)}else if("object"==typeof t){const r=Object.keys(t);for(const i of r){const r=t[i];("function"==typeof r&&r(n)||"function"!=typeof r&&r)&&(e&&(e+=" "),e+=i)}}if(e){let t=this.getAttribute("has");t&&(t+=" "),this.setAttribute("has",t+e)}}},r.defaultBehaviors=[],r}const Ts=new WeakMap;function As(t){return t.isNode}class Rs extends(Ss(Ms(Br))){constructor(...t){super(),this.isScene=!1,this.isNode=!1,this.__isPossiblyDistributedToShadowRoot=!1,this.__distributedParent=null,this.__shadowRootParent=null,this.__isComposed=!1,this.__onChildSlotChange=t=>{const e=t.target;this.__handleDistributedChildren(e)}}static define(t){t=t||this.defaultElementName,customElements.define(t,this),this.__definedElementName=t}static get definedElementName(){return this.__definedElementName||null}attachShadow(t){const e=super.attachShadow(t);this.__shadowRoot=e;const n=to(e,this.__shadowRootChildAdded.bind(this),this.__shadowRootChildRemoved.bind(this),!0);Ts.set(e,n);const r=Array.from(this.children);for(const t of r)t instanceof Rs&&(t.__isPossiblyDistributedToShadowRoot=!0,this.__childUncomposedCallback(t,"slot"));return e}childConnectedCallback(t){As(t)?!this.isScene&&this.__shadowRoot?t.__isPossiblyDistributedToShadowRoot=!0:this.__childComposedCallback(t,"actual"):t instanceof HTMLSlotElement&&(this.__slots||(this.__slots=[]),this.__slots.push(t),t.addEventListener("slotchange",this.__onChildSlotChange),this.__handleDistributedChildren(t))}childDisconnectedCallback(t){As(t)?this.__shadowRoot?t.__isPossiblyDistributedToShadowRoot=!1:this.__childUncomposedCallback(t,"actual"):t instanceof HTMLSlotElement&&(t.removeEventListener("slotchange",this.__onChildSlotChange),this.__slots.splice(this.__slots.indexOf(t),1),this.__slots.length||(this.__slots=void 0),this.__handleDistributedChildren(t),this.__previousSlotAssignedNodes.delete(t))}get hasHtmlApi(){return this instanceof HTMLElement}traverseComposed(t){const e=this.hasHtmlApi,{children:n}=this;for(let r=n.length,i=0;i<r;i+=1){const r=n[i];r instanceof Rs&&(e&&r.__isPossiblyDistributedToShadowRoot||r.traverseComposed(t),t(r))}const r=this.__distributedChildren;if(e&&r)for(const e of r)e.traverseComposed(t),t(e)}setAttribute(t,e){super.setAttribute(t,e)}get _hasShadowRoot(){return!!this.__shadowRoot}get _isPossiblyDistributedToShadowRoot(){return this.__isPossiblyDistributedToShadowRoot}get _shadowRootParent(){return this.__shadowRootParent}get _distributedParent(){return this.__distributedParent}get _distributedChildren(){return this.__distributedChildren?[...this.__distributedChildren]:null}get _composedParent(){return this.__distributedParent||this.__shadowRootParent||this.parentElement}get _composedChildren(){return this.__shadowRoot?[...Array.prototype.filter.call(this.__shadowRoot.children,t=>t instanceof Rs)]:[...this.__distributedChildren||[],...Array.from(this.children).filter(t=>t instanceof Rs)]}get __previousSlotAssignedNodes(){return this.__prevAssignedNodes||(this.__prevAssignedNodes=new WeakMap),this.__prevAssignedNodes}__shadowRootChildAdded(t){t instanceof Rs?(t.__shadowRootParent=this,this.__childComposedCallback(t,"root")):t instanceof HTMLSlotElement&&(t.addEventListener("slotchange",this.__onChildSlotChange),this.__handleDistributedChildren(t))}__shadowRootChildRemoved(t){t instanceof Rs?(t.__shadowRootParent=null,this.__childUncomposedCallback(t,"root")):t instanceof HTMLSlotElement&&(t.removeEventListener("slotchange",this.__onChildSlotChange),this.__handleDistributedChildren(t),this.__previousSlotAssignedNodes.delete(t))}__childComposedCallback(t,e){t.__isComposed||(t.__isComposed=!0,this.childComposedCallback&&this.childComposedCallback(t,e))}__childUncomposedCallback(t,e){t.__isComposed&&(t.__isComposed=!1,this.childUncomposedCallback&&this.childUncomposedCallback(t,e))}__handleDistributedChildren(t){const e=this.__getDistributedChildDifference(t),{added:n}=e;for(let t=n.length,e=0;e<t;e+=1){const t=n[e];if(!(t instanceof Rs))continue;const r=t.__distributedParent;if(r){const e=r.__distributedChildren;e&&(e.delete(t),e.size||(r.__distributedChildren=void 0))}t.__distributedParent=this,this.__distributedChildren||(this.__distributedChildren=new Set),this.__distributedChildren.add(t),this.__childComposedCallback(t,"slot")}const{removed:r}=e;for(let t=r.length,e=0;e<t;e+=1){const t=r[e];t instanceof Rs&&(t.__distributedParent=null,this.__distributedChildren.delete(t),this.__distributedChildren.size||(this.__distributedChildren=void 0),this.__childUncomposedCallback(t,"slot"))}}__getDistributedChildDifference(t){var e;let n=null!==(e=this.__previousSlotAssignedNodes.get(t))&&void 0!==e?e:[];const r=t.assignedNodes({flatten:!0});this.__previousSlotAssignedNodes.set(t,r);const i={added:r,removed:[]};for(let t=0,e=n.length;t<e;t+=1){const e=n[t];r.indexOf(e)>=0?r.splice(t,1):i.removed.push(e)}return i}}Rs.defaultElementName="ERROR: Subclass needs to set defaultElementName";var Ls,Cs=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},Ps=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Os=Ls=class extends(Y(Rs)){constructor(){var t,e;super(),this.__parent=null,this.__children=[],this.__isConnected=!1,null===(e=null===(t=this.parentNode)||void 0===t?void 0:t.add)||void 0===e||e.call(t,this)}get parent(){var t,e;return this.__parent||null===(e=null===(t=this.parentNode)||void 0===t?void 0:t.add)||void 0===e||e.call(t,this),this.__parent}get subnodes(){return[...this.__children]}get isConnected(){return this instanceof Element?super.isConnected:this.__isConnected}add(t){if(!(t instanceof Ls))throw new TypeError("TreeNode.add() expects the childNode argument to be a TreeNode instance.");return t.__parent===this||(t.__parent&&t.__parent.removeNode(t),t.__parent=this,this.__children||(this.__children=[]),this.__children.push(t),t.__isConnected=!0,io(()=>{t.connected(),this.childConnected(t)})),this}addChildren(t){return t.forEach(t=>this.add(t)),this}removeNode(t){if(!(t instanceof Ls))throw new Error("\n\t\t\t\tTreeNode.remove expects the childNode argument to be an\n\t\t\t\tinstance of TreeNode. There should only be TreeNodes in the\n\t\t\t\ttree.\n\t\t\t");if(t.__parent!==this)throw new ReferenceError("childNode is not a child of this parent.");return t.__parent=null,this.__children.splice(this.__children.indexOf(t),1),t.__isConnected=!1,io(()=>{t.disconnected(),this.childDisconnected(t)}),this}removeChildren(t){for(let e=t.length-1;e>=0;e-=1)this.removeNode(t[e]);return this}removeAllChildren(){if(!this.__children.length)throw new ReferenceError("This node has no children.");return this.removeChildren(this.__children),this}get childCount(){return this.__children.length}connected(){}disconnected(){}childConnected(t){}childDisconnected(t){}traverse(t){t(this);const e=this.__children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}};Cs([Jr,Ps("design:type",Object)],Os.prototype,"__parent",void 0),Os=Ls=Cs([Jr,Ps("design:paramtypes",[])],Os);class Ns extends bs{get default(){return{x:"",y:"",z:""}}checkValue(t,e){if(!super.checkValue(t,e))return!1;if(void 0===e)return!1;if("string"!=typeof e)throw new TypeError(`Expected ${t} to be a string. Received: ${e}`);return!0}}class Is extends Ns{get default(){return{x:"literal",y:"literal",z:"literal"}}get allowedValues(){return["literal","proportional"]}checkValue(t,e){if(!super.checkValue(t,e))return!1;if(!this.allowedValues.includes(e))throw new TypeError(`Expected ${t} to be one of 'literal' or 'proportional'. Received: '${e}'`);return!0}}class Ds extends xs{checkValue(t,e){if(!super.checkValue(t,e))return!1;if(e<0)throw new TypeError(`Expected ${t} not to be negative. Received: ${e}`);return!0}}var Fs,Us,Bs,ks,zs,Hs,Gs,js,Vs,Ws,qs,Xs,Ys,Zs=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},Js=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};Us=new WeakMap,Bs=new WeakMap,ks=new WeakMap,zs=new WeakMap,Hs=new WeakMap,Gs=new WeakMap,js=new WeakMap,Vs=new WeakMap,Fs=new WeakSet,Ws=async function(){if("loading"===document.readyState&&await new Promise(t=>setTimeout(t)),Zs(this,Us,"f"))return;Js(this,Us,!0,"f");let t=null;for(;Zs(this,Us,"f");)t=await Zs(this,Fs,"m",qs).call(this),Zs(this,Fs,"m",Xs).call(this,t),Zs(this,Fs,"m",Ys).call(this,t),Zs(this,zs,"f").length||Js(this,Us,!1,"f")},qs=function(){return new Promise(t=>Zs(this,Vs,"f").call(this,t))},Xs=function(t){for(Js(this,Bs,0,"f");Zs(this,Bs,"f")<Zs(this,ks,"f");Js(this,Bs,Zs(this,Bs,"f")+1,"f")){const e=Zs(this,zs,"f")[Zs(this,Bs,"f")];!1===e(t)&&this.removeRenderTask(e)}},Ys=function(t){if(!Zs(this,Hs,"f").length)return;for(let e=0,n=Zs(this,Hs,"f").length;e<n;e+=1){const n=Zs(this,Hs,"f")[e];n.scene&&(n._render(t),n._getNearestAncestorThatShouldBeRendered()||Zs(this,js,"f").includes(n)||Zs(this,js,"f").push(n),Zs(this,Gs,"f").includes(n.scene)||Zs(this,Gs,"f").push(n.scene))}const e=Zs(this,js,"f");for(let t=0,n=e.length;t<n;t+=1)e[t]._calculateWorldMatricesInSubtree();e.length=0;const n=Zs(this,Gs,"f");for(let t=0,e=n.length;t<e;t+=1)n[t].drawScene();n.length=0;const r=Zs(this,Hs,"f");for(let t=0,e=r.length;t<e;t+=1)r[t]._willBeRendered=!1;r.length=0};const $s=new class{constructor(){Fs.add(this),Us.set(this,!1),Bs.set(this,0),ks.set(this,0),zs.set(this,[]),Hs.set(this,[]),Gs.set(this,[]),js.set(this,[]),Vs.set(this,window.requestAnimationFrame.bind(window))}addRenderTask(t){if("function"!=typeof t)throw new Error("Render task must be a function.");return Zs(this,zs,"f").includes(t)||(Zs(this,zs,"f").push(t),Js(this,ks,Zs(this,ks,"f")+1,"f"),Zs(this,Us,"f")||Zs(this,Fs,"m",Ws).call(this)),t}removeRenderTask(t){const e=Zs(this,zs,"f").indexOf(t);-1!=e&&(Zs(this,zs,"f").splice(e,1),Js(this,ks,Zs(this,ks,"f")-1,"f"),e<=Zs(this,Bs,"f")&&Js(this,Bs,Zs(this,Bs,"f")-1,"f"))}once(t){return this.addRenderTask(e=>(t(e),!1))}setNodeToBeRendered(t){Zs(this,Hs,"f").includes(t)||(Zs(this,Hs,"f").push(t),Zs(this,Fs,"m",Ws).call(this))}setFrameRequester(t){Js(this,Vs,t,"f")}};var Ks,Qs,ta,ea,na,ra,ia,oa=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},sa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},aa=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},ca=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};const la={},ua=new WeakMap,ha=new WeakMap,da=new WeakMap;let pa=class extends Os{constructor(){super(),Ks.add(this),this._stopFns=[],Qs.set(this,!1),ta.set(this,null),ea.set(this,!1),da.set(this,Yr({x:0,y:0,z:0})),this.sizeMode.on("valuechanged",()=>!this._isSettingProperty&&(this.sizeMode=this.sizeMode)),this.size.on("valuechanged",()=>!this._isSettingProperty&&(this.size=this.size))}set sizeMode(t){if("function"==typeof t)throw new TypeError("property functions are not allowed for sizeMode");ua.has(this)||ua.set(this,new Is("literal","literal","literal")),this._setPropertyXYZ("sizeMode",ua.get(this),t)}get sizeMode(){return ua.has(this)||ua.set(this,new Is("literal","literal","literal")),ua.get(this)}getSizeMode(){return this.sizeMode}set size(t){ha.has(this)||ha.set(this,new Ds(0,0,0)),this._setPropertyXYZ("size",ha.get(this),t)}get size(){return ha.has(this)||ha.set(this,new Ds(0,0,0)),ha.get(this)}getSize(){return this.size}get calculatedSize(){var t,e;return{...null!==(e=null===(t=da.get(this))||void 0===t?void 0:t.get())&&void 0!==e?e:{x:0,y:0,z:0}}}connectedCallback(){super.connectedCallback()}disconnectedCallback(){var t;null===(t=super.disconnectedCallback)||void 0===t||t.call(this);for(const t of this._stopFns)t();this._stopFns.length=0}get _renderParent(){return this.hasHtmlApi?this._composedParent:this.parent}get _renderChildren(){return this.hasHtmlApi?this._composedChildren:this.subnodes}_getParentSize(){var t,e;return null!==(e=this._renderParent&&(null===(t=da.get(this._renderParent))||void 0===t?void 0:t.get()))&&void 0!==e?e:{x:0,y:0,z:0}}_calcSize(){const t=da.get(this).get();Object.assign(la,t);const e=this.getSize(),n=this.getSizeMode(),r=this._getParentSize();"literal"==n.x?t.x=e.x:t.x=r.x*e.x,"literal"==n.y?t.y=e.y:t.y=r.y*e.y,"literal"==n.z?t.z=e.z:t.z=r.z*e.z,da.get(this).set(t),la.x===t.x&&la.y===t.y&&la.z===t.z||this.emit("sizechange",{...t})}get _isSettingProperty(){return aa(this,Qs,"f")}_setPropertyXYZ(t,e,n){n!==e&&(ca(this,Qs,!0,"f"),"function"==typeof n?aa(this,Ks,"m",na).call(this,n,t,e):(aa(this,ea,"f")?ca(this,ea,!1,"f"):aa(this,Ks,"m",ia).call(this,t),ri(()=>{e.from(n)})),ca(this,Qs,!1,"f"))}_setPropertySingle(t,e,n){ca(this,Qs,!0,"f"),"function"==typeof n?aa(this,Ks,"m",ra).call(this,n,t):(aa(this,ea,"f")?ca(this,ea,!1,"f"):aa(this,Ks,"m",ia).call(this,t),ri(()=>{e(n)})),ca(this,Qs,!1,"f")}};Qs=new WeakMap,ta=new WeakMap,ea=new WeakMap,Ks=new WeakSet,na=function(t,e,n){aa(this,ta,"f")||ca(this,ta,new Map,"f");const r=aa(this,ta,"f").get(e);r&&$s.removeRenderTask(r),aa(this,ta,"f").set(e,$s.addRenderTask(r=>{const i=t(n.x,n.y,n.z,r);if(!1===i)return aa(this,ta,"f").delete(e),!1;ca(this,ea,!0,"f"),n.from(i)}))},ra=function(t,e){aa(this,ta,"f")||ca(this,ta,new Map,"f");const n=aa(this,ta,"f").get(e);n&&$s.removeRenderTask(n),aa(this,ta,"f").set(e,$s.addRenderTask(n=>{const r=t(this[e],n);if(!1===r)return aa(this,ta,"f").delete(e),!1;ca(this,ea,!0,"f"),this[e]=r}))},ia=function(t){if(!aa(this,ta,"f"))return;const e=aa(this,ta,"f").get(t);e&&($s.removeRenderTask(e),aa(this,ta,"f").delete(t),aa(this,ta,"f").size||ca(this,ta,null,"f"))},oa([oi,J("propertychange"),sa("design:type",Object),sa("design:paramtypes",[Object])],pa.prototype,"sizeMode",null),oa([oi,J("propertychange"),sa("design:type",Object),sa("design:paramtypes",[Object])],pa.prototype,"size",null),pa=oa([ui,sa("design:paramtypes",[])],pa);var fa=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},ma=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const ga=new WeakMap,va=new WeakMap,ya=new WeakMap,ba=new WeakMap,xa=new WeakMap,_a=new WeakMap,wa=new WeakMap;let Ma=class extends pa{constructor(){super(),this.position.on("valuechanged",()=>!this._isSettingProperty&&(this.position=this.position)),this.rotation.on("valuechanged",()=>!this._isSettingProperty&&(this.rotation=this.rotation)),this.scale.on("valuechanged",()=>!this._isSettingProperty&&(this.scale=this.scale)),this.origin.on("valuechanged",()=>!this._isSettingProperty&&(this.origin=this.origin)),this.alignPoint.on("valuechanged",()=>!this._isSettingProperty&&(this.alignPoint=this.alignPoint)),this.mountPoint.on("valuechanged",()=>!this._isSettingProperty&&(this.mountPoint=this.mountPoint))}set position(t){ga.has(this)||ga.set(this,new xs(0,0,0)),this._setPropertyXYZ("position",ga.get(this),t)}get position(){return ga.has(this)||ga.set(this,new xs(0,0,0)),ga.get(this)}getPosition(){return this.position}set rotation(t){va.has(this)||va.set(this,new xs(0,0,0)),this._setPropertyXYZ("rotation",va.get(this),t)}get rotation(){return va.has(this)||va.set(this,new xs(0,0,0)),va.get(this)}getRotation(){return this.rotation}set scale(t){ya.has(this)||ya.set(this,new xs(1,1,1)),this._setPropertyXYZ("scale",ya.get(this),t)}get scale(){return ya.has(this)||ya.set(this,new xs(1,1,1)),ya.get(this)}getScale(){return this.scale}set origin(t){ba.has(this)||ba.set(this,new xs(.5,.5,.5)),this._setPropertyXYZ("origin",ba.get(this),t)}get origin(){return ba.has(this)||ba.set(this,new xs(.5,.5,.5)),ba.get(this)}getOrigin(){return this.origin}set alignPoint(t){xa.has(this)||xa.set(this,new xs(0,0,0)),this._setPropertyXYZ("alignPoint",xa.get(this),t)}get alignPoint(){return xa.has(this)||xa.set(this,new xs(0,0,0)),xa.get(this)}getAlignPoint(){return this.alignPoint}set mountPoint(t){_a.has(this)||_a.set(this,new xs(0,0,0)),this._setPropertyXYZ("mountPoint",_a.get(this),t)}get mountPoint(){return _a.has(this)||_a.set(this,new xs(0,0,0)),_a.get(this)}getMountPoint(){return this.mountPoint}set opacity(t){wa.has(this)||wa.set(this,1),this._setPropertySingle("opacity",t=>wa.set(this,t),t)}get opacity(){return wa.has(this)||wa.set(this,1),wa.get(this)}getOpacity(){return this.opacity}};fa([oi,J("propertychange"),ma("design:type",Object),ma("design:paramtypes",[Object])],Ma.prototype,"position",null),fa([oi,J("propertychange"),ma("design:type",Object),ma("design:paramtypes",[Object])],Ma.prototype,"rotation",null),fa([oi,J("propertychange"),ma("design:type",Object),ma("design:paramtypes",[Object])],Ma.prototype,"scale",null),fa([oi,J("propertychange"),ma("design:type",Object),ma("design:paramtypes",[Object])],Ma.prototype,"origin",null),fa([oi,J("propertychange"),ma("design:type",Object),ma("design:paramtypes",[Object])],Ma.prototype,"alignPoint",null),fa([oi,J("propertychange"),ma("design:type",Object),ma("design:paramtypes",[Object])],Ma.prototype,"mountPoint",null),fa([oi,J("propertychange"),ma("design:type",Object),ma("design:paramtypes",[Object])],Ma.prototype,"opacity",null),Ma=fa([ui,ma("design:paramtypes",[])],Ma);var Ea,Sa,Ta,Aa,Ra,La,Ca,Pa,Oa=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n},Na=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};void 0===document.createElement("div").style.transform&&"undefined"!=typeof CSSStyleDeclaration&&Object.defineProperty(CSSStyleDeclaration.prototype,"transform",{set(t){this.webkitTransform=t},get(){return this.webkitTransform},enumerable:!0});class Ia{constructor(t){Ea.add(this),Sa.set(this,void 0),Ta.set(this,!1),Oa(this,Sa,t,"f")}connectChildElement(t){(!t.parentNode||t.parentElement&&t.parentElement!==Na(this,Sa,"f"))&&Na(this,Ea,"m",Aa).call(this,t)}disconnectChildElement(t){t.parentNode&&Na(this,Ea,"m",Ra).call(this,t)}applyImperativeNodeProperties(){Na(this,Ta,"f")&&(Na(this,Ea,"m",Ca).call(this),Na(this,Ea,"m",La).call(this))}set shouldRender(t){Oa(this,Ta,t,"f"),requestAnimationFrame(()=>{Na(this,Ea,"m",Pa).call(this,"display",t?"block":"none")})}get shouldRender(){return Na(this,Ta,"f")}}Sa=new WeakMap,Ta=new WeakMap,Ea=new WeakSet,Aa=function(t){Na(this,Sa,"f").appendChild(t)},Ra=function(t){t.parentNode===Na(this,Sa,"f")&&Na(this,Sa,"f").removeChild(t)},La=function(){const{x:t,y:e}=Na(this,Sa,"f").calculatedSize;Na(this,Ea,"m",Pa).call(this,"width",t+"px"),Na(this,Ea,"m",Pa).call(this,"height",e+"px")},Ca=function(){Na(this,Ea,"m",Pa).call(this,"opacity",Na(this,Sa,"f").opacity.toString())},Pa=function(t,e){Na(this,Sa,"f").style.setProperty(t,e)};class Da extends os{get pivot(){return this.__pivot||(this.__pivot=new Lo),this.__pivot}set pivot(t){this.__pivot=t}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);var t=this.pivot;if(0!==t.x||0!==t.y||0!==t.z){var e=t.x,n=t.y,r=t.z,i=this.matrix.elements;i[12]+=e-i[0]*e-i[4]*n-i[8]*r,i[13]+=n-i[1]*e-i[5]*n-i[9]*r,i[14]+=r-i[2]*e-i[6]*n-i[10]*r}this.matrixWorldNeedsUpdate=!0}}os.prototype.updateMatrix=Da.prototype.updateMatrix,Object.defineProperty(os.prototype,"pivot",Object.getOwnPropertyDescriptor(Da.prototype,"pivot"));const Fa="124",Ua={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Ba={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ka=0,za=1,Ha=2,Ga=3,ja=0,Va=1,Wa=2,qa=3,Xa=0,Ya=1,Za=2,Ja=1,$a=2,Ka=0,Qa=1,tc=2,ec=3,nc=4,rc=5,ic=100,oc=101,sc=102,ac=103,cc=104,lc=200,uc=201,hc=202,dc=203,pc=204,fc=205,mc=206,gc=207,vc=208,yc=209,bc=210,xc=0,_c=1,wc=2,Mc=3,Ec=4,Sc=5,Tc=6,Ac=7,Rc=0,Lc=1,Cc=2,Pc=0,Oc=1,Nc=2,Ic=3,Dc=4,Fc=5,Uc=300,Bc=301,kc=302,zc=303,Hc=304,Gc=306,jc=307,Vc=1e3,Wc=1001,qc=1002,Xc=1003,Yc=1004,Zc=1004,Jc=1005,$c=1005,Kc=1006,Qc=1007,tl=1007,el=1008,nl=1008,rl=1009,il=1010,ol=1011,sl=1012,al=1013,cl=1014,ll=1015,ul=1016,hl=1017,dl=1018,pl=1019,fl=1020,ml=1021,gl=1022,vl=1023,yl=1024,bl=1025,xl=vl,_l=1026,wl=1027,Ml=1028,El=1029,Sl=1030,Tl=1031,Al=1032,Rl=1033,Ll=33776,Cl=33777,Pl=33778,Ol=33779,Nl=35840,Il=35841,Dl=35842,Fl=35843,Ul=36196,Bl=37492,kl=37496,zl=37808,Hl=37809,Gl=37810,jl=37811,Vl=37812,Wl=37813,ql=37814,Xl=37815,Yl=37816,Zl=37817,Jl=37818,$l=37819,Kl=37820,Ql=37821,tu=36492,eu=37840,nu=37841,ru=37842,iu=37843,ou=37844,su=37845,au=37846,cu=37847,lu=37848,uu=37849,hu=37850,du=37851,pu=37852,fu=37853,mu=2200,gu=2201,vu=2202,yu=2300,bu=2301,xu=2302,_u=2400,wu=2401,Mu=2402,Eu=2500,Su=2501,Tu=0,Au=1,Ru=2,Lu=3e3,Cu=3001,Pu=3007,Ou=3002,Nu=3003,Iu=3004,Du=3005,Fu=3006,Uu=3200,Bu=3201,ku=0,zu=1,Hu=0,Gu=7680,ju=7681,Vu=7682,Wu=7683,qu=34055,Xu=34056,Yu=5386,Zu=512,Ju=513,$u=514,Ku=515,Qu=516,th=517,eh=518,nh=519,rh=35044,ih=35048,oh=35040,sh=35045,ah=35049,ch=35041,lh=35046,uh=35050,hh=35042,dh="100",ph="300 es";let fh=0;function mh(){Object.defineProperty(this,"id",{value:fh++}),this.uuid=Ao.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=Qa,this.side=Xa,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=pc,this.blendDst=fc,this.blendEquation=ic,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Mc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=nh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gu,this.stencilZFail=Gu,this.stencilZPass=Gu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}mh.prototype=Object.assign(Object.create(zo.prototype),{constructor:mh,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===Ja;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Qa&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==Xa&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(mh.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class gh{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}const vh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yh={h:0,s:0,l:0},bh={h:0,s:0,l:0};function xh(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function _h(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function wh(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Mh{constructor(t,e,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=Ao.euclideanModulo(t,1),e=Ao.clamp(e,0,1),n=Ao.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=xh(i,r,t+1/3),this.g=xh(i,r,t),this.b=xh(i,r,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=vh[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=_h(t.r),this.g=_h(t.g),this.b=_h(t.b),this}copyLinearToSRGB(t){return this.r=wh(t.r),this.g=wh(t.g),this.b=wh(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),o=Math.min(e,n,r);let s,a;const c=(o+i)/2;if(o===i)s=0,a=0;else{const t=i-o;switch(a=c<=.5?t/(i+o):t/(2-i-o),i){case e:s=(n-r)/t+(n<r?6:0);break;case n:s=(r-e)/t+2;break;case r:s=(e-n)/t+4}s/=6}return t.h=s,t.s=a,t.l=c,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(yh),yh.h+=t,yh.s+=e,yh.l+=n,this.setHSL(yh.h,yh.s,yh.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpHSL(t,e){this.getHSL(yh),t.getHSL(bh);const n=Ao.lerp(yh.h,bh.h,e),r=Ao.lerp(yh.s,bh.s,e),i=Ao.lerp(yh.l,bh.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}function Eh(t){mh.call(this),this.type="MeshPhongMaterial",this.color=new Mh(16777215),this.specular=new Mh(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ku,this.normalScale=new gh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Rc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Sh(t){return"geometry"in t&&"material"in t}function Th(t){if(!Sh(t))return;const e=[].concat(t.material);for(const t of e)t.dispose()}function Ah(t,e=!0,n=!0,r=!0){t&&(Sh(t)&&(t.geometry&&n&&t.geometry.dispose(),r&&Th(t)),e&&io(()=>{t.parent&&t.parent.remove(t)}))}function Rh(t,e={}){t.traverse(t=>{Ah(t,e.removeFromParent,e.destroyGeometry,e.destroyMaterial)})}function Lh(t,e,n){return Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n&&Math.abs(t.z-e.z)<n&&Math.abs(t.w-e.w)<n}function Ch(t,e,n=!0){Sh(t)&&(n&&t.material&&Th(t),t.material=e)}function Ph(t,e,n){Oh(t,5592405*Math.random()+5592405,e,n)}function Oh(t,e,n,r=!0){const i=new Eh;i.color=new Mh(e),r?t.traverse(t=>Ch(t,i,n)):Ch(t,i,n)}function Nh(t){return!!t.isPerspectiveCamera}function Ih(t){return!!t.isOrthographicCamera}function Dh(t){return!("object"!=typeof t||!t||!("dispose"in t))}Mh.NAMES=vh,Mh.prototype.r=1,Mh.prototype.g=1,Mh.prototype.b=1,Eh.prototype=Object.create(mh.prototype),Eh.prototype.constructor=Eh,Eh.prototype.isMeshPhongMaterial=!0,Eh.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};var Fh,Uh,Bh,kh,zh,Hh,Gh,jh,Vh,Wh,qh=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},Xh=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};class Yh extends Da{constructor(t){super(),this.element=t,Fh.set(this,requestAnimationFrame(()=>{this.element.style.position="absolute"}))}dispose(){cancelAnimationFrame(qh(this,Fh,"f"))}}Fh=new WeakMap;class Zh extends Yh{}class Jh{constructor(){Uh.add(this),Bh.set(this,new Oo),kh.set(this,{camera:{fov:0,style:""},objects:new WeakMap}),zh.set(this,0),Hh.set(this,0),Gh.set(this,0),jh.set(this,0),Vh.set(this,void 0);const t=document.createElement("div");t.classList.add("CSS3DRendererNested"),t.style.overflow="hidden",this.domElement=t;const e=document.createElement("div");e.classList.add("cameraElement"),e.appendChild(document.createElement("slot")),e.style.transformStyle="preserve-3d",t.appendChild(e),Xh(this,Vh,e,"f")}getSize(){return{width:qh(this,zh,"f"),height:qh(this,Hh,"f")}}setSize(t,e){Xh(this,zh,t,"f"),Xh(this,Hh,e,"f"),Xh(this,Gh,t/2,"f"),Xh(this,jh,e/2,"f"),this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",qh(this,Vh,"f").style.width=t+"px",qh(this,Vh,"f").style.height=e+"px"}render(t,e){const n=e.projectionMatrix.elements[5]*qh(this,jh,"f");qh(this,kh,"f").camera.fov!==n&&(Nh(e)&&(this.domElement.style.perspective=n+"px"),qh(this,kh,"f").camera.fov=n),t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(void 0);let r=0,i=0;Ih(e)&&(r=-(e.right+e.left)/2,i=(e.top+e.bottom)/2);const o=(Ih(e)?"scale("+n+")translate("+Qh(r)+"px,"+Qh(i)+"px)"+$h(e.matrixWorldInverse):"translateZ("+n+"px)"+$h(e.matrixWorldInverse))+"translate("+qh(this,Gh,"f")+"px,"+qh(this,jh,"f")+"px)";qh(this,kh,"f").camera.style!==o&&(qh(this,Vh,"f").style.transform=o,qh(this,kh,"f").camera.style=o),qh(this,Uh,"m",Wh).call(this,t,e)}}function $h(t){const e=t.elements;return"matrix3d("+Qh(e[0])+","+Qh(-e[1])+","+Qh(e[2])+","+Qh(e[3])+","+Qh(e[4])+","+Qh(-e[5])+","+Qh(e[6])+","+Qh(e[7])+","+Qh(e[8])+","+Qh(-e[9])+","+Qh(e[10])+","+Qh(e[11])+","+Qh(e[12])+","+Qh(-e[13])+","+Qh(e[14])+","+Qh(e[15])+")"}function Kh(t,e){const n=t.parent,r=n&&"Scene"===n.type,i=e.elements;return`${r?"translate(-50%, -50%)":""} ${"matrix3d("+Qh(i[0])+","+Qh(i[1])+","+Qh(i[2])+","+Qh(i[3])+","+Qh((r?-1:1)*i[4])+","+Qh((r?-1:1)*i[5])+","+Qh((r?-1:1)*i[6])+","+Qh((r?-1:1)*i[7])+","+Qh(i[8])+","+Qh(i[9])+","+Qh(i[10])+","+Qh(i[11])+","+Qh(i[12])+","+Qh((r?1:-1)*i[13])+","+Qh(i[14])+","+Qh(i[15])+")"}`}function Qh(t){return Math.abs(t)<1e-10?0:t}Bh=new WeakMap,kh=new WeakMap,zh=new WeakMap,Hh=new WeakMap,Gh=new WeakMap,jh=new WeakMap,Vh=new WeakMap,Uh=new WeakSet,Wh=function t(e,n){if(e instanceof Yh){let t="";e instanceof Zh?(qh(this,Bh,"f").copy(n.matrixWorldInverse),qh(this,Bh,"f").transpose(),qh(this,Bh,"f").copyPosition(e.matrixWorld),qh(this,Bh,"f").scale(e.scale),qh(this,Bh,"f").elements[3]=0,qh(this,Bh,"f").elements[7]=0,qh(this,Bh,"f").elements[11]=0,qh(this,Bh,"f").elements[15]=1,t=Kh(e,qh(this,Bh,"f"))):t=Kh(e,e.matrix);const r=e.element,i=qh(this,kh,"f").objects.get(e);if(void 0===i||i.style!==t){r.style.transform=t;const n={style:t};qh(this,kh,"f").objects.set(e,n)}}for(let r=0,i=e.children.length;r<i;r++)qh(this,Uh,"m",t).call(this,e.children[r],n)};const td=Symbol();function ed(t=Object){var e;class n extends t{constructor(){super(...arguments),this[e]=!0}set(t){return Object.assign(this,t),this}}return e=td,n.prototype[td]=!0,n}Object.defineProperty(ed,Symbol.hasInstance,{value:t=>!!t&&!!t[td]});var nd,rd=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},id=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};function od(t){return t.isScene}function sd(t){return t.isNode}const ad=[0,0,0],cd=[0,0,0],ld=[0,0,0],ud=[0,0,0],hd=new WeakMap;let dd=nd=class extends(ed(Ma)){constructor(){super(...arguments),this.imperativeCounterpart=this,this.isScene=!1,this.isNode=!1,this._glLoaded=!1,this._cssLoaded=!1,this._willBeRendered=!1,this._scene=null,this._glStopFns=[],this._cssStopFns=[]}get glLoaded(){return this._glLoaded}get cssLoaded(){return this._cssLoaded}get three(){return this.__three||(this.__three=this.__makeThreeObject3d()),this.__three}__makeThreeObject3d(){const t=this.makeThreeObject3d();return t.name=this.tagName+(this.id?"#"+this.id:""),t}get threeCSS(){return this.__threeCSS||(this.__threeCSS=this.__makeThreeCSSObject()),this.__threeCSS}__makeThreeCSSObject(){const t=this.makeThreeCSSObject();return t.name=this.tagName+(this.id?"#"+this.id:""),t}connectedCallback(){super.connectedCallback(),this._stopFns.push(Zr(()=>{this.rotation,this._updateRotation()}),Zr(()=>{this.scale,this._updateScale()}),Zr(()=>{this.sizeMode,this.size,ri(()=>{this._calcSize()})}),Zr(()=>{this.parent&&(this.parent.calculatedSize,ri(()=>{"proportional"!==this.getSizeMode().x&&"proportional"!==this.getSizeMode().y&&"proportional"!==this.getSizeMode().z&&0===this.getAlignPoint().x&&0===this.getAlignPoint().y&&0===this.getAlignPoint().z||(this._calcSize(),this.needsUpdate())}))}),Zr(()=>{this.sizeMode,this.size,this.position,this.rotation,this.scale,this.origin,this.alignPoint,this.mountPoint,this.opacity,this.needsUpdate()}))}__possiblyLoadThree(t){sd(t)&&(t._triggerLoadGL(),t._triggerLoadCSS())}__possiblyUnloadThree(t){sd(t)&&(t._triggerUnloadGL(),t._triggerUnloadCSS())}childComposedCallback(t,e){if(t instanceof nd){if(!t.parent){const n="actual"===e;this.add(t,n)}t._calcSize(),t.needsUpdate(),this.__possiblyLoadThree(t)}}childUncomposedCallback(t,e){if(t instanceof nd){if(t.parent){const n="actual"===e;this.removeNode(t,n)}this.__possiblyUnloadThree(t)}}get scene(){const t=this.parent;if(this._scene||!t)return this._scene;if(!(t instanceof nd))throw new Error("Expected instance of ImperativeBase");return t._scene?this._scene=t._scene:od(t)?this._scene=t:this._scene=t.scene,this._scene}get parent(){const t=super.parent;if(t&&!(t instanceof nd))throw new TypeError("Parent must be type ImperativeBase.");return t}add(t,e=!0){return t instanceof nd?(od(t)||(super.add(t),e&&this._elementOperations.connectChildElement(t)),this):this}removeNode(t,e=!0){return sd(t)?(super.removeNode(t),e&&this._elementOperations.disconnectChildElement(t),this):this}needsUpdate(){this._willBeRendered=!0,$s.setNodeToBeRendered(this)}get _elementOperations(){return hd.has(this)||hd.set(this,new Ia(this)),hd.get(this)}makeThreeObject3d(){return new os}makeThreeCSSObject(){if(!(this instanceof HTMLElement))throw"API available only in DOM environment.";return new Yh(this)}_connectThree(){this._isPossiblyDistributedToShadowRoot&&this.parent!==this.scene?this._distributedParent&&this._distributedParent.three.add(this.three):this._shadowRootParent?this._shadowRootParent.three.add(this.three):this.parent&&this.parent.three.add(this.three),this.needsUpdate()}_connectThreeCSS(){this._isPossiblyDistributedToShadowRoot&&this.parent!==this.scene?this._distributedParent&&this._distributedParent.threeCSS.add(this.threeCSS):this._shadowRootParent?this._shadowRootParent.threeCSS.add(this.threeCSS):this.parent&&this.parent.threeCSS.add(this.threeCSS),this.needsUpdate()}_loadGL(){return!(!this.scene||!this.scene.webgl)&&(!this._glLoaded&&(this._glLoaded=!0,this.three.matrixAutoUpdate=!1,this._connectThree(),this.needsUpdate(),!0))}_unloadGL(){if(!this._glLoaded)return!1;this._glLoaded=!1;for(const t of this._glStopFns)t();return this._glStopFns.length=0,this.__three&&Ah(this.__three),this.__three=void 0,this.needsUpdate(),!0}_loadCSS(){return!(!this.scene||!this.scene.enableCss)&&(!this._cssLoaded&&(this._cssLoaded=!0,this.threeCSS.matrixAutoUpdate=!1,this._connectThreeCSS(),this.needsUpdate(),!0))}_unloadCSS(){if(!this._cssLoaded)return!1;this._cssLoaded=!1;for(const t of this._cssStopFns)t();return this._cssStopFns.length=0,this.__threeCSS&&Ah(this.__threeCSS),this.__threeCSS=void 0,this.needsUpdate(),!0}_triggerLoadGL(){if(this._loadGL()){this.emit(Mo.BEHAVIOR_GL_LOAD,this),io(async()=>{await null,await null,this.emit(Mo.GL_LOAD,this)});for(const t of this.subnodes)t._triggerLoadGL()}}_triggerUnloadGL(){this._unloadGL(),this.emit(Mo.BEHAVIOR_GL_UNLOAD,this),io(()=>this.emit(Mo.GL_UNLOAD,this))}_triggerLoadCSS(){if(this._loadCSS()){this.emit(Mo.CSS_LOAD,this);for(const t of this.subnodes)t._triggerLoadCSS()}}_triggerUnloadCSS(){this._unloadCSS(),this.emit(Mo.CSS_UNLOAD,this)}_calculateMatrix(){const t=this.getAlignPoint(),e=this.getMountPoint(),n=this.getPosition(),r=this.getOrigin(),i=this.calculatedSize;ad[0]=i.x/2,ad[1]=i.y/2,ad[2]=i.z/2;const o=this._getParentSize();ad[0]+=-o.x/2,ad[1]+=-o.y/2,ad[2]+=-o.z/2,cd[0]=o.x*t.x,cd[1]=o.y*t.y,cd[2]=o.z*t.z,ld[0]=i.x*e.x,ld[1]=i.y*e.y,ld[2]=i.z*e.z,ud[0]=n.x+cd[0]-ld[0],ud[1]=n.y+cd[1]-ld[1],ud[2]=n.z+cd[2]-ld[2],this.three.position.set(ud[0]+ad[0],-(ud[1]+ad[1]),ud[2]+ad[2]);this.threeCSS.parent&&"Scene"===this.threeCSS.parent.type?this.threeCSS.position.set(ud[0]+ad[0],-(ud[1]+ad[1]),ud[2]+ad[2]):this.threeCSS.position.set(ud[0],-ud[1],ud[2]+ad[2]),.5!==r.x||.5!==r.y||.5!==r.z?(this.three.pivot.set(r.x*i.x-i.x/2,-(r.y*i.y-i.y/2),r.z*i.z-i.z/2),this.threeCSS.pivot.set(r.x*i.x-i.x/2,-(r.y*i.y-i.y/2),r.z*i.z-i.z/2)):(this.three.pivot.set(0,0,0),this.threeCSS.pivot.set(0,0,0)),this.three.updateMatrix(),this.threeCSS.updateMatrix()}_updateRotation(){var t;const{x:e,y:n,z:r}=this.getRotation();this.three.rotation.set(-ro(e),ro(n),-ro(r));const i=null===(t=this.parent)||void 0===t?void 0:t.isScene;this.threeCSS.rotation.set((i?-1:1)*ro(e),ro(n),(i?-1:1)*ro(r))}_updateScale(){const{x:t,y:e,z:n}=this.getScale();this.three.scale.set(t,e,n),this.threeCSS.scale.set(t,e,n)}_calculateWorldMatricesInSubtree(){this.three.updateMatrixWorld(),this.threeCSS.updateMatrixWorld(),this.emit("worldMatrixUpdate")}_render(t){this._calculateMatrix(),this._elementOperations.applyImperativeNodeProperties()}_getNearestAncestorThatShouldBeRendered(){let t=this.parent;for(;t;){if(!(t instanceof nd))throw new Error("expected ImperativeBase");if(t._willBeRendered)return t;t=t.parent}return!1}};rd([Jr,id("design:type",Object)],dd.prototype,"_cssLoaded",void 0),rd([Jr,id("design:type",Object)],dd.prototype,"_scene",void 0),dd=nd=rd([ui],dd),window.addEventListener("error",t=>{const e=t.error;e&&/Illegal constructor/i.test(e.message)&&console.error("\n\t\t\tOne of the reasons the following error can happen is if a Custom\n\t\t\tElement is called with 'new' before being defined. Did you forget\n\t\t\tto call 'LUME.useDefaultNames'?  For other reasons, see:\n\t\t\thttps://www.google.com/search?q=chrome%20illegal%20constructor\n        ")});class pd extends dd{get root(){return this}set root(t){}}pd.css='\n\t\t:host {\n\t\t\t/*\n\t\t\t * All items of the scene graph are hidden until they are mounted in\n\t\t\t * a scene (this changes to display:block). This gets toggled\n\t\t\t * between "none" and "block" by ImperativeBase depending on if CSS\n\t\t\t * rendering is enabled.\n\t\t\t */\n\t\t\tdisplay: none;\n\n\t\t\tbox-sizing: border-box;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\n\t\t\t/*\n\t\t\t * Defaults to [0.5,0.5,0.5] (the Z axis doesn\'t apply for DOM\n\t\t\t * elements, but does for 3D objects in WebGL that have any size\n\t\t\t * along Z.)\n\t\t\t */\n\t\t\ttransform-origin: 50% 50% 0; /* default */\n\n\t\t\ttransform-style: preserve-3d;\n\t\t}\n\t';var fd=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},md=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let gd=class extends pd{constructor(){super(),this.visible=!0,this.isNode=!0,this.parent&&(this._calcSize(),this.needsUpdate())}_loadCSS(){return!!super._loadCSS()&&(this._cssStopFns.push(Zr(()=>{this._elementOperations.shouldRender=this.visible,this.needsUpdate()})),!0)}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Zr(()=>{this.three.visible=this.visible,this.needsUpdate()})),!0)}};gd.defaultElementName="lume-node",fd([li(!0),J("propertychange"),md("design:type",Object)],gd.prototype,"visible",void 0),gd=fd([ui,md("design:paramtypes",[])],gd);class vd extends _o{constructor(){super(...arguments),this._glLoaded=!1,this._cssLoaded=!1}requiredElementType(){return[gd]}connectedCallback(){super.connectedCallback(),this.loadGL(),this.element.on(Mo.BEHAVIOR_GL_LOAD,this.loadGL,this),this.element.on(Mo.BEHAVIOR_GL_UNLOAD,this.unloadGL,this)}disconnectedCallback(){super.disconnectedCallback(),this.unloadGL(),this.element.off(Mo.BEHAVIOR_GL_LOAD,this.loadGL,this),this.element.off(Mo.BEHAVIOR_GL_UNLOAD,this.unloadGL,this)}get glLoaded(){return this._glLoaded}get cssLoaded(){return this._cssLoaded}loadGL(){return!!this.element.three&&(!this._glLoaded&&(this._glLoaded=!0,!0))}unloadGL(){return!!this._glLoaded&&(this._glLoaded=!1,!0)}}class yd{constructor(t,e,n,r,i,o=0){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new Lo,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new Mh,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}class bd{constructor(t,e){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Lo(1/0,1/0,1/0),this.max=void 0!==e?e:new Lo(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.length;a<c;a+=3){const c=t[a],l=t[a+1],u=t[a+2];c<e&&(e=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(e,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.count;a<c;a++){const c=t.getX(a),l=t.getY(a),u=t.getZ(a);c<e&&(e=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(e,n,r),this.max.set(i,o,s),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=wd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Lo),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Lo),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Md.copy(e.boundingBox),Md.applyMatrix4(t.matrixWorld),this.union(Md));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Lo),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,wd),wd.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Cd),Pd.subVectors(this.max,Cd),Ed.subVectors(t.a,Cd),Sd.subVectors(t.b,Cd),Td.subVectors(t.c,Cd),Ad.subVectors(Sd,Ed),Rd.subVectors(Td,Sd),Ld.subVectors(Ed,Td);let e=[0,-Ad.z,Ad.y,0,-Rd.z,Rd.y,0,-Ld.z,Ld.y,Ad.z,0,-Ad.x,Rd.z,0,-Rd.x,Ld.z,0,-Ld.x,-Ad.y,Ad.x,0,-Rd.y,Rd.x,0,-Ld.y,Ld.x,0];return!!xd(e,Ed,Sd,Td,Pd)&&(e=[1,0,0,0,1,0,0,0,1],!!xd(e,Ed,Sd,Td,Pd)&&(Od.crossVectors(Ad,Rd),e=[Od.x,Od.y,Od.z],xd(e,Ed,Sd,Td,Pd)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Lo),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return wd.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(wd).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(_d[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_d[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_d[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_d[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_d[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_d[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_d[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_d[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_d)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function xd(t,e,n,r,i){for(let o=0,s=t.length-3;o<=s;o+=3){Nd.fromArray(t,o);const s=i.x*Math.abs(Nd.x)+i.y*Math.abs(Nd.y)+i.z*Math.abs(Nd.z),a=e.dot(Nd),c=n.dot(Nd),l=r.dot(Nd);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>s)return!1}return!0}const _d=[new Lo,new Lo,new Lo,new Lo,new Lo,new Lo,new Lo,new Lo],wd=new Lo,Md=new bd,Ed=new Lo,Sd=new Lo,Td=new Lo,Ad=new Lo,Rd=new Lo,Ld=new Lo,Cd=new Lo,Pd=new Lo,Od=new Lo,Nd=new Lo,Id=new bd;class Dd{constructor(t,e){this.center=void 0!==t?t:new Lo,this.radius=void 0!==e?e:-1}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Id.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Lo),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new bd),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}let Fd=0;const Ud=new Oo,Bd=new os,kd=new Lo;function zd(){Object.defineProperty(this,"id",{value:Fd+=2}),this.uuid=Ao.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}zd.prototype=Object.assign(Object.create(zo.prototype),{constructor:zd,isGeometry:!0,applyMatrix4:function(t){const e=(new Wo).getNormalMatrix(t);for(let e=0,n=this.vertices.length;e<n;e++){this.vertices[e].applyMatrix4(t)}for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.normal.applyMatrix3(e).normalize();for(let t=0,r=n.vertexNormals.length;t<r;t++)n.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Ud.makeRotationX(t),this.applyMatrix4(Ud),this},rotateY:function(t){return Ud.makeRotationY(t),this.applyMatrix4(Ud),this},rotateZ:function(t){return Ud.makeRotationZ(t),this.applyMatrix4(Ud),this},translate:function(t,e,n){return Ud.makeTranslation(t,e,n),this.applyMatrix4(Ud),this},scale:function(t,e,n){return Ud.makeScale(t,e,n),this.applyMatrix4(Ud),this},lookAt:function(t){return Bd.lookAt(t),Bd.updateMatrix(),this.applyMatrix4(Bd.matrix),this},fromBufferGeometry:function(t){const e=this,n=null!==t.index?t.index:void 0,r=t.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const i=r.position,o=r.normal,s=r.color,a=r.uv,c=r.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let t=0;t<i.count;t++)e.vertices.push((new Lo).fromBufferAttribute(i,t)),void 0!==s&&e.colors.push((new Mh).fromBufferAttribute(s,t));function l(t,n,r,i){const l=void 0===s?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()],u=void 0===o?[]:[(new Lo).fromBufferAttribute(o,t),(new Lo).fromBufferAttribute(o,n),(new Lo).fromBufferAttribute(o,r)],h=new yd(t,n,r,u,l,i);e.faces.push(h),void 0!==a&&e.faceVertexUvs[0].push([(new gh).fromBufferAttribute(a,t),(new gh).fromBufferAttribute(a,n),(new gh).fromBufferAttribute(a,r)]),void 0!==c&&e.faceVertexUvs[1].push([(new gh).fromBufferAttribute(c,t),(new gh).fromBufferAttribute(c,n),(new gh).fromBufferAttribute(c,r)])}const u=t.groups;if(u.length>0)for(let t=0;t<u.length;t++){const e=u[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)void 0!==n?l(n.getX(t),n.getX(t+1),n.getX(t+2),e.materialIndex):l(t,t+1,t+2,e.materialIndex)}else if(void 0!==n)for(let t=0;t<n.count;t+=3)l(n.getX(t),n.getX(t+1),n.getX(t+2));else for(let t=0;t<i.count;t+=3)l(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(kd).negate(),this.translate(kd.x,kd.y,kd.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new Oo;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){const t=new Lo,e=new Lo;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],i=this.vertices[r.a],o=this.vertices[r.b],s=this.vertices[r.c];t.subVectors(s,o),e.subVectors(i,o),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t=!0){const e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new Lo;if(t){const t=new Lo,n=new Lo;for(let r=0,i=this.faces.length;r<i;r++){const i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];t.subVectors(a,s),n.subVectors(o,s),t.cross(n),e[i.a].add(t),e[i.b].add(t),e[i.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],r=n.vertexNormals;3===r.length?(r[0].copy(e[n.a]),r[1].copy(e[n.b]),r[2].copy(e[n.c])):(r[0]=e[n.a].clone(),r[1]=e[n.b].clone(),r[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const t=new zd;t.faces=this.faces;for(let e=0,n=this.morphTargets.length;e<n;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,n=this.morphNormals[e].vertexNormals;for(let e=0,r=this.faces.length;e<r;e++){const e=new Lo,r={a:new Lo,b:new Lo,c:new Lo};t.push(e),n.push(r)}}const n=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],r=n.faceNormals[t],i=n.vertexNormals[t];r.copy(e.normal),i.a.copy(e.vertexNormals[0]),i.b.copy(e.vertexNormals[1]),i.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new bd),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Dd),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n=0){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let r;const i=this.vertices.length,o=this.vertices,s=t.vertices,a=this.faces,c=t.faces,l=this.colors,u=t.colors;void 0!==e&&(r=(new Wo).getNormalMatrix(e));for(let t=0,n=s.length;t<n;t++){const n=s[t].clone();void 0!==e&&n.applyMatrix4(e),o.push(n)}for(let t=0,e=u.length;t<e;t++)l.push(u[t].clone());for(let t=0,e=c.length;t<e;t++){const e=c[t];let o,s;const l=e.vertexNormals,u=e.vertexColors,h=new yd(e.a+i,e.b+i,e.c+i);h.normal.copy(e.normal),void 0!==r&&h.normal.applyMatrix3(r).normalize();for(let t=0,e=l.length;t<e;t++)o=l[t].clone(),void 0!==r&&o.applyMatrix3(r).normalize(),h.vertexNormals.push(o);h.color.copy(e.color);for(let t=0,e=u.length;t<e;t++)s=u[t],h.vertexColors.push(s.clone());h.materialIndex=e.materialIndex+n,a.push(h)}for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,r=n.length;t<r;t++){const r=n[t],i=[];for(let t=0,e=r.length;t<e;t++)i.push(r[t].clone());this.faceVertexUvs[e].push(i)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(t=4){const e={},n=[],r=[],i=Math.pow(10,t);for(let t=0,o=this.vertices.length;t<o;t++){const o=this.vertices[t],s=Math.round(o.x*i)+"_"+Math.round(o.y*i)+"_"+Math.round(o.z*i);void 0===e[s]?(e[s]=t,n.push(this.vertices[t]),r[t]=n.length-1):r[t]=r[e[s]]}const o=[];for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.a=r[e.a],e.b=r[e.b],e.c=r[e.c];const n=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(n[e]===n[(e+1)%3]){o.push(t);break}}for(let t=o.length-1;t>=0;t--){const e=o[t];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const s=this.vertices.length-n.length;return this.vertices=n,s},setFromPoints:function(t){this.vertices=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];this.vertices.push(new Lo(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));const n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let i,o;n&&n.length===e&&(i=[]),r&&r.length===e&&(o=[]);for(let s=0;s<e;s++){const e=t[s]._id;i&&i.push(n[e]),o&&o.push(r[e])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}const e=[];for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];e.push(n.x,n.y,n.z)}const n=[],r=[],i={},o=[],s={},a=[],c={};for(let t=0;t<this.faces.length;t++){const e=this.faces[t],r=!0,i=!1,o=void 0!==this.faceVertexUvs[0][t],s=e.normal.length()>0,a=e.vertexNormals.length>0,c=1!==e.color.r||1!==e.color.g||1!==e.color.b,p=e.vertexColors.length>0;let f=0;if(f=l(f,0,0),f=l(f,1,r),f=l(f,2,i),f=l(f,3,o),f=l(f,4,s),f=l(f,5,a),f=l(f,6,c),f=l(f,7,p),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),o){const e=this.faceVertexUvs[0][t];n.push(d(e[0]),d(e[1]),d(e[2]))}if(s&&n.push(u(e.normal)),a){const t=e.vertexNormals;n.push(u(t[0]),u(t[1]),u(t[2]))}if(c&&n.push(h(e.color)),p){const t=e.vertexColors;n.push(h(t[0]),h(t[1]),h(t[2]))}}function l(t,e,n){return n?t|1<<e:t&~(1<<e)}function u(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==i[e]||(i[e]=r.length/3,r.push(t.x,t.y,t.z)),i[e]}function h(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==s[e]||(s[e]=o.length,o.push(t.getHex())),s[e]}function d(t){const e=t.x.toString()+t.y.toString();return void 0!==c[e]||(c[e]=a.length/2,a.push(t.x,t.y)),c[e]}return t.data={},t.data.vertices=e,t.data.normals=r,o.length>0&&(t.data.colors=o),a.length>0&&(t.data.uvs=[a]),t.data.faces=n,t},clone:function(){return(new zd).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let t=0,n=e.length;t<n;t++)this.vertices.push(e[t].clone());const n=t.colors;for(let t=0,e=n.length;t<e;t++)this.colors.push(n[t].clone());const r=t.faces;for(let t=0,e=r.length;t<e;t++)this.faces.push(r[t].clone());for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,r=n.length;t<r;t++){const r=n[t],i=[];for(let t=0,e=r.length;t<e;t++){const e=r[t];i.push(e.clone())}this.faceVertexUvs[e].push(i)}}const i=t.morphTargets;for(let t=0,e=i.length;t<e;t++){const e={};if(e.name=i[t].name,void 0!==i[t].vertices){e.vertices=[];for(let n=0,r=i[t].vertices.length;n<r;n++)e.vertices.push(i[t].vertices[n].clone())}if(void 0!==i[t].normals){e.normals=[];for(let n=0,r=i[t].normals.length;n<r;n++)e.normals.push(i[t].normals[n].clone())}this.morphTargets.push(e)}const o=t.morphNormals;for(let t=0,e=o.length;t<e;t++){const e={};if(void 0!==o[t].vertexNormals){e.vertexNormals=[];for(let n=0,r=o[t].vertexNormals.length;n<r;n++){const r=o[t].vertexNormals[n],i={};i.a=r.a.clone(),i.b=r.b.clone(),i.c=r.c.clone(),e.vertexNormals.push(i)}}if(void 0!==o[t].faceNormals){e.faceNormals=[];for(let n=0,r=o[t].faceNormals.length;n<r;n++)e.faceNormals.push(o[t].faceNormals[n].clone())}this.morphNormals.push(e)}const s=t.skinWeights;for(let t=0,e=s.length;t<e;t++)this.skinWeights.push(s[t].clone());const a=t.skinIndices;for(let t=0,e=a.length;t<e;t++)this.skinIndices.push(a[t].clone());const c=t.lineDistances;for(let t=0,e=c.length;t<e;t++)this.lineDistances.push(c[t]);const l=t.boundingBox;null!==l&&(this.boundingBox=l.clone());const u=t.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Hd{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const o=t.elements,s=o[0],a=o[4],c=o[8],l=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-l)<.01&&Math.abs(c-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+l)<.1&&Math.abs(c+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(s+1)/2,o=(u+1)/2,m=(f+1)/2,g=(a+l)/4,v=(c+d)/4,y=(h+p)/4;return t>o&&t>m?t<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=g/n,i=v/n):o>m?o<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,e),this}let m=Math.sqrt((p-h)*(p-h)+(c-d)*(c-d)+(l-a)*(l-a));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(c-d)/m,this.z=(l-a)/m,this.w=Math.acos((s+u+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}const Gd=new Lo,jd=new gh;function Vd(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=rh,this.updateRange={offset:0,count:-1},this.version=0}function Wd(t,e,n){Vd.call(this,new Int8Array(t),e,n)}function qd(t,e,n){Vd.call(this,new Uint8Array(t),e,n)}function Xd(t,e,n){Vd.call(this,new Uint8ClampedArray(t),e,n)}function Yd(t,e,n){Vd.call(this,new Int16Array(t),e,n)}function Zd(t,e,n){Vd.call(this,new Uint16Array(t),e,n)}function Jd(t,e,n){Vd.call(this,new Int32Array(t),e,n)}function $d(t,e,n){Vd.call(this,new Uint32Array(t),e,n)}function Kd(t,e,n){Vd.call(this,new Uint16Array(t),e,n)}function Qd(t,e,n){Vd.call(this,new Float32Array(t),e,n)}function tp(t,e,n){Vd.call(this,new Float64Array(t),e,n)}Object.defineProperty(Vd.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Vd.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Mh),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new gh),e[n++]=i.x,e[n++]=i.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Lo),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Hd),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)jd.fromBufferAttribute(this,e),jd.applyMatrix3(t),this.setXY(e,jd.x,jd.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Gd.fromBufferAttribute(this,e),Gd.applyMatrix3(t),this.setXYZ(e,Gd.x,Gd.y,Gd.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)Gd.x=this.getX(e),Gd.y=this.getY(e),Gd.z=this.getZ(e),Gd.applyMatrix4(t),this.setXYZ(e,Gd.x,Gd.y,Gd.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)Gd.x=this.getX(e),Gd.y=this.getY(e),Gd.z=this.getZ(e),Gd.applyNormalMatrix(t),this.setXYZ(e,Gd.x,Gd.y,Gd.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)Gd.x=this.getX(e),Gd.y=this.getY(e),Gd.z=this.getZ(e),Gd.transformDirection(t),this.setXYZ(e,Gd.x,Gd.y,Gd.z);return this},set:function(t,e=0){return this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Wd.prototype=Object.create(Vd.prototype),Wd.prototype.constructor=Wd,qd.prototype=Object.create(Vd.prototype),qd.prototype.constructor=qd,Xd.prototype=Object.create(Vd.prototype),Xd.prototype.constructor=Xd,Yd.prototype=Object.create(Vd.prototype),Yd.prototype.constructor=Yd,Zd.prototype=Object.create(Vd.prototype),Zd.prototype.constructor=Zd,Jd.prototype=Object.create(Vd.prototype),Jd.prototype.constructor=Jd,$d.prototype=Object.create(Vd.prototype),$d.prototype.constructor=$d,Kd.prototype=Object.create(Vd.prototype),Kd.prototype.constructor=Kd,Kd.prototype.isFloat16BufferAttribute=!0,Qd.prototype=Object.create(Vd.prototype),Qd.prototype.constructor=Qd,tp.prototype=Object.create(Vd.prototype),tp.prototype.constructor=tp;class ep{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const e=[];let n,r,i=void 0;const o=t.faces;for(r=0;r<o.length;r++){const t=o[r];t.materialIndex!==i&&(i=t.materialIndex,void 0!==n&&(n.count=3*r-n.start,e.push(n)),n={start:3*r,materialIndex:i})}void 0!==n&&(n.count=3*r-n.start,e.push(n)),this.groups=e}fromGeometry(t){const e=t.faces,n=t.vertices,r=t.faceVertexUvs,i=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,s=t.morphTargets,a=s.length;let c;if(a>0){c=[];for(let t=0;t<a;t++)c[t]={name:s[t].name,data:[]};this.morphTargets.position=c}const l=t.morphNormals,u=l.length;let h;if(u>0){h=[];for(let t=0;t<u;t++)h[t]={name:l[t].name,data:[]};this.morphTargets.normal=h}const d=t.skinIndices,p=t.skinWeights,f=d.length===n.length,m=p.length===n.length;n.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<e.length;t++){const g=e[t];this.vertices.push(n[g.a],n[g.b],n[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=g.normal;this.normals.push(t,t,t)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=g.color;this.colors.push(t,t,t)}if(!0===i){const e=r[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new gh,new gh,new gh))}if(!0===o){const e=r[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new gh,new gh,new gh))}for(let t=0;t<a;t++){const e=s[t].vertices;c[t].data.push(e[g.a],e[g.b],e[g.c])}for(let e=0;e<u;e++){const n=l[e].vertexNormals[t];h[e].data.push(n.a,n.b,n.c)}f&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),m&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}}function np(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}const rp={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ip(t,e){return new rp[t](e)}let op=1;const sp=new Oo,ap=new os,cp=new Lo,lp=new bd,up=new bd,hp=new Lo;function dp(){Object.defineProperty(this,"id",{value:op+=2}),this.uuid=Ao.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}dp.prototype=Object.assign(Object.create(zo.prototype),{constructor:dp,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(np(t)>65535?$d:Zd)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Wo).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return sp.makeRotationX(t),this.applyMatrix4(sp),this},rotateY:function(t){return sp.makeRotationY(t),this.applyMatrix4(sp),this},rotateZ:function(t){return sp.makeRotationZ(t),this.applyMatrix4(sp),this},translate:function(t,e,n){return sp.makeTranslation(t,e,n),this.applyMatrix4(sp),this},scale:function(t,e,n){return sp.makeScale(t,e,n),this.applyMatrix4(sp),this},lookAt:function(t){return ap.lookAt(t),ap.updateMatrix(),this.applyMatrix4(ap.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(cp).negate(),this.translate(cp.x,cp.y,cp.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Qd(3*e.vertices.length,3),n=new Qd(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Qd(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Qd(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new ep).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new Vd(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new Vd(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new Vd(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new Vd(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new Vd(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const n=[],r=t.morphTargets[e];for(let t=0,e=r.length;t<e;t++){const e=r[t],i=new Qd(3*e.data.length,3);i.name=e.name,n.push(i.copyVector3sArray(e.data))}this.morphAttributes[e]=n}if(t.skinIndices.length>0){const e=new Qd(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Qd(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new bd);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Lo(-1/0,-1/0,-1/0),new Lo(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];lp.setFromBufferAttribute(n),this.morphTargetsRelative?(hp.addVectors(this.boundingBox.min,lp.min),this.boundingBox.expandByPoint(hp),hp.addVectors(this.boundingBox.max,lp.max),this.boundingBox.expandByPoint(hp)):(this.boundingBox.expandByPoint(lp.min),this.boundingBox.expandByPoint(lp.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Dd);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Lo,1/0);if(t){const n=this.boundingSphere.center;if(lp.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];up.setFromBufferAttribute(n),this.morphTargetsRelative?(hp.addVectors(lp.min,up.min),lp.expandByPoint(hp),hp.addVectors(lp.max,up.max),lp.expandByPoint(hp)):(lp.expandByPoint(up.min),lp.expandByPoint(up.max))}lp.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)hp.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(hp));if(e)for(let i=0,o=e.length;i<o;i++){const o=e[i],s=this.morphTargetsRelative;for(let e=0,i=o.count;e<i;e++)hp.fromBufferAttribute(o,e),s&&(cp.fromBufferAttribute(t,e),hp.add(cp)),r=Math.max(r,n.distanceToSquared(hp))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Vd(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new Lo,i=new Lo,o=new Lo,s=new Lo,a=new Lo,c=new Lo,l=new Lo,u=new Lo;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),o.fromBufferAttribute(e,f),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),c.fromBufferAttribute(n,f),s.add(l),a.add(l),c.add(l),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let t=0,s=e.count;t<s;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r].array,o=t.attributes[r],s=o.array,a=o.itemSize*e,c=Math.min(s.length,i.length-a);for(let t=0,e=a;t<c;t++,e++)i[e]=s[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)hp.fromBufferAttribute(t,e),hp.normalize(),t.setXYZ(e,hp.x,hp.y,hp.z)},toNonIndexed:function(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r);let s=0,a=0;for(let t=0,i=e.length;t<i;t++){s=e[t]*r;for(let t=0;t<r;t++)o[a++]=n[s++]}return new Vd(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new dp,n=this.index.array,r=this.attributes;for(const i in r){const o=t(r[i],n);e.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let e=0,r=s.length;e<r;e++){const r=t(s[e],n);o.push(r)}e.morphAttributes[r]=o}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,n=o.length;t<n;t++){const n=o[t];e.addGroup(n.start,n.count,n.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),t.data.attributes[e]=i}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],o=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),o.push(i)}o.length>0&&(r[e]=o,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(t.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),t},clone:function(){return(new dp).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];this.addGroup(e.start,e.count,e.materialIndex)}const s=t.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class pp extends dp{constructor(t=1,e=1,n=1,r=1,i=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],c=[],l=[],u=[];let h=0,d=0;function p(t,e,n,r,i,o,p,f,m,g,v){const y=o/m,b=p/g,x=o/2,_=p/2,w=f/2,M=m+1,E=g+1;let S=0,T=0;const A=new Lo;for(let o=0;o<E;o++){const s=o*b-_;for(let a=0;a<M;a++){const h=a*y-x;A[t]=h*r,A[e]=s*i,A[n]=w,c.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,l.push(A.x,A.y,A.z),u.push(a/m),u.push(1-o/g),S+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+M*t,r=h+e+M*(t+1),i=h+(e+1)+M*(t+1),o=h+(e+1)+M*t;a.push(n,r,o),a.push(r,i,o),T+=6}s.addGroup(d,T,v),d+=T,h+=S}p("z","y","x",-1,-1,n,e,t,o,i,0),p("z","y","x",1,-1,n,e,-t,o,i,1),p("x","z","y",1,1,t,n,e,r,o,2),p("x","z","y",1,-1,t,n,-e,r,o,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new Qd(c,3)),this.setAttribute("normal",new Qd(l,3)),this.setAttribute("uv",new Qd(u,2))}}class fp extends zd{constructor(t,e,n,r,i,o){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new pp(t,e,n,r,i,o)),this.mergeVertices()}}const mp=new Lo,gp=new Lo,vp=new Lo,yp=new Lo,bp=new Lo,xp=new Lo,_p=new Lo;class wp{constructor(t,e){this.origin=void 0!==t?t:new Lo,this.direction=void 0!==e?e:new Lo(0,0,-1)}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Lo),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,mp)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Lo),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=mp.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(mp.copy(this.direction).multiplyScalar(e).add(this.origin),mp.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){gp.copy(t).add(e).multiplyScalar(.5),vp.copy(e).sub(t).normalize(),yp.copy(this.origin).sub(gp);const i=.5*t.distanceTo(e),o=-this.direction.dot(vp),s=yp.dot(this.direction),a=-yp.dot(vp),c=yp.lengthSq(),l=Math.abs(1-o*o);let u,h,d,p;if(l>0)if(u=o*a-s,h=o*s-a,p=i*l,u>=0)if(h>=-p)if(h<=p){const t=1/l;u*=t,h*=t,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+c}else h=i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h=-i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h<=-p?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+c):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(vp).multiplyScalar(h).add(gp),d}intersectSphere(t,e){mp.subVectors(t.center,this.origin);const n=mp.dot(this.direction),r=mp.dot(mp)-n*n,i=t.radius*t.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,e):this.at(s,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(t.min.x-h.x)*c,r=(t.max.x-h.x)*c):(n=(t.max.x-h.x)*c,r=(t.min.x-h.x)*c),l>=0?(i=(t.min.y-h.y)*l,o=(t.max.y-h.y)*l):(i=(t.max.y-h.y)*l,o=(t.min.y-h.y)*l),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(s=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(s=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,mp)}intersectTriangle(t,e,n,r,i){bp.subVectors(e,t),xp.subVectors(n,t),_p.crossVectors(bp,xp);let o,s=this.direction.dot(_p);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}yp.subVectors(this.origin,t);const a=o*this.direction.dot(xp.crossVectors(yp,xp));if(a<0)return null;const c=o*this.direction.dot(bp.cross(yp));if(c<0)return null;if(a+c>s)return null;const l=-o*yp.dot(_p);return l<0?null:this.at(l/s,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}const Mp=new Lo,Ep=new Lo,Sp=new Wo;class Tp{constructor(t,e){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Lo(1,0,0),this.constant=void 0!==e?e:0}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=Mp.subVectors(n,e).cross(Ep.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Lo),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Lo);const n=t.delta(Mp),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Lo),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Sp.getNormalMatrix(t),r=this.coplanarPoint(Mp).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const Ap=new Lo,Rp=new Lo,Lp=new Lo,Cp=new Lo,Pp=new Lo,Op=new Lo,Np=new Lo,Ip=new Lo,Dp=new Lo,Fp=new Lo;class Up{constructor(t,e,n){this.a=void 0!==t?t:new Lo,this.b=void 0!==e?e:new Lo,this.c=void 0!==n?n:new Lo}static getNormal(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Lo),r.subVectors(n,e),Ap.subVectors(t,e),r.cross(Ap);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){Ap.subVectors(r,e),Rp.subVectors(n,e),Lp.subVectors(t,e);const o=Ap.dot(Ap),s=Ap.dot(Rp),a=Ap.dot(Lp),c=Rp.dot(Rp),l=Rp.dot(Lp),u=o*c-s*s;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Lo),0===u)return i.set(-2,-1,-1);const h=1/u,d=(c*a-s*l)*h,p=(o*l-s*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,Cp),Cp.x>=0&&Cp.y>=0&&Cp.x+Cp.y<=1}static getUV(t,e,n,r,i,o,s,a){return this.getBarycoord(t,e,n,r,Cp),a.set(0,0),a.addScaledVector(i,Cp.x),a.addScaledVector(o,Cp.y),a.addScaledVector(s,Cp.z),a}static isFrontFacing(t,e,n,r){return Ap.subVectors(n,e),Rp.subVectors(t,e),Ap.cross(Rp).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ap.subVectors(this.c,this.b),Rp.subVectors(this.a,this.b),.5*Ap.cross(Rp).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Lo),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Up.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Tp),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Up.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,i){return Up.getUV(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return Up.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Up.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Lo);const n=this.a,r=this.b,i=this.c;let o,s;Pp.subVectors(r,n),Op.subVectors(i,n),Ip.subVectors(t,n);const a=Pp.dot(Ip),c=Op.dot(Ip);if(a<=0&&c<=0)return e.copy(n);Dp.subVectors(t,r);const l=Pp.dot(Dp),u=Op.dot(Dp);if(l>=0&&u<=l)return e.copy(r);const h=a*u-l*c;if(h<=0&&a>=0&&l<=0)return o=a/(a-l),e.copy(n).addScaledVector(Pp,o);Fp.subVectors(t,i);const d=Pp.dot(Fp),p=Op.dot(Fp);if(p>=0&&d<=p)return e.copy(i);const f=d*c-a*p;if(f<=0&&c>=0&&p<=0)return s=c/(c-p),e.copy(n).addScaledVector(Op,s);const m=l*p-d*u;if(m<=0&&u-l>=0&&d-p>=0)return Np.subVectors(i,r),s=(u-l)/(u-l+(d-p)),e.copy(r).addScaledVector(Np,s);const g=1/(m+f+h);return o=f*g,s=h*g,e.copy(n).addScaledVector(Pp,o).addScaledVector(Op,s)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}function Bp(t){mh.call(this),this.type="MeshBasicMaterial",this.color=new Mh(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Rc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Bp.prototype=Object.create(mh.prototype),Bp.prototype.constructor=Bp,Bp.prototype.isMeshBasicMaterial=!0,Bp.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const kp=new Oo,zp=new wp,Hp=new Dd,Gp=new Lo,jp=new Lo,Vp=new Lo,Wp=new Lo,qp=new Lo,Xp=new Lo,Yp=new Lo,Zp=new Lo,Jp=new Lo,$p=new gh,Kp=new gh,Qp=new gh,tf=new Lo,ef=new Lo;function nf(t=new dp,e=new Bp){os.call(this),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}function rf(t,e,n,r,i,o,s,a){let c;if(c=e.side===Ya?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,e.side!==Za,a),null===c)return null;ef.copy(a),ef.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(ef);return l<n.near||l>n.far?null:{distance:l,point:ef.clone(),object:t}}function of(t,e,n,r,i,o,s,a,c,l,u,h){Gp.fromBufferAttribute(i,l),jp.fromBufferAttribute(i,u),Vp.fromBufferAttribute(i,h);const d=t.morphTargetInfluences;if(e.morphTargets&&o&&d){Yp.set(0,0,0),Zp.set(0,0,0),Jp.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=d[t],n=o[t];0!==e&&(Wp.fromBufferAttribute(n,l),qp.fromBufferAttribute(n,u),Xp.fromBufferAttribute(n,h),s?(Yp.addScaledVector(Wp,e),Zp.addScaledVector(qp,e),Jp.addScaledVector(Xp,e)):(Yp.addScaledVector(Wp.sub(Gp),e),Zp.addScaledVector(qp.sub(jp),e),Jp.addScaledVector(Xp.sub(Vp),e)))}Gp.add(Yp),jp.add(Zp),Vp.add(Jp)}t.isSkinnedMesh&&(t.boneTransform(l,Gp),t.boneTransform(u,jp),t.boneTransform(h,Vp));const p=rf(t,e,n,r,Gp,jp,Vp,tf);if(p){a&&($p.fromBufferAttribute(a,l),Kp.fromBufferAttribute(a,u),Qp.fromBufferAttribute(a,h),p.uv=Up.getUV(tf,Gp,jp,Vp,$p,Kp,Qp,new gh)),c&&($p.fromBufferAttribute(c,l),Kp.fromBufferAttribute(c,u),Qp.fromBufferAttribute(c,h),p.uv2=Up.getUV(tf,Gp,jp,Vp,$p,Kp,Qp,new gh));const t=new yd(l,u,h);Up.getNormal(Gp,jp,Vp,t.normal),p.face=t}return p}nf.prototype=Object.assign(Object.create(os.prototype),{constructor:nf,isMesh:!0,copy:function(t){return os.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Hp.copy(n.boundingSphere),Hp.applyMatrix4(i),!1===t.ray.intersectsSphere(Hp))return;if(kp.copy(i).invert(),zp.copy(t.ray).applyMatrix4(kp),null!==n.boundingBox&&!1===zp.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=of(this,f,t,zp,s,a,c,l,u,r,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,e.push(o))}}else{for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);o=of(this,r,t,zp,s,a,c,l,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}}else if(void 0!==s)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3){o=of(this,p,t,zp,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,e.push(o))}}else{for(let n=Math.max(0,d.start),i=Math.min(s.count,d.start+d.count);n<i;n+=3){o=of(this,r,t,zp,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}}}else if(n.isGeometry){const i=Array.isArray(r),s=n.vertices,a=n.faces;let c;const l=n.faceVertexUvs[0];l.length>0&&(c=l);for(let n=0,l=a.length;n<l;n++){const l=a[n],u=i?r[l.materialIndex]:r;if(void 0===u)continue;const h=s[l.a],d=s[l.b],p=s[l.c];if(o=rf(this,u,t,zp,h,d,p,tf),o){if(c&&c[n]){const t=c[n];$p.copy(t[0]),Kp.copy(t[1]),Qp.copy(t[2]),o.uv=Up.getUV(tf,h,d,p,$p,Kp,Qp,new gh)}o.face=l,o.faceIndex=n,e.push(o)}}}}});var sf=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},af=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let cf=class extends gd{constructor(){super(...arguments),this.castShadow=!0,this.receiveShadow=!0}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Zr(()=>{this.three.castShadow=this.castShadow,this.needsUpdate()}),Zr(()=>{this.three.receiveShadow=this.receiveShadow,this.three.material.needsUpdate=!0,this.needsUpdate()})),!0)}makeThreeObject3d(){return new nf}};function lf(t){mh.call(this),this.type="PointsMaterial",this.color=new Mh(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}cf.defaultElementName="lume-mesh",cf.defaultBehaviors={"box-geometry":t=>!t.some(t=>t.endsWith("-geometry")),"phong-material":t=>!t.some(t=>t.endsWith("-material"))},sf([li(!0),J("propertychange"),af("design:type",Object)],cf.prototype,"castShadow",void 0),sf([li(!0),J("propertychange"),af("design:type",Object)],cf.prototype,"receiveShadow",void 0),cf=sf([ui],cf),lf.prototype=Object.create(mh.prototype),lf.prototype.constructor=lf,lf.prototype.isPointsMaterial=!0,lf.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const uf=new Oo,hf=new wp,df=new Dd,pf=new Lo;function ff(t=new dp,e=new lf){os.call(this),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}function mf(t,e,n,r,i,o,s){const a=hf.distanceSqToPoint(t);if(a<n){const n=new Lo;hf.closestPointToPoint(t,n),n.applyMatrix4(r);const c=i.ray.origin.distanceTo(n);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:s})}}var gf,vf;ff.prototype=Object.assign(Object.create(os.prototype),{constructor:ff,isPoints:!0,copy:function(t){return os.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),df.copy(n.boundingSphere),df.applyMatrix4(r),df.radius+=i,!1===t.ray.intersectsSphere(df))return;uf.copy(r).invert(),hf.copy(t.ray).applyMatrix4(uf);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,a=n.length;i<a;i++){const a=n[i];pf.fromBufferAttribute(o,a),mf(pf,a,s,r,t,e,this)}}else for(let n=0,i=o.count;n<i;n++)pf.fromBufferAttribute(o,n),mf(pf,n,s,r,t,e,this)}else{const i=n.vertices;for(let n=0,o=i.length;n<o;n++)mf(i[n],n,s,r,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const yf=null!==(vf=null===(gf=window.$LUME)||void 0===gf?void 0:gf.autoDefineElements)&&void 0!==vf&&vf;var bf=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};let xf=class extends gd{makeThreeObject3d(){return new ff}};xf.defaultBehaviors={"box-geometry":t=>!t.some(t=>t.endsWith("-geometry")),"points-material":t=>!t.some(t=>t.endsWith("-material"))},xf=bf([ui("lume-points",yf)],xf);var _f,wf,Mf,Ef,Sf,Tf=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};class Af extends vd{constructor(){super(...arguments),_f.add(this)}requiredElementType(){return[cf,xf]}loadGL(){return!!super.loadGL()&&(this.resetMeshComponent(),this.element.needsUpdate(),!0)}unloadGL(){return!!super.unloadGL()&&(this.element.three?Tf(this,_f,"m",Ef).call(this,this.element,this.type):Tf(this,_f,"m",wf).call(this,this.element,this.type),this.element.needsUpdate(),!0)}resetMeshComponent(){Tf(this,_f,"m",Mf).call(this,this.element,this.type,this._createComponent()),this.element.needsUpdate()}getMeshComponent(t){return this.element.three[t]}_createComponent(){throw new Error("`_createComponent()` is not implemented by subclass.")}}_f=new WeakSet,wf=function(t,e){t.three[e]&&t.three[e].dispose()},Mf=function(t,e,n){Tf(this,_f,"m",wf).call(this,t,e),t.three[e]=n},Ef=function(t,e){Tf(this,_f,"m",Mf).call(this,t,e,Tf(this,_f,"m",Sf).call(this,t,e))},Sf=function(t,e){switch(e){case"geometry":return new fp(t.calculatedSize.x,t.calculatedSize.y,t.calculatedSize.z);case"material":return new Eh({color:16737792})}};class Rf extends Af{constructor(){super(...arguments),this.type="geometry",this._stopFns=[]}get size(){return this.element.size}set size(t){this.element.size=t}get sizeMode(){return this.element.sizeMode}set sizeMode(t){this.element.sizeMode=t}loadGL(){return!!super.loadGL()&&(this._stopFns.push(Zr(()=>{this.size,this.sizeMode,this.resetMeshComponent()})),!0)}unloadGL(){if(!super.unloadGL())return!1;for(const t of this._stopFns)t();return this._stopFns.length=0,!0}}class Lf extends Rf{_createComponent(){return new fp(this.element.calculatedSize.x,this.element.calculatedSize.y,this.element.calculatedSize.z)}}elementBehaviors.has("box-geometry")||elementBehaviors.define("box-geometry",Lf);class Cf extends Rf{_createComponent(){return new fp(this.element.calculatedSize.x,this.element.calculatedSize.y,1)}}elementBehaviors.has("mixedplane-geometry")||elementBehaviors.define("mixedplane-geometry",Cf);const Pf=0,Of=1,Nf=2,If=0,Df=1,Ff=2,Uf=3;function Bf(){}Object.assign(Bf.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t)}}});const kf=[];for(let t=0;t<256;t++)kf[t]=(t<16?"0":"")+t.toString(16);let zf=1234567;const Hf={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(kf[255&t]+kf[t>>8&255]+kf[t>>16&255]+kf[t>>24&255]+"-"+kf[255&e]+kf[e>>8&255]+"-"+kf[e>>16&15|64]+kf[e>>24&255]+"-"+kf[63&n|128]+kf[n>>8&255]+"-"+kf[n>>16&255]+kf[n>>24&255]+kf[255&r]+kf[r>>8&255]+kf[r>>16&255]+kf[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(zf=t%2147483647),zf=16807*zf%2147483647,(zf-1)/2147483646},degToRad:function(t){return t*Hf.DEG2RAD},radToDeg:function(t){return t*Hf.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),l=o((e+r)/2),u=s((e+r)/2),h=o((e-r)/2),d=s((e-r)/2),p=o((r-e)/2),f=s((r-e)/2);switch(i){case"XYX":t.set(a*u,c*h,c*d,a*l);break;case"YZY":t.set(c*d,a*u,c*h,a*l);break;case"ZXZ":t.set(c*h,c*d,a*u,a*l);break;case"XZX":t.set(a*u,c*f,c*p,a*l);break;case"YXY":t.set(c*p,a*u,c*f,a*l);break;case"ZYZ":t.set(c*f,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class Gf{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class jf{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,s,a,c){const l=this.elements;return l[0]=t,l[1]=r,l[2]=s,l[3]=e,l[4]=i,l[5]=a,l[6]=n,l[7]=o,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],l=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],_=r[5],w=r[8];return i[0]=o*f+s*v+a*x,i[3]=o*m+s*y+a*_,i[6]=o*g+s*b+a*w,i[1]=c*f+l*v+u*x,i[4]=c*m+l*y+u*_,i[7]=c*g+l*b+u*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*_,i[8]=h*g+d*b+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8];return e*o*l-e*s*c-n*i*l+n*s*a+r*i*c-r*o*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8],u=l*o-s*c,h=s*a-l*i,d=c*i-o*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(r*c-l*n)*f,t[2]=(s*n-r*o)*f,t[3]=h*f,t[4]=(l*e-r*a)*f,t[5]=(r*i-s*e)*f,t[6]=d*f,t[7]=(n*a-c*e)*f,t[8]=(o*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,o,s){const a=Math.cos(i),c=Math.sin(i);return this.set(n*a,n*c,-n*(a*o+c*s)+o+t,-r*c,r*a,-r*(-c*o+a*s)+s+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],c=r[4],l=r[7];return r[0]=e*i+n*a,r[3]=e*o+n*c,r[6]=e*s+n*l,r[1]=-n*i+e*a,r[4]=-n*o+e*c,r[7]=-n*s+e*l,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}let Vf;const Wf={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Vf&&(Vf=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Vf.width=t.width,Vf.height=t.height;const n=Vf.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Vf}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let qf=0;function Xf(t=Xf.DEFAULT_IMAGE,e=Xf.DEFAULT_MAPPING,n=1001,r=1001,i=1006,o=1008,s=1023,a=1009,c=1,l=3e3){Object.defineProperty(this,"id",{value:qf++}),this.uuid=Hf.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=a,this.offset=new Gf(0,0),this.repeat=new Gf(1,1),this.center=new Gf(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new jf,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.version=0,this.onUpdate=null}function Yf(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Wf.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Xf.DEFAULT_IMAGE=void 0,Xf.DEFAULT_MAPPING=300,Xf.prototype=Object.assign(Object.create(Bf.prototype),{constructor:Xf,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Hf.generateUUID()),!e&&void 0===t.images[r.uuid]){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Yf(r[t].image)):e.push(Yf(r[t]))}else e=Yf(r);t.images[r.uuid]={uuid:r.uuid,url:e}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Xf.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class Zf{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const o=t.elements,s=o[0],a=o[4],c=o[8],l=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-l)<.01&&Math.abs(c-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+l)<.1&&Math.abs(c+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(s+1)/2,o=(u+1)/2,m=(f+1)/2,g=(a+l)/4,v=(c+d)/4,y=(h+p)/4;return t>o&&t>m?t<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=g/n,i=v/n):o>m?o<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,e),this}let m=Math.sqrt((p-h)*(p-h)+(c-d)*(c-d)+(l-a)*(l-a));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(c-d)/m,this.z=(l-a)/m,this.w=Math.acos((s+u+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function Jf(t,e,n){this.width=t,this.height=e,this.scissor=new Zf(0,0,t,e),this.scissorTest=!1,this.viewport=new Zf(0,0,t,e),n=n||{},this.texture=new Xf(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function $f(t,e,n){Jf.call(this,t,e,n),this.samples=4}Jf.prototype=Object.assign(Object.create(Bf.prototype),{constructor:Jf,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),$f.prototype=Object.assign(Object.create(Jf.prototype),{constructor:$f,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Jf.prototype.copy.call(this,t),this.samples=t.samples,this}});class Kf{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return n.copy(t).slerp(e,r)}static slerpFlat(t,e,n,r,i,o,s){let a=n[r+0],c=n[r+1],l=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||c!==d||l!==p){let t=1-s;const e=a*h+c*d+l*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,e*n);t=Math.sin(t*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*t+h*i,c=c*t+d*i,l=l*t+p*i,u=u*t+f*i,t===1-s){const t=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=t,c*=t,l*=t,u*=t}}t[e]=a,t[e+1]=c,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,o){const s=n[r],a=n[r+1],c=n[r+2],l=n[r+3],u=i[o],h=i[o+1],d=i[o+2],p=i[o+3];return t[e]=s*p+l*u+a*d-c*h,t[e+1]=a*p+l*h+c*u-s*d,t[e+2]=c*p+l*d+s*h-a*u,t[e+3]=l*p-s*u-a*h-c*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,o=t._order,s=Math.cos,a=Math.sin,c=s(n/2),l=s(r/2),u=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(o){case"XYZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"YXZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"ZXY":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"ZYX":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"YZX":this._x=h*l*u+c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u-h*d*p;break;case"XZY":this._x=h*l*u-c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],s=e[5],a=e[9],c=e[2],l=e[6],u=e[10],h=n+s+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(l-a)*t,this._y=(i-c)*t,this._z=(o-r)*t}else if(n>s&&n>u){const t=2*Math.sqrt(1+n-s-u);this._w=(l-a)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(i+c)/t}else if(s>u){const t=2*Math.sqrt(1+s-n-u);this._w=(i-c)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+u-n-s);this._w=(o-r)/t,this._x=(i+c)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Hf.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,o=t._w,s=e._x,a=e._y,c=e._z,l=e._w;return this._x=n*l+o*s+r*c-i*a,this._y=r*l+o*a+i*s-n*c,this._z=i*l+o*c+n*a-r*s,this._w=o*l-n*s-r*a-i*c,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*t._w+n*t._x+r*t._y+i*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),u=Math.sin((1-e)*l)/c,h=Math.sin(e*l)/c;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Qf{constructor(t=0,e=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(em.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(em.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,s=t.z,a=t.w,c=a*e+o*r-s*n,l=a*n+s*e-i*r,u=a*r+i*n-o*e,h=-i*e-o*n-s*r;return this.x=c*a+h*-i+l*-s-u*-o,this.y=l*a+h*-o+u*-i-c*-s,this.z=u*a+h*-s+c*-o-l*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,o=e.x,s=e.y,a=e.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return tm.copy(this).projectOnVector(t),this.sub(tm)}reflect(t){return this.sub(tm.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Hf.clamp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const tm=new Qf,em=new Kf;class nm{constructor(t,e){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Qf(1/0,1/0,1/0),this.max=void 0!==e?e:new Qf(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.length;a<c;a+=3){const c=t[a],l=t[a+1],u=t[a+2];c<e&&(e=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(e,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.count;a<c;a++){const c=t.getX(a),l=t.getY(a),u=t.getZ(a);c<e&&(e=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(e,n,r),this.max.set(i,o,s),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=om.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Qf),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Qf),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),sm.copy(e.boundingBox),sm.applyMatrix4(t.matrixWorld),this.union(sm));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Qf),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,om),om.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(pm),fm.subVectors(this.max,pm),am.subVectors(t.a,pm),cm.subVectors(t.b,pm),lm.subVectors(t.c,pm),um.subVectors(cm,am),hm.subVectors(lm,cm),dm.subVectors(am,lm);let e=[0,-um.z,um.y,0,-hm.z,hm.y,0,-dm.z,dm.y,um.z,0,-um.x,hm.z,0,-hm.x,dm.z,0,-dm.x,-um.y,um.x,0,-hm.y,hm.x,0,-dm.y,dm.x,0];return!!rm(e,am,cm,lm,fm)&&(e=[1,0,0,0,1,0,0,0,1],!!rm(e,am,cm,lm,fm)&&(mm.crossVectors(um,hm),e=[mm.x,mm.y,mm.z],rm(e,am,cm,lm,fm)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Qf),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return om.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(om).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(im[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),im[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),im[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),im[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),im[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),im[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),im[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),im[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(im)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function rm(t,e,n,r,i){for(let o=0,s=t.length-3;o<=s;o+=3){gm.fromArray(t,o);const s=i.x*Math.abs(gm.x)+i.y*Math.abs(gm.y)+i.z*Math.abs(gm.z),a=e.dot(gm),c=n.dot(gm),l=r.dot(gm);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>s)return!1}return!0}const im=[new Qf,new Qf,new Qf,new Qf,new Qf,new Qf,new Qf,new Qf],om=new Qf,sm=new nm,am=new Qf,cm=new Qf,lm=new Qf,um=new Qf,hm=new Qf,dm=new Qf,pm=new Qf,fm=new Qf,mm=new Qf,gm=new Qf,vm=new nm;class ym{constructor(t,e){this.center=void 0!==t?t:new Qf,this.radius=void 0!==e?e:-1}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):vm.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Qf),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new nm),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const bm=new Qf,xm=new Qf,_m=new Qf,wm=new Qf,Mm=new Qf,Em=new Qf,Sm=new Qf;class Tm{constructor(t,e){this.origin=void 0!==t?t:new Qf,this.direction=void 0!==e?e:new Qf(0,0,-1)}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Qf),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,bm)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Qf),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=bm.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(bm.copy(this.direction).multiplyScalar(e).add(this.origin),bm.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){xm.copy(t).add(e).multiplyScalar(.5),_m.copy(e).sub(t).normalize(),wm.copy(this.origin).sub(xm);const i=.5*t.distanceTo(e),o=-this.direction.dot(_m),s=wm.dot(this.direction),a=-wm.dot(_m),c=wm.lengthSq(),l=Math.abs(1-o*o);let u,h,d,p;if(l>0)if(u=o*a-s,h=o*s-a,p=i*l,u>=0)if(h>=-p)if(h<=p){const t=1/l;u*=t,h*=t,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+c}else h=i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h=-i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h<=-p?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+c):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(_m).multiplyScalar(h).add(xm),d}intersectSphere(t,e){bm.subVectors(t.center,this.origin);const n=bm.dot(this.direction),r=bm.dot(bm)-n*n,i=t.radius*t.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,e):this.at(s,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(t.min.x-h.x)*c,r=(t.max.x-h.x)*c):(n=(t.max.x-h.x)*c,r=(t.min.x-h.x)*c),l>=0?(i=(t.min.y-h.y)*l,o=(t.max.y-h.y)*l):(i=(t.max.y-h.y)*l,o=(t.min.y-h.y)*l),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(s=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(s=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,bm)}intersectTriangle(t,e,n,r,i){Mm.subVectors(e,t),Em.subVectors(n,t),Sm.crossVectors(Mm,Em);let o,s=this.direction.dot(Sm);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}wm.subVectors(this.origin,t);const a=o*this.direction.dot(Em.crossVectors(wm,Em));if(a<0)return null;const c=o*this.direction.dot(Mm.cross(wm));if(c<0)return null;if(a+c>s)return null;const l=-o*wm.dot(Sm);return l<0?null:this.at(l/s,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Am{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Am).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Rm.setFromMatrixColumn(t,0).length(),i=1/Rm.setFromMatrixColumn(t,1).length(),o=1/Rm.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),c=Math.sin(r),l=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){const t=o*l,n=o*u,r=s*l,i=s*u;e[0]=a*l,e[4]=-a*u,e[8]=c,e[1]=n+r*c,e[5]=t-i*c,e[9]=-s*a,e[2]=i-t*c,e[6]=r+n*c,e[10]=o*a}else if("YXZ"===t.order){const t=a*l,n=a*u,r=c*l,i=c*u;e[0]=t+i*s,e[4]=r*s-n,e[8]=o*c,e[1]=o*u,e[5]=o*l,e[9]=-s,e[2]=n*s-r,e[6]=i+t*s,e[10]=o*a}else if("ZXY"===t.order){const t=a*l,n=a*u,r=c*l,i=c*u;e[0]=t-i*s,e[4]=-o*u,e[8]=r+n*s,e[1]=n+r*s,e[5]=o*l,e[9]=i-t*s,e[2]=-o*c,e[6]=s,e[10]=o*a}else if("ZYX"===t.order){const t=o*l,n=o*u,r=s*l,i=s*u;e[0]=a*l,e[4]=r*c-n,e[8]=t*c+i,e[1]=a*u,e[5]=i*c+t,e[9]=n*c-r,e[2]=-c,e[6]=s*a,e[10]=o*a}else if("YZX"===t.order){const t=o*a,n=o*c,r=s*a,i=s*c;e[0]=a*l,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=o*l,e[9]=-s*l,e[2]=-c*l,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){const t=o*a,n=o*c,r=s*a,i=s*c;e[0]=a*l,e[4]=-u,e[8]=c*l,e[1]=t*u+i,e[5]=o*l,e[9]=n*u-r,e[2]=r*u-n,e[6]=s*l,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Cm,t,Pm)}lookAt(t,e,n){const r=this.elements;return Im.subVectors(t,e),0===Im.lengthSq()&&(Im.z=1),Im.normalize(),Om.crossVectors(n,Im),0===Om.lengthSq()&&(1===Math.abs(n.z)?Im.x+=1e-4:Im.z+=1e-4,Im.normalize(),Om.crossVectors(n,Im)),Om.normalize(),Nm.crossVectors(Im,Om),r[0]=Om.x,r[4]=Nm.x,r[8]=Im.x,r[1]=Om.y,r[5]=Nm.y,r[9]=Im.y,r[2]=Om.z,r[6]=Nm.z,r[10]=Im.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],l=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=r[0],w=r[4],M=r[8],E=r[12],S=r[1],T=r[5],A=r[9],R=r[13],L=r[2],C=r[6],P=r[10],O=r[14],N=r[3],I=r[7],D=r[11],F=r[15];return i[0]=o*_+s*S+a*L+c*N,i[4]=o*w+s*T+a*C+c*I,i[8]=o*M+s*A+a*P+c*D,i[12]=o*E+s*R+a*O+c*F,i[1]=l*_+u*S+h*L+d*N,i[5]=l*w+u*T+h*C+d*I,i[9]=l*M+u*A+h*P+d*D,i[13]=l*E+u*R+h*O+d*F,i[2]=p*_+f*S+m*L+g*N,i[6]=p*w+f*T+m*C+g*I,i[10]=p*M+f*A+m*P+g*D,i[14]=p*E+f*R+m*O+g*F,i[3]=v*_+y*S+b*L+x*N,i[7]=v*w+y*T+b*C+x*I,i[11]=v*M+y*A+b*P+x*D,i[15]=v*E+y*R+b*O+x*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],s=t[5],a=t[9],c=t[13],l=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-r*c*u-i*s*h+n*c*h+r*s*d-n*a*d)+t[7]*(+e*a*d-e*c*h+i*o*h-r*o*d+r*c*l-i*a*l)+t[11]*(+e*c*u-e*s*d-i*o*u+n*o*d+i*s*l-n*c*l)+t[15]*(-r*s*l-e*a*u+e*s*h+r*o*u-n*o*h+n*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=u*m*c-f*h*c+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*c-l*m*c-p*a*d+o*m*d+l*a*g-o*h*g,b=l*f*c-p*u*c+p*s*d-o*f*d-l*s*g+o*u*g,x=p*u*a-l*f*a-p*s*h+o*f*h+l*s*m-o*u*m,_=e*v+n*y+r*b+i*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return t[0]=v*w,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,t[2]=(s*m*i-f*a*i+f*r*c-n*m*c-s*r*g+n*a*g)*w,t[3]=(u*a*i-s*h*i-u*r*c+n*h*c+s*r*d-n*a*d)*w,t[4]=y*w,t[5]=(l*m*i-p*h*i+p*r*d-e*m*d-l*r*g+e*h*g)*w,t[6]=(p*a*i-o*m*i-p*r*c+e*m*c+o*r*g-e*a*g)*w,t[7]=(o*h*i-l*a*i+l*r*c-e*h*c-o*r*d+e*a*d)*w,t[8]=b*w,t[9]=(p*u*i-l*f*i-p*n*d+e*f*d+l*n*g-e*u*g)*w,t[10]=(o*f*i-p*s*i+p*n*c-e*f*c-o*n*g+e*s*g)*w,t[11]=(l*s*i-o*u*i-l*n*c+e*u*c+o*n*d-e*s*d)*w,t[12]=x*w,t[13]=(l*f*r-p*u*r+p*n*h-e*f*h-l*n*m+e*u*m)*w,t[14]=(p*s*r-o*f*r-p*n*a+e*f*a+o*n*m-e*s*m)*w,t[15]=(o*u*r-l*s*r+l*n*a-e*u*a-o*n*h+e*s*h)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,s=t.y,a=t.z,c=i*o,l=i*s;return this.set(c*o+n,c*s-r*a,c*a+r*s,0,c*s+r*a,l*s+n,l*a-r*o,0,c*a-r*s,l*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,o=e._y,s=e._z,a=e._w,c=i+i,l=o+o,u=s+s,h=i*c,d=i*l,p=i*u,f=o*l,m=o*u,g=s*u,v=a*c,y=a*l,b=a*u,x=n.x,_=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-b)*_,r[5]=(1-(h+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Rm.set(r[0],r[1],r[2]).length();const o=Rm.set(r[4],r[5],r[6]).length(),s=Rm.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Lm.copy(this);const a=1/i,c=1/o,l=1/s;return Lm.elements[0]*=a,Lm.elements[1]*=a,Lm.elements[2]*=a,Lm.elements[4]*=c,Lm.elements[5]*=c,Lm.elements[6]*=c,Lm.elements[8]*=l,Lm.elements[9]*=l,Lm.elements[10]*=l,e.setFromRotationMatrix(Lm),n.x=i,n.y=o,n.z=s,this}makePerspective(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*i/(e-t),c=2*i/(n-r),l=(e+t)/(e-t),u=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,n,r,i,o){const s=this.elements,a=1/(e-t),c=1/(n-r),l=1/(o-i),u=(e+t)*a,h=(n+r)*c,d=(o+i)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Rm=new Qf,Lm=new Am,Cm=new Qf(0,0,0),Pm=new Qf(1,1,1),Om=new Qf,Nm=new Qf,Im=new Qf;class Dm{constructor(t=0,e=0,n=0,r=Dm.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,n){const r=Hf.clamp,i=t.elements,o=i[0],s=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Fm.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Fm,e,n)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return Um.setFromEuler(this),this.setFromQuaternion(Um,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Qf(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Dm.DefaultOrder="XYZ",Dm.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Fm=new Am,Um=new Kf;class Bm{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let km=0;const zm=new Qf,Hm=new Kf,Gm=new Am,jm=new Qf,Vm=new Qf,Wm=new Qf,qm=new Kf,Xm=new Qf(1,0,0),Ym=new Qf(0,1,0),Zm=new Qf(0,0,1),Jm={type:"added"},$m={type:"removed"};function Km(){Object.defineProperty(this,"id",{value:km++}),this.uuid=Hf.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Km.DefaultUp.clone();const t=new Qf,e=new Dm,n=new Kf,r=new Qf(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Am},normalMatrix:{value:new jf}}),this.matrix=new Am,this.matrixWorld=new Am,this.matrixAutoUpdate=Km.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Bm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Km.DefaultUp=new Qf(0,1,0),Km.DefaultMatrixAutoUpdate=!0,Km.prototype=Object.assign(Object.create(Bf.prototype),{constructor:Km,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Hm.setFromAxisAngle(t,e),this.quaternion.multiply(Hm),this},rotateOnWorldAxis:function(t,e){return Hm.setFromAxisAngle(t,e),this.quaternion.premultiply(Hm),this},rotateX:function(t){return this.rotateOnAxis(Xm,t)},rotateY:function(t){return this.rotateOnAxis(Ym,t)},rotateZ:function(t){return this.rotateOnAxis(Zm,t)},translateOnAxis:function(t,e){return zm.copy(t).applyQuaternion(this.quaternion),this.position.add(zm.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(Xm,t)},translateY:function(t){return this.translateOnAxis(Ym,t)},translateZ:function(t){return this.translateOnAxis(Zm,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Gm.copy(this.matrixWorld).invert())},lookAt:function(t,e,n){t.isVector3?jm.copy(t):jm.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Vm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Gm.lookAt(Vm,jm,this.up):Gm.lookAt(jm,Vm,this.up),this.quaternion.setFromRotationMatrix(Gm),r&&(Gm.extractRotation(r.matrixWorld),Hm.setFromRotationMatrix(Gm),this.quaternion.premultiply(Hm.invert()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Jm)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent($m)),this},clear:function(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent($m)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),Gm.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Gm.multiply(t.parent.matrixWorld)),t.applyMatrix4(Gm),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Qf),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Kf),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vm,t,Wm),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Qf),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vm,qm,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Qf),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=o(t.geometries),r=o(t.materials),i=o(t.textures),s=o(t.images),a=o(t.shapes),c=o(t.skeletons),l=o(t.animations);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l)}return n.object=r,n;function o(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}});const Qm=new Qf,tg=new Qf,eg=new jf;class ng{constructor(t,e){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Qf(1,0,0),this.constant=void 0!==e?e:0}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=Qm.subVectors(n,e).cross(tg.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Qf),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Qf);const n=t.delta(Qm),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Qf),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||eg.getNormalMatrix(t),r=this.coplanarPoint(Qm).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const rg=new Qf,ig=new Qf,og=new Qf,sg=new Qf,ag=new Qf,cg=new Qf,lg=new Qf,ug=new Qf,hg=new Qf,dg=new Qf;class pg{constructor(t,e,n){this.a=void 0!==t?t:new Qf,this.b=void 0!==e?e:new Qf,this.c=void 0!==n?n:new Qf}static getNormal(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Qf),r.subVectors(n,e),rg.subVectors(t,e),r.cross(rg);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){rg.subVectors(r,e),ig.subVectors(n,e),og.subVectors(t,e);const o=rg.dot(rg),s=rg.dot(ig),a=rg.dot(og),c=ig.dot(ig),l=ig.dot(og),u=o*c-s*s;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Qf),0===u)return i.set(-2,-1,-1);const h=1/u,d=(c*a-s*l)*h,p=(o*l-s*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,sg),sg.x>=0&&sg.y>=0&&sg.x+sg.y<=1}static getUV(t,e,n,r,i,o,s,a){return this.getBarycoord(t,e,n,r,sg),a.set(0,0),a.addScaledVector(i,sg.x),a.addScaledVector(o,sg.y),a.addScaledVector(s,sg.z),a}static isFrontFacing(t,e,n,r){return rg.subVectors(n,e),ig.subVectors(t,e),rg.cross(ig).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return rg.subVectors(this.c,this.b),ig.subVectors(this.a,this.b),.5*rg.cross(ig).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Qf),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return pg.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new ng),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return pg.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,i){return pg.getUV(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return pg.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return pg.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Qf);const n=this.a,r=this.b,i=this.c;let o,s;ag.subVectors(r,n),cg.subVectors(i,n),ug.subVectors(t,n);const a=ag.dot(ug),c=cg.dot(ug);if(a<=0&&c<=0)return e.copy(n);hg.subVectors(t,r);const l=ag.dot(hg),u=cg.dot(hg);if(l>=0&&u<=l)return e.copy(r);const h=a*u-l*c;if(h<=0&&a>=0&&l<=0)return o=a/(a-l),e.copy(n).addScaledVector(ag,o);dg.subVectors(t,i);const d=ag.dot(dg),p=cg.dot(dg);if(p>=0&&d<=p)return e.copy(i);const f=d*c-a*p;if(f<=0&&c>=0&&p<=0)return s=c/(c-p),e.copy(n).addScaledVector(cg,s);const m=l*p-d*u;if(m<=0&&u-l>=0&&d-p>=0)return lg.subVectors(i,r),s=(u-l)/(u-l+(d-p)),e.copy(r).addScaledVector(lg,s);const g=1/(m+f+h);return o=f*g,s=h*g,e.copy(n).addScaledVector(ag,o).addScaledVector(cg,s)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const fg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},mg={h:0,s:0,l:0},gg={h:0,s:0,l:0};function vg(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function yg(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function bg(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class xg{constructor(t,e,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=Hf.euclideanModulo(t,1),e=Hf.clamp(e,0,1),n=Hf.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=vg(i,r,t+1/3),this.g=vg(i,r,t),this.b=vg(i,r,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=fg[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=yg(t.r),this.g=yg(t.g),this.b=yg(t.b),this}copyLinearToSRGB(t){return this.r=bg(t.r),this.g=bg(t.g),this.b=bg(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),o=Math.min(e,n,r);let s,a;const c=(o+i)/2;if(o===i)s=0,a=0;else{const t=i-o;switch(a=c<=.5?t/(i+o):t/(2-i-o),i){case e:s=(n-r)/t+(n<r?6:0);break;case n:s=(r-e)/t+2;break;case r:s=(e-n)/t+4}s/=6}return t.h=s,t.s=a,t.l=c,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(mg),mg.h+=t,mg.s+=e,mg.l+=n,this.setHSL(mg.h,mg.s,mg.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpHSL(t,e){this.getHSL(mg),t.getHSL(gg);const n=Hf.lerp(mg.h,gg.h,e),r=Hf.lerp(mg.s,gg.s,e),i=Hf.lerp(mg.l,gg.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}xg.NAMES=fg,xg.prototype.r=1,xg.prototype.g=1,xg.prototype.b=1;class _g{constructor(t,e,n,r,i,o=0){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new Qf,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new xg,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}let wg=0;function Mg(){Object.defineProperty(this,"id",{value:wg++}),this.uuid=Hf.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Eg(t){Mg.call(this),this.type="MeshBasicMaterial",this.color=new xg(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Mg.prototype=Object.assign(Object.create(Bf.prototype),{constructor:Mg,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Mg.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Eg.prototype=Object.create(Mg.prototype),Eg.prototype.constructor=Eg,Eg.prototype.isMeshBasicMaterial=!0,Eg.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const Sg=new Qf,Tg=new Gf;function Ag(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Rg(t,e,n){Ag.call(this,new Int8Array(t),e,n)}function Lg(t,e,n){Ag.call(this,new Uint8Array(t),e,n)}function Cg(t,e,n){Ag.call(this,new Uint8ClampedArray(t),e,n)}function Pg(t,e,n){Ag.call(this,new Int16Array(t),e,n)}function Og(t,e,n){Ag.call(this,new Uint16Array(t),e,n)}function Ng(t,e,n){Ag.call(this,new Int32Array(t),e,n)}function Ig(t,e,n){Ag.call(this,new Uint32Array(t),e,n)}function Dg(t,e,n){Ag.call(this,new Uint16Array(t),e,n)}function Fg(t,e,n){Ag.call(this,new Float32Array(t),e,n)}function Ug(t,e,n){Ag.call(this,new Float64Array(t),e,n)}Object.defineProperty(Ag.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ag.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new xg),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Gf),e[n++]=i.x,e[n++]=i.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Qf),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Zf),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Tg.fromBufferAttribute(this,e),Tg.applyMatrix3(t),this.setXY(e,Tg.x,Tg.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Sg.fromBufferAttribute(this,e),Sg.applyMatrix3(t),this.setXYZ(e,Sg.x,Sg.y,Sg.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)Sg.x=this.getX(e),Sg.y=this.getY(e),Sg.z=this.getZ(e),Sg.applyMatrix4(t),this.setXYZ(e,Sg.x,Sg.y,Sg.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)Sg.x=this.getX(e),Sg.y=this.getY(e),Sg.z=this.getZ(e),Sg.applyNormalMatrix(t),this.setXYZ(e,Sg.x,Sg.y,Sg.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)Sg.x=this.getX(e),Sg.y=this.getY(e),Sg.z=this.getZ(e),Sg.transformDirection(t),this.setXYZ(e,Sg.x,Sg.y,Sg.z);return this},set:function(t,e=0){return this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Rg.prototype=Object.create(Ag.prototype),Rg.prototype.constructor=Rg,Lg.prototype=Object.create(Ag.prototype),Lg.prototype.constructor=Lg,Cg.prototype=Object.create(Ag.prototype),Cg.prototype.constructor=Cg,Pg.prototype=Object.create(Ag.prototype),Pg.prototype.constructor=Pg,Og.prototype=Object.create(Ag.prototype),Og.prototype.constructor=Og,Ng.prototype=Object.create(Ag.prototype),Ng.prototype.constructor=Ng,Ig.prototype=Object.create(Ag.prototype),Ig.prototype.constructor=Ig,Dg.prototype=Object.create(Ag.prototype),Dg.prototype.constructor=Dg,Dg.prototype.isFloat16BufferAttribute=!0,Fg.prototype=Object.create(Ag.prototype),Fg.prototype.constructor=Fg,Ug.prototype=Object.create(Ag.prototype),Ug.prototype.constructor=Ug;class Bg{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const e=[];let n,r,i=void 0;const o=t.faces;for(r=0;r<o.length;r++){const t=o[r];t.materialIndex!==i&&(i=t.materialIndex,void 0!==n&&(n.count=3*r-n.start,e.push(n)),n={start:3*r,materialIndex:i})}void 0!==n&&(n.count=3*r-n.start,e.push(n)),this.groups=e}fromGeometry(t){const e=t.faces,n=t.vertices,r=t.faceVertexUvs,i=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,s=t.morphTargets,a=s.length;let c;if(a>0){c=[];for(let t=0;t<a;t++)c[t]={name:s[t].name,data:[]};this.morphTargets.position=c}const l=t.morphNormals,u=l.length;let h;if(u>0){h=[];for(let t=0;t<u;t++)h[t]={name:l[t].name,data:[]};this.morphTargets.normal=h}const d=t.skinIndices,p=t.skinWeights,f=d.length===n.length,m=p.length===n.length;n.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<e.length;t++){const g=e[t];this.vertices.push(n[g.a],n[g.b],n[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=g.normal;this.normals.push(t,t,t)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=g.color;this.colors.push(t,t,t)}if(!0===i){const e=r[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new Gf,new Gf,new Gf))}if(!0===o){const e=r[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new Gf,new Gf,new Gf))}for(let t=0;t<a;t++){const e=s[t].vertices;c[t].data.push(e[g.a],e[g.b],e[g.c])}for(let e=0;e<u;e++){const n=l[e].vertexNormals[t];h[e].data.push(n.a,n.b,n.c)}f&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),m&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}}function kg(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}const zg={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Hg(t,e){return new zg[t](e)}let Gg=1;const jg=new Am,Vg=new Km,Wg=new Qf,qg=new nm,Xg=new nm,Yg=new Qf;function Zg(){Object.defineProperty(this,"id",{value:Gg+=2}),this.uuid=Hf.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Zg.prototype=Object.assign(Object.create(Bf.prototype),{constructor:Zg,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(kg(t)>65535?Ig:Og)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new jf).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return jg.makeRotationX(t),this.applyMatrix4(jg),this},rotateY:function(t){return jg.makeRotationY(t),this.applyMatrix4(jg),this},rotateZ:function(t){return jg.makeRotationZ(t),this.applyMatrix4(jg),this},translate:function(t,e,n){return jg.makeTranslation(t,e,n),this.applyMatrix4(jg),this},scale:function(t,e,n){return jg.makeScale(t,e,n),this.applyMatrix4(jg),this},lookAt:function(t){return Vg.lookAt(t),Vg.updateMatrix(),this.applyMatrix4(Vg.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wg).negate(),this.translate(Wg.x,Wg.y,Wg.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Fg(3*e.vertices.length,3),n=new Fg(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Fg(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Fg(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Bg).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new Ag(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new Ag(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new Ag(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new Ag(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new Ag(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const n=[],r=t.morphTargets[e];for(let t=0,e=r.length;t<e;t++){const e=r[t],i=new Fg(3*e.data.length,3);i.name=e.name,n.push(i.copyVector3sArray(e.data))}this.morphAttributes[e]=n}if(t.skinIndices.length>0){const e=new Fg(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Fg(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new nm);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Qf(-1/0,-1/0,-1/0),new Qf(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];qg.setFromBufferAttribute(n),this.morphTargetsRelative?(Yg.addVectors(this.boundingBox.min,qg.min),this.boundingBox.expandByPoint(Yg),Yg.addVectors(this.boundingBox.max,qg.max),this.boundingBox.expandByPoint(Yg)):(this.boundingBox.expandByPoint(qg.min),this.boundingBox.expandByPoint(qg.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ym);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Qf,1/0);if(t){const n=this.boundingSphere.center;if(qg.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Xg.setFromBufferAttribute(n),this.morphTargetsRelative?(Yg.addVectors(qg.min,Xg.min),qg.expandByPoint(Yg),Yg.addVectors(qg.max,Xg.max),qg.expandByPoint(Yg)):(qg.expandByPoint(Xg.min),qg.expandByPoint(Xg.max))}qg.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)Yg.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(Yg));if(e)for(let i=0,o=e.length;i<o;i++){const o=e[i],s=this.morphTargetsRelative;for(let e=0,i=o.count;e<i;e++)Yg.fromBufferAttribute(o,e),s&&(Wg.fromBufferAttribute(t,e),Yg.add(Wg)),r=Math.max(r,n.distanceToSquared(Yg))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Ag(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new Qf,i=new Qf,o=new Qf,s=new Qf,a=new Qf,c=new Qf,l=new Qf,u=new Qf;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),o.fromBufferAttribute(e,f),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),c.fromBufferAttribute(n,f),s.add(l),a.add(l),c.add(l),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let t=0,s=e.count;t<s;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r].array,o=t.attributes[r],s=o.array,a=o.itemSize*e,c=Math.min(s.length,i.length-a);for(let t=0,e=a;t<c;t++,e++)i[e]=s[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Yg.fromBufferAttribute(t,e),Yg.normalize(),t.setXYZ(e,Yg.x,Yg.y,Yg.z)},toNonIndexed:function(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r);let s=0,a=0;for(let t=0,i=e.length;t<i;t++){s=e[t]*r;for(let t=0;t<r;t++)o[a++]=n[s++]}return new Ag(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new Zg,n=this.index.array,r=this.attributes;for(const i in r){const o=t(r[i],n);e.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let e=0,r=s.length;e<r;e++){const r=t(s[e],n);o.push(r)}e.morphAttributes[r]=o}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,n=o.length;t<n;t++){const n=o[t];e.addGroup(n.start,n.count,n.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),t.data.attributes[e]=i}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],o=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),o.push(i)}o.length>0&&(r[e]=o,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(t.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),t},clone:function(){return(new Zg).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];this.addGroup(e.start,e.count,e.materialIndex)}const s=t.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Jg=new Am,$g=new Tm,Kg=new ym,Qg=new Qf,tv=new Qf,ev=new Qf,nv=new Qf,rv=new Qf,iv=new Qf,ov=new Qf,sv=new Qf,av=new Qf,cv=new Gf,lv=new Gf,uv=new Gf,hv=new Qf,dv=new Qf;function pv(t=new Zg,e=new Eg){Km.call(this),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}function fv(t,e,n,r,i,o,s,a){let c;if(c=1===e.side?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,2!==e.side,a),null===c)return null;dv.copy(a),dv.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(dv);return l<n.near||l>n.far?null:{distance:l,point:dv.clone(),object:t}}function mv(t,e,n,r,i,o,s,a,c,l,u,h){Qg.fromBufferAttribute(i,l),tv.fromBufferAttribute(i,u),ev.fromBufferAttribute(i,h);const d=t.morphTargetInfluences;if(e.morphTargets&&o&&d){ov.set(0,0,0),sv.set(0,0,0),av.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=d[t],n=o[t];0!==e&&(nv.fromBufferAttribute(n,l),rv.fromBufferAttribute(n,u),iv.fromBufferAttribute(n,h),s?(ov.addScaledVector(nv,e),sv.addScaledVector(rv,e),av.addScaledVector(iv,e)):(ov.addScaledVector(nv.sub(Qg),e),sv.addScaledVector(rv.sub(tv),e),av.addScaledVector(iv.sub(ev),e)))}Qg.add(ov),tv.add(sv),ev.add(av)}t.isSkinnedMesh&&(t.boneTransform(l,Qg),t.boneTransform(u,tv),t.boneTransform(h,ev));const p=fv(t,e,n,r,Qg,tv,ev,hv);if(p){a&&(cv.fromBufferAttribute(a,l),lv.fromBufferAttribute(a,u),uv.fromBufferAttribute(a,h),p.uv=pg.getUV(hv,Qg,tv,ev,cv,lv,uv,new Gf)),c&&(cv.fromBufferAttribute(c,l),lv.fromBufferAttribute(c,u),uv.fromBufferAttribute(c,h),p.uv2=pg.getUV(hv,Qg,tv,ev,cv,lv,uv,new Gf));const t=new _g(l,u,h);pg.getNormal(Qg,tv,ev,t.normal),p.face=t}return p}pv.prototype=Object.assign(Object.create(Km.prototype),{constructor:pv,isMesh:!0,copy:function(t){return Km.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Kg.copy(n.boundingSphere),Kg.applyMatrix4(i),!1===t.ray.intersectsSphere(Kg))return;if(Jg.copy(i).invert(),$g.copy(t.ray).applyMatrix4(Jg),null!==n.boundingBox&&!1===$g.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=mv(this,f,t,$g,s,a,c,l,u,r,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,e.push(o))}}else{for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);o=mv(this,r,t,$g,s,a,c,l,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}}else if(void 0!==s)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3){o=mv(this,p,t,$g,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,e.push(o))}}else{for(let n=Math.max(0,d.start),i=Math.min(s.count,d.start+d.count);n<i;n+=3){o=mv(this,r,t,$g,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}}}else if(n.isGeometry){const i=Array.isArray(r),s=n.vertices,a=n.faces;let c;const l=n.faceVertexUvs[0];l.length>0&&(c=l);for(let n=0,l=a.length;n<l;n++){const l=a[n],u=i?r[l.materialIndex]:r;if(void 0===u)continue;const h=s[l.a],d=s[l.b],p=s[l.c];if(o=fv(this,u,t,$g,h,d,p,hv),o){if(c&&c[n]){const t=c[n];cv.copy(t[0]),lv.copy(t[1]),uv.copy(t[2]),o.uv=pg.getUV(hv,h,d,p,cv,lv,uv,new Gf)}o.face=l,o.faceIndex=n,e.push(o)}}}}});class gv extends Zg{constructor(t=1,e=1,n=1,r=1,i=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],c=[],l=[],u=[];let h=0,d=0;function p(t,e,n,r,i,o,p,f,m,g,v){const y=o/m,b=p/g,x=o/2,_=p/2,w=f/2,M=m+1,E=g+1;let S=0,T=0;const A=new Qf;for(let o=0;o<E;o++){const s=o*b-_;for(let a=0;a<M;a++){const h=a*y-x;A[t]=h*r,A[e]=s*i,A[n]=w,c.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,l.push(A.x,A.y,A.z),u.push(a/m),u.push(1-o/g),S+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+M*t,r=h+e+M*(t+1),i=h+(e+1)+M*(t+1),o=h+(e+1)+M*t;a.push(n,r,o),a.push(r,i,o),T+=6}s.addGroup(d,T,v),d+=T,h+=S}p("z","y","x",-1,-1,n,e,t,o,i,0),p("z","y","x",1,-1,n,e,-t,o,i,1),p("x","z","y",1,1,t,n,e,r,o,2),p("x","z","y",1,-1,t,n,-e,r,o,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new Fg(c,3)),this.setAttribute("normal",new Fg(l,3)),this.setAttribute("uv",new Fg(u,2))}}function vv(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function yv(t){const e={};for(let n=0;n<t.length;n++){const r=vv(t[n]);for(const t in r)e[t]=r[t]}return e}const bv={clone:vv,merge:yv};function xv(t){Mg.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function _v(){Km.call(this),this.type="Camera",this.matrixWorldInverse=new Am,this.projectionMatrix=new Am,this.projectionMatrixInverse=new Am}function wv(t=50,e=1,n=.1,r=2e3){_v.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}xv.prototype=Object.create(Mg.prototype),xv.prototype.constructor=xv,xv.prototype.isShaderMaterial=!0,xv.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=vv(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},xv.prototype.toJSON=function(t){const e=Mg.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},_v.prototype=Object.assign(Object.create(Km.prototype),{constructor:_v,isCamera:!0,copy:function(t,e){return Km.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Qf),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Km.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,e){Km.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),wv.prototype=Object.assign(Object.create(_v.prototype),{constructor:wv,isPerspectiveCamera:!0,copy:function(t,e){return _v.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Hf.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Hf.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Hf.RAD2DEG*Math.atan(Math.tan(.5*Hf.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*Hf.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/t,e-=o.offsetY*n/s,r*=o.width/t,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=Km.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function Mv(t,e,n){if(Km.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new wv(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Qf(1,0,0)),this.add(r);const i=new wv(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Qf(-1,0,0)),this.add(i);const o=new wv(90,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Qf(0,1,0)),this.add(o);const s=new wv(90,1,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Qf(0,-1,0)),this.add(s);const a=new wv(90,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Qf(0,0,1)),this.add(a);const c=new wv(90,1,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Qf(0,0,-1)),this.add(c),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const l=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(u),t.xr.enabled=l}}function Ev(t,e,n,r,i,o,s,a,c,l){t=void 0!==t?t:[],e=void 0!==e?e:301,s=void 0!==s?s:1022,Xf.call(this,t,e,n,r,i,o,s,a,c,l),this.flipY=!1,this._needsFlipEnvMap=!0}function Sv(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),Jf.call(this,t,t,e),e=e||{},this.texture=new Ev(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsFlipEnvMap=!1}function Tv(t,e,n,r,i,o,s,a,c,l,u,h){Xf.call(this,null,o,s,a,c,l,r,i,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==c?c:1003,this.minFilter=void 0!==l?l:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Mv.prototype=Object.create(Km.prototype),Mv.prototype.constructor=Mv,Ev.prototype=Object.create(Xf.prototype),Ev.prototype.constructor=Ev,Ev.prototype.isCubeTexture=!0,Object.defineProperty(Ev.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Sv.prototype=Object.create(Jf.prototype),Sv.prototype.constructor=Sv,Sv.prototype.isWebGLCubeRenderTarget=!0,Sv.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=1023,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},r=new gv(5,5,5),i=new xv({name:"CubemapFromEquirect",uniforms:vv(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;const o=new pv(r,i),s=e.minFilter;1008===e.minFilter&&(e.minFilter=1006);return new Mv(1,10,this).update(t,o),e.minFilter=s,o.geometry.dispose(),o.material.dispose(),this},Sv.prototype.clear=function(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)},Tv.prototype=Object.create(Xf.prototype),Tv.prototype.constructor=Tv,Tv.prototype.isDataTexture=!0;const Av=new ym,Rv=new Qf;class Lv{constructor(t,e,n,r,i,o){this.planes=[void 0!==t?t:new ng,void 0!==e?e:new ng,void 0!==n?n:new ng,void 0!==r?r:new ng,void 0!==i?i:new ng,void 0!==o?o:new ng]}set(t,e,n,r,i,o){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(s-r,u-a,f-h,y-m).normalize(),e[1].setComponents(s+r,u+a,f+h,y+m).normalize(),e[2].setComponents(s+i,u+c,f+d,y+g).normalize(),e[3].setComponents(s-i,u-c,f-d,y-g).normalize(),e[4].setComponents(s-o,u-l,f-p,y-v).normalize(),e[5].setComponents(s+o,u+l,f+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Av.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Av)}intersectsSprite(t){return Av.center.set(0,0,0),Av.radius=.7071067811865476,Av.applyMatrix4(t.matrixWorld),this.intersectsSphere(Av)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(Rv.x=r.normal.x>0?t.max.x:t.min.x,Rv.y=r.normal.y>0?t.max.y:t.min.y,Rv.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Rv)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}}function Cv(){let t=null,e=!1,n=null,r=null;function i(e,o){n(e,o),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Pv(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const o=r.get(e);void 0===o?r.set(e,function(e,r){const i=e.array,o=e.usage,s=t.createBuffer();t.bindBuffer(r,s),t.bufferData(r,i,o),e.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):o.version<e.version&&(!function(e,r,i){const o=r.array,s=r.updateRange;t.bindBuffer(i,e),-1===s.count?t.bufferSubData(i,0,o):(n?t.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):t.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,e,i),o.version=e.version)}}}class Ov extends Zg{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,o=e/2,s=Math.floor(n),a=Math.floor(r),c=s+1,l=a+1,u=t/s,h=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<l;t++){const e=t*h-o;for(let n=0;n<c;n++){const r=n*u-i;p.push(r,-e,0),f.push(0,0,1),m.push(n/s),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<s;e++){const n=e+c*t,r=e+c*(t+1),i=e+1+c*(t+1),o=e+1+c*t;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new Fg(p,3)),this.setAttribute("normal",new Fg(f,3)),this.setAttribute("uv",new Fg(m,2))}}const Nv={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Iv={common:{diffuse:{value:new xg(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new jf},uv2Transform:{value:new jf},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Gf(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new xg(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new xg(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new jf}},sprite:{diffuse:{value:new xg(15658734)},opacity:{value:1},center:{value:new Gf(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new jf}}},Dv={basic:{uniforms:yv([Iv.common,Iv.specularmap,Iv.envmap,Iv.aomap,Iv.lightmap,Iv.fog]),vertexShader:Nv.meshbasic_vert,fragmentShader:Nv.meshbasic_frag},lambert:{uniforms:yv([Iv.common,Iv.specularmap,Iv.envmap,Iv.aomap,Iv.lightmap,Iv.emissivemap,Iv.fog,Iv.lights,{emissive:{value:new xg(0)}}]),vertexShader:Nv.meshlambert_vert,fragmentShader:Nv.meshlambert_frag},phong:{uniforms:yv([Iv.common,Iv.specularmap,Iv.envmap,Iv.aomap,Iv.lightmap,Iv.emissivemap,Iv.bumpmap,Iv.normalmap,Iv.displacementmap,Iv.fog,Iv.lights,{emissive:{value:new xg(0)},specular:{value:new xg(1118481)},shininess:{value:30}}]),vertexShader:Nv.meshphong_vert,fragmentShader:Nv.meshphong_frag},standard:{uniforms:yv([Iv.common,Iv.envmap,Iv.aomap,Iv.lightmap,Iv.emissivemap,Iv.bumpmap,Iv.normalmap,Iv.displacementmap,Iv.roughnessmap,Iv.metalnessmap,Iv.fog,Iv.lights,{emissive:{value:new xg(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Nv.meshphysical_vert,fragmentShader:Nv.meshphysical_frag},toon:{uniforms:yv([Iv.common,Iv.aomap,Iv.lightmap,Iv.emissivemap,Iv.bumpmap,Iv.normalmap,Iv.displacementmap,Iv.gradientmap,Iv.fog,Iv.lights,{emissive:{value:new xg(0)}}]),vertexShader:Nv.meshtoon_vert,fragmentShader:Nv.meshtoon_frag},matcap:{uniforms:yv([Iv.common,Iv.bumpmap,Iv.normalmap,Iv.displacementmap,Iv.fog,{matcap:{value:null}}]),vertexShader:Nv.meshmatcap_vert,fragmentShader:Nv.meshmatcap_frag},points:{uniforms:yv([Iv.points,Iv.fog]),vertexShader:Nv.points_vert,fragmentShader:Nv.points_frag},dashed:{uniforms:yv([Iv.common,Iv.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Nv.linedashed_vert,fragmentShader:Nv.linedashed_frag},depth:{uniforms:yv([Iv.common,Iv.displacementmap]),vertexShader:Nv.depth_vert,fragmentShader:Nv.depth_frag},normal:{uniforms:yv([Iv.common,Iv.bumpmap,Iv.normalmap,Iv.displacementmap,{opacity:{value:1}}]),vertexShader:Nv.normal_vert,fragmentShader:Nv.normal_frag},sprite:{uniforms:yv([Iv.sprite,Iv.fog]),vertexShader:Nv.sprite_vert,fragmentShader:Nv.sprite_frag},background:{uniforms:{uvTransform:{value:new jf},t2D:{value:null}},vertexShader:Nv.background_vert,fragmentShader:Nv.background_frag},cube:{uniforms:yv([Iv.envmap,{opacity:{value:1}}]),vertexShader:Nv.cube_vert,fragmentShader:Nv.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Nv.equirect_vert,fragmentShader:Nv.equirect_frag},distanceRGBA:{uniforms:yv([Iv.common,Iv.displacementmap,{referencePosition:{value:new Qf},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Nv.distanceRGBA_vert,fragmentShader:Nv.distanceRGBA_frag},shadow:{uniforms:yv([Iv.lights,Iv.fog,{color:{value:new xg(0)},opacity:{value:1}}]),vertexShader:Nv.shadow_vert,fragmentShader:Nv.shadow_frag}};function Fv(t,e,n,r,i){const o=new xg(0);let s,a,c=0,l=null,u=0,h=null;function d(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),c=e,d(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,d(o,c)},render:function(n,i,p,f){let m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(o,c):m&&m.isColor&&(d(m,1),f=!0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||306===m.mapping)?(void 0===a&&(a=new pv(new gv(1,1,1),new xv({name:"BackgroundCubeMaterial",uniforms:vv(Dv.cube.uniforms),vertexShader:Dv.cube.vertexShader,fragmentShader:Dv.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,l===m&&u===m.version&&h===t.toneMapping||(a.material.needsUpdate=!0,l=m,u=m.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new pv(new Ov(2,2),new xv({name:"BackgroundMaterial",uniforms:vv(Dv.background.uniforms),vertexShader:Dv.background.vertexShader,fragmentShader:Dv.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&u===m.version&&h===t.toneMapping||(s.material.needsUpdate=!0,l=m,u=m.version,h=t.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function Uv(t,e,n,r){const i=t.getParameter(34921),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},c=d(null);let l=c;function u(e){return r.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function h(e){return r.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function d(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function p(){const t=l.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){const o=l.newAttributes,s=l.enabledAttributes,a=l.attributeDivisors;if(o[n]=1,0===s[n]&&(t.enableVertexAttribArray(n),s[n]=1),a[n]!==i){(r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i}}function g(){const e=l.newAttributes,n=l.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function v(e,n,i,o,s,a){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,o,s,a):t.vertexAttribIPointer(e,n,i,s,a)}function y(){b(),l!==c&&(l=c,u(l.object))}function b(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,h,y,b){let x=!1;if(s){const e=function(e,n,i){const s=!0===i.wireframe;let c=a[e.id];void 0===c&&(c={},a[e.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let u=l[s];void 0===u&&(u=d(r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),l[s]=u);return u}(y,h,c);l!==e&&(l=e,u(l.object)),x=function(t,e){const n=l.attributes,r=t.attributes;let i=0;for(const t in r){const e=n[t],o=r[t];if(void 0===e)return!0;if(e.attribute!==o)return!0;if(e.data!==o.data)return!0;i++}return l.attributesNum!==i||l.index!==e}(y,b),x&&function(t,e){const n={},r=t.attributes;let i=0;for(const t in r){const e=r[t],o={};o.attribute=e,e.data&&(o.data=e.data),n[t]=o,i++}l.attributes=n,l.attributesNum=i,l.index=e}(y,b)}else{const t=!0===c.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===t||(l.geometry=y.id,l.program=h.id,l.wireframe=t,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==b&&n.update(b,34963),x&&(!function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const c=a.attributes,l=s.getAttributes(),u=o.defaultAttributeValues;for(const e in l){const r=l[e];if(r>=0){const o=c[e];if(void 0!==o){const e=o.normalized,i=o.itemSize,s=n.get(o);if(void 0===s)continue;const c=s.buffer,l=s.type,u=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),t.bindBuffer(34962,c),v(r,i,l,e,s*u,h*u)}else o.isInstancedBufferAttribute?(m(r,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(r),t.bindBuffer(34962,c),v(r,i,l,e,0,0)}else if("instanceMatrix"===e){const e=n.get(i.instanceMatrix);if(void 0===e)continue;const o=e.buffer,s=e.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),t.bindBuffer(34962,o),t.vertexAttribPointer(r+0,4,s,!1,64,0),t.vertexAttribPointer(r+1,4,s,!1,64,16),t.vertexAttribPointer(r+2,4,s,!1,64,32),t.vertexAttribPointer(r+3,4,s,!1,64,48)}else if("instanceColor"===e){const e=n.get(i.instanceColor);if(void 0===e)continue;const o=e.buffer,s=e.type;m(r,1),t.bindBuffer(34962,o),t.vertexAttribPointer(r,3,s,!1,12,0)}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r,n);break;case 3:t.vertexAttrib3fv(r,n);break;case 4:t.vertexAttrib4fv(r,n);break;default:t.vertexAttrib1fv(r,n)}}}}g()}(i,c,h,y),null!==b&&t.bindBuffer(34963,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)h(r[t].object),delete r[t];delete n[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function Bv(t,e,n,r){const i=r.isWebGL2;let o;this.setMode=function(t){o=t},this.render=function(e,r){t.drawArrays(o,e,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let c,l;if(i)c=t,l="drawArraysInstanced";else if(c=e.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](o,r,s,a),n.update(s,o,a)}}function kv(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=i(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===n.logarithmicDepthBuffer,l=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=u>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=e.get("EXT_texture_filter_anisotropic");return r=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function zv(t){const e=this;let n=null,r=0,i=!1,o=!1;const s=new ng,a=new jf,c={value:null,needsUpdate:!1};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,n,r,i){const o=null!==t?t.length:0;let l=null;if(0!==o){if(l=c.value,!0!==i||null===l){const e=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,n=r;e!==o;++e,n+=4)s.copy(t[e]).applyMatrix4(i,a),s.normal.toArray(l,n),l[n+3]=s.constant}c.value=l,c.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){const s=0!==t.length||e||0!==r||i;return i=e,n=u(t,o,0),r=t.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,l()},this.setState=function(e,s,a){const h=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||o&&!p)o?u(null):l();else{const t=o?0:r,e=4*t;let i=f.clippingState||null;c.value=i,i=u(h,s,e,a);for(let t=0;t!==e;++t)i[t]=n[t];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Hv(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=301:304===e&&(t.mapping=302),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(303===o||304===o){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const s=t.getRenderList(),a=t.getRenderTarget(),c=new Sv(o.height/2);return c.fromEquirectangularTexture(t,i),e.set(i,c),t.setRenderTarget(a),t.setRenderList(s),i.addEventListener("dispose",r),n(c.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}function Gv(t){const e={};return{has:function(n){if(void 0!==e[n])return null!==e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,null!==r},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e[t]}}}function jv(t,e,n,r){const i=new WeakMap,o=new WeakMap;function s(t){const a=t.target,c=i.get(a);null!==c.index&&e.remove(c.index);for(const t in c.attributes)e.remove(c.attributes[t]);a.removeEventListener("dispose",s),i.delete(a);const l=o.get(c);l&&(e.remove(l),o.delete(c)),r.releaseStatesOfGeometry(c),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let s=0;if(null!==r){const t=r.array;s=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],o=t[e+2];n.push(r,i,i,o,o,r)}}else{const t=i.array;s=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const a=new(kg(n)>65535?Ig:Og)(n,1);a.version=s;const c=o.get(t);c&&e.remove(c),o.set(t,a)}return{get:function(t,e){let r=i.get(e);return r||(e.addEventListener("dispose",s),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Zg).setFromObject(t)),r=e._bufferGeometry),i.set(e,r),n.memory.geometries++,r)},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const r=t.morphAttributes;for(const t in r){const n=r[t];for(let t=0,r=n.length;t<r;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return o.get(t)}}}function Vv(t,e,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(t){o=t},this.setIndex=function(t){s=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(o,r,s,e*a),n.update(r,o,1)},this.renderInstances=function(r,c,l){if(0===l)return;let u,h;if(i)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,c,s,r*a,l),n.update(c,o,l)}}function Wv(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function qv(t,e){return t[0]-e[0]}function Xv(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Yv(t){const e={},n=new Float32Array(8),r=[];for(let t=0;t<8;t++)r[t]=[t,0];return{update:function(i,o,s,a){const c=i.morphTargetInfluences,l=void 0===c?0:c.length;let u=e[o.id];if(void 0===u){u=[];for(let t=0;t<l;t++)u[t]=[t,0];e[o.id]=u}for(let t=0;t<l;t++){const e=u[t];e[0]=t,e[1]=c[t]}u.sort(Xv);for(let t=0;t<8;t++)t<l&&u[t][1]?(r[t][0]=u[t][0],r[t][1]=u[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(qv);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let t=0;t<8;t++){const e=r[t],i=e[0],s=e[1];i!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+t)!==h[i]&&o.setAttribute("morphTarget"+t,h[i]),d&&o.getAttribute("morphNormal"+t)!==d[i]&&o.setAttribute("morphNormal"+t,d[i]),n[t]=s,p+=s):(h&&!0===o.hasAttribute("morphTarget"+t)&&o.deleteAttribute("morphTarget"+t),d&&!0===o.hasAttribute("morphNormal"+t)&&o.deleteAttribute("morphNormal"+t),n[t]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Zv(t,e,n,r){let i=new WeakMap;function o(t){const e=t.target;e.removeEventListener("dispose",o),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const s=r.render.frame,a=t.geometry,c=e.get(t,a);return i.get(c)!==s&&(a.isGeometry&&c.updateFromObject(t),e.update(c),i.set(c,s)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",o)&&t.addEventListener("dispose",o),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),c},dispose:function(){i=new WeakMap}}}function Jv(t=null,e=1,n=1,r=1){Xf.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function $v(t=null,e=1,n=1,r=1){Xf.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Dv.physical={uniforms:yv([Dv.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Gf(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new xg(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Nv.meshphysical_vert,fragmentShader:Nv.meshphysical_frag},Jv.prototype=Object.create(Xf.prototype),Jv.prototype.constructor=Jv,Jv.prototype.isDataTexture2DArray=!0,$v.prototype=Object.create(Xf.prototype),$v.prototype.constructor=$v,$v.prototype.isDataTexture3D=!0;const Kv=new Xf,Qv=new Jv,ty=new $v,ey=new Ev,ny=[],ry=[],iy=new Float32Array(16),oy=new Float32Array(9),sy=new Float32Array(4);function ay(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let o=ny[i];if(void 0===o&&(o=new Float32Array(i),ny[i]=o),0!==e){r.toArray(o,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(o,i)}return o}function cy(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function ly(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function uy(t,e){let n=ry[e];void 0===n&&(n=new Int32Array(e),ry[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function hy(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function dy(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(cy(n,e))return;t.uniform2fv(this.addr,e),ly(n,e)}}function py(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(cy(n,e))return;t.uniform3fv(this.addr,e),ly(n,e)}}function fy(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(cy(n,e))return;t.uniform4fv(this.addr,e),ly(n,e)}}function my(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(cy(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),ly(n,e)}else{if(cy(n,r))return;sy.set(r),t.uniformMatrix2fv(this.addr,!1,sy),ly(n,r)}}function gy(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(cy(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),ly(n,e)}else{if(cy(n,r))return;oy.set(r),t.uniformMatrix3fv(this.addr,!1,oy),ly(n,r)}}function vy(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(cy(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),ly(n,e)}else{if(cy(n,r))return;iy.set(r),t.uniformMatrix4fv(this.addr,!1,iy),ly(n,r)}}function yy(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||Kv,i)}function by(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Qv,i)}function xy(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||ty,i)}function _y(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||ey,i)}function wy(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function My(t,e){const n=this.cache;cy(n,e)||(t.uniform2iv(this.addr,e),ly(n,e))}function Ey(t,e){const n=this.cache;cy(n,e)||(t.uniform3iv(this.addr,e),ly(n,e))}function Sy(t,e){const n=this.cache;cy(n,e)||(t.uniform4iv(this.addr,e),ly(n,e))}function Ty(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Ay(t,e){t.uniform1fv(this.addr,e)}function Ry(t,e){t.uniform1iv(this.addr,e)}function Ly(t,e){t.uniform2iv(this.addr,e)}function Cy(t,e){t.uniform3iv(this.addr,e)}function Py(t,e){t.uniform4iv(this.addr,e)}function Oy(t,e){const n=ay(e,this.size,2);t.uniform2fv(this.addr,n)}function Ny(t,e){const n=ay(e,this.size,3);t.uniform3fv(this.addr,n)}function Iy(t,e){const n=ay(e,this.size,4);t.uniform4fv(this.addr,n)}function Dy(t,e){const n=ay(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Fy(t,e){const n=ay(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Uy(t,e){const n=ay(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function By(t,e,n){const r=e.length,i=uy(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTexture2D(e[t]||Kv,i[t])}function ky(t,e,n){const r=e.length,i=uy(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTextureCube(e[t]||ey,i[t])}function zy(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return hy;case 35664:return dy;case 35665:return py;case 35666:return fy;case 35674:return my;case 35675:return gy;case 35676:return vy;case 5124:case 35670:return wy;case 35667:case 35671:return My;case 35668:case 35672:return Ey;case 35669:case 35673:return Sy;case 5125:return Ty;case 35678:case 36198:case 36298:case 36306:case 35682:return yy;case 35679:case 36299:case 36307:return xy;case 35680:case 36300:case 36308:case 36293:return _y;case 36289:case 36303:case 36311:case 36292:return by}}(e.type)}function Hy(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ay;case 35664:return Oy;case 35665:return Ny;case 35666:return Iy;case 35674:return Dy;case 35675:return Fy;case 35676:return Uy;case 5124:case 35670:return Ry;case 35667:case 35671:return Ly;case 35668:case 35672:return Cy;case 35669:case 35673:return Py;case 35678:case 36198:case 36298:case 36306:case 35682:return By;case 35680:case 36300:case 36308:case 36293:return ky}}(e.type)}function Gy(t){this.id=t,this.seq=[],this.map={}}Hy.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ly(e,t)},Gy.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(t,e[o.id],n)}};const jy=/(\w+)(\])?(\[|\.)?/g;function Vy(t,e){t.seq.push(e),t.map[e.id]=e}function Wy(t,e,n){const r=t.name,i=r.length;for(jy.lastIndex=0;;){const o=jy.exec(r),s=jy.lastIndex;let a=o[1];const c="]"===o[2],l=o[3];if(c&&(a|=0),void 0===l||"["===l&&s+2===i){Vy(n,void 0===l?new zy(a,t,e):new Hy(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Gy(a),Vy(n,t)),n=t}}}function qy(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);Wy(n,t.getUniformLocation(e,n.name),this)}}function Xy(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}qy.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},qy.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},qy.upload=function(t,e,n,r){for(let i=0,o=e.length;i!==o;++i){const o=e[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,r)}},qy.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let Yy=0;function Zy(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Jy(t,e,n){const r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function $y(t,e){const n=Zy(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Ky(t,e){const n=Zy(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Qy(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function tb(t){return""!==t}function eb(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function nb(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const rb=/^[ \t]*#include +<([\w\d./]+)>/gm;function ib(t){return t.replace(rb,ob)}function ob(t,e){const n=Nv[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return ib(n)}const sb=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ab=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function cb(t){return t.replace(ab,ub).replace(sb,lb)}function lb(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ub(t,e,n,r)}function ub(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function hb(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function db(t,e,n,r){const i=t.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),l=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=t.gammaFactor>0?t.gammaFactor:1,p=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(tb).join("\n")}(n),f=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(o),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(tb).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(tb).join("\n"),v.length>0&&(v+="\n")):(g=[hb(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(tb).join("\n"),v=[p,hb(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Nv.tonemapping_pars_fragment:"",0!==n.toneMapping?Qy("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Nv.encodings_pars_fragment,n.map?$y("mapTexelToLinear",n.mapEncoding):"",n.matcap?$y("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?$y("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?$y("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?$y("lightMapTexelToLinear",n.lightMapEncoding):"",Ky("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(tb).join("\n")),s=ib(s),s=eb(s,n),s=nb(s,n),a=ib(a),a=eb(a,n),a=nb(a,n),s=cb(s),a=cb(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+v+a,x=Xy(i,35633,y+g+s),_=Xy(i,35632,b);if(i.attachShader(m,x),i.attachShader(m,_),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(m).trim(),e=i.getShaderInfoLog(x).trim(),n=i.getShaderInfoLog(_).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(m,35714)){r=!1;const e=Jy(i,x,"vertex"),n=Jy(i,_,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(m,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:v}})}let w,M;return i.deleteShader(x),i.deleteShader(_),this.getUniforms=function(){return void 0===w&&(w=new qy(i,m)),w},this.getAttributes=function(){return void 0===M&&(M=function(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i).name;n[r]=t.getAttribLocation(e,r)}return n}(i,m)),M},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=Yy++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=_,this}function pb(t,e,n,r,i,o){const s=[],a=r.isWebGL2,c=r.logarithmicDepthBuffer,l=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=3e3,e}return{getParameters:function(i,s,f,g,v){const y=g.fog,b=i.isMeshStandardMaterial?g.environment:null,x=e.get(i.envMap||b),_=p[i.type],w=v.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(l)return 1024;{const t=u,n=Math.floor((t-20)/4),r=Math.min(n,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}}(v):0;let M,E;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),_){const t=Dv[_];M=t.vertexShader,E=t.fragmentShader}else M=i.vertexShader,E=i.fragmentShader;const S=t.getRenderTarget();return{isWebGL2:a,shaderID:_,shaderName:i.type,vertexShader:M,fragmentShader:E,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:h,outputEncoding:null!==S?m(S.texture):t.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(306===x.mapping||307===x.mapping),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!y,useFog:i.fog,fogExp2:y&&y.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:c,skinning:i.skinning&&w>0,maxBones:w,useVertexTexture:l,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&f.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<f.length;t++)n.push(e[f[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=p[t.type];let n;if(e){const t=Dv[e];n=bv.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=s.length;t<e;t++){const e=s[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new db(t,n,e,i),s.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=s.indexOf(t);s[e]=s[s.length-1],s.pop(),t.destroy()}},programs:s}}function fb(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function mb(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function gb(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function vb(t){const e=[];let n=0;const r=[],i=[],o={id:-1};function s(r,i,s,a,c,l){let u=e[n];const h=t.get(s);return void 0===u?(u={id:r.id,object:r,geometry:i,material:s,program:h.program||o,groupOrder:a,renderOrder:r.renderOrder,z:c,group:l},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=s,u.program=h.program||o,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=c,u.group=l),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(t,e,n,o,a,c){const l=s(t,e,n,o,a,c);(!0===n.transparent?i:r).push(l)},unshift:function(t,e,n,o,a,c){const l=s(t,e,n,o,a,c);(!0===n.transparent?i:r).unshift(l)},finish:function(){for(let t=n,r=e.length;t<r;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){r.length>1&&r.sort(t||mb),i.length>1&&i.sort(e||gb)}}}function yb(t){let e=new WeakMap;return{get:function(n,r){const i=e.get(n);let o;return void 0===i?(o=new vb(t),e.set(n,new WeakMap),e.get(n).set(r,o)):(o=i.get(r),void 0===o&&(o=new vb(t),i.set(r,o))),o},dispose:function(){e=new WeakMap}}}function bb(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Qf,color:new xg};break;case"SpotLight":n={position:new Qf,direction:new Qf,color:new xg,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Qf,color:new xg,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Qf,skyColor:new xg,groundColor:new xg};break;case"RectAreaLight":n={color:new xg,position:new Qf,halfWidth:new Qf,halfHeight:new Qf}}return t[e.id]=n,n}}}let xb=0;function _b(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function wb(t,e){const n=new bb,r=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Gf};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Gf,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new Qf);const o=new Qf,s=new Am,a=new Am;return{setup:function(o){let s=0,a=0,c=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;o.sort(_b);for(let t=0,e=o.length;t<e;t++){const e=o[t],v=e.color,y=e.intensity,b=e.distance,x=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)s+=v.r*y,a+=v.g*y,c+=v.b*y;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],y);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[l]=n,i.directionalShadowMap[l]=x,i.directionalShadowMatrix[l]=e.shadow.matrix,f++}i.directional[l]=t,l++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(v).multiplyScalar(y),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=x,i.spotShadowMatrix[h]=e.shadow.matrix,g++}i.spot[h]=t,h++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(v).multiplyScalar(y),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[d]=t,d++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=x,i.pointShadowMatrix[u]=e.shadow.matrix,m++}i.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(y),t.groundColor.copy(e.groundColor).multiplyScalar(y),i.hemi[p]=t,p++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=Iv.LTC_FLOAT_1,i.rectAreaLTC2=Iv.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Iv.LTC_HALF_1,i.rectAreaLTC2=Iv.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=c;const v=i.hash;v.directionalLength===l&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(i.directional.length=l,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,v.directionalLength=l,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,i.version=xb++)},setupView:function(t,e){let n=0,r=0,c=0,l=0,u=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),n++}else if(d.isSpotLight){const t=i.spot[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),c++}else if(d.isRectAreaLight){const t=i.rectArea[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),l++}else if(d.isPointLight){const t=i.point[r];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const t=i.hemi[u];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:i}}function Mb(t,e){const n=new wb(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function Eb(t,e){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new Mb(t,e),n.set(r,[]),n.get(r).push(o)):i>=n.get(r).length?(o=new Mb(t,e),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}function Sb(t){Mg.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Tb(t){Mg.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Qf,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Sb.prototype=Object.create(Mg.prototype),Sb.prototype.constructor=Sb,Sb.prototype.isMeshDepthMaterial=!0,Sb.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Tb.prototype=Object.create(Mg.prototype),Tb.prototype.constructor=Tb,Tb.prototype.isMeshDistanceMaterial=!0,Tb.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function Ab(t,e,n){let r=new Lv;const i=new Gf,o=new Gf,s=new Zf,a=[],c=[],l={},u={0:1,1:0,2:2},h=new xv({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Gf},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const p=new Zg;p.setAttribute("position",new Ag(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new pv(p,h),m=this;function g(n,r){const i=e.update(f);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,h,f,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,d,f,null)}function v(t,e,n){const r=t<<0|e<<1|n<<2;let i=a[r];return void 0===i&&(i=new Sb({depthPacking:3201,morphTargets:t,skinning:e}),a[r]=i),i}function y(t,e,n){const r=t<<0|e<<1|n<<2;let i=c[r];return void 0===i&&(i=new Tb({morphTargets:t,skinning:e}),c[r]=i),i}function b(e,n,r,i,o,s,a){let c=null,h=v,d=e.customDepthMaterial;if(!0===i.isPointLight&&(h=y,d=e.customDistanceMaterial),void 0===d){let t=!1;!0===r.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e));c=h(t,i,!0===e.isInstancedMesh)}else c=d;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const t=c.uuid,e=r.uuid;let n=l[t];void 0===n&&(n={},l[t]=n);let i=n[e];void 0===i&&(i=c.clone(),n[e]=i),c=i}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=3===a?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,!0===i.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(i.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function x(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let c=0,l=e.length;c<l;c++){const l=e[c],u=i[l.materialIndex];if(u&&u.visible){const e=b(n,r,u,s,o.near,o.far,a);t.renderBufferDirect(o,null,r,e,n,l)}}}else if(i.visible){const e=b(n,r,i,s,o.near,o.far,a);t.renderBufferDirect(o,null,r,e,n,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)x(c[t],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,a,c){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,u=e.length;l<u;l++){const u=e[l],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const p=h.getFrameExtents();if(i.multiply(p),o.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(o.x=Math.floor(n/p.x),i.x=o.x*p.x,h.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/p.y),i.y=o.y*p.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const t={minFilter:1006,magFilter:1006,format:1023};h.map=new Jf(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.mapPass=new Jf(i.x,i.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:1003,magFilter:1003,format:1023};h.map=new Jf(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const f=h.getViewportCount();for(let t=0;t<f;t++){const e=h.getViewport(t);s.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),d.viewport(s),h.updateMatrices(u,t),r=h.getFrustum(),x(a,c,h.camera,u,this.type)}h.isPointLightShadow||3!==this.type||g(h,c),h.needsUpdate=!1}m.needsUpdate=!1,t.setRenderTarget(l,u,h)}}function Rb(t,e,n){const r=n.isWebGL2;const i=new function(){let e=!1;const n=new Zf;let r=null;const i=new Zf(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,s,a){!0===a&&(e*=s,r*=s,o*=s),n.set(e,r,o,s),!1===i.equals(n)&&(t.clearColor(e,r,o,s),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?N(2929):I(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},s=new function(){let e=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null;return{setTest:function(t){e||(t?N(2960):I(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,s){r===e&&i===n&&o===s||(t.stencilFunc(e,n,s),r=e,i=n,o=s)},setOp:function(e,n,r){s===e&&a===n&&c===r||(t.stencilOp(e,n,r),s=e,a=n,c=r)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null}}};let a={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null;const M=t.getParameter(35661);let E=!1,S=0;const T=t.getParameter(7938);-1!==T.indexOf("WebGL")?(S=parseFloat(/^WebGL (\d)/.exec(T)[1]),E=S>=1):-1!==T.indexOf("OpenGL ES")&&(S=parseFloat(/^OpenGL ES (\d)/.exec(T)[1]),E=S>=2);let A=null,R={};const L=new Zf,C=new Zf;function P(e,n,r){const i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return o}const O={};function N(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function I(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}O[3553]=P(3553,3553,1),O[34067]=P(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),s.setClear(0),N(2929),o.setFunc(3),B(!1),k(1),N(2884),U(0);const D={100:32774,101:32778,102:32779};if(r)D[103]=32775,D[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(D[103]=t.MIN_EXT,D[104]=t.MAX_EXT)}const F={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function U(e,n,r,i,o,s,a,c){if(0!==e){if(l||(N(3042),l=!0),5===e)o=o||n,s=s||r,a=a||i,n===h&&o===f||(t.blendEquationSeparate(D[n],D[o]),h=n,f=o),r===d&&i===p&&s===m&&a===g||(t.blendFuncSeparate(F[r],F[i],F[s],F[a]),d=r,p=i,m=s,g=a),u=e,v=null;else if(e!==u||c!==v){if(100===h&&100===f||(t.blendEquation(32774),h=100,f=100),c)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}d=null,p=null,m=null,g=null,u=e,v=c}}else l&&(I(3042),l=!1)}function B(e){y!==e&&(e?t.frontFace(2304):t.frontFace(2305),y=e)}function k(e){0!==e?(N(2884),e!==b&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):I(2884),b=e}function z(e,n,r){e?(N(32823),_===n&&w===r||(t.polygonOffset(n,r),_=n,w=r)):I(32823)}function H(e){void 0===e&&(e=33984+M-1),A!==e&&(t.activeTexture(e),A=e)}return{buffers:{color:i,depth:o,stencil:s},enable:N,disable:I,useProgram:function(e){return c!==e&&(t.useProgram(e),c=e,!0)},setBlending:U,setMaterial:function(t,e){2===t.side?I(2884):N(2884);let n=1===t.side;e&&(n=!n),B(n),1===t.blending&&!1===t.transparent?U(0):U(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),i.setMask(t.colorWrite);const r=t.stencilWrite;s.setTest(r),r&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),z(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:B,setCullFace:k,setLineWidth:function(e){e!==x&&(E&&t.lineWidth(e),x=e)},setPolygonOffset:z,setScissorTest:function(t){t?N(3089):I(3089)},activeTexture:H,bindTexture:function(e,n){null===A&&H();let r=R[A];void 0===r&&(r={type:void 0,texture:void 0},R[A]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||O[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=R[A];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===L.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),L.copy(e))},viewport:function(e){!1===C.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),C.copy(e))},reset:function(){a={},A=null,R={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null,i.reset(),o.reset(),s.reset()}}}function Lb(t,e,n,r,i,o,s){const a=i.isWebGL2,c=i.maxTextures,l=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?Hf.floorPowerOfTwo:Math.floor,o=r(i*t.width),s=r(i*t.height);void 0===p&&(p=m(o,s));const a=n?m(o,s):p;a.width=o,a.height=s;return a.getContext("2d").drawImage(t,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return Hf.isPowerOfTwo(t.width)&&Hf.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function b(e,n,i,o){t.generateMipmap(e);r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function x(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function _(t){return 1003===t||1004===t||1005===t?9728:9729}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=r.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),r.remove(e)}(n),n.isVideoTexture&&d.delete(n),s.memory.textures--}function M(e){const n=e.target;n.removeEventListener("dispose",M),function(e){const n=r.get(e),i=r.get(e.texture);if(!e)return;void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}(n),s.memory.textures--}let E=0;function S(t,e){const i=r.get(t);if(t.isVideoTexture&&function(t){const e=s.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void P(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function T(e,i){const s=r.get(e);e.version>0&&s.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;C(e,r),n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,r.flipY);const s=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),c=r.image[0]&&r.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=s||c?c?r.image[t].image:r.image[t]:g(r.image[t],!1,!0,l);const h=u[0],d=v(h)||a,p=o.convert(r.format),f=o.convert(r.type),m=x(r.internalFormat,p,f);let _;if(L(34067,r,d),s){for(let t=0;t<6;t++){_=u[t].mipmaps;for(let e=0;e<_.length;e++){const i=_[e];1023!==r.format&&1022!==r.format?null!==p?n.compressedTexImage2D(34069+t,e,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,m,i.width,i.height,0,p,f,i.data)}}e.__maxMipLevel=_.length-1}else{_=r.mipmaps;for(let t=0;t<6;t++)if(c){n.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,p,f,u[t].data);for(let e=0;e<_.length;e++){const r=_[e].image[t].image;n.texImage2D(34069+t,e+1,m,r.width,r.height,0,p,f,r.data)}}else{n.texImage2D(34069+t,0,m,p,f,u[t]);for(let e=0;e<_.length;e++){const r=_[e];n.texImage2D(34069+t,e+1,m,p,f,r.image[t])}}e.__maxMipLevel=_.length}y(r,d)&&b(34067,r,h.width,h.height);e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(s,e,i):(n.activeTexture(33984+i),n.bindTexture(34067,s.__webglTexture))}const A={1e3:10497,1001:33071,1002:33648},R={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function L(n,o,s){s?(t.texParameteri(n,10242,A[o.wrapS]),t.texParameteri(n,10243,A[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,A[o.wrapR]),t.texParameteri(n,10240,R[o.magFilter]),t.texParameteri(n,10241,R[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,_(o.magFilter)),t.texParameteri(n,10241,_(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const c=e.get("EXT_texture_filter_anisotropic");if(c){if(1015===o.type&&null===e.get("OES_texture_float_linear"))return;if(1016===o.type&&null===(a||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(t.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function C(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),s.memory.textures++)}function P(e,r,i){let s=3553;r.isDataTexture2DArray&&(s=35866),r.isDataTexture3D&&(s=32879),C(e,r),n.activeTexture(33984+i),n.bindTexture(s,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment);const c=function(t){return!a&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)}(r)&&!1===v(r.image),l=g(r.image,c,!1,u),h=v(l)||a,d=o.convert(r.format);let p,f=o.convert(r.type),m=x(r.internalFormat,d,f);L(s,r,h);const _=r.mipmaps;if(r.isDepthTexture)m=6402,a?m=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,f=o.convert(r.type)),1027===r.format&&6402===m&&(m=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,f=o.convert(r.type))),n.texImage2D(3553,0,m,l.width,l.height,0,d,f,null);else if(r.isDataTexture)if(_.length>0&&h){for(let t=0,e=_.length;t<e;t++)p=_[t],n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);r.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,l.width,l.height,0,d,f,l.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,e=_.length;t<e;t++)p=_[t],1023!==r.format&&1022!==r.format?null!==d?n.compressedTexImage2D(3553,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);e.__maxMipLevel=_.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,l.width,l.height,l.depth,0,d,f,l.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,l.width,l.height,l.depth,0,d,f,l.data),e.__maxMipLevel=0;else if(_.length>0&&h){for(let t=0,e=_.length;t<e;t++)p=_[t],n.texImage2D(3553,t,m,d,f,p);r.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,d,f,l),e.__maxMipLevel=0;y(r,h)&&b(s,r,l.width,l.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function O(e,i,s,a){const c=o.convert(i.texture.format),l=o.convert(i.texture.type),u=x(i.texture.internalFormat,c,l);n.texImage2D(a,0,u,i.width,i.height,0,c,l,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,s,a,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function N(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(1015===e.type?i=36012:1014===e.type&&(i=33190));const r=D(n);t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=D(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=o.convert(n.texture.format),i=o.convert(n.texture.type),s=x(n.texture.internalFormat,e,i);if(r){const e=D(n);t.renderbufferStorageMultisample(36161,e,s,n.width,n.height)}else t.renderbufferStorage(36161,s,n.width,n.height)}t.bindRenderbuffer(36161,null)}function I(e){const n=r.get(e),i=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),S(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,e)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)t.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=t.createRenderbuffer(),N(n.__webglDepthbuffer[r],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),N(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function D(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let F=!1,U=!1;this.allocateTextureUnit=function(){const t=E;return t>=c&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+c),E+=1,t},this.resetTextureUnits=function(){E=0},this.setTexture2D=S,this.setTexture2DArray=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?P(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?P(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(e){const i=r.get(e),c=r.get(e.texture);e.addEventListener("dispose",M),c.__webglTexture=t.createTexture(),s.memory.textures++;const l=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultisampleRenderTarget,h=v(e)||a;if(!a||1022!==e.texture.format||1015!==e.texture.type&&1016!==e.texture.type||(e.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){i.__webglFramebuffer=[];for(let e=0;e<6;e++)i.__webglFramebuffer[e]=t.createFramebuffer()}else if(i.__webglFramebuffer=t.createFramebuffer(),u)if(a){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,i.__webglColorRenderbuffer);const n=o.convert(e.texture.format),r=o.convert(e.texture.type),s=x(e.texture.internalFormat,n,r),a=D(e);t.renderbufferStorageMultisample(36161,a,s,e.width,e.height),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),N(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,c.__webglTexture),L(34067,e.texture,h);for(let t=0;t<6;t++)O(i.__webglFramebuffer[t],e,36064,34069+t);y(e.texture,h)&&b(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,c.__webglTexture),L(3553,e.texture,h),O(i.__webglFramebuffer,e,36064,3553),y(e.texture,h)&&b(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&I(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(y(e,v(t)||a)){const i=t.isWebGLCubeRenderTarget?34067:3553,o=r.get(e).__webglTexture;n.bindTexture(i,o),b(i,e,t.width,t.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const n=r.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const i=e.width,o=e.height;let s=16384;e.depthBuffer&&(s|=256),e.stencilBuffer&&(s|=1024),t.blitFramebuffer(0,0,i,o,0,0,i,o,s,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),S(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),T(t,e)}}function Cb(t,e,n){const r=n.isWebGL2;return{convert:function(t){let n;if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t)return r?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):36492===t?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):1020===t?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Pb(t=[]){wv.call(this),this.cameras=t}function Ob(){Km.call(this),this.type="Group"}function Nb(){this._targetRay=null,this._grip=null,this._hand=null}function Ib(t,e){const n=this;let r=null,i=1,o=null,s="local-floor",a=null;const c=[],l=new Map,u=new wv;u.layers.enable(1),u.viewport=new Zf;const h=new wv;h.layers.enable(2),h.viewport=new Zf;const d=[u,h],p=new Pb;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(t){const e=l.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function v(){l.forEach((function(t,e){t.disconnect(e)})),l.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),E.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(t){o=t,E.setContext(r),E.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function b(t){const e=r.inputSources;for(let t=0;t<c.length;t++)l.set(e[t],c[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=l.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),l.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],r=l.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=c[t];return void 0===e&&(e=new Nb,c[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=c[t];return void 0===e&&(e=new Nb,c[t]=e),e.getGripSpace()},this.getHand=function(t){let e=c[t];return void 0===e&&(e=new Nb,c[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){s=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=function(t){if(r=t,null!==r){r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",v);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i},o=new XRWebGLLayer(r,e,n);r.updateRenderState({baseLayer:o}),r.requestReferenceSpace(s).then(y),r.addEventListener("inputsourceschange",b)}};const x=new Qf,_=new Qf;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){p.near=h.near=u.near=t.near,p.far=h.far=u.far=t.far,f===p.near&&m===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const e=t.parent,n=p.cameras;w(p,e);for(let t=0;t<n.length;t++)w(n[t],e);t.matrixWorld.copy(p.matrixWorld);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){x.setFromMatrixPosition(e.matrixWorld),_.setFromMatrixPosition(n.matrixWorld);const r=x.distanceTo(_),i=e.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=s+f,v=a+f,y=d-m,b=p+(r-m),w=c*a/v*g,M=l*a/v*g;t.projectionMatrix.makePerspective(y,b,w,M,g,v)}(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let M=null;const E=new Cv;E.setAnimationLoop((function(e,n){if(a=n.getViewerPose(o),null!==a){const e=a.views,n=r.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let i=!1;e.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let t=0;t<e.length;t++){const r=e[t],o=n.getViewport(r),s=d[t];s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===t&&p.matrix.copy(s.matrix),!0===i&&p.cameras.push(s)}}const i=r.inputSources;for(let t=0;t<c.length;t++){const e=c[t],r=i[t];e.update(r,n,o)}M&&M(e,n)})),this.setAnimationLoop=function(t){M=t},this.dispose=function(){}}function Db(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const r=t.get(n).envMap;if(r){e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;const i=t.get(r).__maxMipLevel;void 0!==i&&(e.maxMipLevel.value=i)}let i,o;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,o){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r),r.isMeshPhysicalMaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,r):n(t,r)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Fb(t){const e=void 0!==(t=t||{}).canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,v=0,y=0,b=null,x=null,_=-1,w=null;const M=new Zf,E=new Zf;let S=null,T=e.width,A=e.height,R=1,L=null,C=null;const P=new Zf(0,0,T,A),O=new Zf(0,0,T,A);let N=!1;const I=new Lv;let D=!1,F=!1;const U=new Am,B=new Qf,k={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===b?R:1}let H,G,j,V,W,q,X,Y,Z,J,$,K,Q,tt,et,nt,rt,it,ot,st,at,ct=n;function lt(t,n){for(let r=0;r<t.length;r++){const i=t[r],o=e.getContext(i,n);if(null!==o)return o}return null}try{const t={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===ct){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),ct=lt(e,t),null===ct)throw lt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ct.getShaderPrecisionFormat&&(ct.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ut(){H=new Gv(ct),G=new kv(ct,H,t),!1===G.isWebGL2&&(H.get("WEBGL_depth_texture"),H.get("OES_texture_float"),H.get("OES_texture_half_float"),H.get("OES_texture_half_float_linear"),H.get("OES_standard_derivatives"),H.get("OES_element_index_uint"),H.get("OES_vertex_array_object"),H.get("ANGLE_instanced_arrays")),H.get("OES_texture_float_linear"),st=new Cb(ct,H,G),j=new Rb(ct,H,G),j.scissor(E.copy(O).multiplyScalar(R).floor()),j.viewport(M.copy(P).multiplyScalar(R).floor()),V=new Wv(ct),W=new fb,q=new Lb(ct,H,j,W,G,st,V),X=new Hv(f),Y=new Pv(ct,G),at=new Uv(ct,H,Y,G),Z=new jv(ct,Y,V,at),J=new Zv(ct,Z,Y,V),rt=new Yv(ct),et=new zv(W),$=new pb(f,X,H,G,at,et),K=new Db(W),Q=new yb(W),tt=new Eb(H,G),nt=new Fv(f,X,j,J,a),it=new Bv(ct,H,V,G),ot=new Vv(ct,H,V,G),V.programs=$.programs,f.capabilities=G,f.extensions=H,f.properties=W,f.renderLists=Q,f.state=j,f.info=V}ut();const ht=new Ib(f,ct);this.xr=ht;const dt=new Ab(f,J,G.maxTextureSize);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,ut()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){gt(t),W.remove(t)}(e)}function gt(t){const e=W.get(t).program;void 0!==e&&$.releaseProgram(e)}this.shadowMap=dt,this.getContext=function(){return ct},this.getContextAttributes=function(){return ct.getContextAttributes()},this.forceContextLoss=function(){const t=H.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=H.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(t){void 0!==t&&(R=t,this.setSize(T,A,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Gf),t.set(T,A)},this.setSize=function(t,n,r){ht.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,A=n,e.width=Math.floor(t*R),e.height=Math.floor(n*R),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Gf),t.set(T*R,A*R).floor()},this.setDrawingBufferSize=function(t,n,r){T=t,A=n,R=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Zf),t.copy(M)},this.getViewport=function(t){return t.copy(P)},this.setViewport=function(t,e,n,r){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,n,r),j.viewport(M.copy(P).multiplyScalar(R).floor())},this.getScissor=function(t){return t.copy(O)},this.setScissor=function(t,e,n,r){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,n,r),j.scissor(E.copy(O).multiplyScalar(R).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(t){j.setScissorTest(N=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){C=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new xg),t.copy(nt.getClearColor())},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),ct.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",ft,!1),Q.dispose(),tt.dispose(),W.dispose(),X.dispose(),J.dispose(),at.dispose(),ht.dispose(),yt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=W.get(t);t.hasPositions&&!n.position&&(n.position=ct.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=ct.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=ct.createBuffer()),t.hasColors&&!n.color&&(n.color=ct.createBuffer());const r=e.getAttributes();t.hasPositions&&(ct.bindBuffer(34962,n.position),ct.bufferData(34962,t.positionArray,35048),at.enableAttribute(r.position),ct.vertexAttribPointer(r.position,3,5126,!1,0,0)),t.hasNormals&&(ct.bindBuffer(34962,n.normal),ct.bufferData(34962,t.normalArray,35048),at.enableAttribute(r.normal),ct.vertexAttribPointer(r.normal,3,5126,!1,0,0)),t.hasUvs&&(ct.bindBuffer(34962,n.uv),ct.bufferData(34962,t.uvArray,35048),at.enableAttribute(r.uv),ct.vertexAttribPointer(r.uv,2,5126,!1,0,0)),t.hasColors&&(ct.bindBuffer(34962,n.color),ct.bufferData(34962,t.colorArray,35048),at.enableAttribute(r.color),ct.vertexAttribPointer(r.color,3,5126,!1,0,0)),at.disableUnusedAttributes(),ct.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){null===e&&(e=k);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=Mt(t,e,r,i);j.setMaterial(r,s);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let u,h=1;!0===r.wireframe&&(c=Z.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&rt.update(i,n,r,a),at.setup(i,r,a,n,c);let d=it;null!==c&&(u=Y.get(c),d=ot,d.setIndex(u));const p=null!==c?c.count:l.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),b=Math.min(p,f+m,g+v)-1,x=Math.max(0,b-y+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*z()),d.setMode(1)):d.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),j.setLineWidth(t*z()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(y,x,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,x,t)}else d.render(y,x)}},this.compile=function(t,e){d=tt.get(t),d.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights();const n=new WeakMap;t.traverse((function(e){const r=e.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];!1===n.has(o)&&(wt(o,t,e),n.set(o))}else!1===n.has(r)&&(wt(r,t,e),n.set(r))}))};let vt=null;const yt=new Cv;function bt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||I.intersectsSprite(t)){r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=J.update(t),i=t.material;i.visible&&h.push(t,e,i,n,B.z,null)}}else if(t.isImmediateRenderObject)r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U),h.push(t,null,t.material,n,B.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==V.render.frame&&(t.skeleton.update(),t.skeleton.frame=V.render.frame),!t.frustumCulled||I.intersectsObject(t))){r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=J.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&h.push(t,e,a,n,B.z,s)}}else i.visible&&h.push(t,e,i,n,B.z,null)}const i=t.children;for(let t=0,o=i.length;t<o;t++)bt(i[t],e,n,r)}function xt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,o=t.length;i<o;i++){const o=t[i],s=o.object,a=o.geometry,c=null===r?o.material:r,l=o.group;if(n.isArrayCamera){const t=n.cameras;for(let n=0,r=t.length;n<r;n++){const r=t[n];s.layers.test(r.layers)&&(j.viewport(M.copy(r.viewport)),d.setupLightsView(r),_t(s,e,r,a,c,l))}}else _t(s,e,n,a,c,l)}}function _t(t,e,n,r,i,o){if(t.onBeforeRender(f,e,n,r,i,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const r=Mt(n,e,i,t);j.setMaterial(i),at.reset(),function(t,e){t.render((function(t){f.renderBufferImmediate(t,e)}))}(t,r)}else f.renderBufferDirect(n,e,r,i,t,o);t.onAfterRender(f,e,n,r,i,o)}function wt(t,e,n){!0!==e.isScene&&(e=k);const r=W.get(t),i=d.state.lights,o=d.state.shadowsArray,s=i.state.version,a=$.getParameters(t,i.state,o,e,n),c=$.getProgramCacheKey(a);let l=r.program,u=!0;if(void 0===l)t.addEventListener("dispose",mt);else if(l.cacheKey!==c)gt(t);else if(r.lightsStateVersion!==s)u=!1;else{if(void 0!==a.shaderID){const n=t.isMeshStandardMaterial?e.environment:null;return void(r.envMap=X.get(t.envMap||n))}u=!1}u&&(a.uniforms=$.getUniforms(t),t.onBeforeCompile(a,f),l=$.acquireProgram(a,c),r.program=l,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);const h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=et.numPlanes,r.numIntersection=et.numIntersection,h.clippingPlanes=et.uniform),r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=X.get(t.envMap||r.environment),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=r.program.getUniforms(),m=qy.seqWithValue(p.seq,h);r.uniformsList=m}function Mt(t,e,n,r){!0!==e.isScene&&(e=k),q.resetTextureUnits();const i=e.fog,o=n.isMeshStandardMaterial?e.environment:null,s=null===b?f.outputEncoding:b.texture.encoding,a=X.get(n.envMap||o),c=W.get(n),l=d.state.lights;if(!0===D&&(!0===F||t!==w)){const e=t===w&&n.id===_;et.setState(n,t,e)}n.version===c.__version?n.fog&&c.fog!==i||c.environment!==o||c.needsLights&&c.lightsStateVersion!==l.state.version?wt(n,e,r):void 0===c.numClippingPlanes||c.numClippingPlanes===et.numPlanes&&c.numIntersection===et.numIntersection?(c.outputEncoding!==s||c.envMap!==a)&&wt(n,e,r):wt(n,e,r):(wt(n,e,r),c.__version=n.version);let u=!1,h=!1,p=!1;const m=c.program,g=m.getUniforms(),v=c.uniforms;if(j.useProgram(m.program)&&(u=!0,h=!0,p=!0),n.id!==_&&(_=n.id,h=!0),u||w!==t){if(g.setValue(ct,"projectionMatrix",t.projectionMatrix),G.logarithmicDepthBuffer&&g.setValue(ct,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,h=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=g.map.cameraPosition;void 0!==e&&e.setValue(ct,B.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(ct,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(ct,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){g.setOptional(ct,r,"bindMatrix"),g.setOptional(ct,r,"bindMatrixInverse");const t=r.skeleton;if(t){const e=t.bones;if(G.floatVertexTextures){if(null===t.boneTexture){let n=Math.sqrt(4*e.length);n=Hf.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(t.boneMatrices);const i=new Tv(r,n,n,1023,1015);t.boneMatrices=r,t.boneTexture=i,t.boneTextureSize=n}g.setValue(ct,"boneTexture",t.boneTexture,q),g.setValue(ct,"boneTextureSize",t.boneTextureSize)}else g.setOptional(ct,t,"boneMatrices")}}var y,x;return(h||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,g.setValue(ct,"receiveShadow",r.receiveShadow)),h&&(g.setValue(ct,"toneMappingExposure",f.toneMappingExposure),c.needsLights&&(x=p,(y=v).ambientLightColor.needsUpdate=x,y.lightProbe.needsUpdate=x,y.directionalLights.needsUpdate=x,y.directionalLightShadows.needsUpdate=x,y.pointLights.needsUpdate=x,y.pointLightShadows.needsUpdate=x,y.spotLights.needsUpdate=x,y.spotLightShadows.needsUpdate=x,y.rectAreaLights.needsUpdate=x,y.hemisphereLights.needsUpdate=x),i&&n.fog&&K.refreshFogUniforms(v,i),K.refreshMaterialUniforms(v,n,R,A),qy.upload(ct,c.uniformsList,v,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(qy.upload(ct,c.uniformsList,v,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(ct,"center",r.center),g.setValue(ct,"modelViewMatrix",r.modelViewMatrix),g.setValue(ct,"normalMatrix",r.normalMatrix),g.setValue(ct,"modelMatrix",r.matrixWorld),m}yt.setAnimationLoop((function(t){ht.isPresenting||vt&&vt(t)})),"undefined"!=typeof window&&yt.setContext(window),this.setAnimationLoop=function(t){vt=t,ht.setAnimationLoop(t),null===t?yt.stop():yt.start()},this.render=function(t,e){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;at.resetDefaultState(),_=-1,w=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ht.enabled&&!0===ht.isPresenting&&(e=ht.getCamera(e)),!0===t.isScene&&t.onBeforeRender(f,t,e,n||b),d=tt.get(t,p.length),d.init(),p.push(d),U.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),I.setFromProjectionMatrix(U),F=this.localClippingEnabled,D=et.init(this.clippingPlanes,F,e),h=Q.get(t,e),h.init(),bt(t,e,0,f.sortObjects),h.finish(),!0===f.sortObjects&&h.sort(L,C),!0===D&&et.beginShadows();const i=d.state.shadowsArray;dt.render(i,t,e),d.setupLights(),d.setupLightsView(e),!0===D&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(h,t,e,r);const o=h.opaque,s=h.transparent;o.length>0&&xt(o,t,e),s.length>0&&xt(s,t,e),!0===t.isScene&&t.onAfterRender(f,t,e),null!==b&&(q.updateRenderTargetMipmap(b),q.updateMultisampleRenderTarget(b)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),p.pop(),d=p.length>0?p[p.length-1]:null,h=null},this.setFramebuffer=function(t){g!==t&&null===b&&ct.bindFramebuffer(36160,t),g=t},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderList=function(){return h},this.setRenderList=function(t){h=t},this.getRenderTarget=function(){return b},this.setRenderTarget=function(t,e=0,n=0){b=t,v=e,y=n,t&&void 0===W.get(t).__webglFramebuffer&&q.setupRenderTarget(t);let r=g,i=!1;if(t){const n=W.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],i=!0):r=t.isWebGLMultisampleRenderTarget?W.get(t).__webglMultisampledFramebuffer:n,M.copy(t.viewport),E.copy(t.scissor),S=t.scissorTest}else M.copy(P).multiplyScalar(R).floor(),E.copy(O).multiplyScalar(R).floor(),S=N;if(x!==r&&(ct.bindFramebuffer(36160,r),x=r),j.viewport(M),j.scissor(E),j.setScissorTest(S),i){const r=W.get(t.texture);ct.framebufferTexture2D(36160,36064,34069+e,r.__webglTexture,n)}},this.readRenderTargetPixels=function(t,e,n,r,i,o,s){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==x&&(ct.bindFramebuffer(36160,a),s=!0);try{const a=t.texture,c=a.format,l=a.type;if(1023!==c&&st.convert(c)!==ct.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===l||st.convert(l)===ct.getParameter(35738)||1015===l&&(G.isWebGL2||H.get("OES_texture_float")||H.get("WEBGL_color_buffer_float"))||1016===l&&(G.isWebGL2?H.get("EXT_color_buffer_float"):H.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ct.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&ct.readPixels(e,n,r,i,st.convert(c),st.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ct.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r),s=st.convert(e.format);q.setTexture2D(e,0),ct.copyTexImage2D(3553,n,s,t.x,t.y,i,o,0),j.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,o=e.image.height,s=st.convert(n.format),a=st.convert(n.type);q.setTexture2D(n,0),ct.pixelStorei(37440,n.flipY),ct.pixelStorei(37441,n.premultiplyAlpha),ct.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ct.texSubImage2D(3553,r,t.x,t.y,i,o,s,a,e.image.data):e.isCompressedTexture?ct.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,s,e.mipmaps[0].data):ct.texSubImage2D(3553,r,t.x,t.y,s,a,e.image),0===r&&n.generateMipmaps&&ct.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(t){q.setTexture2D(t,0),j.unbindTexture()},this.resetState=function(){j.reset(),at.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ub(t){Fb.call(this,t)}Pb.prototype=Object.assign(Object.create(wv.prototype),{constructor:Pb,isArrayCamera:!0}),Ob.prototype=Object.assign(Object.create(Km.prototype),{constructor:Ob,isGroup:!0}),Object.assign(Nb.prototype,{constructor:Nb,getHandSpace:function(){if(null===this._hand&&(this._hand=new Ob,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){const t=new Ob;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Ob,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Ob,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(c&&t.hand){o=!0;for(let r=0;r<=window.XRHand.LITTLE_PHALANX_TIP;r++)if(t.hand[r]){const i=e.getJointPose(t.hand[r],n),o=c.joints[r];null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=i.radius),o.visible=null!==i;const s=c.joints[window.XRHand.INDEX_PHALANX_TIP],a=c.joints[window.XRHand.THUMB_PHALANX_TIP],l=s.position.distanceTo(a.position),u=.02,h=.005;c.inputState.pinching&&l>u+h?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&l<=u-h&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==s&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==o),this}}),Object.assign(Ib.prototype,Bf.prototype),Ub.prototype=Object.assign(Object.create(Fb.prototype),{constructor:Ub,isWebGL1Renderer:!0});class Bb extends Km{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}function kb(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Hf.generateUUID()}Object.defineProperty(kb.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(kb.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e=0){return this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Hf.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new kb(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Hf.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const zb=new Qf;function Hb(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function Gb(t){Mg.call(this),this.type="SpriteMaterial",this.color=new xg(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let jb;Object.defineProperties(Hb.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(Hb.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)zb.x=this.getX(e),zb.y=this.getY(e),zb.z=this.getZ(e),zb.applyMatrix4(t),this.setXYZ(e,zb.x,zb.y,zb.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Ag(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Hb(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Gb.prototype=Object.create(Mg.prototype),Gb.prototype.constructor=Gb,Gb.prototype.isSpriteMaterial=!0,Gb.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const Vb=new Qf,Wb=new Qf,qb=new Qf,Xb=new Gf,Yb=new Gf,Zb=new Am,Jb=new Qf,$b=new Qf,Kb=new Qf,Qb=new Gf,tx=new Gf,ex=new Gf;function nx(t){if(Km.call(this),this.type="Sprite",void 0===jb){jb=new Zg;const t=new kb(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);jb.setIndex([0,1,2,0,2,3]),jb.setAttribute("position",new Hb(t,3,0,!1)),jb.setAttribute("uv",new Hb(t,2,3,!1))}this.geometry=jb,this.material=void 0!==t?t:new Gb,this.center=new Gf(.5,.5)}function rx(t,e,n,r,i,o){Xb.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Yb.x=o*Xb.x-i*Xb.y,Yb.y=i*Xb.x+o*Xb.y):Yb.copy(Xb),t.copy(e),t.x+=Yb.x,t.y+=Yb.y,t.applyMatrix4(Zb)}nx.prototype=Object.assign(Object.create(Km.prototype),{constructor:nx,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Wb.setFromMatrixScale(this.matrixWorld),Zb.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),qb.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Wb.multiplyScalar(-qb.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;rx(Jb.set(-.5,-.5,0),qb,o,Wb,r,i),rx($b.set(.5,-.5,0),qb,o,Wb,r,i),rx(Kb.set(.5,.5,0),qb,o,Wb,r,i),Qb.set(0,0),tx.set(1,0),ex.set(1,1);let s=t.ray.intersectTriangle(Jb,$b,Kb,!1,Vb);if(null===s&&(rx($b.set(-.5,.5,0),qb,o,Wb,r,i),tx.set(0,1),s=t.ray.intersectTriangle(Jb,Kb,$b,!1,Vb),null===s))return;const a=t.ray.origin.distanceTo(Vb);a<t.near||a>t.far||e.push({distance:a,point:Vb.clone(),uv:pg.getUV(Vb,Jb,$b,Kb,Qb,tx,ex,new Gf),face:null,object:this})},copy:function(t){return Km.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const ix=new Qf,ox=new Qf;function sx(){Km.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}sx.prototype=Object.assign(Object.create(Km.prototype),{constructor:sx,isLOD:!0,copy:function(t){Km.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){ix.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(ix);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){ix.setFromMatrixPosition(t.matrixWorld),ox.setFromMatrixPosition(this.matrixWorld);const n=ix.distanceTo(ox)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}},toJSON:function(t){const e=Km.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}});const ax=new Qf,cx=new Zf,lx=new Zf,ux=new Qf,hx=new Am;function dx(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),pv.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Am,this.bindMatrixInverse=new Am}function px(){Km.call(this),this.type="Bone"}dx.prototype=Object.assign(Object.create(pv.prototype),{constructor:dx,isSkinnedMesh:!0,copy:function(t){return pv.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Zf,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){pv.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,e){const n=this.skeleton,r=this.geometry;cx.fromBufferAttribute(r.attributes.skinIndex,t),lx.fromBufferAttribute(r.attributes.skinWeight,t),ax.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=lx.getComponent(t);if(0!==r){const i=cx.getComponent(t);hx.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(ux.copy(ax).applyMatrix4(hx),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}),px.prototype=Object.assign(Object.create(Km.prototype),{constructor:px,isBone:!0});const fx=new Am,mx=new Am;function gx(t=[],e=[]){this.uuid=Hf.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(gx.prototype,{init:function(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Am)}},calculateInverses:function(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Am;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:mx;fx.multiplyMatrices(i,e[r]),fx.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new gx(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new px),this.bones.push(i),this.boneInverses.push((new Am).fromArray(t.boneInverses[n]))}return this.init(),this},toJSON:function(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const o=n[r];t.boneInverses.push(o.toArray())}return t}});const vx=new Am,yx=new Am,bx=[],xx=new pv;function _x(t,e,n){pv.call(this,t,e),this.instanceMatrix=new Ag(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function wx(t){Mg.call(this),this.type="LineBasicMaterial",this.color=new xg(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}_x.prototype=Object.assign(Object.create(pv.prototype),{constructor:_x,isInstancedMesh:!0,copy:function(t){return pv.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getColorAt:function(t,e){e.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,r=this.count;if(xx.geometry=this.geometry,xx.material=this.material,void 0!==xx.material)for(let i=0;i<r;i++){this.getMatrixAt(i,vx),yx.multiplyMatrices(n,vx),xx.matrixWorld=yx,xx.raycast(t,bx);for(let t=0,n=bx.length;t<n;t++){const n=bx[t];n.instanceId=i,n.object=this,e.push(n)}bx.length=0}},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new Ag(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),wx.prototype=Object.create(Mg.prototype),wx.prototype.constructor=wx,wx.prototype.isLineBasicMaterial=!0,wx.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const Mx=new Qf,Ex=new Qf,Sx=new Am,Tx=new Tm,Ax=new ym;function Rx(t=new Zg,e=new wx){Km.call(this),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}Rx.prototype=Object.assign(Object.create(Km.prototype),{constructor:Rx,isLine:!0,copy:function(t){return Km.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)Mx.fromBufferAttribute(e,t-1),Ex.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Mx.distanceTo(Ex);t.setAttribute("lineDistance",new Fg(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;n[0]=0;for(let t=1,r=e.length;t<r;t++)n[t]=n[t-1],n[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ax.copy(n.boundingSphere),Ax.applyMatrix4(r),Ax.radius+=i,!1===t.ray.intersectsSphere(Ax))return;Sx.copy(r).invert(),Tx.copy(t.ray).applyMatrix4(Sx);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new Qf,c=new Qf,l=new Qf,u=new Qf,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,o=n.length-1;r<o;r+=h){const o=n[r],h=n[r+1];a.fromBufferAttribute(i,o),c.fromBufferAttribute(i,h);if(Tx.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:l.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.count-1;n<r;n+=h){a.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1);if(Tx.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const r=n.vertices,i=r.length;for(let n=0;n<i-1;n+=h){if(Tx.distanceSqToSegment(r[n],r[n+1],u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Lx=new Qf,Cx=new Qf;function Px(t,e){Rx.call(this,t,e),this.type="LineSegments"}function Ox(t,e){Rx.call(this,t,e),this.type="LineLoop"}function Nx(t){Mg.call(this),this.type="PointsMaterial",this.color=new xg(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Px.prototype=Object.assign(Object.create(Rx.prototype),{constructor:Px,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)Lx.fromBufferAttribute(e,t),Cx.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Lx.distanceTo(Cx);t.setAttribute("lineDistance",new Fg(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;for(let t=0,r=e.length;t<r;t+=2)Lx.copy(e[t]),Cx.copy(e[t+1]),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Lx.distanceTo(Cx)}return this}}),Ox.prototype=Object.assign(Object.create(Rx.prototype),{constructor:Ox,isLineLoop:!0}),Nx.prototype=Object.create(Mg.prototype),Nx.prototype.constructor=Nx,Nx.prototype.isPointsMaterial=!0,Nx.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const Ix=new Am,Dx=new Tm,Fx=new ym,Ux=new Qf;function Bx(t=new Zg,e=new Nx){Km.call(this),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}function kx(t,e,n,r,i,o,s){const a=Dx.distanceSqToPoint(t);if(a<n){const n=new Qf;Dx.closestPointToPoint(t,n),n.applyMatrix4(r);const c=i.ray.origin.distanceTo(n);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:s})}}function zx(t,e,n,r,i,o,s,a,c){Xf.call(this,t,e,n,r,i,o,s,a,c),this.format=void 0!==s?s:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==i?i:1006,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}function Hx(t,e,n,r,i,o,s,a,c,l,u,h){Xf.call(this,null,o,s,a,c,l,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Gx(t,e,n,r,i,o,s,a,c){Xf.call(this,t,e,n,r,i,o,s,a,c),this.needsUpdate=!0}function jx(t,e,n,r,i,o,s,a,c,l){if(1026!==(l=void 0!==l?l:1026)&&1027!==l)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===l&&(n=1012),void 0===n&&1027===l&&(n=1020),Xf.call(this,null,r,i,o,s,a,l,n,c),this.image={width:t,height:e},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==a?a:1003,this.flipY=!1,this.generateMipmaps=!1}Bx.prototype=Object.assign(Object.create(Km.prototype),{constructor:Bx,isPoints:!0,copy:function(t){return Km.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Fx.copy(n.boundingSphere),Fx.applyMatrix4(r),Fx.radius+=i,!1===t.ray.intersectsSphere(Fx))return;Ix.copy(r).invert(),Dx.copy(t.ray).applyMatrix4(Ix);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,a=n.length;i<a;i++){const a=n[i];Ux.fromBufferAttribute(o,a),kx(Ux,a,s,r,t,e,this)}}else for(let n=0,i=o.count;n<i;n++)Ux.fromBufferAttribute(o,n),kx(Ux,n,s,r,t,e,this)}else{const i=n.vertices;for(let n=0,o=i.length;n<o;n++)kx(i[n],n,s,r,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),zx.prototype=Object.assign(Object.create(Xf.prototype),{constructor:zx,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Hx.prototype=Object.create(Xf.prototype),Hx.prototype.constructor=Hx,Hx.prototype.isCompressedTexture=!0,Gx.prototype=Object.create(Xf.prototype),Gx.prototype.constructor=Gx,Gx.prototype.isCanvasTexture=!0,jx.prototype=Object.create(Xf.prototype),jx.prototype.constructor=jx,jx.prototype.isDepthTexture=!0;let Vx=0;const Wx=new Am,qx=new Km,Xx=new Qf;function Yx(){Object.defineProperty(this,"id",{value:Vx+=2}),this.uuid=Hf.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Yx.prototype=Object.assign(Object.create(Bf.prototype),{constructor:Yx,isGeometry:!0,applyMatrix4:function(t){const e=(new jf).getNormalMatrix(t);for(let e=0,n=this.vertices.length;e<n;e++){this.vertices[e].applyMatrix4(t)}for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.normal.applyMatrix3(e).normalize();for(let t=0,r=n.vertexNormals.length;t<r;t++)n.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Wx.makeRotationX(t),this.applyMatrix4(Wx),this},rotateY:function(t){return Wx.makeRotationY(t),this.applyMatrix4(Wx),this},rotateZ:function(t){return Wx.makeRotationZ(t),this.applyMatrix4(Wx),this},translate:function(t,e,n){return Wx.makeTranslation(t,e,n),this.applyMatrix4(Wx),this},scale:function(t,e,n){return Wx.makeScale(t,e,n),this.applyMatrix4(Wx),this},lookAt:function(t){return qx.lookAt(t),qx.updateMatrix(),this.applyMatrix4(qx.matrix),this},fromBufferGeometry:function(t){const e=this,n=null!==t.index?t.index:void 0,r=t.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const i=r.position,o=r.normal,s=r.color,a=r.uv,c=r.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let t=0;t<i.count;t++)e.vertices.push((new Qf).fromBufferAttribute(i,t)),void 0!==s&&e.colors.push((new xg).fromBufferAttribute(s,t));function l(t,n,r,i){const l=void 0===s?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()],u=void 0===o?[]:[(new Qf).fromBufferAttribute(o,t),(new Qf).fromBufferAttribute(o,n),(new Qf).fromBufferAttribute(o,r)],h=new _g(t,n,r,u,l,i);e.faces.push(h),void 0!==a&&e.faceVertexUvs[0].push([(new Gf).fromBufferAttribute(a,t),(new Gf).fromBufferAttribute(a,n),(new Gf).fromBufferAttribute(a,r)]),void 0!==c&&e.faceVertexUvs[1].push([(new Gf).fromBufferAttribute(c,t),(new Gf).fromBufferAttribute(c,n),(new Gf).fromBufferAttribute(c,r)])}const u=t.groups;if(u.length>0)for(let t=0;t<u.length;t++){const e=u[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)void 0!==n?l(n.getX(t),n.getX(t+1),n.getX(t+2),e.materialIndex):l(t,t+1,t+2,e.materialIndex)}else if(void 0!==n)for(let t=0;t<n.count;t+=3)l(n.getX(t),n.getX(t+1),n.getX(t+2));else for(let t=0;t<i.count;t+=3)l(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xx).negate(),this.translate(Xx.x,Xx.y,Xx.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new Am;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){const t=new Qf,e=new Qf;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],i=this.vertices[r.a],o=this.vertices[r.b],s=this.vertices[r.c];t.subVectors(s,o),e.subVectors(i,o),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t=!0){const e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new Qf;if(t){const t=new Qf,n=new Qf;for(let r=0,i=this.faces.length;r<i;r++){const i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];t.subVectors(a,s),n.subVectors(o,s),t.cross(n),e[i.a].add(t),e[i.b].add(t),e[i.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],r=n.vertexNormals;3===r.length?(r[0].copy(e[n.a]),r[1].copy(e[n.b]),r[2].copy(e[n.c])):(r[0]=e[n.a].clone(),r[1]=e[n.b].clone(),r[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const t=new Yx;t.faces=this.faces;for(let e=0,n=this.morphTargets.length;e<n;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,n=this.morphNormals[e].vertexNormals;for(let e=0,r=this.faces.length;e<r;e++){const e=new Qf,r={a:new Qf,b:new Qf,c:new Qf};t.push(e),n.push(r)}}const n=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],r=n.faceNormals[t],i=n.vertexNormals[t];r.copy(e.normal),i.a.copy(e.vertexNormals[0]),i.b.copy(e.vertexNormals[1]),i.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new nm),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ym),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n=0){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let r;const i=this.vertices.length,o=this.vertices,s=t.vertices,a=this.faces,c=t.faces,l=this.colors,u=t.colors;void 0!==e&&(r=(new jf).getNormalMatrix(e));for(let t=0,n=s.length;t<n;t++){const n=s[t].clone();void 0!==e&&n.applyMatrix4(e),o.push(n)}for(let t=0,e=u.length;t<e;t++)l.push(u[t].clone());for(let t=0,e=c.length;t<e;t++){const e=c[t];let o,s;const l=e.vertexNormals,u=e.vertexColors,h=new _g(e.a+i,e.b+i,e.c+i);h.normal.copy(e.normal),void 0!==r&&h.normal.applyMatrix3(r).normalize();for(let t=0,e=l.length;t<e;t++)o=l[t].clone(),void 0!==r&&o.applyMatrix3(r).normalize(),h.vertexNormals.push(o);h.color.copy(e.color);for(let t=0,e=u.length;t<e;t++)s=u[t],h.vertexColors.push(s.clone());h.materialIndex=e.materialIndex+n,a.push(h)}for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,r=n.length;t<r;t++){const r=n[t],i=[];for(let t=0,e=r.length;t<e;t++)i.push(r[t].clone());this.faceVertexUvs[e].push(i)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(t=4){const e={},n=[],r=[],i=Math.pow(10,t);for(let t=0,o=this.vertices.length;t<o;t++){const o=this.vertices[t],s=Math.round(o.x*i)+"_"+Math.round(o.y*i)+"_"+Math.round(o.z*i);void 0===e[s]?(e[s]=t,n.push(this.vertices[t]),r[t]=n.length-1):r[t]=r[e[s]]}const o=[];for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.a=r[e.a],e.b=r[e.b],e.c=r[e.c];const n=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(n[e]===n[(e+1)%3]){o.push(t);break}}for(let t=o.length-1;t>=0;t--){const e=o[t];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const s=this.vertices.length-n.length;return this.vertices=n,s},setFromPoints:function(t){this.vertices=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];this.vertices.push(new Qf(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));const n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let i,o;n&&n.length===e&&(i=[]),r&&r.length===e&&(o=[]);for(let s=0;s<e;s++){const e=t[s]._id;i&&i.push(n[e]),o&&o.push(r[e])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}const e=[];for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];e.push(n.x,n.y,n.z)}const n=[],r=[],i={},o=[],s={},a=[],c={};for(let t=0;t<this.faces.length;t++){const e=this.faces[t],r=!0,i=!1,o=void 0!==this.faceVertexUvs[0][t],s=e.normal.length()>0,a=e.vertexNormals.length>0,c=1!==e.color.r||1!==e.color.g||1!==e.color.b,p=e.vertexColors.length>0;let f=0;if(f=l(f,0,0),f=l(f,1,r),f=l(f,2,i),f=l(f,3,o),f=l(f,4,s),f=l(f,5,a),f=l(f,6,c),f=l(f,7,p),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),o){const e=this.faceVertexUvs[0][t];n.push(d(e[0]),d(e[1]),d(e[2]))}if(s&&n.push(u(e.normal)),a){const t=e.vertexNormals;n.push(u(t[0]),u(t[1]),u(t[2]))}if(c&&n.push(h(e.color)),p){const t=e.vertexColors;n.push(h(t[0]),h(t[1]),h(t[2]))}}function l(t,e,n){return n?t|1<<e:t&~(1<<e)}function u(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==i[e]||(i[e]=r.length/3,r.push(t.x,t.y,t.z)),i[e]}function h(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==s[e]||(s[e]=o.length,o.push(t.getHex())),s[e]}function d(t){const e=t.x.toString()+t.y.toString();return void 0!==c[e]||(c[e]=a.length/2,a.push(t.x,t.y)),c[e]}return t.data={},t.data.vertices=e,t.data.normals=r,o.length>0&&(t.data.colors=o),a.length>0&&(t.data.uvs=[a]),t.data.faces=n,t},clone:function(){return(new Yx).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let t=0,n=e.length;t<n;t++)this.vertices.push(e[t].clone());const n=t.colors;for(let t=0,e=n.length;t<e;t++)this.colors.push(n[t].clone());const r=t.faces;for(let t=0,e=r.length;t<e;t++)this.faces.push(r[t].clone());for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,r=n.length;t<r;t++){const r=n[t],i=[];for(let t=0,e=r.length;t<e;t++){const e=r[t];i.push(e.clone())}this.faceVertexUvs[e].push(i)}}const i=t.morphTargets;for(let t=0,e=i.length;t<e;t++){const e={};if(e.name=i[t].name,void 0!==i[t].vertices){e.vertices=[];for(let n=0,r=i[t].vertices.length;n<r;n++)e.vertices.push(i[t].vertices[n].clone())}if(void 0!==i[t].normals){e.normals=[];for(let n=0,r=i[t].normals.length;n<r;n++)e.normals.push(i[t].normals[n].clone())}this.morphTargets.push(e)}const o=t.morphNormals;for(let t=0,e=o.length;t<e;t++){const e={};if(void 0!==o[t].vertexNormals){e.vertexNormals=[];for(let n=0,r=o[t].vertexNormals.length;n<r;n++){const r=o[t].vertexNormals[n],i={};i.a=r.a.clone(),i.b=r.b.clone(),i.c=r.c.clone(),e.vertexNormals.push(i)}}if(void 0!==o[t].faceNormals){e.faceNormals=[];for(let n=0,r=o[t].faceNormals.length;n<r;n++)e.faceNormals.push(o[t].faceNormals[n].clone())}this.morphNormals.push(e)}const s=t.skinWeights;for(let t=0,e=s.length;t<e;t++)this.skinWeights.push(s[t].clone());const a=t.skinIndices;for(let t=0,e=a.length;t<e;t++)this.skinIndices.push(a[t].clone());const c=t.lineDistances;for(let t=0,e=c.length;t<e;t++)this.lineDistances.push(c[t]);const l=t.boundingBox;null!==l&&(this.boundingBox=l.clone());const u=t.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});new Qf,new Qf,new Qf,new pg;const Zx=function(t,e,n){n=n||2;const r=e&&e.length,i=r?e[0]*n:t.length;let o=Jx(t,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,l,u,h,d,p;if(r&&(o=function(t,e,n,r){const i=[];let o,s,a,c,l;for(o=0,s=e.length;o<s;o++)a=e[o]*r,c=o<s-1?e[o+1]*r:t.length,l=Jx(t,a,c,r,!1),l===l.next&&(l.steiner=!0),i.push(a_(l));for(i.sort(r_),o=0;o<i.length;o++)i_(i[o],n),n=$x(n,n.next);return n}(t,e,o,n)),t.length>80*n){a=l=t[0],c=u=t[1];for(let e=n;e<i;e+=n)h=t[e],d=t[e+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=0!==p?1/p:0}return Kx(o,s,n,a,c,p),s};function Jx(t,e,n,r,i){let o,s;if(i===function(t,e,n,r){let i=0;for(let o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)s=v_(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=v_(o,t[o],t[o+1],s);return s&&h_(s,s.next)&&(y_(s),s=s.next),s}function $x(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!h_(r,r.next)&&0!==u_(r.prev,r,r.next))r=r.next;else{if(y_(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function Kx(t,e,n,r,i,o,s){if(!t)return;!s&&o&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=s_(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,o,s,a,c,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<l&&(a++,r=r.nextZ,r);e++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1)}(i)}(t,r,i,o);let a,c,l=t;for(;t.prev!==t.next;)if(a=t.prev,c=t.next,o?t_(t,r,i,o):Qx(t))e.push(a.i/n),e.push(t.i/n),e.push(c.i/n),y_(t),t=c.next,l=c.next;else if((t=c)===l){s?1===s?Kx(t=e_($x(t),e,n),e,n,r,i,o,2):2===s&&n_(t,e,n,r,i,o):Kx($x(t),e,n,r,i,o,1);break}}function Qx(t){const e=t.prev,n=t,r=t.next;if(u_(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(c_(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&u_(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function t_(t,e,n,r){const i=t.prev,o=t,s=t.next;if(u_(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,c=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=s_(a,c,e,n,r),d=s_(l,u,e,n,r);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&c_(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&u_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&c_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&u_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&c_(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&u_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&c_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&u_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function e_(t,e,n){let r=t;do{const i=r.prev,o=r.next.next;!h_(i,o)&&d_(i,r,r.next,o)&&m_(i,o)&&m_(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),y_(r),y_(r.next),r=t=o),r=r.next}while(r!==t);return $x(r)}function n_(t,e,n,r,i,o){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&l_(s,t)){let a=g_(s,t);return s=$x(s,s.next),a=$x(a,a.next),Kx(s,e,n,r,i,o),void Kx(a,e,n,r,i,o)}t=t.next}s=s.next}while(s!==t)}function r_(t,e){return t.x-e.x}function i_(t,e){if(e=function(t,e){let n=e;const r=t.x,i=t.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const t=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>s){if(s=t,t===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(r===s)return o;const a=o,c=o.x,l=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=c&&r!==n.x&&c_(i<l?r:s,i,c,l,i<l?s:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),m_(n,t)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&o_(o,n)))&&(o=n,h=u)),n=n.next}while(n!==a);return o}(t,e)){const n=g_(e,t);$x(e,e.next),$x(n,n.next)}}function o_(t,e){return u_(t.prev,t,e.prev)<0&&u_(e.next,t,t.next)<0}function s_(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a_(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function c_(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function l_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&d_(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(m_(t,e)&&m_(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(u_(t.prev,t,e.prev)||u_(t,e.prev,e))||h_(t,e)&&u_(t.prev,t,t.next)>0&&u_(e.prev,e,e.next)>0)}function u_(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function h_(t,e){return t.x===e.x&&t.y===e.y}function d_(t,e,n,r){const i=f_(u_(t,e,n)),o=f_(u_(t,e,r)),s=f_(u_(n,r,t)),a=f_(u_(n,r,e));return i!==o&&s!==a||(!(0!==i||!p_(t,n,e))||(!(0!==o||!p_(t,r,e))||(!(0!==s||!p_(n,t,r))||!(0!==a||!p_(n,e,r)))))}function p_(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function f_(t){return t>0?1:t<0?-1:0}function m_(t,e){return u_(t.prev,t,t.next)<0?u_(t,e,t.next)>=0&&u_(t,t.prev,e)>=0:u_(t,e,t.prev)<0||u_(t,t.next,e)<0}function g_(t,e){const n=new b_(t.i,t.x,t.y),r=new b_(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function v_(t,e,n,r){const i=new b_(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function y_(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function b_(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const x_={area:function(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return x_.area(t)<0},triangulateShape:function(t,e){const n=[],r=[],i=[];__(t),w_(n,t);let o=t.length;e.forEach(__);for(let t=0;t<e.length;t++)r.push(o),o+=e[t].length,w_(n,e[t]);const s=Zx(n,r);for(let t=0;t<s.length;t+=3)i.push(s.slice(t,t+3));return i}};function __(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function w_(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class M_ extends Zg{constructor(t,e){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++){o(t[e])}function o(t){const o=[],s=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let c=void 0!==e.depth?e.depth:100,l=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:E_;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=e.amount);let g,v,y,b,x,_=!1;f&&(g=f.getSpacedPoints(a),_=!0,l=!1,v=f.computeFrenetFrames(a,!1),y=new Qf,b=new Qf,x=new Qf),l||(p=0,u=0,h=0,d=0);const w=t.extractPoints(s);let M=w.shape;const E=w.holes;if(!x_.isClockWise(M)){M=M.reverse();for(let t=0,e=E.length;t<e;t++){const e=E[t];x_.isClockWise(e)&&(E[t]=e.reverse())}}const S=x_.triangulateShape(M,E),T=M;for(let t=0,e=E.length;t<e;t++){const e=E[t];M=M.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const R=M.length,L=S.length;function C(t,e,n){let r,i,o;const s=t.x-e.x,a=t.y-e.y,c=n.x-t.x,l=n.y-t.y,u=s*s+a*a,h=s*l-a*c;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(c*c+l*l),p=e.x-a/h,f=e.y+s/h,m=((n.x-l/d-p)*l-(n.y+c/d-f)*c)/(s*l-a*c);r=p+s*m-t.x,i=f+a*m-t.y;const g=r*r+i*i;if(g<=2)return new Gf(r,i);o=Math.sqrt(g/2)}else{let t=!1;s>Number.EPSILON?c>Number.EPSILON&&(t=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new Gf(r/o,i/o)}const P=[];for(let t=0,e=T.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),P[t]=C(T[t],T[n],T[r]);const O=[];let N,I=P.concat();for(let t=0,e=E.length;t<e;t++){const e=E[t];N=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[t]=C(e[t],e[r],e[i]);O.push(N),I=I.concat(N)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],P[t],r);U(e.x,e.y,-n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];N=O[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);U(i.x,i.y,-n)}}}const D=h+d;for(let t=0;t<R;t++){const e=l?A(M[t],I[t],D):M[t];_?(b.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(b).add(y),U(x.x,x.y,x.z)):U(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<R;e++){const n=l?A(M[e],I[e],D):M[e];_?(b.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(b).add(y),U(x.x,x.y,x.z)):U(n.x,n.y,c/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],P[t],r);U(e.x,e.y,c+n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];N=O[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);_?U(i.x,i.y+g[a-1].y,g[a-1].x+n):U(i.x,i.y,c+n)}}}function F(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=R*t,o=R*(t+1);k(e+r+n,e+i+n,e+i+o,e+r+o)}}}function U(t,e,n){o.push(t),o.push(e),o.push(n)}function B(t,e,i){z(t),z(e),z(i);const o=r.length/3,s=m.generateTopUV(n,r,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[2])}function k(t,e,i,o){z(t),z(e),z(o),z(e),z(i),z(o);const s=r.length/3,a=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function z(t){r.push(o[3*t+0]),r.push(o[3*t+1]),r.push(o[3*t+2])}function H(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(l){let t=0,e=R*t;for(let t=0;t<L;t++){const n=S[t];B(n[2]+e,n[1]+e,n[0]+e)}t=a+2*p,e=R*t;for(let t=0;t<L;t++){const n=S[t];B(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<L;t++){const e=S[t];B(e[2],e[1],e[0])}for(let t=0;t<L;t++){const e=S[t];B(e[0]+R*a,e[1]+R*a,e[2]+R*a)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;F(T,e),e+=T.length;for(let t=0,n=E.length;t<n;t++){const n=E[t];F(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new Fg(r,3)),this.setAttribute("uv",new Fg(i,2)),this.computeVertexNormals()}toJSON(){const t=Zg.prototype.toJSON.call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}}const E_={generateTopUV:function(t,e,n,r,i){const o=e[3*n],s=e[3*n+1],a=e[3*r],c=e[3*r+1],l=e[3*i],u=e[3*i+1];return[new Gf(o,s),new Gf(a,c),new Gf(l,u)]},generateSideWallUV:function(t,e,n,r,i,o){const s=e[3*n],a=e[3*n+1],c=e[3*n+2],l=e[3*r],u=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(a-u)<.01?[new Gf(s,1-c),new Gf(l,1-h),new Gf(d,1-f),new Gf(m,1-v)]:[new Gf(a,1-c),new Gf(u,1-h),new Gf(p,1-f),new Gf(g,1-v)]}};class S_ extends Yx{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new M_(t,e)),this.mergeVertices()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}}function T_(t,e,n){Zg.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],i=[],o=[],s=[],a=1e-5,c=new Qf,l=new Qf,u=new Qf,h=new Qf,d=new Qf;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=e;n++){const r=n/e;t(r,p,l),i.push(l.x,l.y,l.z),r-a>=0?(t(r-a,p,u),h.subVectors(l,u)):(t(r+a,p,u),h.subVectors(u,l)),p-a>=0?(t(r,p-a,u),d.subVectors(l,u)):(t(r,p+a,u),d.subVectors(u,l)),c.crossVectors(h,d).normalize(),o.push(c.x,c.y,c.z),s.push(r,p)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*p+n,i=t*p+n+1,o=(t+1)*p+n+1,s=(t+1)*p+n;r.push(e,i,s),r.push(i,o,s)}this.setIndex(r),this.setAttribute("position",new Fg(i,3)),this.setAttribute("normal",new Fg(o,3)),this.setAttribute("uv",new Fg(s,2))}function A_(t,e,n){Yx.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new T_(t,e,n)),this.mergeVertices()}T_.prototype=Object.create(Zg.prototype),T_.prototype.constructor=T_,A_.prototype=Object.create(Yx.prototype),A_.prototype.constructor=A_;class R_ extends Zg{constructor(t,e=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(t))c(t);else for(let e=0;e<t.length;e++)c(t[e]),this.addGroup(s,a,e),s+=a,a=0;function c(t){const s=r.length/3,c=t.extractPoints(e);let l=c.shape;const u=c.holes;!1===x_.isClockWise(l)&&(l=l.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===x_.isClockWise(e)&&(u[t]=e.reverse())}const h=x_.triangulateShape(l,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];r.push(e.x,e.y,0),i.push(0,0,1),o.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],r=e[0]+s,i=e[1]+s,o=e[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Fg(r,3)),this.setAttribute("normal",new Fg(i,3)),this.setAttribute("uv",new Fg(o,2))}toJSON(){const t=Zg.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}class L_ extends Yx{constructor(t,e){super(),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new R_(t,e)),this.mergeVertices()}toJSON(){const t=Yx.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}function C_(t){Mg.call(this),this.type="ShadowMaterial",this.color=new xg(0),this.transparent=!0,this.setValues(t)}function P_(t){xv.call(this,t),this.type="RawShaderMaterial"}function O_(t){Mg.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new xg(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xg(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gf(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function N_(t){O_.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Gf(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Hf.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function I_(t){Mg.call(this),this.type="MeshPhongMaterial",this.color=new xg(16777215),this.specular=new xg(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xg(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gf(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function D_(t){Mg.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new xg(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xg(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gf(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function F_(t){Mg.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gf(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function U_(t){Mg.call(this),this.type="MeshLambertMaterial",this.color=new xg(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xg(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function B_(t){Mg.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new xg(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gf(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function k_(t){wx.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}C_.prototype=Object.create(Mg.prototype),C_.prototype.constructor=C_,C_.prototype.isShadowMaterial=!0,C_.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this},P_.prototype=Object.create(xv.prototype),P_.prototype.constructor=P_,P_.prototype.isRawShaderMaterial=!0,O_.prototype=Object.create(Mg.prototype),O_.prototype.constructor=O_,O_.prototype.isMeshStandardMaterial=!0,O_.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},N_.prototype=Object.create(O_.prototype),N_.prototype.constructor=N_,N_.prototype.isMeshPhysicalMaterial=!0,N_.prototype.copy=function(t){return O_.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new xg).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},I_.prototype=Object.create(Mg.prototype),I_.prototype.constructor=I_,I_.prototype.isMeshPhongMaterial=!0,I_.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},D_.prototype=Object.create(Mg.prototype),D_.prototype.constructor=D_,D_.prototype.isMeshToonMaterial=!0,D_.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},F_.prototype=Object.create(Mg.prototype),F_.prototype.constructor=F_,F_.prototype.isMeshNormalMaterial=!0,F_.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},U_.prototype=Object.create(Mg.prototype),U_.prototype.constructor=U_,U_.prototype.isMeshLambertMaterial=!0,U_.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},B_.prototype=Object.create(Mg.prototype),B_.prototype.constructor=B_,B_.prototype.isMeshMatcapMaterial=!0,B_.prototype.copy=function(t){return Mg.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},k_.prototype=Object.create(wx.prototype),k_.prototype.constructor=k_,k_.prototype.isLineDashedMaterial=!0,k_.prototype.copy=function(t){return wx.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var z_=Object.freeze({__proto__:null,ShadowMaterial:C_,SpriteMaterial:Gb,RawShaderMaterial:P_,ShaderMaterial:xv,PointsMaterial:Nx,MeshPhysicalMaterial:N_,MeshStandardMaterial:O_,MeshPhongMaterial:I_,MeshToonMaterial:D_,MeshNormalMaterial:F_,MeshLambertMaterial:U_,MeshDepthMaterial:Sb,MeshDistanceMaterial:Tb,MeshBasicMaterial:Eg,MeshMatcapMaterial:B_,LineDashedMaterial:k_,LineBasicMaterial:wx,Material:Mg});const H_={arraySlice:function(t,e,n){return H_.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*e;for(let n=0;n!==e;++n)i[s++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,o=t[0];for(;void 0!==o&&void 0===o[r];)o=t[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(e.push(o.time),n.push.apply(n,s)),o=t[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(e.push(o.time),s.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(e.push(o.time),n.push(s)),o=t[i++]}while(void 0!==o)},subclip:function(t,e,n,r,i=30){const o=t.clone();o.name=e;const s=[];for(let t=0;t<o.tracks.length;++t){const e=o.tracks[t],a=e.getValueSize(),c=[],l=[];for(let t=0;t<e.times.length;++t){const o=e.times[t]*i;if(!(o<n||o>=r)){c.push(e.times[t]);for(let n=0;n<a;++n)l.push(e.values[t*a+n])}}0!==c.length&&(e.times=H_.convertArray(c,e.times.constructor),e.values=H_.convertArray(l,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let t=0;t<o.tracks.length;++t)a>o.tracks[t].times[0]&&(a=o.tracks[t].times[0]);for(let t=0;t<o.tracks.length;++t)o.tracks[t].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,o=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const s=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===s)continue;let a=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const h=r.times.length-1;let d;if(o<=r.times[0]){const t=a,e=c-a;d=H_.arraySlice(r.values,t,e)}else if(o>=r.times[h]){const t=h*c+a,e=t+c-a;d=H_.arraySlice(r.values,t,e)}else{const t=r.createInterpolant(),e=a,n=c-a;t.evaluate(o),d=H_.arraySlice(t.resultBuffer,e,n)}if("quaternion"===i){(new Kf).fromArray(d).normalize().conjugate().toArray(d)}const p=s.times.length;for(let t=0;t<p;++t){const e=t*u+l;if("quaternion"===i)Kf.multiplyQuaternionsFlat(s.values,e,d,0,s.values,e);else{const t=u-2*l;for(let n=0;n<t;++n)s.values[e+n]-=d[n]}}}return t.blendMode=2501,t}};function G_(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function j_(t,e,n,r){G_.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function V_(t,e,n,r){G_.call(this,t,e,n,r)}function W_(t,e,n,r){G_.call(this,t,e,n,r)}function q_(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=H_.convertArray(e,this.TimeBufferType),this.values=H_.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function X_(t,e,n){q_.call(this,t,e,n)}function Y_(t,e,n,r){q_.call(this,t,e,n,r)}function Z_(t,e,n,r){q_.call(this,t,e,n,r)}function J_(t,e,n,r){G_.call(this,t,e,n,r)}function $_(t,e,n,r){q_.call(this,t,e,n,r)}function K_(t,e,n,r){q_.call(this,t,e,n,r)}function Q_(t,e,n,r){q_.call(this,t,e,n,r)}function tw(t,e=-1,n,r=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=Hf.generateUUID(),this.duration<0&&this.resetDuration()}function ew(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Z_;case"vector":case"vector2":case"vector3":case"vector4":return Q_;case"color":return Y_;case"quaternion":return $_;case"bool":case"boolean":return X_;case"string":return K_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];H_.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(G_.prototype,{evaluate:function(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let o;n:{r:if(!(t<r)){for(let o=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,r=e[++n],t<r)break e}o=e.length;break n}if(t>=i)break t;{const s=e[1];t<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break e}o=n,n=0}}for(;n<o;){const r=n+o>>>1;t<e[r]?o=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(G_.prototype,{beforeStart_:G_.prototype.copySampleValue_,afterEnd_:G_.prototype.copySampleValue_}),j_.prototype=Object.assign(Object.create(G_.prototype),{constructor:j_,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,n){const r=this.parameterPositions;let i=t-2,o=t+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:i=t,s=2*e-n;break;case 2402:i=r.length-2,s=e+r[i]-r[i+1];break;default:i=t,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=t,a=2*n-e;break;case 2402:o=1,a=n+r[1]-r[0];break;default:o=t-1,a=e}const c=.5*(n-e),l=this.valueSize;this._weightPrev=c/(e-s),this._weightNext=c/(a-n),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let t=0;t!==s;++t)i[t]=g*o[l+t]+v*o[c+t]+y*o[a+t]+b*o[u+t];return i}}),V_.prototype=Object.assign(Object.create(G_.prototype),{constructor:V_,interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=(n-e)/(r-e),u=1-l;for(let t=0;t!==s;++t)i[t]=o[c+t]*u+o[a+t]*l;return i}}),W_.prototype=Object.assign(Object.create(G_.prototype),{constructor:W_,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(q_,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:H_.convertArray(t.times,Array),values:H_.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(q_.prototype,{constructor:q_,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new W_(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new V_(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new j_(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const t=this.getValueSize();this.times=H_.arraySlice(n,i,o),this.values=H_.arraySlice(this.values,i*t,o*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,o),t=!1;break}o=r}if(void 0!==r&&H_.isTypedArray(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t},optimize:function(){const t=H_.arraySlice(this.times),e=H_.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),i=t.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=t[s];if(a!==t[s+1]&&(1!==s||a!==a[0]))if(r)i=!0;else{const t=s*n,r=t-n,o=t+n;for(let s=0;s!==n;++s){const n=e[t+s];if(n!==e[r+s]||n!==e[o+s]){i=!0;break}}}if(i){if(s!==o){t[o]=t[s];const r=s*n,i=o*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++o}}if(i>0){t[o]=t[i];for(let t=i*n,r=o*n,s=0;s!==n;++s)e[r+s]=e[t+s];++o}return o!==t.length?(this.times=H_.arraySlice(t,0,o),this.values=H_.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this},clone:function(){const t=H_.arraySlice(this.times,0),e=H_.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),X_.prototype=Object.assign(Object.create(q_.prototype),{constructor:X_,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Y_.prototype=Object.assign(Object.create(q_.prototype),{constructor:Y_,ValueTypeName:"color"}),Z_.prototype=Object.assign(Object.create(q_.prototype),{constructor:Z_,ValueTypeName:"number"}),J_.prototype=Object.assign(Object.create(G_.prototype),{constructor:J_,interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-e)/(r-e);let c=t*s;for(let t=c+s;c!==t;c+=4)Kf.slerpFlat(i,0,o,c-s,o,c,a);return i}}),$_.prototype=Object.assign(Object.create(q_.prototype),{constructor:$_,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new J_(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),K_.prototype=Object.assign(Object.create(q_.prototype),{constructor:K_,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Q_.prototype=Object.assign(Object.create(q_.prototype),{constructor:Q_,ValueTypeName:"vector"}),Object.assign(tw,{parse:function(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(ew(n[t]).scale(r));const i=new tw(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i},toJSON:function(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(q_.toJSON(n[t]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){const i=e.length,o=[];for(let t=0;t<i;t++){let s=[],a=[];s.push((t+i-1)%i,t,(t+1)%i),a.push(0,1,0);const c=H_.getKeyframeOrder(s);s=H_.sortedArray(s,1,c),a=H_.sortedArray(a,1,c),r||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new Z_(".morphTargetInfluences["+e[t].name+"]",s,a).scale(1/n))}return new tw(t,-1,o)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],o=n.name.match(i);if(o&&o.length>1){const t=o[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const o=[];for(const t in r)o.push(tw.CreateFromMorphTargetSequence(t,r[t],e,n));return o},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const o=[],s=[];H_.flattenJSON(n,o,s,r),0!==o.length&&i.push(new t(e,o,s))}},r=[],i=t.name||"default",o=t.fps||30,s=t.blendMode;let a=t.length||-1;const c=t.hierarchy||[];for(let t=0;t<c.length;t++){const i=c[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],o=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new Z_(".morphTargetInfluence["+n+"]",t,o))}a=t.length*(o||1)}else{const o=".bones["+e[t].name+"]";n(Q_,o+".position",i,"pos",r),n($_,o+".quaternion",i,"rot",r),n(Q_,o+".scale",i,"scl",r)}}if(0===r.length)return null;return new tw(i,a,r,s)}}),Object.assign(tw.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new tw(this.name,this.duration,t,this.blendMode)},toJSON:function(){return tw.toJSON(this)}});const nw={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function rw(t,e,n){const r=this;let i=!1,o=0,s=0,a=void 0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,s),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,s),o===s&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=c.length;e<n;e+=2){const n=c[e],r=c[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}const iw=new rw;function ow(t){this.manager=void 0!==t?t:iw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(ow.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const sw={};function aw(t){ow.call(this,t)}function cw(t){ow.call(this,t)}function lw(t){ow.call(this,t)}function uw(t){ow.call(this,t)}function hw(t){ow.call(this,t)}function dw(t){ow.call(this,t)}function pw(t){ow.call(this,t)}function fw(){this.type="Curve",this.arcLengthDivisions=200}function mw(t,e,n,r,i,o,s,a){fw.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function gw(t,e,n,r,i,o){mw.call(this,t,e,n,n,r,i,o),this.type="ArcCurve"}function vw(){let t=0,e=0,n=0,r=0;function i(i,o,s,a){t=i,e=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,s,a){let c=(e-t)/o-(n-t)/(o+s)+(n-e)/s,l=(n-e)/s-(r-e)/(s+a)+(r-n)/a;c*=s,l*=s,i(e,n,c,l)},calc:function(i){const o=i*i;return t+e*i+n*o+r*(o*i)}}}aw.prototype=Object.assign(Object.create(ow.prototype),{constructor:aw,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=nw.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0!==sw[t])return void sw[t].push({onLoad:e,onProgress:n,onError:r});const s=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);r="blob"===o?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;r=e.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){e&&e(r),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{sw[t]=[],sw[t].push({onLoad:e,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const n=this.response,r=sw[t];if(delete sw[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),nw.add(t,n);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onLoad&&e.onLoad(n)}i.manager.itemEnd(t)}else{for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const n=sw[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onProgress&&r.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const n=sw[t];delete sw[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const n=sw[t];delete sw[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return i.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),cw.prototype=Object.assign(Object.create(ow.prototype),{constructor:cw,load:function(t,e,n,r){const i=this,o=new aw(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const r=tw.parse(t[n]);e.push(r)}return e}}),lw.prototype=Object.assign(Object.create(ow.prototype),{constructor:lw,load:function(t,e,n,r){const i=this,o=[],s=new Hx,a=new aw(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let c=0;function l(l){a.load(t[l],(function(t){const n=i.parse(t,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(s.minFilter=1006),s.image=o,s.format=n.format,s.needsUpdate=!0,e&&e(s))}),n,r)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)l(e);else a.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){o[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)o[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),o[e].format=n.format,o[e].width=n.width,o[e].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=1006),s.format=n.format,s.needsUpdate=!0,e&&e(s)}),n,r);return s}}),uw.prototype=Object.assign(Object.create(ow.prototype),{constructor:uw,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=nw.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),nw.add(t,this),e&&e(this),i.manager.itemEnd(t)}function c(e){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(t),s.src=t,s}}),hw.prototype=Object.assign(Object.create(ow.prototype),{constructor:hw,load:function(t,e,n,r){const i=new Ev,o=new uw(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(t[n],(function(t){i.images[n]=t,s++,6===s&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return i}}),dw.prototype=Object.assign(Object.create(ow.prototype),{constructor:dw,load:function(t,e,n,r){const i=this,o=new Tv,s=new aw(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(t,(function(t){const n=i.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:1001,o.wrapT=void 0!==n.wrapT?n.wrapT:1001,o.magFilter=void 0!==n.magFilter?n.magFilter:1006,o.minFilter=void 0!==n.minFilter?n.minFilter:1006,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=1008),1===n.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,e&&e(o,n))}),n,r),o}}),pw.prototype=Object.assign(Object.create(ow.prototype),{constructor:pw,load:function(t,e,n,r){const i=new Xf,o=new uw(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(n){i.image=n;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?1022:1023,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}),Object.assign(fw.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let r=0;const i=n.length;let o;o=e||t*n[i-1];let s,a=0,c=i-1;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(r=c,n[r]===o)return r/(i-1);const l=n[r];return(r+(o-l)/(n[r+1]-l))/(i-1)},getTangent:function(t,e){let n=t-1e-4,r=t+1e-4;n<0&&(n=0),r>1&&(r=1);const i=this.getPoint(n),o=this.getPoint(r),s=e||(i.isVector2?new Gf:new Qf);return s.copy(o).sub(i).normalize(),s},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Qf,r=[],i=[],o=[],s=new Qf,a=new Am;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new Qf),r[e].normalize()}i[0]=new Qf,o[0]=new Qf;let c=Number.MAX_VALUE;const l=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),h<=c&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),o[e]=o[e-1].clone(),s.crossVectors(r[e-1],r[e]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(Hf.clamp(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(s,t))}o[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Hf.clamp(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(s.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),mw.prototype=Object.create(fw.prototype),mw.prototype.constructor=mw,mw.prototype.isEllipseCurve=!0,mw.prototype.getPoint=function(t,e){const n=e||new Gf,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=c-this.aY;a=n*t-r*e+this.aX,c=n*e+r*t+this.aY}return n.set(a,c)},mw.prototype.copy=function(t){return fw.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},mw.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},mw.prototype.fromJSON=function(t){return fw.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},gw.prototype=Object.create(mw.prototype),gw.prototype.constructor=gw,gw.prototype.isArcCurve=!0;const yw=new Qf,bw=new vw,xw=new vw,_w=new vw;function ww(t=[],e=!1,n="centripetal",r=.5){fw.call(this),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}function Mw(t,e,n,r,i){const o=.5*(r-e),s=.5*(i-n),a=t*t;return(2*n-2*r+o+s)*(t*a)+(-3*n+3*r-2*o-s)*a+o*t+n}function Ew(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function Sw(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}function Tw(t=new Gf,e=new Gf,n=new Gf,r=new Gf){fw.call(this),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function Aw(t=new Qf,e=new Qf,n=new Qf,r=new Qf){fw.call(this),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function Rw(t=new Gf,e=new Gf){fw.call(this),this.type="LineCurve",this.v1=t,this.v2=e}function Lw(t=new Qf,e=new Qf){fw.call(this),this.type="LineCurve3",this.v1=t,this.v2=e}function Cw(t=new Gf,e=new Gf,n=new Gf){fw.call(this),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}function Pw(t=new Qf,e=new Qf,n=new Qf){fw.call(this),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}function Ow(t=[]){fw.call(this),this.type="SplineCurve",this.points=t}ww.prototype=Object.create(fw.prototype),ww.prototype.constructor=ww,ww.prototype.isCatmullRomCurve3=!0,ww.prototype.getPoint=function(t,e=new Qf){const n=e,r=this.points,i=r.length,o=(i-(this.closed?0:1))*t;let s,a,c=Math.floor(o),l=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:0===l&&c===i-1&&(c=i-2,l=1),this.closed||c>0?s=r[(c-1)%i]:(yw.subVectors(r[0],r[1]).add(r[0]),s=yw);const u=r[c%i],h=r[(c+1)%i];if(this.closed||c+2<i?a=r[(c+2)%i]:(yw.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=yw),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),bw.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,e,n,r),xw.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,e,n,r),_w.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(bw.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),xw.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),_w.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return n.set(bw.calc(l),xw.calc(l),_w.calc(l)),n},ww.prototype.copy=function(t){fw.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},ww.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},ww.prototype.fromJSON=function(t){fw.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Qf).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Tw.prototype=Object.create(fw.prototype),Tw.prototype.constructor=Tw,Tw.prototype.isCubicBezierCurve=!0,Tw.prototype.getPoint=function(t,e=new Gf){const n=e,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Sw(t,r.x,i.x,o.x,s.x),Sw(t,r.y,i.y,o.y,s.y)),n},Tw.prototype.copy=function(t){return fw.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Tw.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Tw.prototype.fromJSON=function(t){return fw.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Aw.prototype=Object.create(fw.prototype),Aw.prototype.constructor=Aw,Aw.prototype.isCubicBezierCurve3=!0,Aw.prototype.getPoint=function(t,e=new Qf){const n=e,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Sw(t,r.x,i.x,o.x,s.x),Sw(t,r.y,i.y,o.y,s.y),Sw(t,r.z,i.z,o.z,s.z)),n},Aw.prototype.copy=function(t){return fw.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Aw.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Aw.prototype.fromJSON=function(t){return fw.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Rw.prototype=Object.create(fw.prototype),Rw.prototype.constructor=Rw,Rw.prototype.isLineCurve=!0,Rw.prototype.getPoint=function(t,e=new Gf){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Rw.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Rw.prototype.getTangent=function(t,e){const n=e||new Gf;return n.copy(this.v2).sub(this.v1).normalize(),n},Rw.prototype.copy=function(t){return fw.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Rw.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Rw.prototype.fromJSON=function(t){return fw.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Lw.prototype=Object.create(fw.prototype),Lw.prototype.constructor=Lw,Lw.prototype.isLineCurve3=!0,Lw.prototype.getPoint=function(t,e=new Qf){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Lw.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Lw.prototype.copy=function(t){return fw.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Lw.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Lw.prototype.fromJSON=function(t){return fw.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Cw.prototype=Object.create(fw.prototype),Cw.prototype.constructor=Cw,Cw.prototype.isQuadraticBezierCurve=!0,Cw.prototype.getPoint=function(t,e=new Gf){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Ew(t,r.x,i.x,o.x),Ew(t,r.y,i.y,o.y)),n},Cw.prototype.copy=function(t){return fw.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Cw.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Cw.prototype.fromJSON=function(t){return fw.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Pw.prototype=Object.create(fw.prototype),Pw.prototype.constructor=Pw,Pw.prototype.isQuadraticBezierCurve3=!0,Pw.prototype.getPoint=function(t,e=new Qf){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Ew(t,r.x,i.x,o.x),Ew(t,r.y,i.y,o.y),Ew(t,r.z,i.z,o.z)),n},Pw.prototype.copy=function(t){return fw.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Pw.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Pw.prototype.fromJSON=function(t){return fw.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ow.prototype=Object.create(fw.prototype),Ow.prototype.constructor=Ow,Ow.prototype.isSplineCurve=!0,Ow.prototype.getPoint=function(t,e=new Gf){const n=e,r=this.points,i=(r.length-1)*t,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],c=r[o],l=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(Mw(s,a.x,c.x,l.x,u.x),Mw(s,a.y,c.y,l.y,u.y)),n},Ow.prototype.copy=function(t){fw.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},Ow.prototype.toJSON=function(){const t=fw.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},Ow.prototype.fromJSON=function(t){fw.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Gf).fromArray(n))}return this};var Nw=Object.freeze({__proto__:null,ArcCurve:gw,CatmullRomCurve3:ww,CubicBezierCurve:Tw,CubicBezierCurve3:Aw,EllipseCurve:mw,LineCurve:Rw,LineCurve3:Lw,QuadraticBezierCurve:Cw,QuadraticBezierCurve3:Pw,SplineCurve:Ow});function Iw(){fw.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Dw(t){Iw.call(this),this.type="Path",this.currentPoint=new Gf,t&&this.setFromPoints(t)}function Fw(t){Dw.call(this,t),this.uuid=Hf.generateUUID(),this.type="Shape",this.holes=[]}function Uw(t,e=1){Km.call(this),this.type="Light",this.color=new xg(t),this.intensity=e}function Bw(t,e,n){Uw.call(this,t,n),this.type="HemisphereLight",this.position.copy(Km.DefaultUp),this.updateMatrix(),this.groundColor=new xg(e)}function kw(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Gf(512,512),this.map=null,this.mapPass=null,this.matrix=new Am,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Lv,this._frameExtents=new Gf(1,1),this._viewportCount=1,this._viewports=[new Zf(0,0,1,1)]}function zw(){kw.call(this,new wv(50,1,.5,500)),this.focus=1}function Hw(t,e,n,r,i,o){Uw.call(this,t,e),this.type="SpotLight",this.position.copy(Km.DefaultUp),this.updateMatrix(),this.target=new Km,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new zw}function Gw(){kw.call(this,new wv(90,1,.5,500)),this._frameExtents=new Gf(4,2),this._viewportCount=6,this._viewports=[new Zf(2,1,1,1),new Zf(0,1,1,1),new Zf(3,1,1,1),new Zf(1,1,1,1),new Zf(3,0,1,1),new Zf(1,0,1,1)],this._cubeDirections=[new Qf(1,0,0),new Qf(-1,0,0),new Qf(0,0,1),new Qf(0,0,-1),new Qf(0,1,0),new Qf(0,-1,0)],this._cubeUps=[new Qf(0,1,0),new Qf(0,1,0),new Qf(0,1,0),new Qf(0,1,0),new Qf(0,0,1),new Qf(0,0,-1)]}function jw(t,e,n,r){Uw.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Gw}function Vw(t=-1,e=1,n=1,r=-1,i=.1,o=2e3){_v.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}function Ww(){kw.call(this,new Vw(-5,5,5,-5,.5,500))}function qw(t,e){Uw.call(this,t,e),this.type="DirectionalLight",this.position.copy(Km.DefaultUp),this.updateMatrix(),this.target=new Km,this.shadow=new Ww}function Xw(t,e){Uw.call(this,t,e),this.type="AmbientLight"}function Yw(t,e,n,r){Uw.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}Iw.prototype=Object.assign(Object.create(fw.prototype),{constructor:Iw,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Rw(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=e){const t=n[r]-e,i=this.curves[r],o=i.getLength(),s=0===o?0:1-t/o;return i.getPointAt(s)}r++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s);for(let t=0;t<a.length;t++){const r=a[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){fw.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=fw.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){fw.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Nw[n.type]).fromJSON(n))}return this}}),Dw.prototype=Object.assign(Object.create(Iw.prototype),{constructor:Dw,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new Rw(this.currentPoint.clone(),new Gf(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){const i=new Cw(this.currentPoint.clone(),new Gf(t,e),new Gf(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,i,o){const s=new Tw(this.currentPoint.clone(),new Gf(t,e),new Gf(n,r),new Gf(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this},splineThru:function(t){const e=new Ow([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,e+a,n,r,i,o),this},absarc:function(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this},ellipse:function(t,e,n,r,i,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,n,r,i,o,s,a),this},absellipse:function(t,e,n,r,i,o,s,a){const c=new mw(t,e,n,r,i,o,s,a);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(t){return Iw.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=Iw.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Iw.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Fw.prototype=Object.assign(Object.create(Dw.prototype),{constructor:Fw,getPointsHoles:function(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Dw.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=Dw.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){Dw.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new Dw).fromJSON(n))}return this}}),Uw.prototype=Object.assign(Object.create(Km.prototype),{constructor:Uw,isLight:!0,copy:function(t){return Km.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=Km.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Bw.prototype=Object.assign(Object.create(Uw.prototype),{constructor:Bw,isHemisphereLight:!0,copy:function(t){return Uw.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(kw.prototype,{_projScreenMatrix:new Am,_lightPositionWorld:new Qf,_lookTarget:new Qf,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),zw.prototype=Object.assign(Object.create(kw.prototype),{constructor:zw,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*Hf.RAD2DEG*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),kw.prototype.updateMatrices.call(this,t)}}),Hw.prototype=Object.assign(Object.create(Uw.prototype),{constructor:Hw,isSpotLight:!0,copy:function(t){return Uw.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Gw.prototype=Object.assign(Object.create(kw.prototype),{constructor:Gw,isPointLightShadow:!0,updateMatrices:function(t,e=0){const n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),jw.prototype=Object.assign(Object.create(Uw.prototype),{constructor:jw,isPointLight:!0,copy:function(t){return Uw.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Vw.prototype=Object.assign(Object.create(_v.prototype),{constructor:Vw,isOrthographicCamera:!0,copy:function(t,e){return _v.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,o=n+t,s=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,o=i+t*this.view.width,s-=e*this.view.offsetY,a=s-e*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=Km.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Ww.prototype=Object.assign(Object.create(kw.prototype),{constructor:Ww,isDirectionalLightShadow:!0,updateMatrices:function(t){kw.prototype.updateMatrices.call(this,t)}}),qw.prototype=Object.assign(Object.create(Uw.prototype),{constructor:qw,isDirectionalLight:!0,copy:function(t){return Uw.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Xw.prototype=Object.assign(Object.create(Uw.prototype),{constructor:Xw,isAmbientLight:!0}),Yw.prototype=Object.assign(Object.create(Uw.prototype),{constructor:Yw,isRectAreaLight:!0,copy:function(t){return Uw.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=Uw.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});class Zw{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Qf)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}function Jw(t,e){Uw.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new Zw}function $w(t){ow.call(this,t),this.textures={}}Jw.prototype=Object.assign(Object.create(Uw.prototype),{constructor:Jw,isLightProbe:!0,copy:function(t){return Uw.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=Uw.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),$w.prototype=Object.assign(Object.create(ow.prototype),{constructor:$w,load:function(t,e,n,r){const i=this,o=new aw(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new z_[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new xg).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(r.uniforms[e]={},i.type){case"t":r.uniforms[e].value=n(i.value);break;case"c":r.uniforms[e].value=(new xg).setHex(i.value);break;case"v2":r.uniforms[e].value=(new Gf).fromArray(i.value);break;case"v3":r.uniforms[e].value=(new Qf).fromArray(i.value);break;case"v4":r.uniforms[e].value=(new Zf).fromArray(i.value);break;case"m3":r.uniforms[e].value=(new jf).fromArray(i.value);break;case"m4":r.uniforms[e].value=(new Am).fromArray(i.value);break;default:r.uniforms[e].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new Gf).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Gf).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r},setTextures:function(t){return this.textures=t,this}});const Kw=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},Qw=function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)};function tM(){Zg.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function eM(t,e,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Ag.call(this,t,e,n),this.meshPerAttribute=r||1}function nM(t){ow.call(this,t)}tM.prototype=Object.assign(Object.create(Zg.prototype),{constructor:tM,isInstancedBufferGeometry:!0,copy:function(t){return Zg.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=Zg.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),eM.prototype=Object.assign(Object.create(Ag.prototype),{constructor:eM,isInstancedBufferAttribute:!0,copy:function(t){return Ag.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=Ag.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),nM.prototype=Object.assign(Object.create(ow.prototype),{constructor:nM,load:function(t,e,n,r){const i=this,o=new aw(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const i=t.interleavedBuffers[r],o=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),s=new kb(Hg(i.type,o),i.stride);return s.uuid=i.uuid,e[r]=s,s}const i=t.isInstancedBufferGeometry?new tM:new Zg,o=t.data.index;if(void 0!==o){const t=Hg(o.type,o.array);i.setIndex(new Ag(t,1))}const s=t.data.attributes;for(const e in s){const n=s[e];let o;if(n.isInterleavedBufferAttribute){o=new Hb(r(t.data,n.data),n.itemSize,n.offset,n.normalized)}else{const t=Hg(n.type,n.array);o=new(n.isInstancedBufferAttribute?eM:Ag)(t,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),i.setAttribute(e,o)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],o=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];let s;if(i.isInterleavedBufferAttribute){s=new Hb(r(t.data,i.data),i.itemSize,i.offset,i.normalized)}else{s=new Ag(Hg(i.type,i.array),i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[e]=o}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let t=0,e=c.length;t!==e;++t){const e=c[t];i.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;if(void 0!==l){const t=new Qf;void 0!==l.center&&t.fromArray(l.center),i.boundingSphere=new ym(t,l.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}});function rM(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ow.call(this,t),this.options={premultiplyAlpha:"none"}}function iM(){this.type="ShapePath",this.color=new xg,this.subPaths=[],this.currentPath=null}function oM(t){this.type="Font",this.data=t}function sM(t,e,n,r,i){const o=i.glyphs[t]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");const s=new iM;let a,c,l,u,h,d,p,f;if(o.o){const t=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=t.length;i<o;){switch(t[i++]){case"m":a=t[i++]*e+n,c=t[i++]*e+r,s.moveTo(a,c);break;case"l":a=t[i++]*e+n,c=t[i++]*e+r,s.lineTo(a,c);break;case"q":l=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,s.quadraticCurveTo(h,d,l,u);break;case"b":l=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,p=t[i++]*e+n,f=t[i++]*e+r,s.bezierCurveTo(h,d,p,f,l,u)}}}return{offsetX:o.ha*e,path:s}}function aM(t){ow.call(this,t)}let cM;rM.prototype=Object.assign(Object.create(ow.prototype),{constructor:rM,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=nw.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,s).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,i.options)})).then((function(n){nw.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(iM.prototype,{moveTo:function(t,e){return this.currentPath=new Dw,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new Fw;i.curves=r.curves,e.push(i)}return e}function r(t,e){const n=e.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=e[i],s=e[o],a=s.x-n.x,c=s.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=e[o],a=-a,s=e[i],c=-c),t.y<n.y||t.y>s.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=c*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(s.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=s.x)return!0}}return r}const i=x_.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);let s,a,c;const l=[];if(1===o.length)return a=o[0],c=new Fw,c.curves=a.curves,l.push(c),l;let u=!i(o[0].getPoints());u=t?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,n=o.length;e<n;e++)a=o[e],p=a.getPoints(),s=i(p),s=t?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new Fw,p:p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)h[t]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<d.length;i++)r(s.p,d[i].p)&&(n!==i&&e.push({froms:n,tos:i,hole:o}),a?(a=!1,h[i].push(s)):t=!0);a&&h[n].push(s)}}e.length>0&&(t||(m=h))}for(let t=0,e=d.length;t<e;t++){c=d[t].s,l.push(c),f=m[t];for(let t=0,e=f.length;t<e;t++)c.holes.push(f[t].h)}return l}}),Object.assign(oM.prototype,{isFont:!0,generateShapes:function(t,e=100){const n=[],r=function(t,e,n){const r=Array.from?Array.from(t):String(t).split(""),i=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[];let a=0,c=0;for(let t=0;t<r.length;t++){const e=r[t];if("\n"===e)a=0,c-=o;else{const t=sM(e,i,a,c,n);a+=t.offsetX,s.push(t.path)}}return s}(t,e,this.data);for(let t=0,e=r.length;t<e;t++)Array.prototype.push.apply(n,r[t].toShapes());return n}}),aM.prototype=Object.assign(Object.create(ow.prototype),{constructor:aM,load:function(t,e,n,r){const i=this,o=new aw(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const r=i.parse(n);e&&e(r)}),n,r)},parse:function(t){return new oM(t)}});const lM=function(){return void 0===cM&&(cM=new(window.AudioContext||window.webkitAudioContext)),cM};function uM(t){ow.call(this,t)}function hM(t,e,n){Jw.call(this,void 0,n);const r=(new xg).set(t),i=(new xg).set(e),o=new Qf(r.r,r.g,r.b),s=new Qf(i.r,i.g,i.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}function dM(t,e){Jw.call(this,void 0,e);const n=(new xg).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}uM.prototype=Object.assign(Object.create(ow.prototype),{constructor:uM,load:function(t,e,n,r){const i=this,o=new aw(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{const t=n.slice(0);lM().decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}}),hM.prototype=Object.assign(Object.create(Jw.prototype),{constructor:hM,isHemisphereLightProbe:!0,copy:function(t){return Jw.prototype.copy.call(this,t),this},toJSON:function(t){return Jw.prototype.toJSON.call(this,t)}}),dM.prototype=Object.assign(Object.create(Jw.prototype),{constructor:dM,isAmbientLightProbe:!0,copy:function(t){return Jw.prototype.copy.call(this,t),this},toJSON:function(t){return Jw.prototype.toJSON.call(this,t)}});const pM=new Am,fM=new Am;Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new wv,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new wv,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,o=e.near*Math.tan(Hf.DEG2RAD*e.fov*.5)/e.zoom;let s,a;fM.elements[12]=-r,pM.elements[12]=r,s=-o*e.aspect+i,a=o*e.aspect+i,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*e.aspect-i,a=o*e.aspect-i,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(fM),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(pM)}});class mM extends Km{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}function gM(t,e,n){let r,i,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(gM.prototype,{accumulate:function(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==r;++t)n[i+t]=n[t];o=e}else{o+=e;const t=e/o;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=o},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){s.setValue(n,r);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]},_slerp:function(t,e,n,r){Kf.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,i){const o=this._workIndex*i;Kf.multiplyQuaternionsFlat(t,o,t,e,t,n),Kf.slerpFlat(t,e,t,e,t,o,r)},_lerp:function(t,e,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=e+s;t[i]=t[i]*o+t[n+s]*r}},_lerpAdditive:function(t,e,n,r,i){for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]+t[n+o]*r}}});const vM=new RegExp("[\\[\\]\\.:\\/]","g"),yM="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",bM=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),xM=/(WCOD+)?/.source.replace("WCOD",yM),_M=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),wM=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),MM=new RegExp("^"+bM+xM+_M+wM+"$"),EM=["material","materials","bones"];function SM(t,e,n){const r=n||TM.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function TM(t,e,n){this.path=e,this.parsedPath=n||TM.parseTrackName(e),this.node=TM.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(SM.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(TM,{Composite:SM,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new TM.Composite(t,e,n):new TM(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(vM,"")},parseTrackName:function(t){const e=MM.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==EM.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const o=n(i.children);if(o)return o}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(TM.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=TM.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const o=t[r];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let s=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(TM.prototype,{_getValue_unbound:TM.prototype.getValue,_setValue_unbound:TM.prototype.setValue}),Object.assign(function(){this.uuid=Hf.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s=void 0,a=t.length,c=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const u=arguments[l],h=u.uuid;let d=e[h];if(void 0===d){d=a++,e[h]=d,t.push(u);for(let t=0,e=o;t!==e;++t)i[t].push(new TM(u,n[t],r[t]))}else if(d<c){s=t[d];const a=--c,l=t[a];e[l.uuid]=d,t[d]=l,e[h]=a,t[a]=u;for(let t=0,e=o;t!==e;++t){const e=i[t],o=e[a];let s=e[d];e[d]=o,void 0===s&&(s=new TM(u,n[t],r[t])),e[a]=s}}else t[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=e[a];if(void 0!==c&&c>=i){const o=i++,l=t[o];e[l.uuid]=c,t[c]=l,e[a]=o,t[o]=s;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[c];e[c]=r,e[o]=i}}}this.nCachedObjects_=i},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=t.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=e[a];if(void 0!==c)if(delete e[a],c<i){const s=--i,a=t[s],l=--o,u=t[l];e[a.uuid]=c,t[c]=a,e[u.uuid]=s,t[s]=u,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[s],i=e[l];e[c]=r,e[s]=i,e.pop()}}else{const i=--o,s=t[i];i>0&&(e[s.uuid]=c),t[c]=s,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[c]=e[i],e.pop()}}}this.nCachedObjects_=i},subscribe_:function(t,e){const n=this._bindingsIndicesByPath;let r=n[t];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,u=new Array(c);r=i.length,n[t]=r,o.push(t),s.push(e),i.push(u);for(let n=l,r=a.length;n!==r;++n){const r=a[n];u[n]=new TM(r,t,e)}return u},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];e[t[s]]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}});class AM{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,o=i.length,s=new Array(o),a={endingStart:2400,endingEnd:2400};for(let t=0;t!==o;++t){const e=i[t].createInterpolant(null);s[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,o=n/r;t.warp(1,i,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+n,c[0]=t/o,c[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const o=this._updateTime(e),s=this._updateWeight(t);if(s>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case 2501:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulateAdditive(s);break;case 2500:default:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulate(r,s)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const o=2202===n;if(0===t)return-1===i?r:o&&1==(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=e,s[1]=i+t,a[1]=n,this}}function RM(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}RM.prototype=Object.assign(Object.create(Bf.prototype),{constructor:RM,_bindAction:function(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,s=t._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let t=0;t!==i;++t){const i=r[t],c=i.name;let u=l[c];if(void 0!==u)o[t]=u;else{if(u=o[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,c));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;u=new gM(TM.create(n,c,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,c),o[t]=u}s[t].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const r=this._actions,i=this._actionsByClip;let o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,c=a[a.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),t._byClipCacheIndex=null;delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new V_(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const r=e||this._root,i=r.uuid;let o="string"==typeof t?tw.findByName(r,t):t;const s=null!==o?o.uuid:t,a=this._actionsByClip[s];let c=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==a){const t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const l=new AM(this,o,e,n);return this._bindAction(l,c),this._addInactiveAction(l,s,i),l},existingAction:function(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?tw.findByName(n,t):t,o=i?i.uuid:t,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1;for(let s=0;s!==n;++s){e[s]._update(r,t,i,o)}const s=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)s[t].apply(o);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,o=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,e[i]=o,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class LM{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new LM(void 0===this.value.clone?this.value:this.value.clone())}}function CM(t,e,n){kb.call(this,t,e),this.meshPerAttribute=n||1}function PM(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function OM(t,e,n,r){this.ray=new Tm(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new Bm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function NM(t,e){return t.distance-e.distance}function IM(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)IM(r[t],e,n,!0)}}CM.prototype=Object.assign(Object.create(kb.prototype),{constructor:CM,isInstancedInterleavedBuffer:!0,copy:function(t){return kb.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=kb.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=kb.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(PM.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(PM.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(OM.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(t,e,n){const r=n||[];return IM(t,this,r,e),r.sort(NM),r},intersectObjects:function(t,e,n){const r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=t.length;n<i;n++)IM(t[n],this,r,e);return r.sort(NM),r}});class DM{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Hf.clamp(e/this.radius,-1,1))),this}}const FM=new Gf;const UM=new Qf,BM=new Qf;function kM(t){Km.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}kM.prototype=Object.create(Km.prototype),kM.prototype.constructor=kM,kM.prototype.isImmediateRenderObject=!0;const zM=new Qf,HM=new Am,GM=new Am;const jM=new Float32Array(1),VM=(new Int32Array(jM.buffer),Math.pow(2,8),[.125,.215,.35,.446,.526,.582]),WM=5+VM.length,{_lodPlanes:qM,_sizeLods:XM,_sigmas:YM}=ZM();Math.sqrt(5);function ZM(){const t=[],e=[],n=[];let r=8;for(let i=0;i<WM;i++){const o=Math.pow(2,r);e.push(o);let s=1/o;i>4?s=VM[i-8+4-1]:0==i&&(s=0),n.push(s);const a=1/(o-1),c=-a/2,l=1+a/2,u=[c,c,l,c,l,l,c,c,l,l,c,l],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(r,p*d*t),v.set(u,f*d*t);const i=[t,t,t,t,t,t];y.set(i,m*d*t)}const b=new Zg;b.setAttribute("position",new Ag(g,p)),b.setAttribute("uv",new Ag(v,f)),b.setAttribute("faceIndex",new Ag(y,m)),t.push(b),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function JM(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ww.call(this,t),this.type="catmullrom"}fw.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(fw.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(Iw.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new Yx;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.vertices.push(new Qf(r.x,r.y,r.z||0))}return e}}),Object.assign(Dw.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Object.create(ww.prototype),Object.create(ww.prototype),JM.prototype=Object.create(ww.prototype),Object.assign(JM.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),class extends Px{constructor(t=10,e=10,n=4473924,r=8947848){n=new xg(n),r=new xg(r);const i=e/2,o=t/e,s=t/2,a=[],c=[];for(let t=0,l=0,u=-s;t<=e;t++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const e=t===i?n:r;e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3}const l=new Zg;l.setAttribute("position",new Fg(a,3)),l.setAttribute("color",new Fg(c,3));super(l,new wx({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Px{constructor(t){const e=function t(e){const n=[];e&&e.isBone&&n.push(e);for(let r=0;r<e.children.length;r++)n.push.apply(n,t(e.children[r]));return n}(t),n=new Zg,r=[],i=[],o=new xg(0,0,1),s=new xg(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new Fg(r,3)),n.setAttribute("color",new Fg(i,3));super(n,new wx({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");GM.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(HM.multiplyMatrices(GM,i.matrixWorld),zM.setFromMatrixPosition(HM),r.setXYZ(n,zM.x,zM.y,zM.z),HM.multiplyMatrices(GM,i.parent.matrixWorld),zM.setFromMatrixPosition(HM),r.setXYZ(n+1,zM.x,zM.y,zM.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ow.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Qw(t)}}),ow.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(class{constructor(t,e){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Gf(1/0,1/0),this.max=void 0!==e?e:new Gf(-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=FM.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Gf),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Gf),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Gf),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Gf),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return FM.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(nm.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(ym.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Lv.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},class{constructor(t,e){this.start=void 0!==t?t:new Qf,this.end=void 0!==e?e:new Qf}set(t,e){return this.start.copy(t),this.end.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Qf),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Qf),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Qf),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){UM.subVectors(t,this.start),BM.subVectors(this.end,this.start);const n=BM.dot(BM);let r=BM.dot(UM)/n;return e&&(r=Hf.clamp(r,0,1)),r}closestPointToPoint(t,e,n){const r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Qf),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Hf,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Hf.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Hf.ceilPowerOfTwo(t)}}),Object.assign(jf.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(Am.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Qf).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),ng.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Object.assign(Kf.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(Tm.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(pg.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(pg,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pg.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pg.getNormal(t,e,n,r)}}),Object.assign(Fw.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new S_(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new L_(this,t)}}),Object.assign(Gf.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Qf.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Zf.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Yx.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(Km.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Km.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(pv.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(pv.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(sx.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(gx.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),dx.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(fw.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),wv.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Uw.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Ag.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(Ag.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Zg.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Ag(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Zg.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(tM.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(OM.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(kb.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(kb.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(M_.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Bb.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(LM.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Mg.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new xg}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(I_.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(N_.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(xv.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Fb.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Fb.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Ab.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Jf.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(mM.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new uM).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),class{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Mv.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Mv.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)};Wf.crossOrigin=void 0,Wf.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new pw;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},Wf.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new hw;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},Wf.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Wf.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"124"}}));var $M=function(t){ow.call(this,t),this.propertyNameMapping={}};$M.prototype=Object.assign(Object.create(ow.prototype),{constructor:$M,load:function(t,e,n,r){var i=this,o=new aw(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(i.parse(n))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},setPropertyNameMapping:function(t){this.propertyNameMapping=t},parse:function(t){function e(t){var e="",n=0,r=/ply([\s\S]*)end_header\r?\n/.exec(t);null!==r&&(e=r[1],n=new Blob([r[0]]).size);var i,o,s,a,c,l,h={comments:[],elements:[],headerLength:n,objInfo:""},d=e.split("\n");for(var p=0;p<d.length;p++){var f=d[p];if(""!==(f=f.trim()))switch(o=(s=f.split(/\s+/)).shift(),f=s.join(" "),o){case"format":h.format=s[0],h.version=s[1];break;case"comment":h.comments.push(f);break;case"element":void 0!==i&&h.elements.push(i),(i={}).name=s[0],i.count=parseInt(s[1]),i.properties=[];break;case"property":i.properties.push((a=s,c=u.propertyNameMapping,l=void 0,"list"===(l={type:a[0]}).type?(l.name=a[3],l.countType=a[1],l.itemType=a[2]):l.name=a[1],l.name in c&&(l.name=c[l.name]),l));break;case"obj_info":h.objInfo=f;break;default:console.log("unhandled",o,s)}}return void 0!==i&&h.elements.push(i),h}function n(t,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(t);case"float":case"double":case"float32":case"float64":return parseFloat(t)}}function r(t,e){for(var r=e.split(/\s+/),i={},o=0;o<t.length;o++)if("list"===t[o].type){for(var s=[],a=n(r.shift(),t[o].countType),c=0;c<a;c++)s.push(n(r.shift(),t[o].itemType));i[t[o].name]=s}else i[t[o].name]=n(r.shift(),t[o].type);return i}function i(t,e){var n,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},a="";null!==(n=/end_header\s([\s\S]*)$/.exec(t))&&(a=n[1]);for(var c=a.split("\n"),l=0,u=0,h=0;h<c.length;h++){var d=c[h];if(""!==(d=d.trim())){u>=e.elements[l].count&&(l++,u=0);var p=r(e.elements[l].properties,d);s(i,e.elements[l].name,p),u++}}return o(i)}function o(t){var e=new Zg;return t.indices.length>0&&e.setIndex(t.indices),e.setAttribute("position",new Fg(t.vertices,3)),t.normals.length>0&&e.setAttribute("normal",new Fg(t.normals,3)),t.uvs.length>0&&e.setAttribute("uv",new Fg(t.uvs,2)),t.colors.length>0&&e.setAttribute("color",new Fg(t.colors,3)),t.faceVertexUvs.length>0&&(e=e.toNonIndexed()).setAttribute("uv",new Fg(t.faceVertexUvs,2)),e.computeBoundingSphere(),e}function s(t,e,n){if("vertex"===e)t.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&t.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&t.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&t.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===e){var r=n.vertex_indices||n.vertex_index,i=n.texcoord;3===r.length?(t.indices.push(r[0],r[1],r[2]),i&&6===i.length&&(t.faceVertexUvs.push(i[0],i[1]),t.faceVertexUvs.push(i[2],i[3]),t.faceVertexUvs.push(i[4],i[5]))):4===r.length&&(t.indices.push(r[0],r[1],r[3]),t.indices.push(r[1],r[2],r[3]))}}function a(t,e,n,r){switch(n){case"int8":case"char":return[t.getInt8(e),1];case"uint8":case"uchar":return[t.getUint8(e),1];case"int16":case"short":return[t.getInt16(e,r),2];case"uint16":case"ushort":return[t.getUint16(e,r),2];case"int32":case"int":return[t.getInt32(e,r),4];case"uint32":case"uint":return[t.getUint32(e,r),4];case"float32":case"float":return[t.getFloat32(e,r),4];case"float64":case"double":return[t.getFloat64(e,r),8]}}function c(t,e,n,r){for(var i,o={},s=0,c=0;c<n.length;c++)if("list"===n[c].type){var l=[],u=(i=a(t,e+s,n[c].countType,r))[0];s+=i[1];for(var h=0;h<u;h++)i=a(t,e+s,n[c].itemType,r),l.push(i[0]),s+=i[1];o[n[c].name]=l}else i=a(t,e+s,n[c].type,r),o[n[c].name]=i[0],s+=i[1];return[o,s]}var l,u=this;if(t instanceof ArrayBuffer){var h=Kw(new Uint8Array(t)),d=e(h);l="ascii"===d.format?i(h,d):function(t,e){for(var n,r={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===e.format,a=new DataView(t,e.headerLength),l=0,u=0;u<e.elements.length;u++)for(var h=0;h<e.elements[u].count;h++){l+=(n=c(a,l,e.elements[u].properties,i))[1];var d=n[0];s(r,e.elements[u].name,d)}return o(r)}(t,d)}else l=i(t,e(t));return l}});var KM,QM,tE,eE,nE,rE,iE=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},oE=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},sE=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},aE=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let cE=class extends Rf{constructor(){super(...arguments),KM.add(this),this.src="",QM.set(this,0)}requiredElementType(){return[xf]}_createComponent(){return this.model?this.model:new dp}loadGL(){return!!super.loadGL()&&(this.loader=new $M,this._stopFns.push(Zr(()=>{this.src,sE(this,KM,"m",tE).call(this),aE(this,QM,+sE(this,QM,"f")+1,"f"),sE(this,KM,"m",eE).call(this)})),!0)}unloadGL(){return!!super.unloadGL()&&(this.loader=void 0,sE(this,KM,"m",tE).call(this),aE(this,QM,+sE(this,QM,"f")+1,"f"),!0)}};QM=new WeakMap,KM=new WeakSet,tE=function(){this.model=void 0},eE=function(){const{src:t}=this,e=sE(this,QM,"f");t&&(console.log("load the model!"),this.loader.load(t,t=>e===sE(this,QM,"f")&&sE(this,KM,"m",rE).call(this,t),t=>e===sE(this,QM,"f")&&this.element.emit(Mo.PROGRESS,t),t=>e===sE(this,QM,"f")&&sE(this,KM,"m",nE).call(this,t)))},nE=function(t){var e;const n=null!==(e=null==t?void 0:t.message)&&void 0!==e?e:`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}".`;console.warn(n),t.error&&console.error(t.error),this.element.emit(Mo.MODEL_ERROR,t.error)},rE=function(t){this.model=t,this.model.computeVertexNormals(),this.resetMeshComponent(),console.log("emit model load"),this.element.emit(Mo.MODEL_LOAD,{format:"ply",model:t})},cE._observedProperties=["src",...Rf._observedProperties||[]],iE([ai(""),oE("design:type",Object)],cE.prototype,"src",void 0),cE=iE([Jr],cE),elementBehaviors.has("ply-geometry")||elementBehaviors.define("ply-geometry",cE);class lE extends dp{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,o=e/2,s=Math.floor(n),a=Math.floor(r),c=s+1,l=a+1,u=t/s,h=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<l;t++){const e=t*h-o;for(let n=0;n<c;n++){const r=n*u-i;p.push(r,-e,0),f.push(0,0,1),m.push(n/s),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<s;e++){const n=e+c*t,r=e+c*(t+1),i=e+1+c*(t+1),o=e+1+c*t;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new Qd(p,3)),this.setAttribute("normal",new Qd(f,3)),this.setAttribute("uv",new Qd(m,2))}}class uE extends zd{constructor(t,e,n,r){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new lE(t,e,n,r)),this.mergeVertices()}}class hE extends Rf{_createComponent(){return new uE(this.element.calculatedSize.x,this.element.calculatedSize.y)}}function dE(){this.type="Curve",this.arcLengthDivisions=200}function pE(t,e,n,r,i,o,s,a){dE.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function fE(t,e,n,r,i,o){pE.call(this,t,e,n,n,r,i,o),this.type="ArcCurve"}function mE(){let t=0,e=0,n=0,r=0;function i(i,o,s,a){t=i,e=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,s,a){let c=(e-t)/o-(n-t)/(o+s)+(n-e)/s,l=(n-e)/s-(r-e)/(s+a)+(r-n)/a;c*=s,l*=s,i(e,n,c,l)},calc:function(i){const o=i*i;return t+e*i+n*o+r*(o*i)}}}elementBehaviors.has("plane-geometry")||elementBehaviors.define("plane-geometry",hE),Object.assign(dE.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let r=0;const i=n.length;let o;o=e||t*n[i-1];let s,a=0,c=i-1;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(r=c,n[r]===o)return r/(i-1);const l=n[r];return(r+(o-l)/(n[r+1]-l))/(i-1)},getTangent:function(t,e){let n=t-1e-4,r=t+1e-4;n<0&&(n=0),r>1&&(r=1);const i=this.getPoint(n),o=this.getPoint(r),s=e||(i.isVector2?new gh:new Lo);return s.copy(o).sub(i).normalize(),s},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Lo,r=[],i=[],o=[],s=new Lo,a=new Oo;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new Lo),r[e].normalize()}i[0]=new Lo,o[0]=new Lo;let c=Number.MAX_VALUE;const l=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),h<=c&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),o[e]=o[e-1].clone(),s.crossVectors(r[e-1],r[e]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(Ao.clamp(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(s,t))}o[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Ao.clamp(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(s.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),pE.prototype=Object.create(dE.prototype),pE.prototype.constructor=pE,pE.prototype.isEllipseCurve=!0,pE.prototype.getPoint=function(t,e){const n=e||new gh,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=c-this.aY;a=n*t-r*e+this.aX,c=n*e+r*t+this.aY}return n.set(a,c)},pE.prototype.copy=function(t){return dE.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},pE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},pE.prototype.fromJSON=function(t){return dE.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},fE.prototype=Object.create(pE.prototype),fE.prototype.constructor=fE,fE.prototype.isArcCurve=!0;const gE=new Lo,vE=new mE,yE=new mE,bE=new mE;function xE(t=[],e=!1,n="centripetal",r=.5){dE.call(this),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}function _E(t,e,n,r,i){const o=.5*(r-e),s=.5*(i-n),a=t*t;return(2*n-2*r+o+s)*(t*a)+(-3*n+3*r-2*o-s)*a+o*t+n}function wE(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function ME(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}function EE(t=new gh,e=new gh,n=new gh,r=new gh){dE.call(this),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function SE(t=new Lo,e=new Lo,n=new Lo,r=new Lo){dE.call(this),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function TE(t=new gh,e=new gh){dE.call(this),this.type="LineCurve",this.v1=t,this.v2=e}function AE(t=new Lo,e=new Lo){dE.call(this),this.type="LineCurve3",this.v1=t,this.v2=e}function RE(t=new gh,e=new gh,n=new gh){dE.call(this),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}function LE(t=new Lo,e=new Lo,n=new Lo){dE.call(this),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}function CE(t=[]){dE.call(this),this.type="SplineCurve",this.points=t}function PE(){dE.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function OE(t){PE.call(this),this.type="Path",this.currentPoint=new gh,t&&this.setFromPoints(t)}function NE(t){OE.call(this,t),this.uuid=Ao.generateUUID(),this.type="Shape",this.holes=[]}xE.prototype=Object.create(dE.prototype),xE.prototype.constructor=xE,xE.prototype.isCatmullRomCurve3=!0,xE.prototype.getPoint=function(t,e=new Lo){const n=e,r=this.points,i=r.length,o=(i-(this.closed?0:1))*t;let s,a,c=Math.floor(o),l=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:0===l&&c===i-1&&(c=i-2,l=1),this.closed||c>0?s=r[(c-1)%i]:(gE.subVectors(r[0],r[1]).add(r[0]),s=gE);const u=r[c%i],h=r[(c+1)%i];if(this.closed||c+2<i?a=r[(c+2)%i]:(gE.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=gE),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),vE.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,e,n,r),yE.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,e,n,r),bE.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(vE.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),yE.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),bE.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return n.set(vE.calc(l),yE.calc(l),bE.calc(l)),n},xE.prototype.copy=function(t){dE.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},xE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},xE.prototype.fromJSON=function(t){dE.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Lo).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},EE.prototype=Object.create(dE.prototype),EE.prototype.constructor=EE,EE.prototype.isCubicBezierCurve=!0,EE.prototype.getPoint=function(t,e=new gh){const n=e,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(ME(t,r.x,i.x,o.x,s.x),ME(t,r.y,i.y,o.y,s.y)),n},EE.prototype.copy=function(t){return dE.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},EE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},EE.prototype.fromJSON=function(t){return dE.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},SE.prototype=Object.create(dE.prototype),SE.prototype.constructor=SE,SE.prototype.isCubicBezierCurve3=!0,SE.prototype.getPoint=function(t,e=new Lo){const n=e,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(ME(t,r.x,i.x,o.x,s.x),ME(t,r.y,i.y,o.y,s.y),ME(t,r.z,i.z,o.z,s.z)),n},SE.prototype.copy=function(t){return dE.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},SE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},SE.prototype.fromJSON=function(t){return dE.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},TE.prototype=Object.create(dE.prototype),TE.prototype.constructor=TE,TE.prototype.isLineCurve=!0,TE.prototype.getPoint=function(t,e=new gh){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},TE.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},TE.prototype.getTangent=function(t,e){const n=e||new gh;return n.copy(this.v2).sub(this.v1).normalize(),n},TE.prototype.copy=function(t){return dE.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},TE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},TE.prototype.fromJSON=function(t){return dE.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},AE.prototype=Object.create(dE.prototype),AE.prototype.constructor=AE,AE.prototype.isLineCurve3=!0,AE.prototype.getPoint=function(t,e=new Lo){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},AE.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},AE.prototype.copy=function(t){return dE.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},AE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},AE.prototype.fromJSON=function(t){return dE.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},RE.prototype=Object.create(dE.prototype),RE.prototype.constructor=RE,RE.prototype.isQuadraticBezierCurve=!0,RE.prototype.getPoint=function(t,e=new gh){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(wE(t,r.x,i.x,o.x),wE(t,r.y,i.y,o.y)),n},RE.prototype.copy=function(t){return dE.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},RE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},RE.prototype.fromJSON=function(t){return dE.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},LE.prototype=Object.create(dE.prototype),LE.prototype.constructor=LE,LE.prototype.isQuadraticBezierCurve3=!0,LE.prototype.getPoint=function(t,e=new Lo){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(wE(t,r.x,i.x,o.x),wE(t,r.y,i.y,o.y),wE(t,r.z,i.z,o.z)),n},LE.prototype.copy=function(t){return dE.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LE.prototype.fromJSON=function(t){return dE.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},CE.prototype=Object.create(dE.prototype),CE.prototype.constructor=CE,CE.prototype.isSplineCurve=!0,CE.prototype.getPoint=function(t,e=new gh){const n=e,r=this.points,i=(r.length-1)*t,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],c=r[o],l=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(_E(s,a.x,c.x,l.x,u.x),_E(s,a.y,c.y,l.y,u.y)),n},CE.prototype.copy=function(t){dE.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},CE.prototype.toJSON=function(){const t=dE.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},CE.prototype.fromJSON=function(t){dE.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new gh).fromArray(n))}return this},PE.prototype=Object.assign(Object.create(dE.prototype),{constructor:PE,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new TE(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=e){const t=n[r]-e,i=this.curves[r],o=i.getLength(),s=0===o?0:1-t/o;return i.getPointAt(s)}r++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s);for(let t=0;t<a.length;t++){const r=a[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){dE.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=dE.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){dE.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new o[n.type]).fromJSON(n))}return this}}),OE.prototype=Object.assign(Object.create(PE.prototype),{constructor:OE,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new TE(this.currentPoint.clone(),new gh(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){const i=new RE(this.currentPoint.clone(),new gh(t,e),new gh(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,i,o){const s=new EE(this.currentPoint.clone(),new gh(t,e),new gh(n,r),new gh(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this},splineThru:function(t){const e=new CE([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,e+a,n,r,i,o),this},absarc:function(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this},ellipse:function(t,e,n,r,i,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,n,r,i,o,s,a),this},absellipse:function(t,e,n,r,i,o,s,a){const c=new pE(t,e,n,r,i,o,s,a);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(t){return PE.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=PE.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return PE.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),NE.prototype=Object.assign(Object.create(OE.prototype),{constructor:NE,getPointsHoles:function(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){OE.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=OE.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){OE.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new OE).fromJSON(n))}return this}});const IE=function(t,e,n){n=n||2;const r=e&&e.length,i=r?e[0]*n:t.length;let o=DE(t,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,l,u,h,d,p;if(r&&(o=function(t,e,n,r){const i=[];let o,s,a,c,l;for(o=0,s=e.length;o<s;o++)a=e[o]*r,c=o<s-1?e[o+1]*r:t.length,l=DE(t,a,c,r,!1),l===l.next&&(l.steiner=!0),i.push(qE(l));for(i.sort(GE),o=0;o<i.length;o++)jE(i[o],n),n=FE(n,n.next);return n}(t,e,o,n)),t.length>80*n){a=l=t[0],c=u=t[1];for(let e=n;e<i;e+=n)h=t[e],d=t[e+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=0!==p?1/p:0}return UE(o,s,n,a,c,p),s};function DE(t,e,n,r,i){let o,s;if(i===function(t,e,n,r){let i=0;for(let o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)s=nS(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=nS(o,t[o],t[o+1],s);return s&&JE(s,s.next)&&(rS(s),s=s.next),s}function FE(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!JE(r,r.next)&&0!==ZE(r.prev,r,r.next))r=r.next;else{if(rS(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function UE(t,e,n,r,i,o,s){if(!t)return;!s&&o&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=WE(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,o,s,a,c,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<l&&(a++,r=r.nextZ,r);e++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1)}(i)}(t,r,i,o);let a,c,l=t;for(;t.prev!==t.next;)if(a=t.prev,c=t.next,o?kE(t,r,i,o):BE(t))e.push(a.i/n),e.push(t.i/n),e.push(c.i/n),rS(t),t=c.next,l=c.next;else if((t=c)===l){s?1===s?UE(t=zE(FE(t),e,n),e,n,r,i,o,2):2===s&&HE(t,e,n,r,i,o):UE(FE(t),e,n,r,i,o,1);break}}function BE(t){const e=t.prev,n=t,r=t.next;if(ZE(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(XE(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&ZE(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function kE(t,e,n,r){const i=t.prev,o=t,s=t.next;if(ZE(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,c=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=WE(a,c,e,n,r),d=WE(l,u,e,n,r);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&XE(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&ZE(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&XE(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&ZE(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&XE(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&ZE(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&XE(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&ZE(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function zE(t,e,n){let r=t;do{const i=r.prev,o=r.next.next;!JE(i,o)&&$E(i,r,r.next,o)&&tS(i,o)&&tS(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),rS(r),rS(r.next),r=t=o),r=r.next}while(r!==t);return FE(r)}function HE(t,e,n,r,i,o){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&YE(s,t)){let a=eS(s,t);return s=FE(s,s.next),a=FE(a,a.next),UE(s,e,n,r,i,o),void UE(a,e,n,r,i,o)}t=t.next}s=s.next}while(s!==t)}function GE(t,e){return t.x-e.x}function jE(t,e){if(e=function(t,e){let n=e;const r=t.x,i=t.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const t=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>s){if(s=t,t===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(r===s)return o;const a=o,c=o.x,l=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=c&&r!==n.x&&XE(i<l?r:s,i,c,l,i<l?s:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),tS(n,t)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&VE(o,n)))&&(o=n,h=u)),n=n.next}while(n!==a);return o}(t,e)){const n=eS(e,t);FE(e,e.next),FE(n,n.next)}}function VE(t,e){return ZE(t.prev,t,e.prev)<0&&ZE(e.next,t,t.next)<0}function WE(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function qE(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function XE(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function YE(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&$E(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(tS(t,e)&&tS(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(ZE(t.prev,t,e.prev)||ZE(t,e.prev,e))||JE(t,e)&&ZE(t.prev,t,t.next)>0&&ZE(e.prev,e,e.next)>0)}function ZE(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function JE(t,e){return t.x===e.x&&t.y===e.y}function $E(t,e,n,r){const i=QE(ZE(t,e,n)),o=QE(ZE(t,e,r)),s=QE(ZE(n,r,t)),a=QE(ZE(n,r,e));return i!==o&&s!==a||(!(0!==i||!KE(t,n,e))||(!(0!==o||!KE(t,r,e))||(!(0!==s||!KE(n,t,r))||!(0!==a||!KE(n,e,r)))))}function KE(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function QE(t){return t>0?1:t<0?-1:0}function tS(t,e){return ZE(t.prev,t,t.next)<0?ZE(t,e,t.next)>=0&&ZE(t,t.prev,e)>=0:ZE(t,e,t.prev)<0||ZE(t,t.next,e)<0}function eS(t,e){const n=new iS(t.i,t.x,t.y),r=new iS(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function nS(t,e,n,r){const i=new iS(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function rS(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function iS(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const oS={area:function(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return oS.area(t)<0},triangulateShape:function(t,e){const n=[],r=[],i=[];sS(t),aS(n,t);let o=t.length;e.forEach(sS);for(let t=0;t<e.length;t++)r.push(o),o+=e[t].length,aS(n,e[t]);const s=IE(n,r);for(let t=0;t<s.length;t+=3)i.push(s.slice(t,t+3));return i}};function sS(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function aS(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class cS extends dp{constructor(t,e){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++){o(t[e])}function o(t){const o=[],s=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let c=void 0!==e.depth?e.depth:100,l=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:lS;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=e.amount);let g,v,y,b,x,_=!1;f&&(g=f.getSpacedPoints(a),_=!0,l=!1,v=f.computeFrenetFrames(a,!1),y=new Lo,b=new Lo,x=new Lo),l||(p=0,u=0,h=0,d=0);const w=t.extractPoints(s);let M=w.shape;const E=w.holes;if(!oS.isClockWise(M)){M=M.reverse();for(let t=0,e=E.length;t<e;t++){const e=E[t];oS.isClockWise(e)&&(E[t]=e.reverse())}}const S=oS.triangulateShape(M,E),T=M;for(let t=0,e=E.length;t<e;t++){const e=E[t];M=M.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const R=M.length,L=S.length;function C(t,e,n){let r,i,o;const s=t.x-e.x,a=t.y-e.y,c=n.x-t.x,l=n.y-t.y,u=s*s+a*a,h=s*l-a*c;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(c*c+l*l),p=e.x-a/h,f=e.y+s/h,m=((n.x-l/d-p)*l-(n.y+c/d-f)*c)/(s*l-a*c);r=p+s*m-t.x,i=f+a*m-t.y;const g=r*r+i*i;if(g<=2)return new gh(r,i);o=Math.sqrt(g/2)}else{let t=!1;s>Number.EPSILON?c>Number.EPSILON&&(t=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new gh(r/o,i/o)}const P=[];for(let t=0,e=T.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),P[t]=C(T[t],T[n],T[r]);const O=[];let N,I=P.concat();for(let t=0,e=E.length;t<e;t++){const e=E[t];N=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[t]=C(e[t],e[r],e[i]);O.push(N),I=I.concat(N)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],P[t],r);U(e.x,e.y,-n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];N=O[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);U(i.x,i.y,-n)}}}const D=h+d;for(let t=0;t<R;t++){const e=l?A(M[t],I[t],D):M[t];_?(b.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(b).add(y),U(x.x,x.y,x.z)):U(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<R;e++){const n=l?A(M[e],I[e],D):M[e];_?(b.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(b).add(y),U(x.x,x.y,x.z)):U(n.x,n.y,c/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],P[t],r);U(e.x,e.y,c+n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];N=O[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);_?U(i.x,i.y+g[a-1].y,g[a-1].x+n):U(i.x,i.y,c+n)}}}function F(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=R*t,o=R*(t+1);k(e+r+n,e+i+n,e+i+o,e+r+o)}}}function U(t,e,n){o.push(t),o.push(e),o.push(n)}function B(t,e,i){z(t),z(e),z(i);const o=r.length/3,s=m.generateTopUV(n,r,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[2])}function k(t,e,i,o){z(t),z(e),z(o),z(e),z(i),z(o);const s=r.length/3,a=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function z(t){r.push(o[3*t+0]),r.push(o[3*t+1]),r.push(o[3*t+2])}function H(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(l){let t=0,e=R*t;for(let t=0;t<L;t++){const n=S[t];B(n[2]+e,n[1]+e,n[0]+e)}t=a+2*p,e=R*t;for(let t=0;t<L;t++){const n=S[t];B(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<L;t++){const e=S[t];B(e[2],e[1],e[0])}for(let t=0;t<L;t++){const e=S[t];B(e[0]+R*a,e[1]+R*a,e[2]+R*a)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;F(T,e),e+=T.length;for(let t=0,n=E.length;t<n;t++){const n=E[t];F(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new Qd(r,3)),this.setAttribute("uv",new Qd(i,2)),this.computeVertexNormals()}toJSON(){const t=dp.prototype.toJSON.call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}}const lS={generateTopUV:function(t,e,n,r,i){const o=e[3*n],s=e[3*n+1],a=e[3*r],c=e[3*r+1],l=e[3*i],u=e[3*i+1];return[new gh(o,s),new gh(a,c),new gh(l,u)]},generateSideWallUV:function(t,e,n,r,i,o){const s=e[3*n],a=e[3*n+1],c=e[3*n+2],l=e[3*r],u=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(a-u)<.01?[new gh(s,1-c),new gh(l,1-h),new gh(d,1-f),new gh(m,1-v)]:[new gh(a,1-c),new gh(u,1-h),new gh(p,1-f),new gh(g,1-v)]}};class uS extends zd{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new cS(t,e)),this.mergeVertices()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}}class hS extends dp{constructor(t,e=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(t))c(t);else for(let e=0;e<t.length;e++)c(t[e]),this.addGroup(s,a,e),s+=a,a=0;function c(t){const s=r.length/3,c=t.extractPoints(e);let l=c.shape;const u=c.holes;!1===oS.isClockWise(l)&&(l=l.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===oS.isClockWise(e)&&(u[t]=e.reverse())}const h=oS.triangulateShape(l,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];r.push(e.x,e.y,0),i.push(0,0,1),o.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],r=e[0]+s,i=e[1]+s,o=e[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Qd(r,3)),this.setAttribute("normal",new Qd(i,3)),this.setAttribute("uv",new Qd(o,2))}toJSON(){const t=dp.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}class dS extends zd{constructor(t,e){super(),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new hS(t,e)),this.mergeVertices()}toJSON(){const t=zd.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}var pS,fS=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},mS=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},gS=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},vS=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let yS=class extends Rf{constructor(){super(...arguments),this.cornerRadius=0,this.thickness=0,pS.set(this,!1)}get quadraticCorners(){return gS(this,pS,"f")}set quadraticCorners(t){vS(this,pS,null!==t&&"false"!==t,"f")}loadGL(){return!!super.loadGL()&&(this._stopFns.push(Zr(()=>{this.cornerRadius,this.thickness,this.quadraticCorners,this.resetMeshComponent()})),!0)}_createComponent(){let t,e=this.thickness;const n=new bS(0,0,this.element.calculatedSize.x,this.element.calculatedSize.y,this.cornerRadius,this.quadraticCorners);return t=e>0?new uS(n,{bevelEnabled:!0,steps:1,bevelSegments:1,bevelSize:0,bevelThickness:0,depth:e}):new dS(n),t.translate(-this.element.calculatedSize.x/2,-this.element.calculatedSize.y/2,-e/2),t}};pS=new WeakMap,yS._observedProperties=["cornerRadius","thickness","quadraticCorners",...Rf._observedProperties||[]],fS([oi({from:Number}),mS("design:type",Object)],yS.prototype,"cornerRadius",void 0),fS([oi({from:Number}),mS("design:type",Object)],yS.prototype,"thickness",void 0),fS([oi,mS("design:type",Boolean),mS("design:paramtypes",[Boolean])],yS.prototype,"quadraticCorners",null),yS=fS([Jr],yS),elementBehaviors.has("rounded-rectangle-geometry")||elementBehaviors.define("rounded-rectangle-geometry",yS);class bS extends NE{constructor(t,e,n,r,i,o=!1){if(super(),o)return this.moveTo(t,e+i),this.lineTo(t,e+r-i),this.quadraticCurveTo(t,e+r,t+i,e+r),this.lineTo(t+n-i,e+r),this.quadraticCurveTo(t+n,e+r,t+n,e+r-i),this.lineTo(t+n,e+i),this.quadraticCurveTo(t+n,e,t+n-i,e),this.lineTo(t+i,e),void this.quadraticCurveTo(t,e,t,e+i);this.absarc(t+n-i,e+i,i,-Math.PI/2,0,!1),this.absarc(t+n-i,e+r-i,i,0,Math.PI/2,!1),this.absarc(t+i,e+r-i,i,Math.PI/2,Math.PI,!1),this.absarc(t+i,e+i,i,Math.PI,Math.PI+Math.PI/2,!1),this.lineTo(t+n-i,e)}}class xS extends dp{constructor(t=1,e=8,n=6,r=0,i=2*Math.PI,o=0,s=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let c=0;const l=[],u=new Lo,h=new Lo,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==o?y=.5/e:d==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;u.x=-t*Math.cos(r+a*i)*Math.sin(o+v*s),u.y=t*Math.cos(o+v*s),u.z=t*Math.sin(r+a*i)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),g.push(c++)}l.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=l[t][r+1],i=l[t][r],s=l[t+1][r],c=l[t+1][r+1];(0!==t||o>0)&&d.push(e,i,c),(t!==n-1||a<Math.PI)&&d.push(i,s,c)}this.setIndex(d),this.setAttribute("position",new Qd(p,3)),this.setAttribute("normal",new Qd(f,3)),this.setAttribute("uv",new Qd(m,2))}}class _S extends zd{constructor(t,e,n,r,i,o,s){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new xS(t,e,n,r,i,o,s)),this.mergeVertices()}}class wS extends Rf{_createComponent(){return new _S(this.element.calculatedSize.x/2,32,32)}}elementBehaviors.has("sphere-geometry")||elementBehaviors.define("sphere-geometry",wS);var MS,ES=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},SS=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},TS=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},AS=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let RS=class extends Af{constructor(){super(...arguments),this.type="material",this.wireframe=!1,this.opacity=1,this.sidedness="front",MS.set(this,new Mh("deeppink")),this._stopFns=[]}get color(){return TS(this,MS,"f")}set color(t){"string"==typeof(t=null!=t?t:"")||"number"==typeof t?TS(this,MS,"f").set(t):AS(this,MS,t,"f")}get transparent(){return this.opacity<1}loadGL(){return!!super.loadGL()&&(this._stopFns.push(Zr(()=>{this.wireframe,this.updateMaterial("wireframe")}),Zr(()=>{this.opacity,this.updateMaterial("opacity"),this.updateMaterial("transparent")}),Zr(()=>{let t;switch(this.sidedness){case"front":t=Xa;break;case"back":t=Ya;break;case"double":t=Za}this.element.three.material.side=t,this.element.needsUpdate()}),Zr(()=>{this.color,this.updateMaterial("color")})),!0)}unloadGL(){if(!super.unloadGL())return!1;for(const t of this._stopFns)t();return this._stopFns.length=0,!0}updateMaterial(t,e=t){const n=this.element.three.material;if(Array.isArray(n))for(const r of n)r[t]=this[e];else n[t]=this[e];this.element.needsUpdate()}};MS=new WeakMap,RS._observedProperties=["wireframe","opacity","sidedness","color",...Af._observedProperties||[]],ES([li(!1),SS("design:type",Object)],RS.prototype,"wireframe",void 0),ES([ci(1),SS("design:type",Object)],RS.prototype,"opacity",void 0),ES([ai("front"),SS("design:type",String)],RS.prototype,"sidedness",void 0),ES([ai("deeppink"),SS("design:type",Object),SS("design:paramtypes",[Object])],RS.prototype,"color",null),RS=ES([Jr],RS);const LS={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function CS(t,e,n){const r=this;let i=!1,o=0,s=0,a=void 0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,s),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,s),o===s&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=c.length;e<n;e+=2){const n=c[e],r=c[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}const PS=new CS;function OS(t){this.manager=void 0!==t?t:PS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}function NS(t){OS.call(this,t)}let IS;Object.assign(OS.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),NS.prototype=Object.assign(Object.create(OS.prototype),{constructor:NS,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=LS.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),LS.add(t,this),e&&e(this),i.manager.itemEnd(t)}function c(e){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(t),s.src=t,s}});const DS={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===IS&&(IS=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),IS.width=t.width,IS.height=t.height;const n=IS.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=IS}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let FS=0;function US(t=US.DEFAULT_IMAGE,e=US.DEFAULT_MAPPING,n=Wc,r=Wc,i=Kc,o=el,s=vl,a=rl,c=1,l=Lu){Object.defineProperty(this,"id",{value:FS++}),this.uuid=Ao.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=a,this.offset=new gh(0,0),this.repeat=new gh(1,1),this.center=new gh(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.version=0,this.onUpdate=null}function BS(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?DS.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}function kS(t){OS.call(this,t)}US.DEFAULT_IMAGE=void 0,US.DEFAULT_MAPPING=Uc,US.prototype=Object.assign(Object.create(zo.prototype),{constructor:US,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Ao.generateUUID()),!e&&void 0===t.images[r.uuid]){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(BS(r[t].image)):e.push(BS(r[t]))}else e=BS(r);t.images[r.uuid]={uuid:r.uuid,url:e}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==Uc)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Vc:t.x=t.x-Math.floor(t.x);break;case Wc:t.x=t.x<0?0:1;break;case qc:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Vc:t.y=t.y-Math.floor(t.y);break;case Wc:t.y=t.y<0?0:1;break;case qc:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(US.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),kS.prototype=Object.assign(Object.create(OS.prototype),{constructor:kS,load:function(t,e,n,r){const i=new US,o=new NS(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(n){i.image=n;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?gl:vl,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}});var zS=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},HS=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},GS=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};function jS(t){var e;const n=t;let r=class extends t{constructor(){super(...arguments),this.type="material",this.texture="",this.bumpMap="",this.specularMap="",e.set(this,[])}loadGL(){if(!super.loadGL())return!1;const t=(t,e)=>{this[t];const n=this.element.three.material;if(e in n){if(n[e]&&n[e].dispose(),this[t]){const r=(new kS).load(this[t],()=>this.element.needsUpdate());n[e]=r}else n[e]=null;n.needsUpdate=!0,this.element.needsUpdate()}else console.warn(`Warning: The material specified for the <${this.element.tagName.toLowerCase()}> element does not support a "${e}" texture.`)};return GS(this,e,"f").push(Zr(()=>t("texture","map")),Zr(()=>t("bumpMap","bumpMap")),Zr(()=>t("specularMap","specularMap"))),!0}unloadGL(){if(!super.unloadGL())return!1;for(const t of GS(this,e,"f"))t();GS(this,e,"f").length=0;const t=this.element.three.material;return t.map&&t.map.dispose(),!0}};return e=new WeakMap,r._observedProperties=["texture","bumpMap","specularMap",...n._observedProperties||[]],zS([ai(""),HS("design:type",Object)],r.prototype,"texture",void 0),zS([ai(""),HS("design:type",Object)],r.prototype,"bumpMap",void 0),zS([ai(""),HS("design:type",Object)],r.prototype,"specularMap",void 0),r=zS([Jr],r),r}class VS extends(jS(RS)){_createComponent(){return new Bp({color:65280})}}elementBehaviors.has("basic-material")||elementBehaviors.define("basic-material",VS);class WS extends(jS(RS)){_createComponent(){return new Eh({opacity:.5,color:new Mh(1118481),blending:Ka})}}elementBehaviors.has("mixedplane-material")||elementBehaviors.define("mixedplane-material",WS);class qS extends(jS(RS)){_createComponent(){return new Eh({color:65280})}}function XS(t){mh.call(this),this.type="MeshLambertMaterial",this.color=new Mh(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Rc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}elementBehaviors.has("phong-material")||elementBehaviors.define("phong-material",qS),XS.prototype=Object.create(mh.prototype),XS.prototype.constructor=XS,XS.prototype.isMeshLambertMaterial=!0,XS.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};class YS extends(jS(RS)){_createComponent(){return new XS({color:65280})}}elementBehaviors.has("lambert-material")||elementBehaviors.define("lambert-material",YS);var ZS=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},JS=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let $S=class extends(jS(RS)){constructor(){super(...arguments),this.sizeAttenuation=!0,this.pointSize=1}loadGL(){return!!super.loadGL()&&(this._stopFns.push(Zr(()=>{this.sizeAttenuation,this.updateMaterial("sizeAttenuation")}),Zr(()=>{this.pointSize,this.updateMaterial("size","pointSize")})),!0)}updateMaterial(t,e){super.updateMaterial(t,e)}_createComponent(){return new lf({color:65280})}};function KS(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function QS(t){const e={};for(let n=0;n<t.length;n++){const r=KS(t[n]);for(const t in r)e[t]=r[t]}return e}$S._observedProperties=["sizeAttenuation","pointSize",...RS._observedProperties],ZS([li(!0),JS("design:type",Object)],$S.prototype,"sizeAttenuation",void 0),ZS([ci(1),JS("design:type",Object)],$S.prototype,"pointSize",void 0),$S=ZS([Jr],$S),elementBehaviors.has("points-material")||elementBehaviors.define("points-material",$S);const tT={clone:KS,merge:QS};var eT="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",nT="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n";function rT(t){mh.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=eT,this.fragmentShader=nT,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}rT.prototype=Object.create(mh.prototype),rT.prototype.constructor=rT,rT.prototype.isShaderMaterial=!0,rT.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=KS(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},rT.prototype.toJSON=function(t){const e=mh.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e};var iT,oT=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},sT=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},aT=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},cT=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let lT=class extends(jS(RS)){constructor(){super(...arguments),iT.set(this,{}),this.vertexShader=eT,this.fragmentShader=nT}get uniforms(){return aT(this,iT,"f")}set uniforms(t){cT(this,iT,t?"string"==typeof t?JSON.parse(t):t:{},"f")}_createComponent(){return new rT({uniforms:this.uniforms,vertexShader:this.vertexShader||eT,fragmentShader:this.fragmentShader||nT})}loadGL(){return!!super.loadGL()&&(this._stopFns.push(Zr(()=>{const t=this.getMeshComponent("material");t.uniforms=this.uniforms,t.vertexShader=this.vertexShader||eT,t.fragmentShader=this.fragmentShader||nT,this.element.needsUpdate()})),!0)}};iT=new WeakMap,lT._observedProperties=["uniforms","vertexShader","fragmentShader",...RS._observedProperties],oT([oi,sT("design:type",Object),sT("design:paramtypes",[Object])],lT.prototype,"uniforms",null),oT([oi,sT("design:type",Object)],lT.prototype,"vertexShader",void 0),oT([oi,sT("design:type",Object)],lT.prototype,"fragmentShader",void 0),lT=oT([Jr],lT),elementBehaviors.has("shader-material")||elementBehaviors.define("shader-material",lT);var uT=function(t){ow.call(this,t)};uT.prototype=Object.assign(Object.create(ow.prototype),{constructor:uT,load:function(t,e,n,r){var i=this,o=new Xf,s=new aw(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.setWithCredentials(this.withCredentials),s.load(t,(function(t){o.image=i.parse(t),o.needsUpdate=!0,void 0!==e&&e(o)}),n,r),o},parse:function(t){var e=0,n=1,r=2,i=3,o=9,s=10,a=11,c=48,l=4,u=0,h=1,d=2,p=3;t.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var f=new Uint8Array(t),m=0,g={id_length:f[m++],colormap_type:f[m++],image_type:f[m++],colormap_index:f[m++]|f[m++]<<8,colormap_length:f[m++]|f[m++]<<8,colormap_size:f[m++],origin:[f[m++]|f[m++]<<8,f[m++]|f[m++]<<8],width:f[m++]|f[m++]<<8,height:f[m++]|f[m++]<<8,pixel_size:f[m++],flags:f[m++]};!function(t){switch(t.image_type){case n:case o:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case r:case i:case s:case a:t.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case e:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',t.image_type)}(t.width<=0||t.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',t.pixel_size)}(g),g.id_length+m>t.length&&console.error("THREE.TGALoader: No data."),m+=g.id_length;var v=!1,y=!1,b=!1;switch(g.image_type){case o:v=!0,y=!0;break;case n:y=!0;break;case s:v=!0;break;case r:break;case a:v=!0,b=!0;break;case i:b=!0}var x="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(g.width,g.height):document.createElement("canvas");x.width=g.width,x.height=g.height;var _=x.getContext("2d"),w=_.createImageData(g.width,g.height),M=function(t,e,n,r,i){var o,s,a,c;if(s=n.pixel_size>>3,a=n.width*n.height*s,e&&(c=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),t){var l,u,h;o=new Uint8Array(a);for(var d=0,p=new Uint8Array(s);d<a;)if(u=1+(127&(l=i[r++])),128&l){for(h=0;h<s;++h)p[h]=i[r++];for(h=0;h<u;++h)o.set(p,d+h*s);d+=s*u}else{for(u*=s,h=0;h<u;++h)o[d+h]=i[r++];d+=u}}else o=i.subarray(r,r+=e?n.width*n.height:a);return{pixel_data:o,palettes:c}}(v,y,g,m,f);return function(t,e,n,r,i){var o,s,a,f,m,v;switch((g.flags&c)>>l){default:case d:o=0,a=1,m=e,s=0,f=1,v=n;break;case u:o=0,a=1,m=e,s=n-1,f=-1,v=-1;break;case p:o=e-1,a=-1,m=-1,s=0,f=1,v=n;break;case h:o=e-1,a=-1,m=-1,s=n-1,f=-1,v=-1}if(b)switch(g.pixel_size){case 8:!function(t,e,n,r,i,o,s,a){var c,l,u,h=0,d=g.width;for(u=e;u!==r;u+=n)for(l=i;l!==s;l+=o,h++)c=a[h],t[4*(l+d*u)+0]=c,t[4*(l+d*u)+1]=c,t[4*(l+d*u)+2]=c,t[4*(l+d*u)+3]=255}(t,s,f,v,o,a,m,r);break;case 16:!function(t,e,n,r,i,o,s,a){var c,l,u=0,h=g.width;for(l=e;l!==r;l+=n)for(c=i;c!==s;c+=o,u+=2)t[4*(c+h*l)+0]=a[u+0],t[4*(c+h*l)+1]=a[u+0],t[4*(c+h*l)+2]=a[u+0],t[4*(c+h*l)+3]=a[u+1]}(t,s,f,v,o,a,m,r);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(g.pixel_size){case 8:!function(t,e,n,r,i,o,s,a,c){var l,u,h,d=c,p=0,f=g.width;for(h=e;h!==r;h+=n)for(u=i;u!==s;u+=o,p++)l=a[p],t[4*(u+f*h)+3]=255,t[4*(u+f*h)+2]=d[3*l+0],t[4*(u+f*h)+1]=d[3*l+1],t[4*(u+f*h)+0]=d[3*l+2]}(t,s,f,v,o,a,m,r,i);break;case 16:!function(t,e,n,r,i,o,s,a){var c,l,u,h=0,d=g.width;for(u=e;u!==r;u+=n)for(l=i;l!==s;l+=o,h+=2)c=a[h+0]+(a[h+1]<<8),t[4*(l+d*u)+0]=(31744&c)>>7,t[4*(l+d*u)+1]=(992&c)>>2,t[4*(l+d*u)+2]=(31&c)>>3,t[4*(l+d*u)+3]=32768&c?0:255}(t,s,f,v,o,a,m,r);break;case 24:!function(t,e,n,r,i,o,s,a){var c,l,u=0,h=g.width;for(l=e;l!==r;l+=n)for(c=i;c!==s;c+=o,u+=3)t[4*(c+h*l)+3]=255,t[4*(c+h*l)+2]=a[u+0],t[4*(c+h*l)+1]=a[u+1],t[4*(c+h*l)+0]=a[u+2]}(t,s,f,v,o,a,m,r);break;case 32:!function(t,e,n,r,i,o,s,a){var c,l,u=0,h=g.width;for(l=e;l!==r;l+=n)for(c=i;c!==s;c+=o,u+=4)t[4*(c+h*l)+2]=a[u+0],t[4*(c+h*l)+1]=a[u+1],t[4*(c+h*l)+0]=a[u+2],t[4*(c+h*l)+3]=a[u+3]}(t,s,f,v,o,a,m,r);break;default:console.error("THREE.TGALoader: Format not supported.")}}(w.data,g.width,g.height,M.pixel_data,M.palettes),_.putImageData(w,0,0),x}});var hT=function(t){ow.call(this,t)};hT.prototype=Object.assign(Object.create(ow.prototype),{constructor:hT,load:function(t,e,n,r){var i=this,o=""===i.path?Qw(t):i.path,s=new aw(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(n,o))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},options:{set convertUpAxis(t){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(t,e){function n(t,e){for(var n=[],r=t.childNodes,i=0,o=r.length;i<o;i++){var s=r[i];s.nodeName===e&&n.push(s)}return n}function r(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=e[r];return n}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseFloat(e[r]);return n}function o(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseInt(e[r]);return n}function s(t){return t.substring(1)}function a(t){return 0===Object.keys(t).length}function c(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}function l(t){return void 0!==t?t.textContent:"Y_UP"}function u(t,e,r,i){var o=n(t,e)[0];if(void 0!==o)for(var s=n(o,r),a=0;a<s.length;a++)i(s[a])}function h(t,e){for(var n in t){t[n].build=e(t[n])}}function d(t,e){return void 0!==t.build||(t.build=e(t)),t.build}function p(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=s(i.getAttribute("source")),a=i.getAttribute("semantic");e.inputs[a]=o}}return e}function f(t){var e={},n=t.getAttribute("target").split("/"),r=n.shift(),i=n.shift(),o=-1!==i.indexOf("("),a=-1!==i.indexOf(".");if(a)n=i.split("."),i=n.shift(),e.member=n.shift();else if(o){var c=i.split("(");i=c.shift();for(var l=0;l<c.length;l++)c[l]=parseInt(c[l].replace(/\)/,""));e.indices=c}return e.id=r,e.sid=i,e.arraySyntax=o,e.memberSyntax=a,e.sampler=s(t.getAttribute("source")),e}function m(t){var e=[],n=t.channels,r=t.samplers,i=t.sources;for(var o in n)if(n.hasOwnProperty(o)){var s=n[o],a=r[s.sampler],c=a.inputs.INPUT,l=a.inputs.OUTPUT;_(v(s,i[c],i[l]),e)}return e}function g(t){return d(Jt.animations[t],m)}function v(t,e,n){var r,i,o,s,a,c,l=Jt.nodes[t.id],u=Dt(l.id),h=l.transforms[t.sid],d=l.matrix.clone().transpose(),p={};switch(h){case"matrix":for(o=0,s=e.array.length;o<s;o++)if(r=e.array[o],i=o*n.stride,void 0===p[r]&&(p[r]={}),!0===t.arraySyntax){var f=n.array[i],m=t.indices[0]+4*t.indices[1];p[r][m]=f}else for(a=0,c=n.stride;a<c;a++)p[r][a]=n.array[i+a];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var g=function(t,e){var n=[];for(var r in t)n.push({time:parseFloat(r),value:t[r]});n.sort((function(t,e){return t.time-e.time}));for(var i=0;i<16;i++)w(n,i,e.elements[i]);return n}(p,d);return{name:u.uuid,keyframes:g}}var y=new Qf,b=new Qf,x=new Kf;function _(t,e){for(var n=t.keyframes,r=t.name,i=[],o=[],s=[],a=[],c=0,l=n.length;c<l;c++){var u=n[c],h=u.time,d=u.value;Et.fromArray(d).transpose(),Et.decompose(y,x,b),i.push(h),o.push(y.x,y.y,y.z),s.push(x.x,x.y,x.z,x.w),a.push(b.x,b.y,b.z)}return o.length>0&&e.push(new Q_(r+".position",i,o)),s.length>0&&e.push(new $_(r+".quaternion",i,s)),a.length>0&&e.push(new Q_(r+".scale",i,a)),e}function w(t,e,n){var r,i,o,s=!0;for(i=0,o=t.length;i<o;i++)void 0===(r=t[i]).value[e]?r.value[e]=null:s=!1;if(!0===s)for(i=0,o=t.length;i<o;i++)(r=t[i]).value[e]=n;else!function(t,e){for(var n,r,i=0,o=t.length;i<o;i++){var s=t[i];if(null===s.value[e]){if(n=M(t,i,e),r=E(t,i,e),null===n){s.value[e]=r.value[e];continue}if(null===r){s.value[e]=n.value[e];continue}S(s,n,r,e)}}}(t,e)}function M(t,e,n){for(;e>=0;){var r=t[e];if(null!==r.value[n])return r;e--}return null}function E(t,e,n){for(;e<t.length;){var r=t[e];if(null!==r.value[n])return r;e++}return null}function S(t,e,n,r){n.time-e.time!=0?t.value[r]=(t.time-e.time)*(n.value[r]-e.value[r])/(n.time-e.time)+e.value[r]:t.value[r]=e.value[r]}function T(t){for(var e=[],n=t.name,r=t.end-t.start||-1,i=t.animations,o=0,s=i.length;o<s;o++)for(var a=g(i[o]),c=0,l=a.length;c<l;c++)e.push(a[c]);return new tw(n,r,e)}function A(t){return d(Jt.clips[t],T)}function R(t){for(var e={sources:{}},n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=i(o.textContent);break;case"source":var s=o.getAttribute("id");e.sources[s]=it(o);break;case"joints":e.joints=L(o);break;case"vertex_weights":e.vertexWeights=C(o)}}return e}function L(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),a=s(i.getAttribute("source"));e.inputs[o]=a}}return e}function C(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),c=s(i.getAttribute("source")),l=parseInt(i.getAttribute("offset"));e.inputs[a]={id:c,offset:l};break;case"vcount":e.vcount=o(i.textContent);break;case"v":e.v=o(i.textContent)}}return e}function P(t){var e={id:t.id},n=Jt.geometries[e.id];return void 0!==t.skin&&(e.skin=function(t){var e,n,r,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=t.sources,s=t.vertexWeights,a=s.vcount,c=s.v,l=s.inputs.JOINT.offset,u=s.inputs.WEIGHT.offset,h=t.sources[t.joints.inputs.JOINT],d=t.sources[t.joints.inputs.INV_BIND_MATRIX],p=o[s.inputs.WEIGHT.id].array,f=0;for(e=0,r=a.length;e<r;e++){var m=a[e],g=[];for(n=0;n<m;n++){var v=c[f+l],y=c[f+u],b=p[y];g.push({index:v,weight:b}),f+=2}for(g.sort(M),n=0;n<4;n++){var x=g[n];void 0!==x?(i.indices.array.push(x.index),i.weights.array.push(x.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}t.bindShapeMatrix?i.bindMatrix=(new Am).fromArray(t.bindShapeMatrix).transpose():i.bindMatrix=(new Am).identity();for(e=0,r=h.array.length;e<r;e++){var _=h.array[e],w=(new Am).fromArray(d.array,e*d.stride).transpose();i.joints.push({name:_,boneInverse:w})}return i;function M(t,e){return e.weight-t.weight}}(t.skin),n.sources.skinIndices=e.skin.indices,n.sources.skinWeights=e.skin.weights),e}function O(t){return void 0!==t.build?t.build:t.init_from}function N(t){var e=Jt.images[t];return void 0!==e?d(e,O):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function I(t){for(var e={surfaces:{},samplers:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":D(i,e);break;case"technique":e.technique=B(i);break;case"extra":e.extra=V(i)}}return e}function D(t,e){for(var n=t.getAttribute("sid"),r=0,i=t.childNodes.length;r<i;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":e.surfaces[n]=F(o);break;case"sampler2D":e.samplers[n]=U(o)}}}function F(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"init_from":e.init_from=i.textContent}}return e}function U(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"source":e.source=i.textContent}}return e}function B(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=i.nodeName,e.parameters=k(i)}}return e}function k(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[i.nodeName]=z(i);break;case"transparent":e[i.nodeName]={opaque:i.getAttribute("opaque"),data:z(i)}}}return e}function z(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":e[o.nodeName]=i(o.textContent);break;case"float":e[o.nodeName]=parseFloat(o.textContent);break;case"texture":e[o.nodeName]={id:o.getAttribute("texture"),extra:H(o)}}}return e}function H(t){for(var e={technique:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"extra":G(i,e)}}return e}function G(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":j(i,e)}}}function j(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?e.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?e.technique[i.nodeName]=0:e.technique[i.nodeName]=parseInt(i.textContent)}}}function V(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":e.technique=W(i)}}return e}function W(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":e[i.nodeName]=parseInt(i.textContent)}}return e}function q(t){return t}function X(t){var e,n,r=(e=t.url,d(Jt.effects[e],q)),i=r.profile.technique,o=r.profile.extra;switch(i.type){case"phong":case"blinn":n=new I_;break;case"lambert":n=new U_;break;default:n=new Eg}function s(t){var e=r.profile.samplers[t.id],n=null;void 0!==e?n=N(r.profile.surfaces[e.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),n=N(t.id));if(null!==n){var i=function(t){var e,n=t.slice(2+(t.lastIndexOf(".")-1>>>0));switch(n=n.toLowerCase()){case"tga":e=Vt;break;default:e=qt}return e}(n);if(void 0!==i){var o=i.load(n),s=t.extra;if(void 0!==s&&void 0!==s.technique&&!1===a(s.technique)){var c=s.technique;o.wrapS=c.wrapU?1e3:1001,o.wrapT=c.wrapV?1e3:1001,o.offset.set(c.offsetU||0,c.offsetV||0),o.repeat.set(c.repeatU||1,c.repeatV||1)}else o.wrapS=1e3,o.wrapT=1e3;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",n),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}n.name=t.name||"";var c=i.parameters;for(var l in c){var u=c[l];switch(l){case"diffuse":u.color&&n.color.fromArray(u.color),u.texture&&(n.map=s(u.texture));break;case"specular":u.color&&n.specular&&n.specular.fromArray(u.color),u.texture&&(n.specularMap=s(u.texture));break;case"bump":u.texture&&(n.normalMap=s(u.texture));break;case"ambient":u.texture&&(n.lightMap=s(u.texture));break;case"shininess":u.float&&n.shininess&&(n.shininess=u.float);break;case"emission":u.color&&n.emissive&&n.emissive.fromArray(u.color),u.texture&&(n.emissiveMap=s(u.texture))}}var h=c.transparent,p=c.transparency;if(void 0===p&&h&&(p={float:1}),void 0===h&&p&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&p)if(h.data.texture)n.transparent=!0;else{var f=h.data.color;switch(h.opaque){case"A_ONE":n.opacity=f[3]*p.float;break;case"RGB_ZERO":n.opacity=1-f[0]*p.float;break;case"A_ZERO":n.opacity=1-f[3]*p.float;break;case"RGB_ONE":n.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}n.opacity<1&&(n.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(n.side=2),n}function Y(t){return d(Jt.materials[t],X)}function Z(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"technique_common":return J(n)}}return{}}function J(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":e.technique=r.nodeName,e.parameters=$(r)}}return e}function $(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[r.nodeName]=parseFloat(r.textContent)}}return e}function K(t){var e;switch(t.optics.technique){case"perspective":e=new wv(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var n=t.optics.parameters.ymag,r=t.optics.parameters.xmag,i=t.optics.parameters.aspect_ratio;r=void 0===r?n*i:r,n=void 0===n?r/i:n,e=new Vw(-(r*=.5),r,n*=.5,-n,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new wv}return e.name=t.name||"",e}function Q(t){var e=Jt.cameras[t];return void 0!==e?d(e,K):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function tt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=i.nodeName,e.parameters=et(i)}}return e}function et(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":var s=i(o.textContent);e.color=(new xg).fromArray(s);break;case"falloff_angle":e.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);e.distance=a?Math.sqrt(1/a):0}}return e}function nt(t){var e;switch(t.technique){case"directional":e=new qw;break;case"point":e=new jw;break;case"spot":e=new Hw;break;case"ambient":e=new Xw}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function rt(t){var e=Jt.lights[t];return void 0!==e?d(e,nt):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function it(t){for(var e={array:[],stride:3},o=0;o<t.childNodes.length;o++){var s=t.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"float_array":e.array=i(s.textContent);break;case"Name_array":e.array=r(s.textContent);break;case"technique_common":var a=n(s,"accessor")[0];void 0!==a&&(e.stride=parseInt(a.getAttribute("stride")))}}return e}function ot(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];1===r.nodeType&&(e[r.getAttribute("semantic")]=s(r.getAttribute("source")))}return e}function st(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var a=s(i.getAttribute("source")),c=i.getAttribute("semantic"),l=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),h=u>0?c+u:c;e.inputs[h]={id:a,offset:l},e.stride=Math.max(e.stride,l+1),"TEXCOORD"===c&&(e.hasUV=!0);break;case"vcount":e.vcount=o(i.textContent);break;case"p":e.p=o(i.textContent)}}return e}function at(t){for(var e=0,n=0,r=t.length;n<r;n++){!0===t[n].hasUV&&e++}e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function ct(t){var e={},n=t.sources,r=t.vertices,i=t.primitives;if(0===i.length)return{};var o=function(t){for(var e={},n=0;n<t.length;n++){var r=t[n];void 0===e[r.type]&&(e[r.type]=[]),e[r.type].push(r)}return e}(i);for(var s in o){var a=o[s];at(a),e[s]=lt(a,n,r)}return e}function lt(t,e,n){for(var r={},i={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},c={array:[],stride:0},l=[],u=4,h=[],d=4,p=new Zg,f=[],m=0,g=0;g<t.length;g++){var v=t[g],y=v.inputs,b=0;switch(v.type){case"lines":case"linestrips":b=2*v.count;break;case"triangles":b=3*v.count;break;case"polylist":for(var x=0;x<v.count;x++){var _=v.vcount[x];switch(_){case 3:b+=3;break;case 4:b+=6;break;default:b+=3*(_-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",v.type)}for(var w in p.addGroup(m,b,g),m+=b,v.material&&f.push(v.material),y){var M=y[w];switch(w){case"VERTEX":for(var E in n){var S=n[E];switch(E){case"POSITION":var T=i.array.length;if(ut(v,e[S],M.offset,i.array),i.stride=e[S].stride,e.skinWeights&&e.skinIndices&&(ut(v,e.skinIndices,M.offset,l),ut(v,e.skinWeights,M.offset,h)),!1===v.hasUV&&!0===t.uvsNeedsFix){b=(i.array.length-T)/i.stride;for(var A=0;A<b;A++)s.array.push(0,0)}break;case"NORMAL":ut(v,e[S],M.offset,o.array),o.stride=e[S].stride;break;case"COLOR":ut(v,e[S],M.offset,c.array),c.stride=e[S].stride;break;case"TEXCOORD":ut(v,e[S],M.offset,s.array),s.stride=e[S].stride;break;case"TEXCOORD1":ut(v,e[S],M.offset,a.array),s.stride=e[S].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',E)}}break;case"NORMAL":ut(v,e[M.id],M.offset,o.array),o.stride=e[M.id].stride;break;case"COLOR":ut(v,e[M.id],M.offset,c.array),c.stride=e[M.id].stride;break;case"TEXCOORD":ut(v,e[M.id],M.offset,s.array),s.stride=e[M.id].stride;break;case"TEXCOORD1":ut(v,e[M.id],M.offset,a.array),a.stride=e[M.id].stride}}}return i.array.length>0&&p.setAttribute("position",new Fg(i.array,i.stride)),o.array.length>0&&p.setAttribute("normal",new Fg(o.array,o.stride)),c.array.length>0&&p.setAttribute("color",new Fg(c.array,c.stride)),s.array.length>0&&p.setAttribute("uv",new Fg(s.array,s.stride)),a.array.length>0&&p.setAttribute("uv2",new Fg(a.array,a.stride)),l.length>0&&p.setAttribute("skinIndex",new Fg(l,u)),h.length>0&&p.setAttribute("skinWeight",new Fg(h,d)),r.data=p,r.type=t[0].type,r.materialKeys=f,r}function ut(t,e,n,r){var i=t.p,o=t.stride,s=t.vcount;function a(t){for(var e=i[t+n]*l,o=e+l;e<o;e++)r.push(c[e])}var c=e.array,l=e.stride;if(void 0!==t.vcount)for(var u=0,h=0,d=s.length;h<d;h++){var p=s[h];if(4===p){var f=u+1*o,m=u+2*o,g=u+3*o;a(u+0*o),a(f),a(g),a(f),a(m),a(g)}else if(3===p){f=u+1*o,m=u+2*o;a(u+0*o),a(f),a(m)}else if(p>4)for(var v=1,y=p-2;v<=y;v++){f=u+o*v,m=u+o*(v+1);a(u+0*o),a(f),a(m)}u+=o*p}else for(h=0,d=i.length;h<d;h+=o)a(h)}function ht(t){return d(Jt.geometries[t],ct)}function dt(t){return void 0!==t.build?t.build:t}function pt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":e.joints[r.getAttribute("sid")]=ft(r);break;case"link":e.links.push(gt(r))}}}function ft(t){for(var e,n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":e=mt(r)}}return e}function mt(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new Qf,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var o=i(r.textContent);e.axis.fromArray(o);break;case"limits":var s=r.getElementsByTagName("max")[0],a=r.getElementsByTagName("min")[0];e.limits.max=parseFloat(s.textContent),e.limits.min=parseFloat(a.textContent)}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function gt(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":e.attachments.push(vt(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(yt(r))}}return e}function vt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":e.links.push(gt(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(yt(r))}}return e}function yt(t){var e={type:t.nodeName},n=i(t.textContent);switch(e.type){case"matrix":e.obj=new Am,e.obj.fromArray(n).transpose();break;case"translate":e.obj=new Qf,e.obj.fromArray(n);break;case"rotate":e.obj=new Qf,e.obj.fromArray(n),e.angle=Hf.degToRad(n[3])}return e}function bt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":xt(r,e)}}}function xt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":e.inertia=i(r.textContent);break;case"mass":e.mass=i(r.textContent)[0]}}}function _t(t){for(var e={target:t.getAttribute("target").split("/").pop()},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var i=r.getElementsByTagName("param")[0];e.axis=i.textContent;var o=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=o.substr(0,o.length-1)}}return e}function wt(t){return void 0!==t.build?t.build:t}function Mt(t){for(var e=[],n=kt.querySelector('[id="'+t.id+'"]'),r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=i(o.textContent),a=(new Am).fromArray(s).transpose();e.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"translate":case"scale":s=i(o.textContent);var c=(new Qf).fromArray(s);e.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c});break;case"rotate":s=i(o.textContent),c=(new Qf).fromArray(s);var l=Hf.degToRad(s[3]);e.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c,angle:l})}}return e}var Et=new Am,St=new Qf;function Tt(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new Am,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"node":e.nodes.push(r.getAttribute("id")),Tt(r);break;case"instance_camera":e.instanceCameras.push(s(r.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(At(r));break;case"instance_light":e.instanceLights.push(s(r.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(At(r));break;case"instance_node":e.instanceNodes.push(s(r.getAttribute("url")));break;case"matrix":var o=i(r.textContent);e.matrix.multiply(Et.fromArray(o).transpose()),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":o=i(r.textContent);St.fromArray(o),e.matrix.multiply(Et.makeTranslation(St.x,St.y,St.z)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":o=i(r.textContent);var a=Hf.degToRad(o[3]);e.matrix.multiply(Et.makeRotationAxis(St.fromArray(o),a)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":o=i(r.textContent);e.matrix.scale(St.fromArray(o)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return It(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):Jt.nodes[e.id]=e,e}function At(t){for(var e={id:s(t.getAttribute("url")),materials:{},skeletons:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"bind_material":for(var i=r.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var a=i[o],c=a.getAttribute("symbol"),l=a.getAttribute("target");e.materials[c]=s(l)}break;case"skeleton":e.skeletons.push(s(r.textContent))}}return e}function Rt(t,e){var n,r,i,o=[],s=[];for(n=0;n<t.length;n++){var a=t[n];if(It(a))Lt(Dt(a),e,o);else if(i=a,void 0!==Jt.visualScenes[i])for(var c=Jt.visualScenes[a].children,l=0;l<c.length;l++){var u=c[l];if("JOINT"===u.type)Lt(Dt(u.id),e,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",a)}for(n=0;n<e.length;n++)for(l=0;l<o.length;l++)if((r=o[l]).bone.name===e[n].name){s[n]=r,r.processed=!0;break}for(n=0;n<o.length;n++)!1===(r=o[n]).processed&&(s.push(r),r.processed=!0);var h=[],d=[];for(n=0;n<s.length;n++)r=s[n],h.push(r.bone),d.push(r.boneInverse);return new gx(h,d)}function Lt(t,e,n){t.traverse((function(t){if(!0===t.isBone){for(var r,i=0;i<e.length;i++){var o=e[i];if(o.name===t.name){r=o.boneInverse;break}}void 0===r&&(r=new Am),n.push({bone:t,boneInverse:r,processed:!1})}}))}function Ct(t){for(var e,n=[],r=t.matrix,i=t.nodes,o=t.type,s=t.instanceCameras,a=t.instanceControllers,c=t.instanceLights,l=t.instanceGeometries,u=t.instanceNodes,h=0,p=i.length;h<p;h++)n.push(Dt(i[h]));for(h=0,p=s.length;h<p;h++){var f=Q(s[h]);null!==f&&n.push(f.clone())}for(h=0,p=a.length;h<p;h++)for(var m=a[h],g=(e=m.id,d(Jt.controllers[e],P)),v=Nt(ht(g.id),m.materials),y=Rt(m.skeletons,g.skin.joints),b=0,x=v.length;b<x;b++){var _;(_=v[b]).isSkinnedMesh&&(_.bind(y,g.skin.bindMatrix),_.normalizeSkinWeights()),n.push(_)}for(h=0,p=c.length;h<p;h++){var w=rt(c[h]);null!==w&&n.push(w.clone())}for(h=0,p=l.length;h<p;h++)for(b=0,x=(v=Nt(ht((m=l[h]).id),m.materials)).length;b<x;b++)n.push(v[b]);for(h=0,p=u.length;h<p;h++)n.push(Dt(u[h]).clone());if(0===i.length&&1===n.length)_=n[0];else{_="JOINT"===o?new px:new Ob;for(h=0;h<n.length;h++)_.add(n[h])}return _.name="JOINT"===o?t.sid:t.name,_.matrix.copy(r),_.matrix.decompose(_.position,_.quaternion,_.scale),_}var Pt=new Eg({color:16711935});function Ot(t,e){for(var n=[],r=0,i=t.length;r<i;r++){var o=e[t[r]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[r]),n.push(Pt)):n.push(Y(o))}return n}function Nt(t,e){var n=[];for(var r in t){var i=t[r],o=Ot(i.materialKeys,e);0===o.length&&("lines"===r||"linestrips"===r?o.push(new wx):o.push(new I_));var s=void 0!==i.data.attributes.skinIndex;if(s)for(var a=0,c=o.length;a<c;a++)o[a].skinning=!0;var l,u=1===o.length?o[0]:o;switch(r){case"lines":l=new Px(i.data,u);break;case"linestrips":l=new Rx(i.data,u);break;case"triangles":case"polylist":l=s?new dx(i.data,u):new pv(i.data,u)}n.push(l)}return n}function It(t){return void 0!==Jt.nodes[t]}function Dt(t){return d(Jt.nodes[t],Ct)}function Ft(t){var e=new Ob;e.name=t.name;for(var n=t.children,r=0;r<n.length;r++){var i=n[r];e.add(Dt(i.id))}return e}function Ut(t){return d(Jt.visualScenes[t],Ft)}if(0===t.length)return{scene:new Bb};var Bt=(new DOMParser).parseFromString(t,"application/xml"),kt=n(Bt,"COLLADA")[0],zt=Bt.getElementsByTagName("parsererror")[0];if(void 0!==zt){var Ht,Gt=n(zt,"div")[0];return Ht=Gt?Gt.textContent:function(t){for(var e="",n=[t];n.length;){var r=n.shift();r.nodeType===Node.TEXT_NODE?e+=r.textContent:(e+="\n",n.push.apply(n,r.childNodes))}return e.trim()}(zt),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",Ht),null}var jt=kt.getAttribute("version");console.log("THREE.ColladaLoader: File version",jt);var Vt,Wt=function(t){return{unit:c(n(t,"unit")[0]),upAxis:l(n(t,"up_axis")[0])}}(n(kt,"asset")[0]),qt=new pw(this.manager);qt.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin),uT&&(Vt=new uT(this.manager)).setPath(this.resourcePath||e);var Xt=[],Yt={},Zt=0,Jt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(kt,"library_animations","animation",(function t(e){for(var n={sources:{},samplers:{},channels:{}},r=!1,i=0,o=e.childNodes.length;i<o;i++){var s,a=e.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"source":s=a.getAttribute("id"),n.sources[s]=it(a);break;case"sampler":s=a.getAttribute("id"),n.samplers[s]=p(a);break;case"channel":s=a.getAttribute("target"),n.channels[s]=f(a);break;case"animation":t(a),r=!0;break;default:console.log(a)}}!1===r&&(Jt.animations[e.getAttribute("id")||Hf.generateUUID()]=n)})),u(kt,"library_animation_clips","animation_clip",(function(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":e.animations.push(s(i.getAttribute("url")))}}Jt.clips[t.getAttribute("id")]=e})),u(kt,"library_controllers","controller",(function(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":e.id=s(i.getAttribute("source")),e.skin=R(i);break;case"morph":e.id=s(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Jt.controllers[t.getAttribute("id")]=e})),u(kt,"library_images","image",(function(t){var e={init_from:n(t,"init_from")[0].textContent};Jt.images[t.getAttribute("id")]=e})),u(kt,"library_effects","effect",(function(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":e.profile=I(i)}}Jt.effects[t.getAttribute("id")]=e})),u(kt,"library_materials","material",(function(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":e.url=s(i.getAttribute("url"))}}Jt.materials[t.getAttribute("id")]=e})),u(kt,"library_cameras","camera",(function(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"optics":e.optics=Z(i)}}Jt.cameras[t.getAttribute("id")]=e})),u(kt,"library_lights","light",(function(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique_common":e=tt(i)}}Jt.lights[t.getAttribute("id")]=e})),u(kt,"library_geometries","geometry",(function(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(t,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];if(1===o.nodeType){var s=o.getAttribute("id");switch(o.nodeName){case"source":e.sources[s]=it(o);break;case"vertices":e.vertices=ot(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(st(o));break;default:console.log(o)}}}Jt.geometries[t.getAttribute("id")]=e}})),u(kt,"library_nodes","node",Tt),u(kt,"library_visual_scenes","visual_scene",(function(t){var e={name:t.getAttribute("name"),children:[]};!function(t){for(var e=t.getElementsByTagName("node"),n=0;n<e.length;n++){var r=e[n];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+Zt++)}}(t);for(var r=n(t,"node"),i=0;i<r.length;i++)e.children.push(Tt(r[i]));Jt.visualScenes[t.getAttribute("id")]=e})),u(kt,"library_kinematics_models","kinematics_model",(function(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":pt(r,e)}}Jt.kinematicsModels[t.getAttribute("id")]=e})),u(kt,"library_physics_models","physics_model",(function(t){for(var e={name:t.getAttribute("name")||"",rigidBodies:{}},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"rigid_body":e.rigidBodies[r.getAttribute("name")]={},bt(r,e.rigidBodies[r.getAttribute("name")])}}Jt.physicsModels[t.getAttribute("id")]=e})),u(kt,"scene","instance_kinematics_scene",(function(t){for(var e={bindJointAxis:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":e.bindJointAxis.push(_t(r))}}Jt.kinematicsScenes[s(t.getAttribute("url"))]=e})),h(Jt.animations,m),h(Jt.clips,T),h(Jt.controllers,P),h(Jt.images,O),h(Jt.effects,q),h(Jt.materials,X),h(Jt.cameras,K),h(Jt.lights,nt),h(Jt.geometries,ct),h(Jt.visualScenes,Ft),function(){var t=Jt.clips;if(!0===a(t)){if(!1===a(Jt.animations)){var e=[];for(var n in Jt.animations)for(var r=g(n),i=0,o=r.length;i<o;i++)e.push(r[i]);Xt.push(new tw("default",-1,e))}}else for(var n in t)Xt.push(A(n))}(),function(){var t=Object.keys(Jt.kinematicsModels)[0],e=Object.keys(Jt.kinematicsScenes)[0],n=Object.keys(Jt.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var r,i=(r=t,d(Jt.kinematicsModels[r],dt)),o=function(t){return d(Jt.kinematicsScenes[t],wt)}(e),s=Ut(n),a=o.bindJointAxis,c={},l=0,u=a.length;l<u;l++){var h=a[l],p=kt.querySelector('[sid="'+h.target+'"]');if(p){var f=p.parentElement;g(h.jointIndex,f)}}var m=new Am;Yt={joints:i&&i.joints,getJointValue:function(t){var e=c[t];if(e)return e.position;console.warn("THREE.ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var n=c[t];if(n){var r=n.joint;if(e>r.limits.max||e<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{var i=n.object,o=r.axis,s=n.transforms;Et.identity();for(var a=0;a<s.length;a++){var l=s[a];if(l.sid&&-1!==l.sid.indexOf(t))switch(r.type){case"revolute":Et.multiply(m.makeRotationAxis(o,Hf.degToRad(e)));break;case"prismatic":Et.multiply(m.makeTranslation(o.x*e,o.y*e,o.z*e));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(l.type){case"matrix":Et.multiply(l.obj);break;case"translate":Et.multiply(m.makeTranslation(l.obj.x,l.obj.y,l.obj.z));break;case"scale":Et.scale(l.obj);break;case"rotate":Et.multiply(m.makeRotationAxis(l.obj,l.angle))}}i.matrix.copy(Et),i.matrix.decompose(i.position,i.quaternion,i.scale),c[t].position=e}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}function g(t,e){var n=e.getAttribute("name"),r=i.joints[t];s.traverse((function(i){i.name===n&&(c[t]={object:i,transforms:Mt(e),joint:r,position:r.zeroPosition})}))}}();var $t=function(t){return Ut(s(n(t,"instance_visual_scene")[0].getAttribute("url")))}(n(kt,"scene")[0]);return $t.animations=Xt,"Z_UP"===Wt.upAxis&&$t.quaternion.setFromEuler(new Dm(-Math.PI/2,0,0)),$t.scale.multiplyScalar(Wt.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Xt},kinematics:Yt,library:Jt,scene:$t}}});var dT,pT,fT,mT,gT,vT,yT,bT=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},xT=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_T=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},wT=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let MT=class extends vd{constructor(){super(...arguments),dT.add(this),this.src="",pT.set(this,0),fT.set(this,[])}loadGL(){return!!super.loadGL()&&(this.loader=new hT,_T(this,fT,"f").push(Zr(()=>{this.src,_T(this,dT,"m",mT).call(this),wT(this,pT,+_T(this,pT,"f")+1,"f"),_T(this,dT,"m",gT).call(this)})),!0)}unloadGL(){if(!super.unloadGL())return!1;for(const t of _T(this,fT,"f"))t();return this.loader=void 0,_T(this,dT,"m",mT).call(this),wT(this,pT,+_T(this,pT,"f")+1,"f"),!0}};pT=new WeakMap,fT=new WeakMap,dT=new WeakSet,mT=function(){this.model&&Rh(this.model.scene),this.model=void 0},gT=function(){const{src:t}=this,e=_T(this,pT,"f");t&&this.loader.load(t,t=>e===_T(this,pT,"f")&&_T(this,dT,"m",yT).call(this,t),t=>e===_T(this,pT,"f")&&this.element.emit(Mo.PROGRESS,t),t=>e===_T(this,pT,"f")&&_T(this,dT,"m",vT).call(this,t))},vT=function(t){var e;const n=null!==(e=null==t?void 0:t.message)&&void 0!==e?e:`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}".`;console.warn(n),t.error&&console.error(t.error),this.element.emit(Mo.MODEL_ERROR,t.error)},yT=function(t){this.model=t,this.element.three.add(t.scene),this.element.emit(Mo.MODEL_LOAD,{format:"collada",model:t}),this.element.needsUpdate()},MT._observedProperties=["src",...vd._observedProperties||[]],bT([ai(""),xT("design:type",Object)],MT.prototype,"src",void 0),MT=bT([Jr],MT),elementBehaviors.has("collada-model")||elementBehaviors.define("collada-model",MT);
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */var ET={},ST=ET;function TT(t,e){var n,r=t.split("."),i=ST;!(r[0]in i)&&i.execScript&&i.execScript("var "+r[0]);for(;r.length&&(n=r.shift());)r.length||void 0===e?i=i[n]?i[n]:i[n]={}:i[n]=e}var AT="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function RT(t){var e,n,r,i,o,s,a,c,l,u,h=t.length,d=0,p=Number.POSITIVE_INFINITY;for(c=0;c<h;++c)t[c]>d&&(d=t[c]),t[c]<p&&(p=t[c]);for(e=1<<d,n=new(AT?Uint32Array:Array)(e),r=1,i=0,o=2;r<=d;){for(c=0;c<h;++c)if(t[c]===r){for(s=0,a=i,l=0;l<r;++l)s=s<<1|1&a,a>>=1;for(u=r<<16|c,l=s;l<e;l+=o)n[l]=u;++i}++r,i<<=1,o<<=1}return[n,d,p]}function LT(t,e){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=AT?new Uint8Array(t):t,this.m=!1,this.i=PT,this.r=!1,!e&&(e={})||(e.index&&(this.a=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.r=e.resize)),this.i){case CT:this.b=32768,this.c=new(AT?Uint8Array:Array)(32768+this.h+258);break;case PT:this.b=0,this.c=new(AT?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var CT=0,PT=1,OT={t:CT,s:PT};LT.prototype.k=function(){for(;!this.m;){var t=$T(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var e=this.input,n=this.a,r=this.c,i=this.b,o=e.length,s=void 0,a=r.length,c=void 0;if(this.d=this.f=0,n+1>=o)throw Error("invalid uncompressed block header: LEN");if(s=e[n++]|e[n++]<<8,n+1>=o)throw Error("invalid uncompressed block header: NLEN");if(s===~(e[n++]|e[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+s>e.length)throw Error("input buffer is broken");switch(this.i){case CT:for(;i+s>r.length;){if(s-=c=a-i,AT)r.set(e.subarray(n,n+c),i),i+=c,n+=c;else for(;c--;)r[i++]=e[n++];this.b=i,r=this.e(),i=this.b}break;case PT:for(;i+s>r.length;)r=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(AT)r.set(e.subarray(n,n+s),i),i+=s,n+=s;else for(;s--;)r[i++]=e[n++];this.a=n,this.b=i,this.c=r;break;case 1:this.j(YT,JT);break;case 2:var l,u,h,d,p=$T(this,5)+257,f=$T(this,5)+1,m=$T(this,4)+4,g=new(AT?Uint8Array:Array)(FT.length),v=void 0,y=void 0,b=void 0,x=void 0,_=void 0;for(_=0;_<m;++_)g[FT[_]]=$T(this,3);if(!AT)for(_=m,m=g.length;_<m;++_)g[FT[_]]=0;for(l=RT(g),v=new(AT?Uint8Array:Array)(p+f),_=0,d=p+f;_<d;)switch(y=KT(this,l),y){case 16:for(x=3+$T(this,2);x--;)v[_++]=b;break;case 17:for(x=3+$T(this,3);x--;)v[_++]=0;b=0;break;case 18:for(x=11+$T(this,7);x--;)v[_++]=0;b=0;break;default:b=v[_++]=y}u=RT(AT?v.subarray(0,p):v.slice(0,p)),h=RT(AT?v.subarray(p):v.slice(p)),this.j(u,h);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var NT,IT,DT=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],FT=AT?new Uint16Array(DT):DT,UT=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],BT=AT?new Uint16Array(UT):UT,kT=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],zT=AT?new Uint8Array(kT):kT,HT=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],GT=AT?new Uint16Array(HT):HT,jT=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],VT=AT?new Uint8Array(jT):jT,WT=new(AT?Uint8Array:Array)(288);for(NT=0,IT=WT.length;NT<IT;++NT)WT[NT]=143>=NT?8:255>=NT?9:279>=NT?7:8;var qT,XT,YT=RT(WT),ZT=new(AT?Uint8Array:Array)(30);for(qT=0,XT=ZT.length;qT<XT;++qT)ZT[qT]=5;var JT=RT(ZT);function $T(t,e){for(var n,r=t.f,i=t.d,o=t.input,s=t.a,a=o.length;i<e;){if(s>=a)throw Error("input buffer is broken");r|=o[s++]<<i,i+=8}return n=r&(1<<e)-1,t.f=r>>>e,t.d=i-e,t.a=s,n}function KT(t,e){for(var n,r,i=t.f,o=t.d,s=t.input,a=t.a,c=s.length,l=e[0],u=e[1];o<u&&!(a>=c);)i|=s[a++]<<o,o+=8;if((r=(n=l[i&(1<<u)-1])>>>16)>o)throw Error("invalid code length: "+r);return t.f=i>>r,t.d=o-r,t.a=a,65535&n}function QT(t,e){var n,r;switch(this.input=t,this.a=0,!e&&(e={})||(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),n=t[this.a++],r=t[this.a++],15&n){case tA:this.method=tA;break;default:throw Error("unsupported compression method")}if(0!=((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new LT(t,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}LT.prototype.j=function(t,e){var n=this.c,r=this.b;this.o=t;for(var i,o,s,a,c=n.length-258;256!==(i=KT(this,t));)if(256>i)r>=c&&(this.b=r,n=this.e(),r=this.b),n[r++]=i;else for(a=BT[o=i-257],0<zT[o]&&(a+=$T(this,zT[o])),i=KT(this,e),s=GT[i],0<VT[i]&&(s+=$T(this,VT[i])),r>=c&&(this.b=r,n=this.e(),r=this.b);a--;)n[r]=n[r++-s];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},LT.prototype.w=function(t,e){var n=this.c,r=this.b;this.o=t;for(var i,o,s,a,c=n.length;256!==(i=KT(this,t));)if(256>i)r>=c&&(c=(n=this.e()).length),n[r++]=i;else for(a=BT[o=i-257],0<zT[o]&&(a+=$T(this,zT[o])),i=KT(this,e),s=GT[i],0<VT[i]&&(s+=$T(this,VT[i])),r+a>c&&(c=(n=this.e()).length);a--;)n[r]=n[r++-s];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},LT.prototype.e=function(){var t,e,n=new(AT?Uint8Array:Array)(this.b-32768),r=this.b-32768,i=this.c;if(AT)n.set(i.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=i[t+32768];if(this.g.push(n),this.l+=n.length,AT)i.set(i.subarray(r,r+32768));else for(t=0;32768>t;++t)i[t]=i[r+t];return this.b=32768,i},LT.prototype.z=function(t){var e,n,r,i=this.input.length/this.a+1|0,o=this.input,s=this.c;return t&&("number"==typeof t.p&&(i=t.p),"number"==typeof t.u&&(i+=t.u)),2>i?n=(r=(o.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+r:s.length<<1:n=s.length*i,AT?(e=new Uint8Array(n)).set(s):e=s,this.c=e},LT.prototype.n=function(){var t,e,n,r,i,o=0,s=this.c,a=this.g,c=new(AT?Uint8Array:Array)(this.l+(this.b-32768));if(0===a.length)return AT?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(e=0,n=a.length;e<n;++e)for(r=0,i=(t=a[e]).length;r<i;++r)c[o++]=t[r];for(e=32768,n=this.b;e<n;++e)c[o++]=s[e];return this.g=[],this.buffer=c},LT.prototype.v=function(){var t,e=this.b;return AT?this.r?(t=new Uint8Array(e)).set(this.c.subarray(0,e)):t=this.c.subarray(0,e):(this.c.length>e&&(this.c.length=e),t=this.c),this.buffer=t},QT.prototype.k=function(){var t,e,n=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){e=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=t;if("string"==typeof r){var i,o,s=r.split("");for(i=0,o=s.length;i<o;i++)s[i]=(255&s[i].charCodeAt(0))>>>0;r=s}for(var a,c=1,l=0,u=r.length,h=0;0<u;){u-=a=1024<u?1024:u;do{l+=c+=r[h++]}while(--a);c%=65521,l%=65521}if(e!==(l<<16|c)>>>0)throw Error("invalid adler-32 checksum")}return t};var tA=8;TT("Zlib.Inflate",QT),TT("Zlib.Inflate.prototype.decompress",QT.prototype.k);var eA,nA,rA,iA,oA={ADAPTIVE:OT.s,BLOCK:OT.t};if(Object.keys)eA=Object.keys(oA);else for(nA in eA=[],rA=0,oA)eA[rA++]=nA;for(rA=0,iA=eA.length;rA<iA;++rA)TT("Zlib.Inflate.BufferType."+(nA=eA[rA]),oA[nA]);var sA=ET.Zlib.Inflate,aA={findSpan:function(t,e,n){var r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;for(var i=t,o=r,s=Math.floor((i+o)/2);e<n[s]||e>=n[s+1];)e<n[s]?o=s:i=s,s=Math.floor((i+o)/2);return s},calcBasisFunctions:function(t,e,n,r){var i=[],o=[],s=[];i[0]=1;for(var a=1;a<=n;++a){o[a]=e-r[t+1-a],s[a]=r[t+a]-e;for(var c=0,l=0;l<a;++l){var u=s[l+1],h=o[a-l],d=i[l]/(u+h);i[l]=c+u*d,c=h*d}i[a]=c}return i},calcBSplinePoint:function(t,e,n,r){for(var i=this.findSpan(t,r,e),o=this.calcBasisFunctions(i,r,t,e),s=new Zf(0,0,0,0),a=0;a<=t;++a){var c=n[i-t+a],l=o[a],u=c.w*l;s.x+=c.x*u,s.y+=c.y*u,s.z+=c.z*u,s.w+=c.w*l}return s},calcBasisFunctionDerivatives:function(t,e,n,r,i){for(var o=[],s=0;s<=n;++s)o[s]=0;var a=[];for(s=0;s<=r;++s)a[s]=o.slice(0);var c=[];for(s=0;s<=n;++s)c[s]=o.slice(0);c[0][0]=1;for(var l=o.slice(0),u=o.slice(0),h=1;h<=n;++h){l[h]=e-i[t+1-h],u[h]=i[t+h]-e;for(var d=0,p=0;p<h;++p){var f=u[p+1],m=l[h-p];c[h][p]=f+m;var g=c[p][h-1]/c[h][p];c[p][h]=d+f*g,d=m*g}c[h][h]=d}for(h=0;h<=n;++h)a[0][h]=c[h][n];for(p=0;p<=n;++p){var v=0,y=1,b=[];for(s=0;s<=n;++s)b[s]=o.slice(0);b[0][0]=1;for(var x=1;x<=r;++x){var _=0,w=p-x,M=n-x;p>=x&&(b[y][0]=b[v][0]/c[M+1][w],_=b[y][0]*c[w][M]);var E=p-1<=M?x-1:n-p;for(h=w>=-1?1:-w;h<=E;++h)b[y][h]=(b[v][h]-b[v][h-1])/c[M+1][w+h],_+=b[y][h]*c[w+h][M];p<=M&&(b[y][x]=-b[v][x-1]/c[M+1][p],_+=b[y][x]*c[p][M]),a[x][p]=_;h=v;v=y,y=h}}for(p=n,x=1;x<=r;++x){for(h=0;h<=n;++h)a[x][h]*=p;p*=n-x}return a},calcBSplineDerivatives:function(t,e,n,r,i){for(var o=i<t?i:t,s=[],a=this.findSpan(t,r,e),c=this.calcBasisFunctionDerivatives(a,r,t,o,e),l=[],u=0;u<n.length;++u){var h=(p=n[u].clone()).w;p.x*=h,p.y*=h,p.z*=h,l[u]=p}for(var d=0;d<=o;++d){for(var p=l[a-t].clone().multiplyScalar(c[d][0]),f=1;f<=t;++f)p.add(l[a-t+f].clone().multiplyScalar(c[d][f]));s[d]=p}for(d=o+1;d<=i+1;++d)s[d]=new Zf(0,0,0);return s},calcKoverI:function(t,e){for(var n=1,r=2;r<=t;++r)n*=r;var i=1;for(r=2;r<=e;++r)i*=r;for(r=2;r<=t-e;++r)i*=r;return n/i},calcRationalCurveDerivatives:function(t){for(var e=t.length,n=[],r=[],i=0;i<e;++i){var o=t[i];n[i]=new Qf(o.x,o.y,o.z),r[i]=o.w}for(var s=[],a=0;a<e;++a){var c=n[a].clone();for(i=1;i<=a;++i)c.sub(s[a-i].clone().multiplyScalar(this.calcKoverI(a,i)*r[i]));s[a]=c.divideScalar(r[0])}return s},calcNURBSDerivatives:function(t,e,n,r,i){var o=this.calcBSplineDerivatives(t,e,n,r,i);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(t,e,n,r,i,o,s,a){for(var c=this.findSpan(t,o,n),l=this.findSpan(e,s,r),u=this.calcBasisFunctions(c,o,t,n),h=this.calcBasisFunctions(l,s,e,r),d=[],p=0;p<=e;++p){d[p]=new Zf(0,0,0,0);for(var f=0;f<=t;++f){var m=i[c-t+f][l-e+p].clone(),g=m.w;m.x*=g,m.y*=g,m.z*=g,d[p].add(m.multiplyScalar(u[f]))}}var v=new Zf(0,0,0,0);for(p=0;p<=e;++p)v.add(d[p].multiplyScalar(h[p]));v.divideScalar(v.w),a.set(v.x,v.y,v.z)}},cA=function(t,e,n,r,i){fw.call(this),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(var o=0;o<n.length;++o){var s=n[o];this.controlPoints[o]=new Zf(s.x,s.y,s.z,s.w)}};(cA.prototype=Object.create(fw.prototype)).constructor=cA,cA.prototype.getPoint=function(t,e){var n=e||new Qf,r=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=aA.calcBSplinePoint(this.degree,this.knots,this.controlPoints,r);return 1!=i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)},cA.prototype.getTangent=function(t,e){var n=e||new Qf,r=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),i=aA.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n};var lA,uA,hA,dA,pA,fA,mA,gA=function(){var t,e,n;function r(t){ow.call(this,t)}function i(t,e){this.textureLoader=t,this.manager=e}function o(){}function s(){}function a(){}function c(){}function l(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function u(){}function h(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function d(t){return t/46186158e3}r.prototype=Object.assign(Object.create(ow.prototype),{constructor:r,load:function(t,e,n,r){var i=this,o=""===i.path?Qw(t):i.path,s=new aw(this.manager);s.setPath(i.path),s.setResponseType("arraybuffer"),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(n,o))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(e,n){if(s="Kaydara FBX Binary  \0",(o=e).byteLength>=s.length&&s===x(o,0,s.length))t=(new c).parse(e);else{var r=x(e);if(!function(t){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;for(var r=0;r<e.length;++r){if((o=void 0,o=t[(i=1)-1],t=t.slice(n+i),n++,o)===e[r])return!1}var i,o;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(h(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+h(r));t=(new a).parse(r)}var o,s;return new i(new pw(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),this.manager).parse(t)}}),i.prototype={constructor:i,parse:function(){e=this.parseConnections();var t=this.parseImages(),r=this.parseTextures(t),i=this.parseMaterials(r),s=this.parseDeformers(),a=(new o).parse(s);return this.parseScene(s,a,i),n},parseConnections:function(){var e=new Map;"Connections"in t&&t.Connections.connections.forEach((function(t){var n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};e.get(n).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});var s={ID:n,relationship:i};e.get(r).children.push(s)}));return e},parseImages:function(){var e={},n={};if("Video"in t.Objects){var r=t.Objects.Video;for(var i in r){var o=r[i];if(e[l=parseInt(i)]=o.RelativeFilename||o.Filename,"Content"in o){var s=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,a="string"==typeof o.Content&&""!==o.Content;if(s||a){var c=this.parseImage(r[i]);n[o.RelativeFilename||o.Filename]=c}}}}for(var l in e){var u=e[l];void 0!==n[u]?e[l]=n[u]:e[l]=e[l].split("\\").pop()}return e},parseImage:function(t){var e,n=t.Content,r=t.RelativeFilename||t.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),e="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof n)return"data:"+e+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:e}))},parseTextures:function(e){var n=new Map;if("Texture"in t.Objects){var r=t.Objects.Texture;for(var i in r){var o=this.parseTexture(r[i],e);n.set(parseInt(i),o)}}return n},parseTexture:function(t,e){var n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;var r=t.WrapModeU,i=t.WrapModeV,o=void 0!==r?r.value:0,s=void 0!==i?i.value:0;if(n.wrapS=0===o?1e3:1001,n.wrapT=0===s?1e3:1001,"Scaling"in t){var a=t.Scaling.value;n.repeat.x=a[0],n.repeat.y=a[1]}return n},loadTexture:function(t,n){var r,i,o=this.textureLoader.path,s=e.get(t.id).children;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(0!==(r=n[s[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));var a=t.FileName.slice(-3).toLowerCase();if("tga"===a){var c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),i=new Xf):i=c.load(r)}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),i=new Xf):i=this.textureLoader.load(r);return this.textureLoader.setPath(o),i},parseMaterials:function(e){var n=new Map;if("Material"in t.Objects){var r=t.Objects.Material;for(var i in r){var o=this.parseMaterial(r[i],e);null!==o&&n.set(parseInt(i),o)}}return n},parseMaterial:function(t,n){var r=t.id,i=t.attrName,o=t.ShadingModel;if("object"==typeof o&&(o=o.value),!e.has(r))return null;var s,a=this.parseParameters(t,n,r);switch(o.toLowerCase()){case"phong":s=new I_;break;case"lambert":s=new U_;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new I_}return s.setValues(a),s.name=i,s},parseParameters:function(t,n,r){var i={};t.BumpFactor&&(i.bumpScale=t.BumpFactor.value),t.Diffuse?i.color=(new xg).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(i.color=(new xg).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(i.displacementScale=t.DisplacementFactor.value),t.Emissive?i.emissive=(new xg).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(i.emissive=(new xg).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(i.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(i.opacity=parseFloat(t.Opacity.value)),i.opacity<1&&(i.transparent=!0),t.ReflectionFactor&&(i.reflectivity=t.ReflectionFactor.value),t.Shininess&&(i.shininess=t.Shininess.value),t.Specular?i.specular=(new xg).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(i.specular=(new xg).fromArray(t.SpecularColor.value));var o=this;return e.get(r).children.forEach((function(t){var e=t.relationship;switch(e){case"Bump":i.bumpMap=o.getTexture(n,t.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(n,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(n,t.ID),i.map.encoding=3001;break;case"DisplacementColor":i.displacementMap=o.getTexture(n,t.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(n,t.ID),i.emissiveMap.encoding=3001;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(n,t.ID);break;case"ReflectionColor":i.envMap=o.getTexture(n,t.ID),i.envMap.mapping=303,i.envMap.encoding=3001;break;case"SpecularColor":i.specularMap=o.getTexture(n,t.ID),i.specularMap.encoding=3001;break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=o.getTexture(n,t.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",e)}})),i},getTexture:function(n,r){return"LayeredTexture"in t.Objects&&r in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=e.get(r).children[0].ID),n.get(r)},parseDeformers:function(){var n={},r={};if("Deformer"in t.Objects){var i=t.Objects.Deformer;for(var o in i){var s=i[o],a=e.get(parseInt(o));if("Skin"===s.attrType){var c=this.parseSkeleton(a,i);c.ID=o,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=a.parents[0].ID,n[o]=c}else if("BlendShape"===s.attrType){var l={id:o};l.rawTargets=this.parseMorphTargets(a,i),l.id=o,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[o]=l}}}return{skeletons:n,morphTargets:r}},parseSkeleton:function(t,e){var n=[];return t.children.forEach((function(t){var r=e[t.ID];if("Cluster"===r.attrType){var i={ID:t.ID,indices:[],weights:[],transformLink:(new Am).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(t,n){for(var r=[],i=0;i<t.children.length;i++){var o=t.children[i],s=n[o.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;a.geoID=e.get(parseInt(o.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,r.push(a)}return r},parseScene:function(r,i,o){n=new Ob;var a=this.parseModels(r.skeletons,i,o),c=t.Objects.Model,l=this;a.forEach((function(t){var r=c[t.ID];l.setLookAtProperties(t,r),e.get(t.ID).parents.forEach((function(e){var n=a.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&n.add(t)})),this.bindSkeleton(r.skeletons,i,a),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrixWorld=t.parent.matrix);var e=v(t.userData.transformData);t.applyMatrix4(e)}}));var u=(new s).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=u,n=n.children[0]),n.animations=u},parseModels:function(n,r,i){var o=new Map,s=t.Objects.Model;for(var a in s){var c=parseInt(a),l=s[a],u=e.get(c),h=this.buildSkeleton(u,n,c,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(u);break;case"Light":h=this.createLight(u);break;case"Mesh":h=this.createMesh(u,r,i);break;case"NurbsCurve":h=this.createCurve(u,r);break;case"LimbNode":case"Root":h=new px;break;case"Null":default:h=new Ob}h.name=l.attrName?TM.sanitizeNodeName(l.attrName):"",h.ID=c}this.getTransformData(h,l),o.set(c,h)}return o},buildSkeleton:function(t,e,n,r){var i=null;return t.parents.forEach((function(t){for(var o in e){var s=e[o];s.rawBones.forEach((function(e,o){if(e.ID===t.ID){var a=i;(i=new px).matrixWorld.copy(e.transformLink),i.name=r?TM.sanitizeNodeName(r):"",i.ID=n,s.bones[o]=i,null!==a&&i.add(a)}}))}})),i},createCamera:function(e){var n,r;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(r=n)})),void 0===r)n=new Km;else{var i=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(i=1);var o=1;void 0!==r.NearPlane&&(o=r.NearPlane.value/1e3);var s=1e3;void 0!==r.FarPlane&&(s=r.FarPlane.value/1e3);var a=window.innerWidth,c=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,c=r.AspectHeight.value);var l=a/c,u=45;void 0!==r.FieldOfView&&(u=r.FieldOfView.value);var h=r.FocalLength?r.FocalLength.value:null;switch(i){case 0:n=new wv(u,l,o,s),null!==h&&n.setFocalLength(h);break;case 1:n=new Vw(-a/2,a/2,c/2,-c/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),n=new Km}}return n},createLight:function(e){var n,r;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(r=n)})),void 0===r)n=new Km;else{var i;i=void 0===r.LightType?0:r.LightType.value;var o=16777215;void 0!==r.Color&&(o=(new xg).fromArray(r.Color.value));var s=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(s=0);var a=0;void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);switch(i){case 0:n=new jw(o,s,a,1);break;case 1:n=new qw(o,s);break;case 2:var c=Math.PI/3;void 0!==r.InnerAngle&&(c=Hf.degToRad(r.InnerAngle.value));var l=0;void 0!==r.OuterAngle&&(l=Hf.degToRad(r.OuterAngle.value),l=Math.max(l,1)),n=new Hw(o,s,a,c,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new jw(o,s)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(t,e,n){var r,i=null,o=null,s=[];return t.children.forEach((function(t){e.has(t.ID)&&(i=e.get(t.ID)),n.has(t.ID)&&s.push(n.get(t.ID))})),s.length>1?o=s:s.length>0?o=s[0]:(o=new I_({color:13421772}),s.push(o)),"color"in i.attributes&&s.forEach((function(t){t.vertexColors=!0})),i.FBX_Deformer?(s.forEach((function(t){t.skinning=!0})),(r=new dx(i,o)).normalizeSkinWeights()):r=new pv(i,o),r},createCurve:function(t,e){return new Rx(t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),new wx({color:3342591,linewidth:1}))},getTransformData:function(t,e){var n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?y(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n},setLookAtProperties:function(r,i){"LookAtProperty"in i&&e.get(r.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){var i=t.Objects.Model[e.ID];if("Lcl_Translation"in i){var o=i.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(o),n.add(r.target)):r.lookAt((new Qf).fromArray(o))}}}))},bindSkeleton:function(t,n,r){var i=this.parsePoseNodes();for(var o in t){var s=t[o];e.get(parseInt(s.ID)).parents.forEach((function(t){if(n.has(t.ID)){var o=t.ID;e.get(o).parents.forEach((function(t){r.has(t.ID)&&r.get(t.ID).bind(new gx(s.bones),i[t.ID])}))}}))}},parsePoseNodes:function(){var e={};if("Pose"in t.Objects){var n=t.Objects.Pose;for(var r in n)if("BindPose"===n[r].attrType){var i=n[r].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new Am).fromArray(t.Matrix.a)})):e[i.Node]=(new Am).fromArray(i.Matrix.a)}}return e},createAmbientLight:function(){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var e=t.GlobalSettings.AmbientColor.value,r=e[0],i=e[1],o=e[2];if(0!==r||0!==i||0!==o){var s=new xg(r,i,o);n.add(new Xw(s,1))}}},setupMorphMaterials:function(){var t=this;n.traverse((function(e){e.isMesh&&e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length&&(Array.isArray(e.material)?e.material.forEach((function(n,r){t.setupMorphMaterial(e,n,r)})):t.setupMorphMaterial(e,e.material))}))},setupMorphMaterial:function(t,e,r){var i=t.uuid,o=e.uuid,s=!1;if(n.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach((function(e){e.uuid===o&&t.uuid!==i&&(s=!0)})):t.material.uuid===o&&t.uuid!==i&&(s=!0))})),!0===s){var a=e.clone();a.morphTargets=!0,void 0===r?t.material=a:t.material[r]=a}else e.morphTargets=!0}},o.prototype={constructor:o,parse:function(n){var r=new Map;if("Geometry"in t.Objects){var i=t.Objects.Geometry;for(var o in i){var s=e.get(parseInt(o)),a=this.parseGeometry(s,i[o],n);r.set(parseInt(o),a)}}return r},parseGeometry:function(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}},parseMeshGeometry:function(e,n,r){var i=r.skeletons,o=[],s=e.parents.map((function(e){return t.Objects.Model[e.ID]}));if(0!==s.length){var a=e.children.reduce((function(t,e){return void 0!==i[e.ID]&&(t=i[e.ID]),t}),null);e.children.forEach((function(t){void 0!==r.morphTargets[t.ID]&&o.push(r.morphTargets[t.ID])}));var c=s[0],l={};"RotationOrder"in c&&(l.eulerOrder=y(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);var u=v(l);return this.genGeometry(n,a,o,u)}},genGeometry:function(t,e,n,r){var i=new Zg;t.attrName&&(i.name=t.attrName);var o=this.parseGeoNode(t,e),s=this.genBuffers(o),a=new Fg(s.vertex,3);if(a.applyMatrix4(r),i.setAttribute("position",a),s.colors.length>0&&i.setAttribute("color",new Fg(s.colors,3)),e&&(i.setAttribute("skinIndex",new Og(s.weightsIndices,4)),i.setAttribute("skinWeight",new Fg(s.vertexWeights,4)),i.FBX_Deformer=e),s.normal.length>0){var c=(new jf).getNormalMatrix(r),l=new Fg(s.normal,3);l.applyNormalMatrix(c),i.setAttribute("normal",l)}if(s.uvs.forEach((function(t,e){var n="uv"+(e+1).toString();0===e&&(n="uv"),i.setAttribute(n,new Fg(s.uvs[e],2))})),o.material&&"AllSame"!==o.material.mappingType){var u=s.materialIndex[0],h=0;if(s.materialIndex.forEach((function(t,e){t!==u&&(i.addGroup(h,e-h,u),u=t,h=e)})),i.groups.length>0){var d=i.groups[i.groups.length-1],p=d.start+d.count;p!==s.materialIndex.length&&i.addGroup(p,s.materialIndex.length-p,u)}0===i.groups.length&&i.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(i,t,n,r),i},parseGeoNode:function(t,e){var n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];for(var r=0;t.LayerElementUV[r];)t.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[r])),r++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:e,weight:t.weights[i]})}))}))),n},genBuffers:function(t){var e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,o=[],s=[],a=[],c=[],l=[],u=[],h=this;return t.vertexIndices.forEach((function(d,p){var m=!1;d<0&&(d^=-1,m=!0);var g=[],v=[];if(o.push(3*d,3*d+1,3*d+2),t.color){var y=f(p,n,d,t.color);a.push(y[0],y[1],y[2])}if(t.skeleton){if(void 0!==t.weightTable[d]&&t.weightTable[d].forEach((function(t){v.push(t.weight),g.push(t.id)})),v.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var b=[0,0,0,0],x=[0,0,0,0];v.forEach((function(t,e){var n=t,r=g[e];x.forEach((function(t,e,i){if(n>t){i[e]=n,n=t;var o=b[e];b[e]=r,r=o}}))})),g=b,v=x}for(;v.length<4;)v.push(0),g.push(0);for(var _=0;_<4;++_)l.push(v[_]),u.push(g[_])}if(t.normal){y=f(p,n,d,t.normal);s.push(y[0],y[1],y[2])}if(t.material&&"AllSame"!==t.material.mappingType)var w=f(p,n,d,t.material)[0];t.uv&&t.uv.forEach((function(t,e){var r=f(p,n,d,t);void 0===c[e]&&(c[e]=[]),c[e].push(r[0]),c[e].push(r[1])})),r++,m&&(h.genFace(e,t,o,w,s,a,c,l,u,r),n++,r=0,o=[],s=[],a=[],c=[],l=[],u=[])})),e},genFace:function(t,e,n,r,i,o,s,a,c,l){for(var u=2;u<l;u++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[3*(u-1)]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+1]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+2]]),t.vertex.push(e.vertexPositions[n[3*u]]),t.vertex.push(e.vertexPositions[n[3*u+1]]),t.vertex.push(e.vertexPositions[n[3*u+2]]),e.skeleton&&(t.vertexWeights.push(a[0]),t.vertexWeights.push(a[1]),t.vertexWeights.push(a[2]),t.vertexWeights.push(a[3]),t.vertexWeights.push(a[4*(u-1)]),t.vertexWeights.push(a[4*(u-1)+1]),t.vertexWeights.push(a[4*(u-1)+2]),t.vertexWeights.push(a[4*(u-1)+3]),t.vertexWeights.push(a[4*u]),t.vertexWeights.push(a[4*u+1]),t.vertexWeights.push(a[4*u+2]),t.vertexWeights.push(a[4*u+3]),t.weightsIndices.push(c[0]),t.weightsIndices.push(c[1]),t.weightsIndices.push(c[2]),t.weightsIndices.push(c[3]),t.weightsIndices.push(c[4*(u-1)]),t.weightsIndices.push(c[4*(u-1)+1]),t.weightsIndices.push(c[4*(u-1)+2]),t.weightsIndices.push(c[4*(u-1)+3]),t.weightsIndices.push(c[4*u]),t.weightsIndices.push(c[4*u+1]),t.weightsIndices.push(c[4*u+2]),t.weightsIndices.push(c[4*u+3])),e.color&&(t.colors.push(o[0]),t.colors.push(o[1]),t.colors.push(o[2]),t.colors.push(o[3*(u-1)]),t.colors.push(o[3*(u-1)+1]),t.colors.push(o[3*(u-1)+2]),t.colors.push(o[3*u]),t.colors.push(o[3*u+1]),t.colors.push(o[3*u+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(r),t.materialIndex.push(r),t.materialIndex.push(r)),e.normal&&(t.normal.push(i[0]),t.normal.push(i[1]),t.normal.push(i[2]),t.normal.push(i[3*(u-1)]),t.normal.push(i[3*(u-1)+1]),t.normal.push(i[3*(u-1)+2]),t.normal.push(i[3*u]),t.normal.push(i[3*u+1]),t.normal.push(i[3*u+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(s[n][0]),t.uvs[n].push(s[n][1]),t.uvs[n].push(s[n][2*(u-1)]),t.uvs[n].push(s[n][2*(u-1)+1]),t.uvs[n].push(s[n][2*u]),t.uvs[n].push(s[n][2*u+1])}))},addMorphTargets:function(e,n,r,i){if(0!==r.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var o=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var s=t.Objects.Geometry[r.geoID];void 0!==s&&o.genMorphGeometry(e,n,s,i,r.name)}))}))}},genMorphGeometry:function(t,e,n,r,i){for(var o=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],s=void 0!==n.Vertices?n.Vertices.a:[],a=void 0!==n.Indexes?n.Indexes.a:[],c=3*t.attributes.position.count,l=new Float32Array(c),u=0;u<a.length;u++){var h=3*a[u];l[h]=s[3*u],l[h+1]=s[3*u+1],l[h+2]=s[3*u+2]}var d={vertexIndices:o,vertexPositions:l},p=new Fg(this.genBuffers(d).vertex,3);p.name=i||n.attrName,p.applyMatrix4(r),t.morphAttributes.position.push(p)},parseNormals:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in t?i=t.NormalIndex.a:"NormalsIndex"in t&&(i=t.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:e,referenceType:n}},parseUVs:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.UV.a,i=[];return"IndexToDirect"===n&&(i=t.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:e,referenceType:n}},parseVertexColors:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Colors.a,i=[];return"IndexToDirect"===n&&(i=t.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:e,referenceType:n}},parseMaterialIndices:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=t.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:e,referenceType:n}},parseNurbsGeometry:function(t){if(void 0===cA)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Zg;var e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new Zg;for(var n,r,i=e-1,o=t.KnotVector.a,s=[],a=t.Points.a,c=0,l=a.length;c<l;c+=4)s.push((new Zf).fromArray(a,c));if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form){n=i,r=o.length-1-n;for(c=0;c<i;++c)s.push(s[c])}var u=new cA(i,o,s,n,r).getPoints(7*s.length),h=new Float32Array(3*u.length);u.forEach((function(t,e){t.toArray(h,3*e)}));var d=new Zg;return d.setAttribute("position",new Ag(h,3)),d}},s.prototype={constructor:s,parse:function(){var t=[],e=this.parseClips();if(void 0!==e)for(var n in e){var r=e[n],i=this.addClip(r);t.push(i)}return t},parseClips:function(){if(void 0!==t.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}},parseAnimationCurveNodes:function(){var e=t.Objects.AnimationCurveNode,n=new Map;for(var r in e){var i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var o={id:i.id,attr:i.attrName,curves:{}};n.set(o.id,o)}}return n},parseAnimationCurves:function(n){var r=t.Objects.AnimationCurve;for(var i in r){var o={id:r[i].id,times:r[i].KeyTime.a.map(d),values:r[i].KeyValueFloat.a},s=e.get(o.id);if(void 0!==s){var a=s.parents[0].ID,c=s.parents[0].relationship;c.match(/X/)?n.get(a).curves.x=o:c.match(/Y/)?n.get(a).curves.y=o:c.match(/Z/)?n.get(a).curves.z=o:c.match(/d|DeformPercent/)&&n.has(a)&&(n.get(a).curves.morph=o)}}},parseAnimationLayers:function(r){var i=t.Objects.AnimationLayer,o=new Map;for(var s in i){var a=[],c=e.get(parseInt(s));if(void 0!==c)c.children.forEach((function(i,o){if(r.has(i.ID)){var s=r.get(i.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===a[o])if(void 0!==(p=e.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID)){if(void 0===(l=t.Objects.Model[p.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",i);var c={modelName:l.attrName?TM.sanitizeNodeName(l.attrName):"",ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(t){t.ID===l.id&&(c.transform=t.matrix,t.userData.transformData&&(c.eulerOrder=t.userData.transformData.eulerOrder))})),c.transform||(c.transform=new Am),"PreRotation"in l&&(c.preRotation=l.PreRotation.value),"PostRotation"in l&&(c.postRotation=l.PostRotation.value),a[o]=c}a[o]&&(a[o][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===a[o]){var l,u=e.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,h=e.get(u).parents[0].ID,d=e.get(h).parents[0].ID,p=e.get(d).parents[0].ID;c={modelName:(l=t.Objects.Model[p]).attrName?TM.sanitizeNodeName(l.attrName):"",morphName:t.Objects.Deformer[u].attrName};a[o]=c}a[o][s.attr]=s}}})),o.set(parseInt(s),a)}return o},parseAnimStacks:function(n){var r=t.Objects.AnimationStack,i={};for(var o in r){var s=e.get(parseInt(o)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var a=n.get(s[0].ID);i[o]={name:r[o].attrName,layer:a}}return i},addClip:function(t){var e=[],n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new tw(t.name,-1,e)},generateTracks:function(t){var e=[],n=new Qf,r=new Kf,i=new Qf;if(t.transform&&t.transform.decompose(n,r,i),n=n.toArray(),r=(new Dm).setFromQuaternion(r,t.eulerOrder).toArray(),i=i.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var o=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==o&&e.push(o)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var s=this.generateRotationTrack(t.modelName,t.R.curves,r,t.preRotation,t.postRotation,t.eulerOrder);void 0!==s&&e.push(s)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var a=this.generateVectorTrack(t.modelName,t.S.curves,i,"scale");void 0!==a&&e.push(a)}if(void 0!==t.DeformPercent){var c=this.generateMorphTrack(t);void 0!==c&&e.push(c)}return e},generateVectorTrack:function(t,e,n,r){var i=this.getTimesForAllAxes(e);return new Q_(t+"."+r,i,this.getKeyframeTrackValues(i,e,n))},generateRotationTrack:function(t,e,n,r,i,o){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(Hf.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(Hf.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(Hf.degToRad));var s=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(s,e,n);void 0!==r&&((r=r.map(Hf.degToRad)).push(o),r=(new Dm).fromArray(r),r=(new Kf).setFromEuler(r)),void 0!==i&&((i=i.map(Hf.degToRad)).push(o),i=(new Dm).fromArray(i),i=(new Kf).setFromEuler(i).invert());for(var c=new Kf,l=new Dm,u=[],h=0;h<a.length;h+=3)l.set(a[h],a[h+1],a[h+2],o),c.setFromEuler(l),void 0!==r&&c.premultiply(r),void 0!==i&&c.multiply(i),c.toArray(u,h/3*4);return new $_(t+".quaternion",s,u)},generateMorphTrack:function(t){var e=t.DeformPercent.curves.morph,r=e.values.map((function(t){return t/100})),i=n.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new Z_(t.modelName+".morphTargetInfluences["+i+"]",e.times,r)},getTimesForAllAxes:function(t){var e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),(e=e.sort((function(t,e){return t-e}))).length>1){for(var n=1,r=e[0],i=1;i<e.length;i++){var o=e[i];o!==r&&(e[n]=o,r=o,n++)}e=e.slice(0,n)}return e},getKeyframeTrackValues:function(t,e,n){var r=n,i=[],o=-1,s=-1,a=-1;return t.forEach((function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(s=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==o){var n=e.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==s){var c=e.y.values[s];i.push(c),r[1]=c}else i.push(r[1]);if(-1!==a){var l=e.z.values[a];i.push(l),r[2]=l}else i.push(r[2])})),i},interpolateRotations:function(t){for(var e=1;e<t.values.length;e++){var n=t.values[e-1],r=t.values[e]-n,i=Math.abs(r);if(i>=180){for(var o=i/180,s=r/o,a=n+s,c=t.times[e-1],l=(t.times[e]-c)/o,u=c+l,h=[],d=[];u<t.times[e];)h.push(u),u+=l,d.push(a),a+=s;t.times=_(t.times,e,h),t.values=_(t.values,e,d)}}}},a.prototype={constructor:a,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new u,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,r){var i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!i&&!o){var s=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=t.match("^\\t{"+(e.currentIndent-1)+"}}");s?e.parseNodeBegin(t,s):a?e.parseNodeProperty(t,a,n[++r]):c?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}})),this.allNodes},parseNodeBegin:function(t,e){var n=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in s?("PoseNode"===n?s.PoseNode.push(i):void 0!==s[n].id&&(s[n]={},s[n][s[n].id]=s[n]),""!==o.id&&(s[n][o.id]=i)):"number"==typeof o.id?(s[n]={},s[n][o.id]=i):"Properties70"!==n&&(s[n]="PoseNode"===n?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var n="",r="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),r=t[2]),{id:e,name:n,type:r}},parseNodeProperty:function(t,e,n){var r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var s=i.split(",").slice(1),a=parseInt(s[0]),c=parseInt(s[1]),l=i.split(",").slice(3);r="connections",function(t,e){for(var n=0,r=t.length,i=e.length;n<i;n++,r++)t[r]=e[n]}(i=[a,c],l=l.map((function(t){return t.trim().replace(/^"/,"")}))),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=b(i))}else this.parseNodeSpecialProperty(t,r,i)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=b(e.a))},parseNodeSpecialProperty:function(t,e,n){var r=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],s=r[2],a=r[3],c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=b(c)}this.getPrevNode()[i]={type:o,type2:s,flag:a,value:c},this.setCurrentProp(this.getPrevNode(),i)}},c.prototype={constructor:c,parse:function(t){var e=new l(t);e.skip(23);var n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var r=new u;!this.endOfContent(e);){var i=this.parseNode(e,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var n={},r=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();var o=t.getUint8(),s=t.getString(o);if(0===r)return null;for(var a=[],c=0;c<i;c++)a.push(this.parseProperty(t));var l=a.length>0?a[0]:"",u=a.length>1?a[1]:"",h=a.length>2?a[2]:"";for(n.singleProperty=1===i&&t.getOffset()===r;r>t.getOffset();){var d=this.parseNode(t,e);null!==d&&this.parseSubNode(s,n,d)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==s&&(n.name=s),n},parseSubNode:function(t,e,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(e[n.name]=n,n.a=r):e[n.name]=r}else if("Connections"===t&&"C"===n.name){var i=[];n.propertyList.forEach((function(t,e){0!==e&&i.push(t)})),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===n.name){Object.keys(n).forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){var o,s=n.propertyList[0],a=n.propertyList[1],c=n.propertyList[2],l=n.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),o="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[s]={type:a,type2:c,flag:l,value:o}}else void 0===e[n.name]?"number"==typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var n=t.getUint32();return t.getArrayBuffer(n);case"S":n=t.getUint32();return t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=t.getUint32(),i=t.getUint32(),o=t.getUint32();if(0===i)switch(e){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}void 0===sA&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new l(new sA(new Uint8Array(t.getArrayBuffer(o))).decompress().buffer);switch(e){case"b":case"c":return s.getBooleanArray(r);case"d":return s.getFloat64Array(r);case"f":return s.getFloat32Array(r);case"i":return s.getInt32Array(r);case"l":return s.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}},l.prototype={constructor:l,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295===(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t},getInt64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=[],n=0;n<t;n++)e[n]=this.getUint8();var r=e.indexOf(0);return r>=0&&(e=e.slice(0,r)),Kw(new Uint8Array(e))}},u.prototype={constructor:u,add:function(t,e){this[t]=e}};var p=[];function f(t,e,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var o=i*r.dataSize,s=o+r.dataSize;return function(t,e,n,r){for(var i=n,o=0;i<r;i++,o++)t[o]=e[i];return t}(p,r.buffer,o,s)}var m=new Dm,g=new Qf;function v(t){var e,n=new Am,r=new Am,i=new Am,o=new Am,s=new Am,a=new Am,c=new Am,l=new Am,u=new Am,h=new Am,d=new Am,p=t.inheritType?t.inheritType:0;(t.translation&&n.setPosition(g.fromArray(t.translation)),t.preRotation)&&((e=t.preRotation.map(Hf.degToRad)).push(t.eulerOrder),r.makeRotationFromEuler(m.fromArray(e)));t.rotation&&((e=t.rotation.map(Hf.degToRad)).push(t.eulerOrder),i.makeRotationFromEuler(m.fromArray(e)));t.postRotation&&((e=t.postRotation.map(Hf.degToRad)).push(t.eulerOrder),o.makeRotationFromEuler(m.fromArray(e)));t.scale&&s.scale(g.fromArray(t.scale)),t.scalingOffset&&c.setPosition(g.fromArray(t.scalingOffset)),t.scalingPivot&&a.setPosition(g.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(g.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(g.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h=t.parentMatrixWorld);var f=r.multiply(i).multiply(o),v=new Am;h.extractRotation(v),(new Am).copyPosition(h);var y=new Am;y.copy(v).invert().multiply(h);var b=new Am;if(0===p)b.copy(v).multiply(f).multiply(y).multiply(s);else if(1===p)b.copy(v).multiply(y).multiply(f).multiply(s);else{var x=new Am;x.copy(s).invert();var _=(new Am).multiply(y).multiply(x);b.copy(v).multiply(f).multiply(_).multiply(s)}var w=new Am;w.copy(u).invert();var M=new Am;M.copy(a).invert();var E=new Am;E.copy(n).multiply(l).multiply(u).multiply(r).multiply(i).multiply(o).multiply(w).multiply(c).multiply(a).multiply(s).multiply(M);var S=(new Am).copyPosition(E),T=(new Am).copy(h).multiply(S);return d.copyPosition(T),E=(new Am).multiply(d).multiply(b)}function y(t){var e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function b(t){return t.split(",").map((function(t){return parseFloat(t)}))}function x(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),Kw(new Uint8Array(t,e,n))}function _(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}return r}(),vA=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},yA=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},bA=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},xA=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let _A=class extends vd{constructor(){super(...arguments),lA.add(this),this.src="",uA.set(this,0),hA.set(this,[])}loadGL(){return!!super.loadGL()&&(this.loader=new gA,bA(this,hA,"f").push(Zr(()=>{this.src,bA(this,lA,"m",dA).call(this),xA(this,uA,+bA(this,uA,"f")+1,"f"),bA(this,lA,"m",pA).call(this)})),!0)}unloadGL(){if(!super.unloadGL())return!1;for(const t of bA(this,hA,"f"))t();return bA(this,hA,"f").length=0,this.loader=void 0,bA(this,lA,"m",dA).call(this),xA(this,uA,+bA(this,uA,"f")+1,"f"),!0}};uA=new WeakMap,hA=new WeakMap,lA=new WeakSet,dA=function(){this.model&&Rh(this.model),this.model=void 0},pA=function(){const{src:t}=this,e=bA(this,uA,"f");t&&this.loader.load(t,t=>e===bA(this,uA,"f")&&bA(this,lA,"m",mA).call(this,t),t=>e===bA(this,uA,"f")&&this.element.emit(Mo.PROGRESS,t),t=>e===bA(this,uA,"f")&&bA(this,lA,"m",fA).call(this,t))},fA=function(t){var e;const n=null!==(e=null==t?void 0:t.message)&&void 0!==e?e:`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}".`;console.warn(n),t.error&&console.error(t.error),this.element.emit(Mo.MODEL_ERROR,t.error)},mA=function(t){this.model=t,this.element.three.add(t),this.element.emit(Mo.MODEL_LOAD,{format:"fbx",model:t}),this.element.needsUpdate()},_A._observedProperties=["src",...vd._observedProperties||[]],vA([ai(""),yA("design:type",Object)],_A.prototype,"src",void 0),_A=vA([Jr],_A),elementBehaviors.has("fbx-model")||elementBehaviors.define("fbx-model",_A);class wA extends os{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}var MA=function(t){ow.call(this,t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};MA.prototype=Object.assign(Object.create(ow.prototype),{constructor:MA,setDecoderPath:function(t){return this.decoderPath=t,this},setDecoderConfig:function(t){return this.decoderConfig=t,this},setWorkerLimit:function(t){return this.workerLimit=t,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(t,e,n,r){var i=new aw(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,t=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,n).then(e).catch(r)},n,r)},decodeDracoFile:function(t,e,n,r){var i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(t,i).then(e)},decodeGeometry:function(t,e){for(var n in e.attributeTypes){var r=e.attributeTypes[n];void 0!==r.BYTES_PER_ELEMENT&&(e.attributeTypes[n]=r.name)}var i,o=JSON.stringify(e);if(MA.taskCache.has(t)){var s=MA.taskCache.get(t);if(s.key===o)return s.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var a=this.workerNextTaskID++,c=t.byteLength,l=this._getWorker(a,c).then(n=>(i=n,new Promise((n,r)=>{i._callbacks[a]={resolve:n,reject:r},i.postMessage({type:"decode",id:a,taskConfig:e,buffer:t},[t])}))).then(t=>this._createGeometry(t.geometry));return l.catch(()=>!0).then(()=>{i&&a&&this._releaseTask(i,a)}),MA.taskCache.set(t,{key:o,promise:l}),l},_createGeometry:function(t){var e=new Zg;t.index&&e.setIndex(new Ag(t.index.array,1));for(var n=0;n<t.attributes.length;n++){var r=t.attributes[n],i=r.name,o=r.array,s=r.itemSize;e.setAttribute(i,new Ag(o,s))}return e},_loadLibrary:function(t,e){var n=new aw(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),n.setWithCredentials(this.withCredentials),new Promise((e,r)=>{n.load(t,e,void 0,r)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(e=>{var n=e[0];t||(this.decoderConfig.wasmBinary=e[1]);var r=MA.DRACOWorker.toString(),i=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending},_getWorker:function(t,e){return this._initDecoder().then(()=>{var n;this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(t){var e=t.data;switch(e.type){case"decode":n._callbacks[e.id].resolve(e);break;case"error":n._callbacks[e.id].reject(e);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+e.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));return(n=this.workerPool[this.workerPool.length-1])._taskCosts[t]=e,n._taskLoad+=e,n})},_releaseTask:function(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]},debug:function(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))},dispose:function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}),MA.DRACOWorker=function(){var t,e;function n(t,e,n,r,i,o){var s=o.num_components(),a=n.num_points()*s,c=a*i.BYTES_PER_ELEMENT,l=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,i),u=t._malloc(c);e.GetAttributeDataArrayForAllPoints(n,o,l,c,u);var h=new i(t.HEAPF32.buffer,u,a).slice();return t._free(u),{name:r,array:h,itemSize:s}}onmessage=function(r){var i=r.data;switch(i.type){case"init":t=i.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":var o=i.buffer,s=i.taskConfig;e.then(t=>{var e=t.draco,r=new e.Decoder,a=new e.DecoderBuffer;a.Init(new Int8Array(o),o.byteLength);try{var c=function(t,e,r,i){var o,s,a=i.attributeIDs,c=i.attributeTypes,l=e.GetEncodedGeometryType(r);if(l===t.TRIANGULAR_MESH)o=new t.Mesh,s=e.DecodeBufferToMesh(r,o);else{if(l!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new t.PointCloud,s=e.DecodeBufferToPointCloud(r,o)}if(!s.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var u={index:null,attributes:[]};for(var h in a){var d,p,f=self[c[h]];if(i.useUniqueIDs)p=a[h],d=e.GetAttributeByUniqueId(o,p);else{if(-1===(p=e.GetAttributeId(o,t[a[h]])))continue;d=e.GetAttribute(o,p)}u.attributes.push(n(t,e,o,h,f,d))}l===t.TRIANGULAR_MESH&&(u.index=function(t,e,n){var r=3*n.num_faces(),i=4*r,o=t._malloc(i);e.GetTrianglesUInt32Array(n,i,o);var s=new Uint32Array(t.HEAPF32.buffer,o,r).slice();return t._free(o),{array:s,itemSize:1}}(t,e,o));return t.destroy(o),u}(e,r,a,s),l=c.attributes.map(t=>t.array.buffer);c.index&&l.push(c.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:c},l)}catch(t){console.error(t),self.postMessage({type:"error",id:i.id,error:t.message})}finally{e.destroy(a),e.destroy(r)}})}}},MA.taskCache=new WeakMap,MA.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},MA.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},MA.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},MA.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};var EA,SA,TA,AA,RA,LA,CA,PA=function(){function t(t){ow.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new s(t)})),this.register((function(t){return new c(t)})),this.register((function(t){return new l(t)})),this.register((function(t){return new a(t)})),this.register((function(t){return new i(t)})),this.register((function(t){return new u(t)}))}function e(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(ow.prototype),{constructor:t,load:function(t,e,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Qw(t),this.manager.itemStart(t);var s=function(e){r?r(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},a=new aw(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{o.parse(n,i,(function(n){e(n),o.manager.itemEnd(t)}),s)}catch(t){s(t)}}),n,s)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},setKTX2Loader:function(t){return this.ktx2Loader=t,this},setMeshoptDecoder:function(t){return this.meshoptDecoder=t,this},register:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse:function(t,e,i,s){var a,c={},l={};if("string"==typeof t)a=t;else if(Kw(new Uint8Array(t,0,4))===h){try{c[n.KHR_BINARY_GLTF]=new f(t)}catch(t){return void(s&&s(t))}a=c[n.KHR_BINARY_GLTF].content}else a=Kw(new Uint8Array(t));var u=JSON.parse(a);if(void 0===u.asset||u.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var d=new j(u,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(var p=0;p<this.pluginCallbacks.length;p++){var v=this.pluginCallbacks[p](d);l[v.name]=v,c[v.name]=!0}if(u.extensionsUsed)for(p=0;p<u.extensionsUsed.length;++p){var x=u.extensionsUsed[p],_=u.extensionsRequired||[];switch(x){case n.KHR_MATERIALS_UNLIT:c[x]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:c[x]=new y;break;case n.KHR_DRACO_MESH_COMPRESSION:c[x]=new m(u,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:c[x]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:c[x]=new g;break;case n.KHR_MESH_QUANTIZATION:c[x]=new b;break;default:_.indexOf(x)>=0&&void 0===l[x]&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}d.setExtensions(c),d.setPlugins(l),d.parse(i,s)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=t}function i(t){this.parser=t,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function o(){this.name=n.KHR_MATERIALS_UNLIT}function s(t){this.parser=t,this.name=n.KHR_MATERIALS_CLEARCOAT}function a(t){this.parser=t,this.name=n.KHR_MATERIALS_TRANSMISSION}function c(t){this.parser=t,this.name=n.KHR_TEXTURE_BASISU}function l(t){this.parser=t,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function u(t){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=t}i.prototype._markDefs=function(){for(var t=this.parser,e=this.parser.json.nodes||[],n=0,r=e.length;n<r;n++){var i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}},i.prototype._loadLight=function(t){var e=this.parser,n="light:"+t,r=e.cache.get(n);if(r)return r;var i,o=e.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t],a=new xg(16777215);void 0!==s.color&&a.fromArray(s.color);var c=void 0!==s.range?s.range:0;switch(s.type){case"directional":(i=new qw(a)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new jw(a)).distance=c;break;case"spot":(i=new Hw(a)).distance=c,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,i.angle=s.spot.outerConeAngle,i.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return i.position.set(0,0,0),i.decay=2,void 0!==s.intensity&&(i.intensity=s.intensity),i.name=e.createUniqueName(s.name||"light_"+t),r=Promise.resolve(i),e.cache.add(n,r),r},i.prototype.createNodeAttachment=function(t){var e=this,n=this.parser,r=n.json.nodes[t],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(t){return n._getNodeRef(e.cache,i,t)}))},o.prototype.getMaterialType=function(){return Eg},o.prototype.extendParams=function(t,e,n){var r=[];t.color=new xg(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(r)},s.prototype.getMaterialType=function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?N_:null},s.prototype.extendMaterialParams=function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(e.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var s=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Gf(s,s)}return Promise.all(i)},a.prototype.getMaterialType=function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?N_:null},a.prototype.extendMaterialParams=function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(e.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(i)},c.prototype.loadTexture=function(t){var e=this.parser,n=e.json,r=n.textures[t];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,o,s)},l.prototype.loadTexture=function(t){var e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;var o=i.extensions[e],s=r.images[o.source],a=s.uri?n.options.manager.getHandler(s.uri):n.textureLoader;return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,s,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))},l.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(t){var e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported},u.prototype.loadBufferView=function(t){var e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(t){var e=r.byteOffset||0,n=r.byteLength||0,i=r.count,s=r.byteStride,a=new ArrayBuffer(i*s),c=new Uint8Array(t[0],e,n);return o.decodeGltfBuffer(new Uint8Array(a),i,s,c,r.mode,r.filter),a}))}return null};var h="glTF",d=1313821514,p=5130562;function f(t){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,12);if(this.header={magic:Kw(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=new DataView(t,12),i=0;i<r.byteLength;){var o=r.getUint32(i,!0);i+=4;var s=r.getUint32(i,!0);if(i+=4,s===d){var a=new Uint8Array(t,12+i,o);this.content=Kw(a)}else if(s===p){var c=12+i;this.body=t.slice(c,c+o)}i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function g(){this.name=n.KHR_TEXTURE_TRANSFORM}function v(t){O_.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new xg).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(t){for(var a in s)t.uniforms[a]=s[a];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(t){s.specular.value=t}},specularMap:{get:function(){return s.specularMap.value},set:function(t){s.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(t){s.glossiness.value=t}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(t){s.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function y(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return v},extendParams:function(t,e,n){var r=e.extensions[this.name];t.color=new xg(1,1,1),t.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;t.color.fromArray(o),t.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(t,"map",r.diffuseTexture)),t.emissive=new xg(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new xg(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var s=r.specularGlossinessTexture;i.push(n.assignTexture(t,"glossinessMap",s)),i.push(n.assignTexture(t,"specularMap",s))}return Promise.all(i)},createMaterial:function(t){var e=new v(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=0,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function b(){this.name=n.KHR_MESH_QUANTIZATION}function x(t,e,n,r){G_.call(this,t,e,n,r)}m.prototype.decodePrimitive=function(t,e){var n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,s={},a={},c={};for(var l in o){var u=O[l]||l.toLowerCase();s[u]=o[l]}for(l in t.attributes){u=O[l]||l.toLowerCase();if(void 0!==o[l]){var h=n.accessors[t.attributes[l]],d=R[h.componentType];c[u]=d,a[u]=!0===h.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(var n in t.attributes){var r=t.attributes[n],i=a[n];void 0!==i&&(r.normalized=i)}e(t)}),s,c)}))}))},g.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},v.prototype=Object.create(O_.prototype),v.prototype.constructor=v,v.prototype.copy=function(t){return O_.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},x.prototype=Object.create(G_.prototype),x.prototype.constructor=x,x.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r,o=0;o!==r;o++)e[o]=n[i+o];return e},x.prototype.beforeStart_=x.prototype.copySampleValue_,x.prototype.afterEnd_=x.prototype.copySampleValue_,x.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,c=3*s,l=r-e,u=(n-e)/l,h=u*u,d=h*u,p=t*c,f=p-c,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u,b=0;b!==s;b++){var x=o[f+b+s],_=o[f+b+a]*l,w=o[p+b+s],M=o[p+b]*l;i[b]=v*x+y*_+m*w+g*M}return i};var _=0,w=1,M=2,E=3,S=4,T=5,A=6,R={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},L={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},C={33071:1001,33648:1002,10497:1e3},P={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},O={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},N={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},D="OPAQUE",F="MASK",U="BLEND";function B(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function k(t,e,n){for(var r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function z(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function H(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)t.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function G(t){for(var e="",n=Object.keys(t).sort(),r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function j(t,n){this.json=t||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new rM(this.options.manager):this.textureLoader=new pw(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new aw(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function V(t,e,n){var r=e.attributes,i=[];function o(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var s in r){var a=O[s]||s.toLowerCase();a in t.attributes||i.push(o(r[s],a))}if(void 0!==e.indices&&!t.index){var c=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(c)}return z(t,e),function(t,e,n){var r=e.attributes,i=new nm;if(void 0!==r.POSITION){var o=(p=n.json.accessors[r.POSITION]).min,s=p.max;if(void 0!==o&&void 0!==s){i.set(new Qf(o[0],o[1],o[2]),new Qf(s[0],s[1],s[2]));var a=e.targets;if(void 0!==a){for(var c=new Qf,l=new Qf,u=0,h=a.length;u<h;u++){var d=a[u];if(void 0!==d.POSITION){var p;o=(p=n.json.accessors[d.POSITION]).min,s=p.max;void 0!==o&&void 0!==s?(l.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),l.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),l.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),c.max(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(c)}t.boundingBox=i;var f=new ym;i.getCenter(f.center),f.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?function(t,e,n){for(var r=!1,i=!1,o=0,s=e.length;o<s;o++){if(void 0!==(l=e[o]).POSITION&&(r=!0),void 0!==l.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(t);var a=[],c=[];for(o=0,s=e.length;o<s;o++){var l=e[o];if(r){var u=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):t.attributes.position;a.push(u)}if(i){u=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):t.attributes.normal;c.push(u)}}return Promise.all([Promise.all(a),Promise.all(c)]).then((function(e){var n=e[0],o=e[1];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=o),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function W(t,e){var n=t.getIndex();if(null===n){var r=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var o=0;o<i.count;o++)r.push(o);t.setIndex(r),n=t.getIndex()}var s=n.count-2,a=[];if(2===e)for(o=1;o<=s;o++)a.push(n.getX(0)),a.push(n.getX(o)),a.push(n.getX(o+1));else for(o=0;o<s;o++)o%2==0?(a.push(n.getX(o)),a.push(n.getX(o+1)),a.push(n.getX(o+2))):(a.push(n.getX(o+2)),a.push(n.getX(o+1)),a.push(n.getX(o)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=t.clone();return c.setIndex(a),c}return j.prototype.setExtensions=function(t){this.extensions=t},j.prototype.setPlugins=function(t){this.plugins=t},j.prototype.parse=function(t,e){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){var o={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};k(i,o,r),z(o,r),t(o)})).catch(e)},j.prototype._markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r=0,i=e.length;r<i;r++)for(var o=e[r].joints,s=0,a=o.length;s<a;s++)t[o[s]].isBone=!0;for(var c=0,l=t.length;c<l;c++){var u=t[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},j.prototype._addNodeRef=function(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)},j.prototype._getNodeRef=function(t,e,n){if(t.refs[e]<=1)return n;var r=n.clone();return r.name+="_instance_"+t.uses[e]++,r},j.prototype._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}},j.prototype._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var n=[],r=0;r<e.length;r++){var i=t(e[r]);i&&n.push(i)}return n},j.prototype.getDependency=function(t,e){var n=t+":"+e,r=this.cache.get(n);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this.loadNode(e);break;case"mesh":r=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":r=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":r=this.loadSkin(e);break;case"animation":r=this.loadAnimation(e);break;case"camera":r=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,r)}return r},j.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e},j.prototype.loadBuffer=function(t){var e=this.json.buffers[t],r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(t,n){r.load(B(e.uri,i.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},j.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))},j.prototype.loadAccessor=function(t){var e=this,n=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(t){var i,o=t[0],s=P[r.type],a=R[r.componentType],c=a.BYTES_PER_ELEMENT,l=c*s,u=r.byteOffset||0,h=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(h&&h!==l){var p=Math.floor(u/h),f="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+p+":"+r.count,m=e.cache.get(f);m||(m=new kb(new a(o,p*h,r.count*h/c),h/c),e.cache.add(f,m)),i=new Hb(m,s,u%h/c,d)}else i=new Ag(null===o?new a(r.count*s):new a(o,u,r.count*s),s,d);if(void 0!==r.sparse){var g=P.SCALAR,v=R[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,x=new v(t[1],y,r.sparse.count*g),_=new a(t[2],b,r.sparse.count*s);null!==o&&(i=new Ag(i.array.slice(),i.itemSize,i.normalized));for(var w=0,M=x.length;w<M;w++){var E=x[w];if(i.setX(E,_[w*s]),s>=2&&i.setY(E,_[w*s+1]),s>=3&&i.setZ(E,_[w*s+2]),s>=4&&i.setW(E,_[w*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},j.prototype.loadTexture=function(t){var e,r,i=this.json,o=this.options,s=i.textures[t],a=s.extensions||{};return(e=a[n.MSFT_TEXTURE_DDS]?i.images[a[n.MSFT_TEXTURE_DDS].source]:i.images[s.source]).uri&&(r=o.manager.getHandler(e.uri)),r||(r=a[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(t,e,r)},j.prototype.loadTextureImage=function(t,e,n){var r=this,i=this.json,o=this.options,s=i.textures[t],a=self.URL||self.webkitURL,c=e.uri,l=!1,u=!0;return"image/jpeg"===e.mimeType&&(u=!1),void 0!==e.bufferView&&(c=r.getDependency("bufferView",e.bufferView).then((function(t){if("image/png"===e.mimeType){var n=new DataView(t,25,1).getUint8(0,!1);u=6===n||4===n||3===n}l=!0;var r=new Blob([t],{type:e.mimeType});return c=a.createObjectURL(r)}))),Promise.resolve(c).then((function(t){return new Promise((function(e,r){var i=e;!0===n.isImageBitmapLoader&&(i=function(t){e(new Gx(t))}),n.load(B(t,o.path),i,void 0,r)}))})).then((function(e){!0===l&&a.revokeObjectURL(c),e.flipY=!1,s.name&&(e.name=s.name),u||(e.format=1022);var n=(i.samplers||{})[s.sampler]||{};return e.magFilter=L[n.magFilter]||1006,e.minFilter=L[n.minFilter]||1008,e.wrapS=C[n.wrapS]||1e3,e.wrapT=C[n.wrapT]||1e3,r.associations.set(e,{type:"textures",index:t}),e}))},j.prototype.assignTexture=function(t,e,r){var i=this;return this.getDependency("texture",r.index).then((function(o){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===e&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var s=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var a=i.associations.get(o);o=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),i.associations.set(o,a)}}t[e]=o}))},j.prototype.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,r=void 0!==e.attributes.tangent,i=void 0!==e.attributes.color,o=void 0===e.attributes.normal,s=!0===t.isSkinnedMesh,a=Object.keys(e.morphAttributes).length>0,c=a&&void 0!==e.morphAttributes.normal;if(t.isPoints){var l="PointsMaterial:"+n.uuid,u=this.cache.get(l);u||(u=new Nx,Mg.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(l,u)),n=u}else if(t.isLine){l="LineBasicMaterial:"+n.uuid;var h=this.cache.get(l);h||(h=new wx,Mg.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(l,h)),n=h}if(r||i||o||s||a){l="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),s&&(l+="skinning:"),r&&(l+="vertex-tangents:"),i&&(l+="vertex-colors:"),o&&(l+="flat-shading:"),a&&(l+="morph-targets:"),c&&(l+="morph-normals:");var d=this.cache.get(l);d||(d=n.clone(),s&&(d.skinning=!0),r&&(d.vertexTangents=!0),i&&(d.vertexColors=!0),o&&(d.flatShading=!0),a&&(d.morphTargets=!0),c&&(d.morphNormals=!0),this.cache.add(l,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),n.normalScale&&!r&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!r&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),t.material=n},j.prototype.getMaterialType=function(){return O_},j.prototype.loadMaterial=function(t){var e,r=this,i=this.json,o=this.extensions,s=i.materials[t],a={},c=s.extensions||{},l=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=u.getMaterialType(),l.push(u.extendParams(a,s,r))}else if(c[n.KHR_MATERIALS_UNLIT]){var h=o[n.KHR_MATERIALS_UNLIT];e=h.getMaterialType(),l.push(h.extendParams(a,s,r))}else{var d=s.pbrMetallicRoughness||{};if(a.color=new xg(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}void 0!==d.baseColorTexture&&l.push(r.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(l.push(r.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),l.push(r.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)}))))}!0===s.doubleSided&&(a.side=2);var f=s.alphaMode||D;return f===U?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,f===F&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==Eg&&(l.push(r.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Gf(1,1),void 0!==s.normalTexture.scale&&a.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&e!==Eg&&(l.push(r.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&e!==Eg&&(a.emissive=(new xg).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&e!==Eg&&l.push(r.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){var i;return i=e===v?o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new e(a),s.name&&(i.name=s.name),i.map&&(i.map.encoding=3001),i.emissiveMap&&(i.emissiveMap.encoding=3001),z(i,s),r.associations.set(i,{type:"materials",index:t}),s.extensions&&k(o,i,s),i}))},j.prototype.createUniqueName=function(t){for(var e=TM.sanitizeNodeName(t||""),n=e,r=1;this.nodeNamesUsed[n];++r)n=e+"_"+r;return this.nodeNamesUsed[n]=!0,n},j.prototype.loadGeometries=function(t){var e=this,r=this.extensions,i=this.primitiveCache;function o(t){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return V(n,t,e)}))}for(var s,a,c=[],l=0,u=t.length;l<u;l++){var h,d=t[l],p=(a=void 0,(a=(s=d).extensions&&s.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+G(a.attributes):s.indices+":"+G(s.attributes)+":"+s.mode),f=i[p];if(f)c.push(f.promise);else h=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(d):V(new Zg,d,e),i[p]={primitive:d,promise:h},c.push(h)}return Promise.all(c)},j.prototype.loadMesh=function(t){for(var e,n=this,r=this.json,i=this.extensions,o=r.meshes[t],s=o.primitives,a=[],c=0,l=s.length;c<l;c++){var u=void 0===s[c].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new O_({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial):this.getDependency("material",s[c].material);a.push(u)}return a.push(n.loadGeometries(s)),Promise.all(a).then((function(e){for(var r=e.slice(0,e.length-1),a=e[e.length-1],c=[],l=0,u=a.length;l<u;l++){var h,d=a[l],p=s[l],f=r[l];if(p.mode===S||p.mode===T||p.mode===A||void 0===p.mode)!0!==(h=!0===o.isSkinnedMesh?new dx(d,f):new pv(d,f)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),p.mode===T?h.geometry=W(h.geometry,1):p.mode===A&&(h.geometry=W(h.geometry,2));else if(p.mode===w)h=new Px(d,f);else if(p.mode===E)h=new Rx(d,f);else if(p.mode===M)h=new Ox(d,f);else{if(p.mode!==_)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);h=new Bx(d,f)}Object.keys(h.geometry.morphAttributes).length>0&&H(h,o),h.name=n.createUniqueName(o.name||"mesh_"+t),z(h,o),p.extensions&&k(i,h,p),n.assignFinalMaterial(h),c.push(h)}if(1===c.length)return c[0];var m=new Ob;for(l=0,u=c.length;l<u;l++)m.add(c[l]);return m}))},j.prototype.loadCamera=function(t){var e,n=this.json.cameras[t],r=n[n.type];if(r)return"perspective"===n.type?e=new wv(Hf.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(e=new Vw(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),z(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},j.prototype.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))},j.prototype.loadAnimation=function(t){for(var e=this.json.animations[t],n=[],r=[],i=[],o=[],s=[],a=0,c=e.channels.length;a<c;a++){var l=e.channels[a],u=e.samplers[l.sampler],h=l.target,d=void 0!==h.node?h.node:h.id,p=void 0!==e.parameters?e.parameters[u.input]:u.input,f=void 0!==e.parameters?e.parameters[u.output]:u.output;n.push(this.getDependency("node",d)),r.push(this.getDependency("accessor",p)),i.push(this.getDependency("accessor",f)),o.push(u),s.push(h)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(s)]).then((function(n){for(var r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=[],l=0,u=r.length;l<u;l++){var h=r[l],d=i[l],p=o[l],f=s[l],m=a[l];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,N[m.path]){case N.weights:g=Z_;break;case N.rotation:g=$_;break;case N.position:case N.scale:default:g=Q_}var v=h.name?h.name:h.uuid,y=void 0!==f.interpolation?I[f.interpolation]:2301,b=[];N[m.path]===N.weights?h.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&b.push(t.name?t.name:t.uuid)})):b.push(v);var _=p.array;if(p.normalized){var w;if(_.constructor===Int8Array)w=1/127;else if(_.constructor===Uint8Array)w=1/255;else if(_.constructor==Int16Array)w=1/32767;else{if(_.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var M=new Float32Array(_.length),E=0,S=_.length;E<S;E++)M[E]=_[E]*w;_=M}for(E=0,S=b.length;E<S;E++){var T=new g(b[E]+"."+N[m.path],d.array,_,y);"CUBICSPLINE"===f.interpolation&&(T.createInterpolant=function(t){return new x(this.times,this.values,this.getValueSize()/3,t)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(T)}}}return new tw(e.name?e.name:"animation_"+t,void 0,c)}))},j.prototype.loadNode=function(t){var e,n=this.json,r=this.extensions,i=this,o=n.nodes[t],s=o.name?i.createUniqueName(o.name):"";return(e=[],void 0!==o.mesh&&e.push(i.getDependency("mesh",o.mesh).then((function(t){var e=i._getNodeRef(i.meshCache,o.mesh,t);return void 0!==o.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,n=o.weights.length;e<n;e++)t.morphTargetInfluences[e]=o.weights[e]})),e}))),void 0!==o.camera&&e.push(i.getDependency("camera",o.camera).then((function(t){return i._getNodeRef(i.cameraCache,o.camera,t)}))),i._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)).then((function(e){var n;if((n=!0===o.isBone?new px:e.length>1?new Ob:1===e.length?e[0]:new Km)!==e[0])for(var a=0,c=e.length;a<c;a++)n.add(e[a]);if(o.name&&(n.userData.name=o.name,n.name=s),z(n,o),o.extensions&&k(r,n,o),void 0!==o.matrix){var l=new Am;l.fromArray(o.matrix),n.applyMatrix4(l)}else void 0!==o.translation&&n.position.fromArray(o.translation),void 0!==o.rotation&&n.quaternion.fromArray(o.rotation),void 0!==o.scale&&n.scale.fromArray(o.scale);return i.associations.set(n,{type:"nodes",index:t}),n}))},j.prototype.loadScene=function(){function t(e,n,r,i){var o=r.nodes[e];return i.getDependency("node",e).then((function(t){return void 0===o.skin?t:i.getDependency("skin",o.skin).then((function(t){for(var n=[],r=0,o=(e=t).joints.length;r<o;r++)n.push(i.getDependency("node",e.joints[r]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var r=[],i=[],o=0,s=n.length;o<s;o++){var a=n[o];if(a){r.push(a);var c=new Am;void 0!==e.inverseBindMatrices&&c.fromArray(e.inverseBindMatrices.array,16*o),i.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[o])}t.bind(new gx(r,i),t.matrixWorld)}})),t}));var e})).then((function(e){n.add(e);var s=[];if(o.children)for(var a=o.children,c=0,l=a.length;c<l;c++){var u=a[c];s.push(t(u,e,r,i))}return Promise.all(s)}))}return function(e){var n=this.json,r=this.extensions,i=this.json.scenes[e],o=new Ob;i.name&&(o.name=this.createUniqueName(i.name)),z(o,i),i.extensions&&k(r,o,i);for(var s=i.nodes||[],a=[],c=0,l=s.length;c<l;c++)a.push(t(s[c],o,n,this));return Promise.all(a).then((function(){return o}))}}(),t}(),OA=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},NA=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},IA=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},DA=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let FA=class extends vd{constructor(){super(...arguments),EA.add(this),this.src="",this.dracoDecoder="",this.centerGeometry=!1,this.model=null,SA.set(this,0),TA.set(this,[])}loadGL(){if(!super.loadGL())return!1;this.dracoLoader=new MA,this.gltfLoader=new PA,this.gltfLoader.setDRACOLoader(this.dracoLoader);let t=!0;return IA(this,TA,"f").push(Zr(()=>{this.dracoDecoder&&(t||this.dracoLoader.dispose(),this.dracoLoader.setDecoderPath(this.dracoDecoder))}),Zr(()=>{this.src,this.dracoDecoder,this.centerGeometry,IA(this,EA,"m",AA).call(this),DA(this,SA,+IA(this,SA,"f")+1,"f"),IA(this,EA,"m",RA).call(this)})),t=!1,!0}unloadGL(){var t;if(!super.unloadGL())return!1;for(const t of IA(this,TA,"f"))t();return IA(this,TA,"f").length=0,this.gltfLoader=void 0,null===(t=this.dracoLoader)||void 0===t||t.dispose(),this.dracoLoader=void 0,IA(this,EA,"m",AA).call(this),DA(this,SA,+IA(this,SA,"f")+1,"f"),!0}};SA=new WeakMap,TA=new WeakMap,EA=new WeakSet,AA=function(){this.model&&Rh(this.model.scene),this.model=null},RA=function(){const{src:t}=this,e=IA(this,SA,"f");t&&this.gltfLoader.load(t,t=>e==IA(this,SA,"f")&&IA(this,EA,"m",CA).call(this,t),t=>e==IA(this,SA,"f")&&this.element.emit(Mo.PROGRESS,t),t=>e==IA(this,SA,"f")&&IA(this,EA,"m",LA).call(this,t))},LA=function(t){var e;const n=null!==(e=null==t?void 0:t.message)&&void 0!==e?e:`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}" and dracoDecoder "${this.dracoDecoder}".`;console.warn(n),t.error&&console.error(t.error),this.element.emit(Mo.MODEL_ERROR,t.error)},CA=function(t){if(this.model=t,t.scene=t.scene||(new wA).add(...t.scenes),this.centerGeometry){const e=new bd;e.setFromObject(t.scene);const n=new Lo;e.getCenter(n),t.scene.position.copy(n.negate())}this.element.three.add(t.scene),this.element.emit(Mo.MODEL_LOAD,{format:"gltf",model:t}),this.element.needsUpdate()},FA._observedProperties=["src","dracoPath","centerGeometry",...vd._observedProperties||[]],OA([oi,NA("design:type",Object)],FA.prototype,"src",void 0),OA([oi,NA("design:type",Object)],FA.prototype,"dracoDecoder",void 0),OA([li(!1),NA("design:type",Object)],FA.prototype,"centerGeometry",void 0),FA=OA([Jr],FA),elementBehaviors.has("gltf-model")||elementBehaviors.define("gltf-model",FA);var UA=function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,n=/^usemtl /,r=/^usemap /,i=new Qf,o=new Qf,s=new Qf,a=new Qf,c=new Qf;function l(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(t,e,n){var r=this.vertices,l=this.object.geometry.normals;i.fromArray(r,t),o.fromArray(r,e),s.fromArray(r,n),c.subVectors(s,o),a.subVectors(i,o),c.cross(a),c.normalize(),l.push(c.x,c.y,c.z),l.push(c.x,c.y,c.z),l.push(c.x,c.y,c.z)},addColor:function(t,e,n){var r=this.colors,i=this.object.geometry.colors;void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(t,e,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[t+0],r[t+1]),i.push(r[e+0],r[e+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){var t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,r,i,o,s,a,c){var l=this.vertices.length,u=this.parseVertexIndex(t,l),h=this.parseVertexIndex(e,l),d=this.parseVertexIndex(n,l);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==s&&""!==s){var p=this.normals.length;u=this.parseNormalIndex(s,p),h=this.parseNormalIndex(a,p),d=this.parseNormalIndex(c,p),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==r&&""!==r){var f=this.uvs.length;u=this.parseUVIndex(r,f),h=this.parseUVIndex(i,f),d=this.parseUVIndex(o,f),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,n=0,r=t.length;n<r;n++){var i=this.parseVertexIndex(t[n],e);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,i=0,o=t.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(t[i],n));var s=0;for(o=e.length;s<o;s++)this.addUVLine(this.parseUVIndex(e[s],r))}};return t.startObject("",!1),t}function u(t){ow.call(this,t),this.materials=null}return u.prototype=Object.assign(Object.create(ow.prototype),{constructor:u,load:function(t,e,n,r){var i=this,o=new aw(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(i.parse(n))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},setMaterials:function(t){return this.materials=t,this},parse:function(i){var o=new l;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var s=i.split("\n"),a="",c="",u=[],h="function"==typeof"".trimLeft,d=0,p=s.length;d<p;d++)if(a=s[d],0!==(a=h?a.trimLeft():a.trim()).length&&"#"!==(c=a.charAt(0)))if("v"===c){var f=a.split(/\s+/);switch(f[0]){case"v":o.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?o.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])):o.colors.push(void 0,void 0,void 0);break;case"vn":o.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":o.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===c){for(var m=a.substr(1).trim().split(/\s+/),g=[],v=0,y=m.length;v<y;v++){var b=m[v];if(b.length>0){var x=b.split("/");g.push(x)}}var _=g[0];for(v=1,y=g.length-1;v<y;v++){var w=g[v],M=g[v+1];o.addFace(_[0],w[0],M[0],_[1],w[1],M[1],_[2],w[2],M[2])}}else if("l"===c){var E=a.substring(1).trim().split(" "),S=[],T=[];if(-1===a.indexOf("/"))S=E;else for(var A=0,R=E.length;A<R;A++){var L=E[A].split("/");""!==L[0]&&S.push(L[0]),""!==L[1]&&T.push(L[1])}o.addLineGeometry(S,T)}else if("p"===c){var C=a.substr(1).trim().split(" ");o.addPointGeometry(C)}else if(null!==(u=t.exec(a))){var P=(" "+u[0].substr(1).trim()).substr(1);o.startObject(P)}else if(n.test(a))o.object.startMaterial(a.substring(7).trim(),o.materialLibraries);else if(e.test(a))o.materialLibraries.push(a.substring(7).trim());else if(r.test(a))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((u=a.split(" ")).length>1){var O=u[1].trim().toLowerCase();o.object.smooth="0"!==O&&"off"!==O}else o.object.smooth=!0;(W=o.object.currentMaterial())&&(W.smooth=o.object.smooth)}else{if("\0"===a)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}o.finalize();var N=new Ob;if(N.materialLibraries=[].concat(o.materialLibraries),!0===!(1===o.objects.length&&0===o.objects[0].geometry.vertices.length))for(d=0,p=o.objects.length;d<p;d++){var I=o.objects[d],D=I.geometry,F=I.materials,U="Line"===D.type,B="Points"===D.type,k=!1;if(0!==D.vertices.length){(Z=new Zg).setAttribute("position",new Fg(D.vertices,3)),D.normals.length>0&&Z.setAttribute("normal",new Fg(D.normals,3)),D.colors.length>0&&(k=!0,Z.setAttribute("color",new Fg(D.colors,3))),!0===D.hasUVIndices&&Z.setAttribute("uv",new Fg(D.uvs,2));for(var z,H=[],G=0,j=F.length;G<j;G++){var V=(Y=F[G]).name+"_"+Y.smooth+"_"+k,W=o.materials[V];if(null!==this.materials)if(W=this.materials.create(Y.name),!U||!W||W instanceof wx){if(B&&W&&!(W instanceof Nx)){var q=new Nx({size:10,sizeAttenuation:!1});Mg.prototype.copy.call(q,W),q.color.copy(W.color),q.map=W.map,W=q}}else{var X=new wx;Mg.prototype.copy.call(X,W),X.color.copy(W.color),W=X}void 0===W&&((W=U?new wx:B?new Nx({size:1,sizeAttenuation:!1}):new I_).name=Y.name,W.flatShading=!Y.smooth,W.vertexColors=k,o.materials[V]=W),H.push(W)}if(H.length>1){for(G=0,j=F.length;G<j;G++){var Y=F[G];Z.addGroup(Y.groupStart,Y.groupCount,G)}z=U?new Px(Z,H):B?new Bx(Z,H):new pv(Z,H)}else z=U?new Px(Z,H[0]):B?new Bx(Z,H[0]):new pv(Z,H[0]);z.name=I.name,N.add(z)}}else if(o.vertices.length>0){var Z;W=new Nx({size:1,sizeAttenuation:!1});(Z=new Zg).setAttribute("position",new Fg(o.vertices,3)),o.colors.length>0&&void 0!==o.colors[0]&&(Z.setAttribute("color",new Fg(o.colors,3)),W.vertexColors=!0);var J=new Bx(Z,W);N.add(J)}return N}}),u}(),BA=function(t){ow.call(this,t)};BA.prototype=Object.assign(Object.create(ow.prototype),{constructor:BA,load:function(t,e,n,r){var i=this,o=""===this.path?Qw(t):this.path,s=new aw(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{e(i.parse(n,o))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},setMaterialOptions:function(t){return this.materialOptions=t,this},parse:function(t,e){for(var n=t.split("\n"),r={},i=/\s+/,o={},s=0;s<n.length;s++){var a=n[s];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var c=a.indexOf(" "),l=c>=0?a.substring(0,c):a;l=l.toLowerCase();var u=c>=0?a.substring(c+1):"";if(u=u.trim(),"newmtl"===l)r={name:u},o[u]=r;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){var h=u.split(i,3);r[l]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else r[l]=u}}var d=new BA.MaterialCreator(this.resourcePath||e,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(o),d}}),(BA.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:0,this.wrap=this.options&&this.options.wrap?this.options.wrap:1e3}).prototype={constructor:BA.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(t){return this.crossOrigin=t,this},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var n in t){var r=t[n],i={};for(var o in e[n]=i,r){var s=!0,a=r[o],c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===a[0]&&0===a[1]&&0===a[2]&&(s=!1)}s&&(i[c]=a)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,n=this.materialsInfo[t],r={name:t,side:this.side};function i(t,n){if(!r[t]){var i,o,s=e.getTextureParams(n,r),a=e.loadTexture((i=e.baseUrl,"string"!=typeof(o=s.url)||""===o?"":/^https?:\/\//i.test(o)?o:i+o));a.repeat.copy(s.scale),a.offset.copy(s.offset),a.wrapS=e.wrap,a.wrapT=e.wrap,r[t]=a}}for(var o in n){var s,a=n[o];if(""!==a)switch(o.toLowerCase()){case"kd":r.color=(new xg).fromArray(a);break;case"ks":r.specular=(new xg).fromArray(a);break;case"ke":r.emissive=(new xg).fromArray(a);break;case"map_kd":i("map",a);break;case"map_ks":i("specularMap",a);break;case"map_ke":i("emissiveMap",a);break;case"norm":i("normalMap",a);break;case"map_bump":case"bump":i("bumpMap",a);break;case"map_d":i("alphaMap",a),r.transparent=!0;break;case"ns":r.shininess=parseFloat(a);break;case"d":(s=parseFloat(a))<1&&(r.opacity=s,r.transparent=!0);break;case"tr":s=parseFloat(a),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(r.opacity=1-s,r.transparent=!0)}}return this.materials[t]=new I_(r),this.materials[t]},getTextureParams:function(t,e){var n,r={scale:new Gf(1,1),offset:new Gf(0,0)},i=t.split(/\s+/);return(n=i.indexOf("-bm"))>=0&&(e.bumpScale=parseFloat(i[n+1]),i.splice(n,2)),(n=i.indexOf("-s"))>=0&&(r.scale.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),(n=i.indexOf("-o"))>=0&&(r.offset.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),r.url=i.join(" ").trim(),r},loadTexture:function(t,e,n,r,i){var o,s=void 0!==this.manager?this.manager:iw,a=s.getHandler(t);return null===a&&(a=new pw(s)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin),o=a.load(t,n,r,i),void 0!==e&&(o.mapping=e),o}};var kA,zA,HA,GA,jA,VA,WA,qA,XA=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},YA=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ZA=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},JA=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let $A=class extends vd{constructor(){super(...arguments),kA.add(this),this.obj="",this.mtl="",zA.set(this,0),HA.set(this,[]),GA.set(this,!1)}loadGL(){if(!super.loadGL())return!1;this.objLoader=new UA,this.mtlLoader=new BA(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.objLoader.manager.onLoad=()=>{this.element.needsUpdate()};let t=!0;const e=Zr(()=>{this.mtl,this.obj,t||ZA(this,kA,"m",jA).call(this),JA(this,zA,+ZA(this,zA,"f")+1,"f"),ZA(this,kA,"m",VA).call(this)});return t=!1,ZA(this,HA,"f").push(e),!0}unloadGL(){if(!super.unloadGL())return!1;for(const t of ZA(this,HA,"f"))t();return ZA(this,HA,"f").length=0,ZA(this,kA,"m",jA).call(this),JA(this,zA,+ZA(this,zA,"f")+1,"f"),!0}};function KA(t,e,n){return Math.max(Math.min(t,n),e)}zA=new WeakMap,HA=new WeakMap,GA=new WeakMap,kA=new WeakSet,jA=function(){this.model&&Rh(this.model,{destroyMaterial:!ZA(this,GA,"f")}),JA(this,GA,!1,"f"),this.model=void 0},VA=function(){const{obj:t,mtl:e,mtlLoader:n,objLoader:r}=this,i=ZA(this,zA,"f");t&&(e?(n.setResourcePath(e.substr(0,e.lastIndexOf("/")+1)),n.load(e,e=>{i===ZA(this,zA,"f")&&(e.preload(),r.setMaterials(e),r.load(t,t=>{i===ZA(this,zA,"f")&&ZA(this,kA,"m",qA).call(this,t)}))})):r.load(t,t=>{if(i!==ZA(this,zA,"f"))return;let e=this.element.behaviors.get("basic-material");e||(e=this.element.behaviors.get("phong-material")),e||(e=this.element.behaviors.get("standard-material")),e||(e=this.element.behaviors.get("lambert-material")),e?(JA(this,GA,!0,"f"),t.traverse(t=>{Sh(t)&&(t.material=e.getMeshComponent("material"))})):Ph(t),ZA(this,kA,"m",qA).call(this,t)},t=>i===ZA(this,zA,"f")&&this.element.emit(Mo.PROGRESS,t),t=>i===ZA(this,zA,"f")&&ZA(this,kA,"m",WA).call(this,t)))},WA=function(t){var e;const n=null!==(e=null==t?void 0:t.message)&&void 0!==e?e:`Failed to load ${this.element.tagName.toLowerCase()} with obj value "${this.obj}" and mtl value "${this.mtl}".`;console.warn(n),this.element.emit(Mo.MODEL_ERROR,t.error)},qA=function(t){this.model=t,this.element.three.add(t),this.element.emit(Mo.MODEL_LOAD,{format:"obj",model:t}),this.element.needsUpdate()},$A._observedProperties=["obj","mtl",...vd._observedProperties||[]],XA([ai(""),YA("design:type",Object)],$A.prototype,"obj",void 0),XA([ai(""),YA("design:type",Object)],$A.prototype,"mtl",void 0),$A=XA([Jr],$A),elementBehaviors.has("obj-model")||elementBehaviors.define("obj-model",$A);var QA,tR,eR,nR,rR,iR=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n},oR=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};class sR{constructor(t){this.minFlingRotationX=-90,this.maxFlingRotationX=90,this.interactionContainer=document,QA.set(this,void 0),tR.set(this,void 0),eR.set(this,()=>{this.rotationXTarget.rotation=()=>!1,this.rotationYTarget.rotation=()=>!1;let t=0,e=0;iR(this,QA,n=>{t=.2*n.movementY,this.rotationXTarget.rotation.x=KA(this.rotationXTarget.rotation.x+t,this.minFlingRotationX,this.maxFlingRotationX),e=.2*-n.movementX,this.rotationYTarget.rotation.y+=e},"f"),this.interactionContainer.addEventListener("pointermove",oR(this,QA,"f")),this.interactionContainer.addEventListener("pointerup",iR(this,tR,()=>{this.interactionContainer.removeEventListener("pointermove",oR(this,QA,"f")),0===t&&0===e||(this.rotationXTarget.rotation=(e,n,r)=>(t*=.95,!(Math.abs(t)<.01)&&[KA(e+t,this.minFlingRotationX,this.maxFlingRotationX),n,r]),this.rotationYTarget.rotation=(t,n,r)=>(e*=.95,!(Math.abs(e)<.01)&&[t,n+e,r]))},"f"),{once:!0})}),nR.set(this,t=>t.preventDefault()),rR.set(this,!1),Object.assign(this,t),this.rotationXTarget||(this.rotationXTarget=this.rotationYTarget.children[0]),this.interactionInitiator||(this.interactionInitiator=this.rotationXTarget)}start(){return oR(this,rR,"f")||(iR(this,rR,!0,"f"),this.interactionInitiator.addEventListener("pointerdown",oR(this,eR,"f")),this.interactionInitiator.addEventListener("dragstart",oR(this,nR,"f")),this.interactionInitiator.addEventListener("pointercancel",()=>{throw new Error("Pointercancel should not be happening. If so, please open a bug report.")})),this}stop(){return oR(this,rR,"f")?(iR(this,rR,!1,"f"),this.rotationXTarget.rotation=()=>!1,this.rotationYTarget.rotation=()=>!1,this.interactionInitiator.removeEventListener("pointerdown",oR(this,eR,"f")),this.interactionInitiator.removeEventListener("dragstart",oR(this,nR,"f")),oR(this,QA,"f")&&this.interactionContainer.removeEventListener("pointermove",oR(this,QA,"f")),oR(this,tR,"f")&&this.interactionContainer.removeEventListener("pointerup",oR(this,tR,"f")),this):this}}QA=new WeakMap,tR=new WeakMap,eR=new WeakMap,nR=new WeakMap,rR=new WeakMap;var aR,cR,lR,uR=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},hR=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},dR=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},pR=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let fR=class{constructor(t){this.x=0,this.y=0,this.minX=-1/0,this.maxX=1/0,this.minY=-1/0,this.maxY=1/0,this.target=document,this.scrollFactor=1,aR.set(this,void 0),cR.set(this,t=>{t.preventDefault();let e=t.deltaX*this.scrollFactor,n=t.deltaY*this.scrollFactor;this.x=KA(this.x+e,this.minX,this.maxX),this.y=KA(this.y+n,this.minY,this.maxY),0===e&&0===n||(dR(this,aR,"f")&&$s.removeRenderTask(dR(this,aR,"f")),pR(this,aR,$s.addRenderTask(()=>{if(e*=.95,n*=.95,this.x=KA(this.x+e,this.minX,this.maxX),this.y=KA(this.y+n,this.minY,this.maxY),Math.abs(e)<.01&&Math.abs(n)<.01)return!1}),"f"))}),lR.set(this,!1),Object.assign(this,t)}start(){return dR(this,lR,"f")||(pR(this,lR,!0,"f"),this.target.addEventListener("wheel",dR(this,cR,"f"))),this}stop(){return dR(this,lR,"f")?(pR(this,lR,!1,"f"),dR(this,aR,"f")&&$s.removeRenderTask(dR(this,aR,"f")),this.target.removeEventListener("wheel",dR(this,cR,"f")),this):this}};aR=new WeakMap,cR=new WeakMap,lR=new WeakMap,uR([Jr,hR("design:type",Object)],fR.prototype,"x",void 0),uR([Jr,hR("design:type",Object)],fR.prototype,"y",void 0),fR=uR([Jr,hR("design:paramtypes",[Object])],fR);var mR=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},gR=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let vR=class extends gd{constructor(){super(...arguments),this.initialPolarAngle=0,this.minPolarAngle=-90,this.maxPolarAngle=90,this.initialDistance=1e3,this.minDistance=200,this.maxDistance=2e3,this.active=!0,this.dollySpeed=1,this.interactive=!0,this.template=()=>Di`
		<lume-node
			size="1 1 1"
			rotation=${()=>ri(()=>[this.initialPolarAngle,0,0])}
			size-mode="proportional proportional proportional"
		>
			<lume-perspective-camera
				ref=${t=>this.cam=t}
				active=${()=>this.active}
				position=${[0,0,this.initialDistance]}
				align-point="0.5 0.5 0.5"
				far="10000"
			></lume-perspective-camera>
		</lume-node>
	`}connectedCallback(){super.connectedCallback(),this.flingRotation=new sR({interactionInitiator:this.scene,rotationYTarget:this,minFlingRotationX:this.minPolarAngle,maxFlingRotationX:this.maxPolarAngle}).start(),this.scrollFling=new fR({target:this.scene,y:this.initialDistance,minY:this.minDistance,maxY:this.maxDistance,scrollFactor:this.dollySpeed}).start(),this.autorunStoppers=[],this.autorunStoppers.push(Zr(()=>{this.scrollFling.y,ri(()=>this.cam.position.z=this.scrollFling.y)}),Zr(()=>{this.interactive?(console.log("interactive, start rotation and scroll flings"),this.flingRotation.start(),this.scrollFling.start()):(console.log("not interactive, stop rotation and scroll flings"),this.flingRotation.stop(),this.scrollFling.stop())}))}disconnectedCallback(){var t,e;if(super.disconnectedCallback(),null===(t=this.flingRotation)||void 0===t||t.stop(),null===(e=this.scrollFling)||void 0===e||e.stop(),this.autorunStoppers)for(const t of this.autorunStoppers)t()}};function yR(){os.call(this),this.type="Camera",this.matrixWorldInverse=new Oo,this.projectionMatrix=new Oo,this.projectionMatrixInverse=new Oo}function bR(t=50,e=1,n=.1,r=2e3){yR.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}mR([ci(0),gR("design:type",Object)],vR.prototype,"initialPolarAngle",void 0),mR([ci(-90),gR("design:type",Object)],vR.prototype,"minPolarAngle",void 0),mR([ci(90),gR("design:type",Object)],vR.prototype,"maxPolarAngle",void 0),mR([ci(1e3),gR("design:type",Object)],vR.prototype,"initialDistance",void 0),mR([ci(200),gR("design:type",Object)],vR.prototype,"minDistance",void 0),mR([ci(2e3),gR("design:type",Object)],vR.prototype,"maxDistance",void 0),mR([li(!0),gR("design:type",Object)],vR.prototype,"active",void 0),mR([ci(1),gR("design:type",Object)],vR.prototype,"dollySpeed",void 0),mR([li(!0),gR("design:type",Object)],vR.prototype,"interactive",void 0),vR=mR([ui("lume-camera-rig",yf)],vR),yR.prototype=Object.assign(Object.create(os.prototype),{constructor:yR,isCamera:!0,copy:function(t,e){return os.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Lo),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){os.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,e){os.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),bR.prototype=Object.assign(Object.create(yR.prototype),{constructor:bR,isPerspectiveCamera:!0,copy:function(t,e){return yR.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Ao.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Ao.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Ao.RAD2DEG*Math.atan(Math.tan(.5*Ao.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*Ao.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/t,e-=o.offsetY*n/s,r*=o.width/t,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=os.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});var xR,_R,wR,MR=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},ER=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},SR=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n},TR=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};let AR=class extends gd{constructor(){super(...arguments),xR.add(this),this.fov=50,this.aspect=0,this.near=.1,this.far=3e3,this.zoom=1,this.active=!1,_R.set(this,null)}connectedCallback(){super.connectedCallback();const t=Zr(e=>{this.scene&&ri(()=>{SR(this,_R,this.scene,"f"),TR(this,xR,"m",wR).call(this,this.active?void 0:"unset"),io(()=>t())})});this._stopFns.push(Zr(t=>{this.three.fov=this.fov,this.three.updateProjectionMatrix(),this.needsUpdate()}),Zr(t=>{if(0!==this.aspect)return this.three.aspect=this.aspect,void this.three.updateProjectionMatrix();let e=0;this.scene&&(e=this.scene.calculatedSize.x/this.scene.calculatedSize.y),e||(e=16/9),this.three.aspect=e,this.three.updateProjectionMatrix(),this.needsUpdate()}),Zr(t=>{this.three.near=this.near,this.three.updateProjectionMatrix(),this.needsUpdate()}),Zr(t=>{this.three.far=this.far,this.three.updateProjectionMatrix(),this.needsUpdate()}),Zr(t=>{this.three.zoom=this.zoom,this.three.updateProjectionMatrix(),this.needsUpdate()}),Zr(t=>{const e=this.active;ri(()=>{TR(this,xR,"m",wR).call(this,e?void 0:"unset")}),this.needsUpdate()}))}makeThreeObject3d(){return new bR(75,16/9,1,1e3)}disconnectedCallback(){super.disconnectedCallback(),TR(this,xR,"m",wR).call(this,"unset"),SR(this,_R,null,"f")}};_R=new WeakMap,xR=new WeakSet,wR=function(t){if(t)TR(this,_R,"f")&&TR(this,_R,"f")._removeCamera(this);else{if(!this.scene||!this.isConnected)return;this.scene._addCamera(this)}},AR.defaultElementName="lume-perspective-camera",MR([ci(50),ER("design:type",Object)],AR.prototype,"fov",void 0),MR([ci(0),ER("design:type",Object)],AR.prototype,"aspect",void 0),MR([ci(.1),ER("design:type",Object)],AR.prototype,"near",void 0),MR([ci(3e3),ER("design:type",Object)],AR.prototype,"far",void 0),MR([ci(1),ER("design:type",Object)],AR.prototype,"zoom",void 0),MR([li(!1),ER("design:type",Object)],AR.prototype,"active",void 0),AR=MR([ui],AR);class RR extends dd{constructor(){super(...arguments),this.template=()=>Di`
		<div class="container">
			<div ref=${t=>this._cssLayer=t} class="CSS3DLayer">
				${""}
			</div>
			<div ref=${t=>this._glLayer=t} class="WebGLLayer">
				${""}
			</div>
			<div ref=${t=>this._miscLayer=t} class="MiscellaneousLayer">
				${""}
				<slot name="misc"></slot>
			</div>
		</div>
	`,this._mounted=!1,this._glLayer=null,this._cssLayer=null,this._miscLayer=null}connectedCallback(){super.connectedCallback(),this._mounted||this.mount(this.parentNode)}disconnectedCallback(){super.disconnectedCallback(),this.unmount()}}RR.css="\n\t\t:host {\n\t\t\t/*\n\t\t\t * All items of the scene graph are hidden until they are mounted in\n\t\t\t * a scene (this changes to display:block). 'display' gets toggled\n\t\t\t * between \"none\" and \"block\" by ImperativeBase depending on if CSS\n\t\t\t * rendering is enabled.\n\t\t\t */\n\t\t\tdisplay: none;\n\n\t\t\tbox-sizing: border-box;\n\t\t\tposition: static;\n\t\t\toverflow: hidden;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\n\t\t\t/*\n\t\t\t\tDefaults to [0.5,0.5,0.5] (the Z axis doesn't apply for DOM elements,\n\t\t\t\tbut will for 3D objects in WebGL.)\n\t\t\t*/\n\t\t\ttransform-origin: 50% 50% 0; /* default */\n\n\t\t\ttransform-style: preserve-3d;\n\t\t}\n\n\t\t/* The purpose of this is to contain the position:absolute layers so they don't break out of the Scene layout. */\n\t\t.container {\n\t\t\tposition: relative\n\t\t}\n\n\t\t.container,\n\t\t.CSS3DLayer,\n\t\t.MiscellaneousLayer,\n\t\t.WebGLLayer,\n\t\t.WebGLLayer > canvas  {\n\t\t\tmargin: 0; padding: 0;\n\t\t\twidth: 100%; height: 100%;\n\t\t\tdisplay: block;\n\t\t}\n\n\t\t.CSS3DLayer,\n\t\t.MiscellaneousLayer,\n\t\t.WebGLLayer {\n\t\t\t/* make sure all layers are stacked on top of each other */\n\t\t\tposition: absolute; top: 0; left: 0;\n\t\t}\n\n\t\t.CSS3DLayer {\n\t\t\ttransform-style: preserve-3d;\n\t\t}\n\n\t\t.WebGLLayer,\n\t\t.MiscellaneousLayer {\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t.MiscellaneousLayer > * {\n\t\t\t/* Allow children of the Misc layer to have pointer events.\tNeeded for the WebXR button, for example */\n\t\t\tpointer-events: auto;\n\t\t}\n\n\t\t/*\n\t\t * This trick is needed in Firefox to remove pointer events from the\n\t\t * transparent cameraElement from interfering with pointer events on the\n\t\t * scene objects. We do not wish to interact with this element anyway, as\n\t\t * it serves only for positioning the view.\n\t\t */\n\t\t.cameraElement {\n\t\t\tpointer-events: none;\n\t\t}\n\t\t.cameraElement > * {\n\t\t\tpointer-events: auto;\n\t\t}\n\t";var LR=n(6),CR=n(4);function PR(){"undefined"==typeof ResizeObserver&&(Object(CR.a)().ResizeObserver=LR.a)}class OR{constructor(t,e,n){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Mh(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}clone(){return new OR(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class NR{constructor(t,e){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Mh(t),this.density=void 0!==e?e:25e-5}clone(){return new NR(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}function IR(t,e,n,r,i,o,s,a,c,l,u,h){US.call(this,null,o,s,a,c,l,r,i,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==c?c:Xc,this.minFilter=void 0!==l?l:Xc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}IR.prototype=Object.create(US.prototype),IR.prototype.constructor=IR,IR.prototype.isDataTexture=!0;const DR=new Dd,FR=new Lo;class UR{constructor(t,e,n,r,i,o){this.planes=[void 0!==t?t:new Tp,void 0!==e?e:new Tp,void 0!==n?n:new Tp,void 0!==r?r:new Tp,void 0!==i?i:new Tp,void 0!==o?o:new Tp]}set(t,e,n,r,i,o){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(s-r,u-a,f-h,y-m).normalize(),e[1].setComponents(s+r,u+a,f+h,y+m).normalize(),e[2].setComponents(s+i,u+c,f+d,y+g).normalize(),e[3].setComponents(s-i,u-c,f-d,y-g).normalize(),e[4].setComponents(s-o,u-l,f-p,y-v).normalize(),e[5].setComponents(s+o,u+l,f+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),DR.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(DR)}intersectsSprite(t){return DR.center.set(0,0,0),DR.radius=.7071067811865476,DR.applyMatrix4(t.matrixWorld),this.intersectsSphere(DR)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(FR.x=r.normal.x>0?t.max.x:t.min.x,FR.y=r.normal.y>0?t.max.y:t.min.y,FR.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(FR)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}}function BR(){let t=null,e=!1,n=null,r=null;function i(e,o){n(e,o),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function kR(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const o=r.get(e);void 0===o?r.set(e,function(e,r){const i=e.array,o=e.usage,s=t.createBuffer();t.bindBuffer(r,s),t.bufferData(r,i,o),e.onUploadCallback();let a=t.FLOAT;return i instanceof Float32Array?a=t.FLOAT:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=t.HALF_FLOAT:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=t.UNSIGNED_SHORT:i instanceof Int16Array?a=t.SHORT:i instanceof Uint32Array?a=t.UNSIGNED_INT:i instanceof Int32Array?a=t.INT:i instanceof Int8Array?a=t.BYTE:i instanceof Uint8Array&&(a=t.UNSIGNED_BYTE),{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):o.version<e.version&&(!function(e,r,i){const o=r.array,s=r.updateRange;t.bindBuffer(i,e),-1===s.count?t.bufferSubData(i,0,o):(n?t.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):t.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,e,i),o.version=e.version)}}}const zR={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)G(v) / 4(nl)(nv)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor.xyz *= color.xyz;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\n\t\tvec2 f = fract( uv );\n\n\t\tuv += 0.5 - f;\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\n\t\t}\n\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\n\t\tuv *= texelSize;\n\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x += texelSize;\n\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.y += texelSize;\n\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x -= texelSize;\n\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tvec3 tm = mix( tl, tr, f.x );\n\n\t\tvec3 bm = mix( bl, br, f.x );\n\n\t\treturn mix( tm, bm, f.y );\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= r1 ) {\n\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\n\t\t} else if ( roughness >= r4 ) {\n\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\n\t\t} else if ( roughness >= r5 ) {\n\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\n\t\t} else if ( roughness >= r6 ) {\n\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n\n#ifdef DOUBLE_SIDED\n\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n\n#endif\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\n\t#endif\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmissionmap_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\n#endif\n",transmissionmap_pars_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform sampler2D transmissionMap;\n\n#endif\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transmission model\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},HR={common:{diffuse:{value:new Mh(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wo},uv2Transform:{value:new Wo},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new gh(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Mh(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Mh(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Wo}},sprite:{diffuse:{value:new Mh(15658734)},opacity:{value:1},center:{value:new gh(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Wo}}},GR={basic:{uniforms:QS([HR.common,HR.specularmap,HR.envmap,HR.aomap,HR.lightmap,HR.fog]),vertexShader:zR.meshbasic_vert,fragmentShader:zR.meshbasic_frag},lambert:{uniforms:QS([HR.common,HR.specularmap,HR.envmap,HR.aomap,HR.lightmap,HR.emissivemap,HR.fog,HR.lights,{emissive:{value:new Mh(0)}}]),vertexShader:zR.meshlambert_vert,fragmentShader:zR.meshlambert_frag},phong:{uniforms:QS([HR.common,HR.specularmap,HR.envmap,HR.aomap,HR.lightmap,HR.emissivemap,HR.bumpmap,HR.normalmap,HR.displacementmap,HR.fog,HR.lights,{emissive:{value:new Mh(0)},specular:{value:new Mh(1118481)},shininess:{value:30}}]),vertexShader:zR.meshphong_vert,fragmentShader:zR.meshphong_frag},standard:{uniforms:QS([HR.common,HR.envmap,HR.aomap,HR.lightmap,HR.emissivemap,HR.bumpmap,HR.normalmap,HR.displacementmap,HR.roughnessmap,HR.metalnessmap,HR.fog,HR.lights,{emissive:{value:new Mh(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zR.meshphysical_vert,fragmentShader:zR.meshphysical_frag},toon:{uniforms:QS([HR.common,HR.aomap,HR.lightmap,HR.emissivemap,HR.bumpmap,HR.normalmap,HR.displacementmap,HR.gradientmap,HR.fog,HR.lights,{emissive:{value:new Mh(0)}}]),vertexShader:zR.meshtoon_vert,fragmentShader:zR.meshtoon_frag},matcap:{uniforms:QS([HR.common,HR.bumpmap,HR.normalmap,HR.displacementmap,HR.fog,{matcap:{value:null}}]),vertexShader:zR.meshmatcap_vert,fragmentShader:zR.meshmatcap_frag},points:{uniforms:QS([HR.points,HR.fog]),vertexShader:zR.points_vert,fragmentShader:zR.points_frag},dashed:{uniforms:QS([HR.common,HR.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zR.linedashed_vert,fragmentShader:zR.linedashed_frag},depth:{uniforms:QS([HR.common,HR.displacementmap]),vertexShader:zR.depth_vert,fragmentShader:zR.depth_frag},normal:{uniforms:QS([HR.common,HR.bumpmap,HR.normalmap,HR.displacementmap,{opacity:{value:1}}]),vertexShader:zR.normal_vert,fragmentShader:zR.normal_frag},sprite:{uniforms:QS([HR.sprite,HR.fog]),vertexShader:zR.sprite_vert,fragmentShader:zR.sprite_frag},background:{uniforms:{uvTransform:{value:new Wo},t2D:{value:null}},vertexShader:zR.background_vert,fragmentShader:zR.background_frag},cube:{uniforms:QS([HR.envmap,{opacity:{value:1}}]),vertexShader:zR.cube_vert,fragmentShader:zR.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zR.equirect_vert,fragmentShader:zR.equirect_frag},distanceRGBA:{uniforms:QS([HR.common,HR.displacementmap,{referencePosition:{value:new Lo},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zR.distanceRGBA_vert,fragmentShader:zR.distanceRGBA_frag},shadow:{uniforms:QS([HR.lights,HR.fog,{color:{value:new Mh(0)},opacity:{value:1}}]),vertexShader:zR.shadow_vert,fragmentShader:zR.shadow_frag}};function jR(t,e,n,r,i){const o=new Mh(0);let s,a,c=0,l=null,u=0,h=null;function d(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),c=e,d(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,d(o,c)},render:function(n,i,p,f){let m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(o,c):m&&m.isColor&&(d(m,1),f=!0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===Gc)?(void 0===a&&(a=new nf(new pp(1,1,1),new rT({name:"BackgroundCubeMaterial",uniforms:KS(GR.cube.uniforms),vertexShader:GR.cube.vertexShader,fragmentShader:GR.cube.fragmentShader,side:Ya,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,l===m&&u===m.version&&h===t.toneMapping||(a.material.needsUpdate=!0,l=m,u=m.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new nf(new lE(2,2),new rT({name:"BackgroundMaterial",uniforms:KS(GR.background.uniforms),vertexShader:GR.background.vertexShader,fragmentShader:GR.background.fragmentShader,side:Xa,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&u===m.version&&h===t.toneMapping||(s.material.needsUpdate=!0,l=m,u=m.version,h=t.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function VR(t,e,n,r){const i=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},c=d(null);let l=c;function u(e){return r.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function h(e){return r.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function d(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function p(){const t=l.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){const o=l.newAttributes,s=l.enabledAttributes,a=l.attributeDivisors;if(o[n]=1,0===s[n]&&(t.enableVertexAttribArray(n),s[n]=1),a[n]!==i){(r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i}}function g(){const e=l.newAttributes,n=l.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function v(e,n,i,o,s,a){!0!==r.isWebGL2||i!==t.INT&&i!==t.UNSIGNED_INT?t.vertexAttribPointer(e,n,i,o,s,a):t.vertexAttribIPointer(e,n,i,s,a)}function y(){b(),l!==c&&(l=c,u(l.object))}function b(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,h,y,b){let x=!1;if(s){const e=function(e,n,i){const s=!0===i.wireframe;let c=a[e.id];void 0===c&&(c={},a[e.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let u=l[s];void 0===u&&(u=d(r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),l[s]=u);return u}(y,h,c);l!==e&&(l=e,u(l.object)),x=function(t,e){const n=l.attributes,r=t.attributes;let i=0;for(const t in r){const e=n[t],o=r[t];if(void 0===e)return!0;if(e.attribute!==o)return!0;if(e.data!==o.data)return!0;i++}return l.attributesNum!==i||l.index!==e}(y,b),x&&function(t,e){const n={},r=t.attributes;let i=0;for(const t in r){const e=r[t],o={};o.attribute=e,e.data&&(o.data=e.data),n[t]=o,i++}l.attributes=n,l.attributesNum=i,l.index=e}(y,b)}else{const t=!0===c.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===t||(l.geometry=y.id,l.program=h.id,l.wireframe=t,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==b&&n.update(b,t.ELEMENT_ARRAY_BUFFER),x&&(!function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const c=a.attributes,l=s.getAttributes(),u=o.defaultAttributeValues;for(const e in l){const r=l[e];if(r>=0){const o=c[e];if(void 0!==o){const e=o.normalized,i=o.itemSize,s=n.get(o);if(void 0===s)continue;const c=s.buffer,l=s.type,u=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),t.bindBuffer(t.ARRAY_BUFFER,c),v(r,i,l,e,s*u,h*u)}else o.isInstancedBufferAttribute?(m(r,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(r),t.bindBuffer(t.ARRAY_BUFFER,c),v(r,i,l,e,0,0)}else if("instanceMatrix"===e){const e=n.get(i.instanceMatrix);if(void 0===e)continue;const o=e.buffer,s=e.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(r+0,4,s,!1,64,0),t.vertexAttribPointer(r+1,4,s,!1,64,16),t.vertexAttribPointer(r+2,4,s,!1,64,32),t.vertexAttribPointer(r+3,4,s,!1,64,48)}else if("instanceColor"===e){const e=n.get(i.instanceColor);if(void 0===e)continue;const o=e.buffer,s=e.type;m(r,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(r,3,s,!1,12,0)}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r,n);break;case 3:t.vertexAttrib3fv(r,n);break;case 4:t.vertexAttrib4fv(r,n);break;default:t.vertexAttrib1fv(r,n)}}}}g()}(i,c,h,y),null!==b&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)h(r[t].object),delete r[t];delete n[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function WR(t,e,n,r){const i=r.isWebGL2;let o;this.setMode=function(t){o=t},this.render=function(e,r){t.drawArrays(o,e,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let c,l;if(i)c=t,l="drawArraysInstanced";else if(c=e.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](o,r,s,a),n.update(s,o,a)}}function qR(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=i(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===n.logarithmicDepthBuffer,l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_TEXTURE_SIZE),d=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),p=t.getParameter(t.MAX_VERTEX_ATTRIBS),f=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),m=t.getParameter(t.MAX_VARYING_VECTORS),g=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=e.get("EXT_texture_filter_anisotropic");return r=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(t.MAX_SAMPLES):0}}function XR(t){const e=this;let n=null,r=0,i=!1,o=!1;const s=new Tp,a=new Wo,c={value:null,needsUpdate:!1};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,n,r,i){const o=null!==t?t.length:0;let l=null;if(0!==o){if(l=c.value,!0!==i||null===l){const e=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,n=r;e!==o;++e,n+=4)s.copy(t[e]).applyMatrix4(i,a),s.normal.toArray(l,n),l[n+3]=s.constant}c.value=l,c.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){const s=0!==t.length||e||0!==r||i;return i=e,n=u(t,o,0),r=t.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,l()},this.setState=function(e,s,a){const h=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||o&&!p)o?u(null):l();else{const t=o?0:r,e=4*t;let i=f.clippingState||null;c.value=i,i=u(h,s,e,a);for(let t=0;t!==e;++t)i[t]=n[t];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function YR(t,e,n){this.width=t,this.height=e,this.scissor=new Hd(0,0,t,e),this.scissorTest=!1,this.viewport=new Hd(0,0,t,e),n=n||{},this.texture=new US(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Kc,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}GR.physical={uniforms:QS([GR.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new gh(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Mh(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:zR.meshphysical_vert,fragmentShader:zR.meshphysical_frag},YR.prototype=Object.assign(Object.create(zo.prototype),{constructor:YR,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function ZR(t,e,n){if(os.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new bR(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Lo(1,0,0)),this.add(r);const i=new bR(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Lo(-1,0,0)),this.add(i);const o=new bR(90,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Lo(0,1,0)),this.add(o);const s=new bR(90,1,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Lo(0,-1,0)),this.add(s);const a=new bR(90,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Lo(0,0,1)),this.add(a);const c=new bR(90,1,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Lo(0,0,-1)),this.add(c),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const l=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(u),t.xr.enabled=l}}function JR(t,e,n,r,i,o,s,a,c,l){t=void 0!==t?t:[],e=void 0!==e?e:Bc,s=void 0!==s?s:gl,US.call(this,t,e,n,r,i,o,s,a,c,l),this.flipY=!1,this._needsFlipEnvMap=!0}function $R(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),YR.call(this,t,t,e),e=e||{},this.texture=new JR(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsFlipEnvMap=!1}function KR(t){let e=new WeakMap;function n(t,e){return e===zc?t.mapping=Bc:e===Hc&&(t.mapping=kc),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(o===zc||o===Hc){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const s=t.getRenderList(),a=t.getRenderTarget(),c=new $R(o.height/2);return c.fromEquirectangularTexture(t,i),e.set(i,c),t.setRenderTarget(a),t.setRenderList(s),i.addEventListener("dispose",r),n(c.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}function QR(t){const e={};return{has:function(n){if(void 0!==e[n])return null!==e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,null!==r},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e[t]}}}function tL(t,e,n,r){const i=new WeakMap,o=new WeakMap;function s(t){const a=t.target,c=i.get(a);null!==c.index&&e.remove(c.index);for(const t in c.attributes)e.remove(c.attributes[t]);a.removeEventListener("dispose",s),i.delete(a);const l=o.get(c);l&&(e.remove(l),o.delete(c)),r.releaseStatesOfGeometry(c),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let s=0;if(null!==r){const t=r.array;s=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],o=t[e+2];n.push(r,i,i,o,o,r)}}else{const t=i.array;s=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const a=new(np(n)>65535?$d:Zd)(n,1);a.version=s;const c=o.get(t);c&&e.remove(c),o.set(t,a)}return{get:function(t,e){let r=i.get(e);return r||(e.addEventListener("dispose",s),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new dp).setFromObject(t)),r=e._bufferGeometry),i.set(e,r),n.memory.geometries++,r)},update:function(n){const r=n.attributes;for(const n in r)e.update(r[n],t.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)e.update(r[n],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return o.get(t)}}}function eL(t,e,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(t){o=t},this.setIndex=function(t){s=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(o,r,s,e*a),n.update(r,o,1)},this.renderInstances=function(r,c,l){if(0===l)return;let u,h;if(i)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,c,s,r*a,l),n.update(c,o,l)}}function nL(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,r,i){switch(e.calls++,r){case t.TRIANGLES:e.triangles+=i*(n/3);break;case t.LINES:e.lines+=i*(n/2);break;case t.LINE_STRIP:e.lines+=i*(n-1);break;case t.LINE_LOOP:e.lines+=i*n;break;case t.POINTS:e.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function rL(t,e){return t[0]-e[0]}function iL(t,e){return Math.abs(e[1])-Math.abs(t[1])}function oL(t){const e={},n=new Float32Array(8),r=[];for(let t=0;t<8;t++)r[t]=[t,0];return{update:function(i,o,s,a){const c=i.morphTargetInfluences,l=void 0===c?0:c.length;let u=e[o.id];if(void 0===u){u=[];for(let t=0;t<l;t++)u[t]=[t,0];e[o.id]=u}for(let t=0;t<l;t++){const e=u[t];e[0]=t,e[1]=c[t]}u.sort(iL);for(let t=0;t<8;t++)t<l&&u[t][1]?(r[t][0]=u[t][0],r[t][1]=u[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(rL);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let t=0;t<8;t++){const e=r[t],i=e[0],s=e[1];i!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+t)!==h[i]&&o.setAttribute("morphTarget"+t,h[i]),d&&o.getAttribute("morphNormal"+t)!==d[i]&&o.setAttribute("morphNormal"+t,d[i]),n[t]=s,p+=s):(h&&!0===o.hasAttribute("morphTarget"+t)&&o.deleteAttribute("morphTarget"+t),d&&!0===o.hasAttribute("morphNormal"+t)&&o.deleteAttribute("morphNormal"+t),n[t]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function sL(t,e,n,r){let i=new WeakMap;function o(t){const e=t.target;e.removeEventListener("dispose",o),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(s){const a=r.render.frame,c=s.geometry,l=e.get(s,c);return i.get(l)!==a&&(c.isGeometry&&l.updateFromObject(s),e.update(l),i.set(l,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),n.update(s.instanceMatrix,t.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,t.ARRAY_BUFFER)),l},dispose:function(){i=new WeakMap}}}function aL(t=null,e=1,n=1,r=1){US.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=Xc,this.minFilter=Xc,this.wrapR=Wc,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function cL(t=null,e=1,n=1,r=1){US.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=Xc,this.minFilter=Xc,this.wrapR=Wc,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ZR.prototype=Object.create(os.prototype),ZR.prototype.constructor=ZR,JR.prototype=Object.create(US.prototype),JR.prototype.constructor=JR,JR.prototype.isCubeTexture=!0,Object.defineProperty(JR.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),$R.prototype=Object.create(YR.prototype),$R.prototype.constructor=$R,$R.prototype.isWebGLCubeRenderTarget=!0,$R.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=vl,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},r=new pp(5,5,5),i=new rT({name:"CubemapFromEquirect",uniforms:KS(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ya,blending:Ka});i.uniforms.tEquirect.value=e;const o=new nf(r,i),s=e.minFilter;e.minFilter===el&&(e.minFilter=Kc);return new ZR(1,10,this).update(t,o),e.minFilter=s,o.geometry.dispose(),o.material.dispose(),this},$R.prototype.clear=function(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)},aL.prototype=Object.create(US.prototype),aL.prototype.constructor=aL,aL.prototype.isDataTexture2DArray=!0,cL.prototype=Object.create(US.prototype),cL.prototype.constructor=cL,cL.prototype.isDataTexture3D=!0;const lL=new US,uL=new aL,hL=new cL,dL=new JR,pL=[],fL=[],mL=new Float32Array(16),gL=new Float32Array(9),vL=new Float32Array(4);function yL(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let o=pL[i];if(void 0===o&&(o=new Float32Array(i),pL[i]=o),0!==e){r.toArray(o,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(o,i)}return o}function bL(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function xL(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function _L(t,e){let n=fL[e];void 0===n&&(n=new Int32Array(e),fL[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function wL(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function ML(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(bL(n,e))return;t.uniform2fv(this.addr,e),xL(n,e)}}function EL(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(bL(n,e))return;t.uniform3fv(this.addr,e),xL(n,e)}}function SL(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(bL(n,e))return;t.uniform4fv(this.addr,e),xL(n,e)}}function TL(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(bL(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),xL(n,e)}else{if(bL(n,r))return;vL.set(r),t.uniformMatrix2fv(this.addr,!1,vL),xL(n,r)}}function AL(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(bL(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),xL(n,e)}else{if(bL(n,r))return;gL.set(r),t.uniformMatrix3fv(this.addr,!1,gL),xL(n,r)}}function RL(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(bL(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),xL(n,e)}else{if(bL(n,r))return;mL.set(r),t.uniformMatrix4fv(this.addr,!1,mL),xL(n,r)}}function LL(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||lL,i)}function CL(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||uL,i)}function PL(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||hL,i)}function OL(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||dL,i)}function NL(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function IL(t,e){const n=this.cache;bL(n,e)||(t.uniform2iv(this.addr,e),xL(n,e))}function DL(t,e){const n=this.cache;bL(n,e)||(t.uniform3iv(this.addr,e),xL(n,e))}function FL(t,e){const n=this.cache;bL(n,e)||(t.uniform4iv(this.addr,e),xL(n,e))}function UL(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function BL(t,e){t.uniform1fv(this.addr,e)}function kL(t,e){t.uniform1iv(this.addr,e)}function zL(t,e){t.uniform2iv(this.addr,e)}function HL(t,e){t.uniform3iv(this.addr,e)}function GL(t,e){t.uniform4iv(this.addr,e)}function jL(t,e){const n=yL(e,this.size,2);t.uniform2fv(this.addr,n)}function VL(t,e){const n=yL(e,this.size,3);t.uniform3fv(this.addr,n)}function WL(t,e){const n=yL(e,this.size,4);t.uniform4fv(this.addr,n)}function qL(t,e){const n=yL(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function XL(t,e){const n=yL(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function YL(t,e){const n=yL(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function ZL(t,e,n){const r=e.length,i=_L(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTexture2D(e[t]||lL,i[t])}function JL(t,e,n){const r=e.length,i=_L(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTextureCube(e[t]||dL,i[t])}function $L(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return wL;case 35664:return ML;case 35665:return EL;case 35666:return SL;case 35674:return TL;case 35675:return AL;case 35676:return RL;case 5124:case 35670:return NL;case 35667:case 35671:return IL;case 35668:case 35672:return DL;case 35669:case 35673:return FL;case 5125:return UL;case 35678:case 36198:case 36298:case 36306:case 35682:return LL;case 35679:case 36299:case 36307:return PL;case 35680:case 36300:case 36308:case 36293:return OL;case 36289:case 36303:case 36311:case 36292:return CL}}(e.type)}function KL(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return BL;case 35664:return jL;case 35665:return VL;case 35666:return WL;case 35674:return qL;case 35675:return XL;case 35676:return YL;case 5124:case 35670:return kL;case 35667:case 35671:return zL;case 35668:case 35672:return HL;case 35669:case 35673:return GL;case 35678:case 36198:case 36298:case 36306:case 35682:return ZL;case 35680:case 36300:case 36308:case 36293:return JL}}(e.type)}function QL(t){this.id=t,this.seq=[],this.map={}}KL.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),xL(e,t)},QL.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(t,e[o.id],n)}};const tC=/(\w+)(\])?(\[|\.)?/g;function eC(t,e){t.seq.push(e),t.map[e.id]=e}function nC(t,e,n){const r=t.name,i=r.length;for(tC.lastIndex=0;;){const o=tC.exec(r),s=tC.lastIndex;let a=o[1];const c="]"===o[2],l=o[3];if(c&&(a|=0),void 0===l||"["===l&&s+2===i){eC(n,void 0===l?new $L(a,t,e):new KL(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new QL(a),eC(n,t)),n=t}}}function rC(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);nC(n,t.getUniformLocation(e,n.name),this)}}function iC(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}rC.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},rC.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},rC.upload=function(t,e,n,r){for(let i=0,o=e.length;i!==o;++i){const o=e[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,r)}},rC.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let oC=0;function sC(t){switch(t){case Lu:return["Linear","( value )"];case Cu:return["sRGB","( value )"];case Ou:return["RGBE","( value )"];case Iu:return["RGBM","( value, 7.0 )"];case Du:return["RGBM","( value, 16.0 )"];case Fu:return["RGBD","( value, 256.0 )"];case Pu:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Nu:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function aC(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function cC(t,e){const n=sC(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function lC(t,e){const n=sC(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function uC(t,e){let n;switch(e){case Oc:n="Linear";break;case Nc:n="Reinhard";break;case Ic:n="OptimizedCineon";break;case Dc:n="ACESFilmic";break;case Fc:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function hC(t){return""!==t}function dC(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pC(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const fC=/^[ \t]*#include +<([\w\d./]+)>/gm;function mC(t){return t.replace(fC,gC)}function gC(t,e){const n=zR[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return mC(n)}const vC=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,yC=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function bC(t){return t.replace(yC,_C).replace(vC,xC)}function xC(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),_C(t,e,n,r)}function _C(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function wC(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function MC(t,e,n,r){const i=t.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===Va?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===Wa?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===qa&&(e="SHADOWMAP_TYPE_VSM"),e}(n),l=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Bc:case kc:e="ENVMAP_TYPE_CUBE";break;case Gc:case jc:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case kc:case jc:e="ENVMAP_MODE_REFRACTION"}return e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Rc:e="ENVMAP_BLENDING_MULTIPLY";break;case Lc:e="ENVMAP_BLENDING_MIX";break;case Cc:e="ENVMAP_BLENDING_ADD"}return e}(n),d=t.gammaFactor>0?t.gammaFactor:1,p=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(hC).join("\n")}(n),f=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(o),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(hC).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(hC).join("\n"),v.length>0&&(v+="\n")):(g=[wC(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(hC).join("\n"),v=[p,wC(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Pc?"#define TONE_MAPPING":"",n.toneMapping!==Pc?zR.tonemapping_pars_fragment:"",n.toneMapping!==Pc?uC("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",zR.encodings_pars_fragment,n.map?cC("mapTexelToLinear",n.mapEncoding):"",n.matcap?cC("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?cC("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?cC("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?cC("lightMapTexelToLinear",n.lightMapEncoding):"",lC("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(hC).join("\n")),s=mC(s),s=dC(s,n),s=pC(s,n),a=mC(a),a=dC(a,n),a=pC(a,n),s=bC(s),a=bC(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===ph?"":"out highp vec4 pc_fragColor;",n.glslVersion===ph?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+g+s,x=y+v+a,_=iC(i,i.VERTEX_SHADER,b),w=iC(i,i.FRAGMENT_SHADER,x);if(i.attachShader(m,_),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(m).trim(),e=i.getShaderInfoLog(_).trim(),n=i.getShaderInfoLog(w).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS)){r=!1;const e=aC(i,_,"vertex"),n=aC(i,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"gl.VALIDATE_STATUS",i.getProgramParameter(m,i.VALIDATE_STATUS),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:v}})}let M,E;return i.deleteShader(_),i.deleteShader(w),this.getUniforms=function(){return void 0===M&&(M=new rC(i,m)),M},this.getAttributes=function(){return void 0===E&&(E=function(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i).name;n[r]=t.getAttribLocation(e,r)}return n}(i,m)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=oC++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=w,this}function EC(t,e,n,r,i,o){const s=[],a=r.isWebGL2,c=r.logarithmicDepthBuffer,l=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Lu,e}return{getParameters:function(i,s,f,g,v){const y=g.fog,b=i.isMeshStandardMaterial?g.environment:null,x=e.get(i.envMap||b),_=p[i.type],w=v.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(l)return 1024;{const t=u,n=Math.floor((t-20)/4),r=Math.min(n,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}}(v):0;let M,E;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),_){const t=GR[_];M=t.vertexShader,E=t.fragmentShader}else M=i.vertexShader,E=i.fragmentShader;const S=t.getRenderTarget();return{isWebGL2:a,shaderID:_,shaderName:i.type,vertexShader:M,fragmentShader:E,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:h,outputEncoding:null!==S?m(S.texture):t.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(x.mapping===Gc||x.mapping===jc),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===zu,tangentSpaceNormalMap:i.normalMapType===ku,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!y,useFog:i.fog,fogExp2:y&&y.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:c,skinning:i.skinning&&w>0,maxBones:w,useVertexTexture:l,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&f.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:Pc,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===Za,flipSided:i.side===Ya,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<f.length;t++)n.push(e[f[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=p[t.type];let n;if(e){const t=GR[e];n=tT.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=s.length;t<e;t++){const e=s[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new MC(t,n,e,i),s.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=s.indexOf(t);s[e]=s[s.length-1],s.pop(),t.destroy()}},programs:s}}function SC(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function TC(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function AC(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function RC(t){const e=[];let n=0;const r=[],i=[],o={id:-1};function s(r,i,s,a,c,l){let u=e[n];const h=t.get(s);return void 0===u?(u={id:r.id,object:r,geometry:i,material:s,program:h.program||o,groupOrder:a,renderOrder:r.renderOrder,z:c,group:l},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=s,u.program=h.program||o,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=c,u.group=l),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(t,e,n,o,a,c){const l=s(t,e,n,o,a,c);(!0===n.transparent?i:r).push(l)},unshift:function(t,e,n,o,a,c){const l=s(t,e,n,o,a,c);(!0===n.transparent?i:r).unshift(l)},finish:function(){for(let t=n,r=e.length;t<r;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){r.length>1&&r.sort(t||TC),i.length>1&&i.sort(e||AC)}}}function LC(t){let e=new WeakMap;return{get:function(n,r){const i=e.get(n);let o;return void 0===i?(o=new RC(t),e.set(n,new WeakMap),e.get(n).set(r,o)):(o=i.get(r),void 0===o&&(o=new RC(t),i.set(r,o))),o},dispose:function(){e=new WeakMap}}}function CC(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Lo,color:new Mh};break;case"SpotLight":n={position:new Lo,direction:new Lo,color:new Mh,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Lo,color:new Mh,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Lo,skyColor:new Mh,groundColor:new Mh};break;case"RectAreaLight":n={color:new Mh,position:new Lo,halfWidth:new Lo,halfHeight:new Lo}}return t[e.id]=n,n}}}let PC=0;function OC(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function NC(t,e){const n=new CC,r=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gh};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gh,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new Lo);const o=new Lo,s=new Oo,a=new Oo;return{setup:function(o){let s=0,a=0,c=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;o.sort(OC);for(let t=0,e=o.length;t<e;t++){const e=o[t],v=e.color,y=e.intensity,b=e.distance,x=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)s+=v.r*y,a+=v.g*y,c+=v.b*y;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],y);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[l]=n,i.directionalShadowMap[l]=x,i.directionalShadowMatrix[l]=e.shadow.matrix,f++}i.directional[l]=t,l++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(v).multiplyScalar(y),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=x,i.spotShadowMatrix[h]=e.shadow.matrix,g++}i.spot[h]=t,h++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(v).multiplyScalar(y),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[d]=t,d++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=x,i.pointShadowMatrix[u]=e.shadow.matrix,m++}i.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(y),t.groundColor.copy(e.groundColor).multiplyScalar(y),i.hemi[p]=t,p++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=HR.LTC_FLOAT_1,i.rectAreaLTC2=HR.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=HR.LTC_HALF_1,i.rectAreaLTC2=HR.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=c;const v=i.hash;v.directionalLength===l&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(i.directional.length=l,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,v.directionalLength=l,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,i.version=PC++)},setupView:function(t,e){let n=0,r=0,c=0,l=0,u=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),n++}else if(d.isSpotLight){const t=i.spot[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),c++}else if(d.isRectAreaLight){const t=i.rectArea[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),l++}else if(d.isPointLight){const t=i.point[r];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const t=i.hemi[u];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:i}}function IC(t,e){const n=new NC(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function DC(t,e){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new IC(t,e),n.set(r,[]),n.get(r).push(o)):i>=n.get(r).length?(o=new IC(t,e),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}function FC(t){mh.call(this),this.type="MeshDepthMaterial",this.depthPacking=Uu,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function UC(t){mh.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Lo,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}FC.prototype=Object.create(mh.prototype),FC.prototype.constructor=FC,FC.prototype.isMeshDepthMaterial=!0,FC.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},UC.prototype=Object.create(mh.prototype),UC.prototype.constructor=UC,UC.prototype.isMeshDistanceMaterial=!0,UC.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function BC(t,e,n){let r=new UR;const i=new gh,o=new gh,s=new Hd,a=[],c=[],l={},u={0:Ya,1:Xa,2:Za},h=new rT({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new gh},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n\t\t#ifdef HORIZONTAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const p=new dp;p.setAttribute("position",new Vd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new nf(p,h),m=this;function g(n,r){const i=e.update(f);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,h,f,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,d,f,null)}function v(t,e,n){const r=t<<0|e<<1|n<<2;let i=a[r];return void 0===i&&(i=new FC({depthPacking:Bu,morphTargets:t,skinning:e}),a[r]=i),i}function y(t,e,n){const r=t<<0|e<<1|n<<2;let i=c[r];return void 0===i&&(i=new UC({morphTargets:t,skinning:e}),c[r]=i),i}function b(e,n,r,i,o,s,a){let c=null,h=v,d=e.customDepthMaterial;if(!0===i.isPointLight&&(h=y,d=e.customDistanceMaterial),void 0===d){let t=!1;!0===r.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e));c=h(t,i,!0===e.isInstancedMesh)}else c=d;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const t=c.uuid,e=r.uuid;let n=l[t];void 0===n&&(n={},l[t]=n);let i=n[e];void 0===i&&(i=c.clone(),n[e]=i),c=i}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=a===qa?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,!0===i.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(i.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function x(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===qa)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let c=0,l=e.length;c<l;c++){const l=e[c],u=i[l.materialIndex];if(u&&u.visible){const e=b(n,r,u,s,o.near,o.far,a);t.renderBufferDirect(o,null,r,e,n,l)}}}else if(i.visible){const e=b(n,r,i,s,o.near,o.far,a);t.renderBufferDirect(o,null,r,e,n,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)x(c[t],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Va,this.render=function(e,a,c){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(Ka),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,u=e.length;l<u;l++){const u=e[l],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const p=h.getFrameExtents();if(i.multiply(p),o.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(o.x=Math.floor(n/p.x),i.x=o.x*p.x,h.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/p.y),i.y=o.y*p.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===qa){const t={minFilter:Kc,magFilter:Kc,format:vl};h.map=new YR(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.mapPass=new YR(i.x,i.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:Xc,magFilter:Xc,format:vl};h.map=new YR(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const f=h.getViewportCount();for(let t=0;t<f;t++){const e=h.getViewport(t);s.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),d.viewport(s),h.updateMatrices(u,t),r=h.getFrustum(),x(a,c,h.camera,u,this.type)}h.isPointLightShadow||this.type!==qa||g(h,c),h.needsUpdate=!1}m.needsUpdate=!1,t.setRenderTarget(l,u,h)}}function kC(t,e,n){const r=n.isWebGL2;const i=new function(){let e=!1;const n=new Hd;let r=null;const i=new Hd(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,s,a){!0===a&&(e*=s,r*=s,o*=s),n.set(e,r,o,s),!1===i.equals(n)&&(t.clearColor(e,r,o,s),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(e){e?N(t.DEPTH_TEST):I(t.DEPTH_TEST)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case xc:t.depthFunc(t.NEVER);break;case _c:t.depthFunc(t.ALWAYS);break;case wc:t.depthFunc(t.LESS);break;case Mc:t.depthFunc(t.LEQUAL);break;case Ec:t.depthFunc(t.EQUAL);break;case Sc:t.depthFunc(t.GEQUAL);break;case Tc:t.depthFunc(t.GREATER);break;case Ac:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},s=new function(){let e=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null;return{setTest:function(n){e||(n?N(t.STENCIL_TEST):I(t.STENCIL_TEST))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,s){r===e&&i===n&&o===s||(t.stencilFunc(e,n,s),r=e,i=n,o=s)},setOp:function(e,n,r){s===e&&a===n&&c===r||(t.stencilOp(e,n,r),s=e,a=n,c=r)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null}}};let a={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null;const M=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let E=!1,S=0;const T=t.getParameter(t.VERSION);-1!==T.indexOf("WebGL")?(S=parseFloat(/^WebGL (\d)/.exec(T)[1]),E=S>=1):-1!==T.indexOf("OpenGL ES")&&(S=parseFloat(/^OpenGL ES (\d)/.exec(T)[1]),E=S>=2);let A=null,R={};const L=new Hd,C=new Hd;function P(e,n,r){const i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let e=0;e<r;e++)t.texImage2D(n+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i);return o}const O={};function N(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function I(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}O[t.TEXTURE_2D]=P(t.TEXTURE_2D,t.TEXTURE_2D,1),O[t.TEXTURE_CUBE_MAP]=P(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),i.setClear(0,0,0,1),o.setClear(1),s.setClear(0),N(t.DEPTH_TEST),o.setFunc(Mc),B(!1),k(za),N(t.CULL_FACE),U(Ka);const D={[ic]:t.FUNC_ADD,[oc]:t.FUNC_SUBTRACT,[sc]:t.FUNC_REVERSE_SUBTRACT};if(r)D[ac]=t.MIN,D[cc]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(D[ac]=t.MIN_EXT,D[cc]=t.MAX_EXT)}const F={[lc]:t.ZERO,[uc]:t.ONE,[hc]:t.SRC_COLOR,[pc]:t.SRC_ALPHA,[bc]:t.SRC_ALPHA_SATURATE,[vc]:t.DST_COLOR,[mc]:t.DST_ALPHA,[dc]:t.ONE_MINUS_SRC_COLOR,[fc]:t.ONE_MINUS_SRC_ALPHA,[yc]:t.ONE_MINUS_DST_COLOR,[gc]:t.ONE_MINUS_DST_ALPHA};function U(e,n,r,i,o,s,a,c){if(e!==Ka){if(l||(N(t.BLEND),l=!0),e===rc)o=o||n,s=s||r,a=a||i,n===h&&o===f||(t.blendEquationSeparate(D[n],D[o]),h=n,f=o),r===d&&i===p&&s===m&&a===g||(t.blendFuncSeparate(F[r],F[i],F[s],F[a]),d=r,p=i,m=s,g=a),u=e,v=null;else if(e!==u||c!==v){if(h===ic&&f===ic||(t.blendEquation(t.FUNC_ADD),h=ic,f=ic),c)switch(e){case Qa:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case tc:t.blendFunc(t.ONE,t.ONE);break;case ec:t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA);break;case nc:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case Qa:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case tc:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case ec:t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR);break;case nc:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}d=null,p=null,m=null,g=null,u=e,v=c}}else l&&(I(t.BLEND),l=!1)}function B(e){y!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),y=e)}function k(e){e!==ka?(N(t.CULL_FACE),e!==b&&(e===za?t.cullFace(t.BACK):e===Ha?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):I(t.CULL_FACE),b=e}function z(e,n,r){e?(N(t.POLYGON_OFFSET_FILL),_===n&&w===r||(t.polygonOffset(n,r),_=n,w=r)):I(t.POLYGON_OFFSET_FILL)}function H(e){void 0===e&&(e=t.TEXTURE0+M-1),A!==e&&(t.activeTexture(e),A=e)}return{buffers:{color:i,depth:o,stencil:s},enable:N,disable:I,useProgram:function(e){return c!==e&&(t.useProgram(e),c=e,!0)},setBlending:U,setMaterial:function(e,n){e.side===Za?I(t.CULL_FACE):N(t.CULL_FACE);let r=e.side===Ya;n&&(r=!r),B(r),e.blending===Qa&&!1===e.transparent?U(Ka):U(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);const a=e.stencilWrite;s.setTest(a),a&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:B,setCullFace:k,setLineWidth:function(e){e!==x&&(E&&t.lineWidth(e),x=e)},setPolygonOffset:z,setScissorTest:function(e){e?N(t.SCISSOR_TEST):I(t.SCISSOR_TEST)},activeTexture:H,bindTexture:function(e,n){null===A&&H();let r=R[A];void 0===r&&(r={type:void 0,texture:void 0},R[A]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||O[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=R[A];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===L.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),L.copy(e))},viewport:function(e){!1===C.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),C.copy(e))},reset:function(){a={},A=null,R={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null,i.reset(),o.reset(),s.reset()}}}function zC(t,e,n,r,i,o,s){const a=i.isWebGL2,c=i.maxTextures,l=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?Ao.floorPowerOfTwo:Math.floor,o=r(i*t.width),s=r(i*t.height);void 0===p&&(p=m(o,s));const a=n?m(o,s):p;a.width=o,a.height=s;return a.getContext("2d").drawImage(t,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return Ao.isPowerOfTwo(t.width)&&Ao.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==Xc&&t.minFilter!==Kc}function b(e,n,i,o){t.generateMipmap(e);r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function x(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return r===t.RED&&(i===t.FLOAT&&(o=t.R32F),i===t.HALF_FLOAT&&(o=t.R16F),i===t.UNSIGNED_BYTE&&(o=t.R8)),r===t.RGB&&(i===t.FLOAT&&(o=t.RGB32F),i===t.HALF_FLOAT&&(o=t.RGB16F),i===t.UNSIGNED_BYTE&&(o=t.RGB8)),r===t.RGBA&&(i===t.FLOAT&&(o=t.RGBA32F),i===t.HALF_FLOAT&&(o=t.RGBA16F),i===t.UNSIGNED_BYTE&&(o=t.RGBA8)),o!==t.R16F&&o!==t.R32F&&o!==t.RGBA16F&&o!==t.RGBA32F||e.get("EXT_color_buffer_float"),o}function _(e){return e===Xc||e===Yc||e===Jc?t.NEAREST:t.LINEAR}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=r.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),r.remove(e)}(n),n.isVideoTexture&&d.delete(n),s.memory.textures--}function M(e){const n=e.target;n.removeEventListener("dispose",M),function(e){const n=r.get(e),i=r.get(e.texture);if(!e)return;void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}(n),s.memory.textures--}let E=0;function S(e,i){const o=r.get(e);if(e.isVideoTexture&&function(t){const e=s.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(e),e.version>0&&o.__version!==e.version){const t=e.image;if(void 0===t)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==t.complete)return void P(o,e,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_2D,o.__webglTexture)}function T(e,i){const s=r.get(e);e.version>0&&s.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;C(e,r),n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY);const s=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),c=r.image[0]&&r.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=s||c?c?r.image[t].image:r.image[t]:g(r.image[t],!1,!0,l);const h=u[0],d=v(h)||a,p=o.convert(r.format),f=o.convert(r.type),m=x(r.internalFormat,p,f);let _;if(L(t.TEXTURE_CUBE_MAP,r,d),s){for(let e=0;e<6;e++){_=u[e].mipmaps;for(let i=0;i<_.length;i++){const o=_[i];r.format!==vl&&r.format!==gl?null!==p?n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,m,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,m,o.width,o.height,0,p,f,o.data)}}e.__maxMipLevel=_.length-1}else{_=r.mipmaps;for(let e=0;e<6;e++)if(c){n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let r=0;r<_.length;r++){const i=_[r].image[e].image;n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,m,i.width,i.height,0,p,f,i.data)}}else{n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,p,f,u[e]);for(let r=0;r<_.length;r++){const i=_[r];n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,m,p,f,i.image[e])}}e.__maxMipLevel=_.length}y(r,d)&&b(t.TEXTURE_CUBE_MAP,r,h.width,h.height);e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(s,e,i):(n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_CUBE_MAP,s.__webglTexture))}const A={[Vc]:t.REPEAT,[Wc]:t.CLAMP_TO_EDGE,[qc]:t.MIRRORED_REPEAT},R={[Xc]:t.NEAREST,[Yc]:t.NEAREST_MIPMAP_NEAREST,[Jc]:t.NEAREST_MIPMAP_LINEAR,[Kc]:t.LINEAR,[Qc]:t.LINEAR_MIPMAP_NEAREST,[el]:t.LINEAR_MIPMAP_LINEAR};function L(n,o,s){s?(t.texParameteri(n,t.TEXTURE_WRAP_S,A[o.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,A[o.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,A[o.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,R[o.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,R[o.minFilter])):(t.texParameteri(n,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(n,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),o.wrapS===Wc&&o.wrapT===Wc||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,t.TEXTURE_MAG_FILTER,_(o.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,_(o.minFilter)),o.minFilter!==Xc&&o.minFilter!==Kc&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const c=e.get("EXT_texture_filter_anisotropic");if(c){if(o.type===ll&&null===e.get("OES_texture_float_linear"))return;if(o.type===ul&&null===(a||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(t.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function C(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),s.memory.textures++)}function P(e,r,i){let s=t.TEXTURE_2D;r.isDataTexture2DArray&&(s=t.TEXTURE_2D_ARRAY),r.isDataTexture3D&&(s=t.TEXTURE_3D),C(e,r),n.activeTexture(t.TEXTURE0+i),n.bindTexture(s,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment);const c=function(t){return!a&&(t.wrapS!==Wc||t.wrapT!==Wc||t.minFilter!==Xc&&t.minFilter!==Kc)}(r)&&!1===v(r.image),l=g(r.image,c,!1,u),h=v(l)||a,d=o.convert(r.format);let p,f=o.convert(r.type),m=x(r.internalFormat,d,f);L(s,r,h);const _=r.mipmaps;if(r.isDepthTexture)m=t.DEPTH_COMPONENT,a?m=r.type===ll?t.DEPTH_COMPONENT32F:r.type===cl?t.DEPTH_COMPONENT24:r.type===fl?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:r.type===ll&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===_l&&m===t.DEPTH_COMPONENT&&r.type!==sl&&r.type!==cl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=sl,f=o.convert(r.type)),r.format===wl&&m===t.DEPTH_COMPONENT&&(m=t.DEPTH_STENCIL,r.type!==fl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=fl,f=o.convert(r.type))),n.texImage2D(t.TEXTURE_2D,0,m,l.width,l.height,0,d,f,null);else if(r.isDataTexture)if(_.length>0&&h){for(let e=0,r=_.length;e<r;e++)p=_[e],n.texImage2D(t.TEXTURE_2D,e,m,p.width,p.height,0,d,f,p.data);r.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else n.texImage2D(t.TEXTURE_2D,0,m,l.width,l.height,0,d,f,l.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,i=_.length;e<i;e++)p=_[e],r.format!==vl&&r.format!==gl?null!==d?n.compressedTexImage2D(t.TEXTURE_2D,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(t.TEXTURE_2D,e,m,p.width,p.height,0,d,f,p.data);e.__maxMipLevel=_.length-1}else if(r.isDataTexture2DArray)n.texImage3D(t.TEXTURE_2D_ARRAY,0,m,l.width,l.height,l.depth,0,d,f,l.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(t.TEXTURE_3D,0,m,l.width,l.height,l.depth,0,d,f,l.data),e.__maxMipLevel=0;else if(_.length>0&&h){for(let e=0,r=_.length;e<r;e++)p=_[e],n.texImage2D(t.TEXTURE_2D,e,m,d,f,p);r.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else n.texImage2D(t.TEXTURE_2D,0,m,d,f,l),e.__maxMipLevel=0;y(r,h)&&b(s,r,l.width,l.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function O(e,i,s,a){const c=o.convert(i.texture.format),l=o.convert(i.texture.type),u=x(i.texture.internalFormat,c,l);n.texImage2D(a,0,u,i.width,i.height,0,c,l,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,s,a,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function N(e,n,r){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer){let i=t.DEPTH_COMPONENT16;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===ll?i=t.DEPTH_COMPONENT32F:e.type===cl&&(i=t.DEPTH_COMPONENT24));const r=D(n);t.renderbufferStorageMultisample(t.RENDERBUFFER,r,i,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,i,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=D(n);t.renderbufferStorageMultisample(t.RENDERBUFFER,e,t.DEPTH24_STENCIL8,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=o.convert(n.texture.format),i=o.convert(n.texture.type),s=x(n.texture.internalFormat,e,i);if(r){const e=D(n);t.renderbufferStorageMultisample(t.RENDERBUFFER,e,s,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,s,n.width,n.height)}t.bindRenderbuffer(t.RENDERBUFFER,null)}function I(e){const n=r.get(e),i=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),S(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===_l)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,i,0);else{if(n.depthTexture.format!==wl)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,i,0)}}(n.__webglFramebuffer,e)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)t.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=t.createRenderbuffer(),N(n.__webglDepthbuffer[r],e,!1)}else t.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),N(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(t.FRAMEBUFFER,null)}function D(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let F=!1,U=!1;this.allocateTextureUnit=function(){const t=E;return t>=c&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+c),E+=1,t},this.resetTextureUnits=function(){E=0},this.setTexture2D=S,this.setTexture2DArray=function(e,i){const o=r.get(e);e.version>0&&o.__version!==e.version?P(o,e,i):(n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_2D_ARRAY,o.__webglTexture))},this.setTexture3D=function(e,i){const o=r.get(e);e.version>0&&o.__version!==e.version?P(o,e,i):(n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_3D,o.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(e){const i=r.get(e),c=r.get(e.texture);e.addEventListener("dispose",M),c.__webglTexture=t.createTexture(),s.memory.textures++;const l=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultisampleRenderTarget,h=v(e)||a;if(!a||e.texture.format!==gl||e.texture.type!==ll&&e.texture.type!==ul||(e.texture.format=vl,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){i.__webglFramebuffer=[];for(let e=0;e<6;e++)i.__webglFramebuffer[e]=t.createFramebuffer()}else if(i.__webglFramebuffer=t.createFramebuffer(),u)if(a){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i.__webglColorRenderbuffer);const n=o.convert(e.texture.format),r=o.convert(e.texture.type),s=x(e.texture.internalFormat,n,r),a=D(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,s,e.width,e.height),t.bindFramebuffer(t.FRAMEBUFFER,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,i.__webglColorRenderbuffer),t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),N(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(t.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),L(t.TEXTURE_CUBE_MAP,e.texture,h);for(let n=0;n<6;n++)O(i.__webglFramebuffer[n],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n);y(e.texture,h)&&b(t.TEXTURE_CUBE_MAP,e.texture,e.width,e.height),n.bindTexture(t.TEXTURE_CUBE_MAP,null)}else n.bindTexture(t.TEXTURE_2D,c.__webglTexture),L(t.TEXTURE_2D,e.texture,h),O(i.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),y(e.texture,h)&&b(t.TEXTURE_2D,e.texture,e.width,e.height),n.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&I(e)},this.updateRenderTargetMipmap=function(e){const i=e.texture;if(y(i,v(e)||a)){const o=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=r.get(i).__webglTexture;n.bindTexture(o,s),b(o,i,e.width,e.height),n.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const n=r.get(e);t.bindFramebuffer(t.READ_FRAMEBUFFER,n.__webglMultisampledFramebuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n.__webglFramebuffer);const i=e.width,o=e.height;let s=t.COLOR_BUFFER_BIT;e.depthBuffer&&(s|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(s|=t.STENCIL_BUFFER_BIT),t.blitFramebuffer(0,0,i,o,0,0,i,o,s,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),S(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),T(t,e)}}function HC(t,e,n){const r=n.isWebGL2;return{convert:function(n){let i;if(n===rl)return t.UNSIGNED_BYTE;if(n===hl)return t.UNSIGNED_SHORT_4_4_4_4;if(n===dl)return t.UNSIGNED_SHORT_5_5_5_1;if(n===pl)return t.UNSIGNED_SHORT_5_6_5;if(n===il)return t.BYTE;if(n===ol)return t.SHORT;if(n===sl)return t.UNSIGNED_SHORT;if(n===al)return t.INT;if(n===cl)return t.UNSIGNED_INT;if(n===ll)return t.FLOAT;if(n===ul)return r?t.HALF_FLOAT:(i=e.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(n===ml)return t.ALPHA;if(n===gl)return t.RGB;if(n===vl)return t.RGBA;if(n===yl)return t.LUMINANCE;if(n===bl)return t.LUMINANCE_ALPHA;if(n===_l)return t.DEPTH_COMPONENT;if(n===wl)return t.DEPTH_STENCIL;if(n===Ml)return t.RED;if(n===El)return t.RED_INTEGER;if(n===Sl)return t.RG;if(n===Tl)return t.RG_INTEGER;if(n===Al)return t.RGB_INTEGER;if(n===Rl)return t.RGBA_INTEGER;if(n===Ll||n===Cl||n===Pl||n===Ol){if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Ll)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Cl)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Pl)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Ol)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Nl||n===Il||n===Dl||n===Fl){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===Nl)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Il)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Dl)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Fl)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Ul)return i=e.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((n===Bl||n===kl)&&(i=e.get("WEBGL_compressed_texture_etc"),null!==i)){if(n===Bl)return i.COMPRESSED_RGB8_ETC2;if(n===kl)return i.COMPRESSED_RGBA8_ETC2_EAC}return n===zl||n===Hl||n===Gl||n===jl||n===Vl||n===Wl||n===ql||n===Xl||n===Yl||n===Zl||n===Jl||n===$l||n===Kl||n===Ql||n===eu||n===nu||n===ru||n===iu||n===ou||n===su||n===au||n===cu||n===lu||n===uu||n===hu||n===du||n===pu||n===fu?(i=e.get("WEBGL_compressed_texture_astc"),null!==i?n:null):n===tu?(i=e.get("EXT_texture_compression_bptc"),null!==i?n:null):n===fl?r?t.UNSIGNED_INT_24_8:(i=e.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function GC(t=[]){bR.call(this),this.cameras=t}function jC(){os.call(this),this.type="Group"}function VC(){this._targetRay=null,this._grip=null,this._hand=null}function WC(t,e){const n=this;let r=null,i=1,o=null,s="local-floor",a=null;const c=[],l=new Map,u=new bR;u.layers.enable(1),u.viewport=new Hd;const h=new bR;h.layers.enable(2),h.viewport=new Hd;const d=[u,h],p=new GC;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(t){const e=l.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function v(){l.forEach((function(t,e){t.disconnect(e)})),l.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),E.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(t){o=t,E.setContext(r),E.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function b(t){const e=r.inputSources;for(let t=0;t<c.length;t++)l.set(e[t],c[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=l.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),l.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],r=l.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=c[t];return void 0===e&&(e=new VC,c[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=c[t];return void 0===e&&(e=new VC,c[t]=e),e.getGripSpace()},this.getHand=function(t){let e=c[t];return void 0===e&&(e=new VC,c[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){s=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=function(t){if(r=t,null!==r){r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",v);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i},o=new XRWebGLLayer(r,e,n);r.updateRenderState({baseLayer:o}),r.requestReferenceSpace(s).then(y),r.addEventListener("inputsourceschange",b)}};const x=new Lo,_=new Lo;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){p.near=h.near=u.near=t.near,p.far=h.far=u.far=t.far,f===p.near&&m===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const e=t.parent,n=p.cameras;w(p,e);for(let t=0;t<n.length;t++)w(n[t],e);t.matrixWorld.copy(p.matrixWorld);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){x.setFromMatrixPosition(e.matrixWorld),_.setFromMatrixPosition(n.matrixWorld);const r=x.distanceTo(_),i=e.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=s+f,v=a+f,y=d-m,b=p+(r-m),w=c*a/v*g,M=l*a/v*g;t.projectionMatrix.makePerspective(y,b,w,M,g,v)}(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let M=null;const E=new BR;E.setAnimationLoop((function(e,n){if(a=n.getViewerPose(o),null!==a){const e=a.views,n=r.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let i=!1;e.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let t=0;t<e.length;t++){const r=e[t],o=n.getViewport(r),s=d[t];s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===t&&p.matrix.copy(s.matrix),!0===i&&p.cameras.push(s)}}const i=r.inputSources;for(let t=0;t<c.length;t++){const e=c[t],r=i[t];e.update(r,n,o)}M&&M(e,n)})),this.setAnimationLoop=function(t){M=t},this.dispose=function(){}}function qC(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const r=t.get(n).envMap;if(r){e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;const i=t.get(r).__maxMipLevel;void 0!==i&&(e.maxMipLevel.value=i)}let i,o;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,n.side===Ya&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),n.side===Ya&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,o){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Ya&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Ya&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Ya&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Ya&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r),r.isMeshPhysicalMaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===Ya&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,r):n(t,r)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Ya&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Ya&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Ya&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Ya&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function XC(t){const e=void 0!==(t=t||{}).canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Lu,this.physicallyCorrectLights=!1,this.toneMapping=Pc,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,v=0,y=0,b=null,x=null,_=-1,w=null;const M=new Hd,E=new Hd;let S=null,T=e.width,A=e.height,R=1,L=null,C=null;const P=new Hd(0,0,T,A),O=new Hd(0,0,T,A);let N=!1;const I=new UR;let D=!1,F=!1;const U=new Oo,B=new Lo,k={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===b?R:1}let H,G,j,V,W,q,X,Y,Z,J,$,K,Q,tt,et,nt,rt,it,ot,st,at,ct=n;function lt(t,n){for(let r=0;r<t.length;r++){const i=t[r],o=e.getContext(i,n);if(null!==o)return o}return null}try{const t={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===ct){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),ct=lt(e,t),null===ct)throw lt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ct.getShaderPrecisionFormat&&(ct.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ut(){H=new QR(ct),G=new qR(ct,H,t),!1===G.isWebGL2&&(H.get("WEBGL_depth_texture"),H.get("OES_texture_float"),H.get("OES_texture_half_float"),H.get("OES_texture_half_float_linear"),H.get("OES_standard_derivatives"),H.get("OES_element_index_uint"),H.get("OES_vertex_array_object"),H.get("ANGLE_instanced_arrays")),H.get("OES_texture_float_linear"),st=new HC(ct,H,G),j=new kC(ct,H,G),j.scissor(E.copy(O).multiplyScalar(R).floor()),j.viewport(M.copy(P).multiplyScalar(R).floor()),V=new nL(ct),W=new SC,q=new zC(ct,H,j,W,G,st,V),X=new KR(f),Y=new kR(ct,G),at=new VR(ct,H,Y,G),Z=new tL(ct,Y,V,at),J=new sL(ct,Z,Y,V),rt=new oL(ct),et=new XR(W),$=new EC(f,X,H,G,at,et),K=new qC(W),Q=new LC(W),tt=new DC(H,G),nt=new jR(f,X,j,J,a),it=new WR(ct,H,V,G),ot=new eL(ct,H,V,G),V.programs=$.programs,f.capabilities=G,f.extensions=H,f.properties=W,f.renderLists=Q,f.state=j,f.info=V}ut();const ht=new WC(f,ct);this.xr=ht;const dt=new BC(f,J,G.maxTextureSize);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,ut()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){gt(t),W.remove(t)}(e)}function gt(t){const e=W.get(t).program;void 0!==e&&$.releaseProgram(e)}this.shadowMap=dt,this.getContext=function(){return ct},this.getContextAttributes=function(){return ct.getContextAttributes()},this.forceContextLoss=function(){const t=H.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=H.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(t){void 0!==t&&(R=t,this.setSize(T,A,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new gh),t.set(T,A)},this.setSize=function(t,n,r){ht.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,A=n,e.width=Math.floor(t*R),e.height=Math.floor(n*R),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new gh),t.set(T*R,A*R).floor()},this.setDrawingBufferSize=function(t,n,r){T=t,A=n,R=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Hd),t.copy(M)},this.getViewport=function(t){return t.copy(P)},this.setViewport=function(t,e,n,r){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,n,r),j.viewport(M.copy(P).multiplyScalar(R).floor())},this.getScissor=function(t){return t.copy(O)},this.setScissor=function(t,e,n,r){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,n,r),j.scissor(E.copy(O).multiplyScalar(R).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(t){j.setScissorTest(N=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){C=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new Mh),t.copy(nt.getClearColor())},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=ct.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=ct.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=ct.STENCIL_BUFFER_BIT),ct.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",ft,!1),Q.dispose(),tt.dispose(),W.dispose(),X.dispose(),J.dispose(),at.dispose(),ht.dispose(),yt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=W.get(t);t.hasPositions&&!n.position&&(n.position=ct.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=ct.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=ct.createBuffer()),t.hasColors&&!n.color&&(n.color=ct.createBuffer());const r=e.getAttributes();t.hasPositions&&(ct.bindBuffer(ct.ARRAY_BUFFER,n.position),ct.bufferData(ct.ARRAY_BUFFER,t.positionArray,ct.DYNAMIC_DRAW),at.enableAttribute(r.position),ct.vertexAttribPointer(r.position,3,ct.FLOAT,!1,0,0)),t.hasNormals&&(ct.bindBuffer(ct.ARRAY_BUFFER,n.normal),ct.bufferData(ct.ARRAY_BUFFER,t.normalArray,ct.DYNAMIC_DRAW),at.enableAttribute(r.normal),ct.vertexAttribPointer(r.normal,3,ct.FLOAT,!1,0,0)),t.hasUvs&&(ct.bindBuffer(ct.ARRAY_BUFFER,n.uv),ct.bufferData(ct.ARRAY_BUFFER,t.uvArray,ct.DYNAMIC_DRAW),at.enableAttribute(r.uv),ct.vertexAttribPointer(r.uv,2,ct.FLOAT,!1,0,0)),t.hasColors&&(ct.bindBuffer(ct.ARRAY_BUFFER,n.color),ct.bufferData(ct.ARRAY_BUFFER,t.colorArray,ct.DYNAMIC_DRAW),at.enableAttribute(r.color),ct.vertexAttribPointer(r.color,3,ct.FLOAT,!1,0,0)),at.disableUnusedAttributes(),ct.drawArrays(ct.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){null===e&&(e=k);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=Mt(t,e,r,i);j.setMaterial(r,s);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let u,h=1;!0===r.wireframe&&(c=Z.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&rt.update(i,n,r,a),at.setup(i,r,a,n,c);let d=it;null!==c&&(u=Y.get(c),d=ot,d.setIndex(u));const p=null!==c?c.count:l.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),b=Math.min(p,f+m,g+v)-1,x=Math.max(0,b-y+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*z()),d.setMode(ct.LINES)):d.setMode(ct.TRIANGLES);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),j.setLineWidth(t*z()),i.isLineSegments?d.setMode(ct.LINES):i.isLineLoop?d.setMode(ct.LINE_LOOP):d.setMode(ct.LINE_STRIP)}else i.isPoints?d.setMode(ct.POINTS):i.isSprite&&d.setMode(ct.TRIANGLES);if(i.isInstancedMesh)d.renderInstances(y,x,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,x,t)}else d.render(y,x)}},this.compile=function(t,e){d=tt.get(t),d.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights();const n=new WeakMap;t.traverse((function(e){const r=e.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];!1===n.has(o)&&(wt(o,t,e),n.set(o))}else!1===n.has(r)&&(wt(r,t,e),n.set(r))}))};let vt=null;const yt=new BR;function bt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||I.intersectsSprite(t)){r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=J.update(t),i=t.material;i.visible&&h.push(t,e,i,n,B.z,null)}}else if(t.isImmediateRenderObject)r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U),h.push(t,null,t.material,n,B.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==V.render.frame&&(t.skeleton.update(),t.skeleton.frame=V.render.frame),!t.frustumCulled||I.intersectsObject(t))){r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=J.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&h.push(t,e,a,n,B.z,s)}}else i.visible&&h.push(t,e,i,n,B.z,null)}const i=t.children;for(let t=0,o=i.length;t<o;t++)bt(i[t],e,n,r)}function xt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,o=t.length;i<o;i++){const o=t[i],s=o.object,a=o.geometry,c=null===r?o.material:r,l=o.group;if(n.isArrayCamera){const t=n.cameras;for(let n=0,r=t.length;n<r;n++){const r=t[n];s.layers.test(r.layers)&&(j.viewport(M.copy(r.viewport)),d.setupLightsView(r),_t(s,e,r,a,c,l))}}else _t(s,e,n,a,c,l)}}function _t(t,e,n,r,i,o){if(t.onBeforeRender(f,e,n,r,i,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const r=Mt(n,e,i,t);j.setMaterial(i),at.reset(),function(t,e){t.render((function(t){f.renderBufferImmediate(t,e)}))}(t,r)}else f.renderBufferDirect(n,e,r,i,t,o);t.onAfterRender(f,e,n,r,i,o)}function wt(t,e,n){!0!==e.isScene&&(e=k);const r=W.get(t),i=d.state.lights,o=d.state.shadowsArray,s=i.state.version,a=$.getParameters(t,i.state,o,e,n),c=$.getProgramCacheKey(a);let l=r.program,u=!0;if(void 0===l)t.addEventListener("dispose",mt);else if(l.cacheKey!==c)gt(t);else if(r.lightsStateVersion!==s)u=!1;else{if(void 0!==a.shaderID){const n=t.isMeshStandardMaterial?e.environment:null;return void(r.envMap=X.get(t.envMap||n))}u=!1}u&&(a.uniforms=$.getUniforms(t),t.onBeforeCompile(a,f),l=$.acquireProgram(a,c),r.program=l,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);const h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=et.numPlanes,r.numIntersection=et.numIntersection,h.clippingPlanes=et.uniform),r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=X.get(t.envMap||r.environment),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=r.program.getUniforms(),m=rC.seqWithValue(p.seq,h);r.uniformsList=m}function Mt(t,e,n,r){!0!==e.isScene&&(e=k),q.resetTextureUnits();const i=e.fog,o=n.isMeshStandardMaterial?e.environment:null,s=null===b?f.outputEncoding:b.texture.encoding,a=X.get(n.envMap||o),c=W.get(n),l=d.state.lights;if(!0===D&&(!0===F||t!==w)){const e=t===w&&n.id===_;et.setState(n,t,e)}n.version===c.__version?n.fog&&c.fog!==i||c.environment!==o||c.needsLights&&c.lightsStateVersion!==l.state.version?wt(n,e,r):void 0===c.numClippingPlanes||c.numClippingPlanes===et.numPlanes&&c.numIntersection===et.numIntersection?(c.outputEncoding!==s||c.envMap!==a)&&wt(n,e,r):wt(n,e,r):(wt(n,e,r),c.__version=n.version);let u=!1,h=!1,p=!1;const m=c.program,g=m.getUniforms(),v=c.uniforms;if(j.useProgram(m.program)&&(u=!0,h=!0,p=!0),n.id!==_&&(_=n.id,h=!0),u||w!==t){if(g.setValue(ct,"projectionMatrix",t.projectionMatrix),G.logarithmicDepthBuffer&&g.setValue(ct,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,h=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=g.map.cameraPosition;void 0!==e&&e.setValue(ct,B.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(ct,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(ct,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){g.setOptional(ct,r,"bindMatrix"),g.setOptional(ct,r,"bindMatrixInverse");const t=r.skeleton;if(t){const e=t.bones;if(G.floatVertexTextures){if(null===t.boneTexture){let n=Math.sqrt(4*e.length);n=Ao.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(t.boneMatrices);const i=new IR(r,n,n,vl,ll);t.boneMatrices=r,t.boneTexture=i,t.boneTextureSize=n}g.setValue(ct,"boneTexture",t.boneTexture,q),g.setValue(ct,"boneTextureSize",t.boneTextureSize)}else g.setOptional(ct,t,"boneMatrices")}}var y,x;return(h||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,g.setValue(ct,"receiveShadow",r.receiveShadow)),h&&(g.setValue(ct,"toneMappingExposure",f.toneMappingExposure),c.needsLights&&(x=p,(y=v).ambientLightColor.needsUpdate=x,y.lightProbe.needsUpdate=x,y.directionalLights.needsUpdate=x,y.directionalLightShadows.needsUpdate=x,y.pointLights.needsUpdate=x,y.pointLightShadows.needsUpdate=x,y.spotLights.needsUpdate=x,y.spotLightShadows.needsUpdate=x,y.rectAreaLights.needsUpdate=x,y.hemisphereLights.needsUpdate=x),i&&n.fog&&K.refreshFogUniforms(v,i),K.refreshMaterialUniforms(v,n,R,A),rC.upload(ct,c.uniformsList,v,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(rC.upload(ct,c.uniformsList,v,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(ct,"center",r.center),g.setValue(ct,"modelViewMatrix",r.modelViewMatrix),g.setValue(ct,"normalMatrix",r.normalMatrix),g.setValue(ct,"modelMatrix",r.matrixWorld),m}yt.setAnimationLoop((function(t){ht.isPresenting||vt&&vt(t)})),"undefined"!=typeof window&&yt.setContext(window),this.setAnimationLoop=function(t){vt=t,ht.setAnimationLoop(t),null===t?yt.stop():yt.start()},this.render=function(t,e){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;at.resetDefaultState(),_=-1,w=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ht.enabled&&!0===ht.isPresenting&&(e=ht.getCamera(e)),!0===t.isScene&&t.onBeforeRender(f,t,e,n||b),d=tt.get(t,p.length),d.init(),p.push(d),U.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),I.setFromProjectionMatrix(U),F=this.localClippingEnabled,D=et.init(this.clippingPlanes,F,e),h=Q.get(t,e),h.init(),bt(t,e,0,f.sortObjects),h.finish(),!0===f.sortObjects&&h.sort(L,C),!0===D&&et.beginShadows();const i=d.state.shadowsArray;dt.render(i,t,e),d.setupLights(),d.setupLightsView(e),!0===D&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(h,t,e,r);const o=h.opaque,s=h.transparent;o.length>0&&xt(o,t,e),s.length>0&&xt(s,t,e),!0===t.isScene&&t.onAfterRender(f,t,e),null!==b&&(q.updateRenderTargetMipmap(b),q.updateMultisampleRenderTarget(b)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),p.pop(),d=p.length>0?p[p.length-1]:null,h=null},this.setFramebuffer=function(t){g!==t&&null===b&&ct.bindFramebuffer(ct.FRAMEBUFFER,t),g=t},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderList=function(){return h},this.setRenderList=function(t){h=t},this.getRenderTarget=function(){return b},this.setRenderTarget=function(t,e=0,n=0){b=t,v=e,y=n,t&&void 0===W.get(t).__webglFramebuffer&&q.setupRenderTarget(t);let r=g,i=!1;if(t){const n=W.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],i=!0):r=t.isWebGLMultisampleRenderTarget?W.get(t).__webglMultisampledFramebuffer:n,M.copy(t.viewport),E.copy(t.scissor),S=t.scissorTest}else M.copy(P).multiplyScalar(R).floor(),E.copy(O).multiplyScalar(R).floor(),S=N;if(x!==r&&(ct.bindFramebuffer(ct.FRAMEBUFFER,r),x=r),j.viewport(M),j.scissor(E),j.setScissorTest(S),i){const r=W.get(t.texture);ct.framebufferTexture2D(ct.FRAMEBUFFER,ct.COLOR_ATTACHMENT0,ct.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.__webglTexture,n)}},this.readRenderTargetPixels=function(t,e,n,r,i,o,s){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==x&&(ct.bindFramebuffer(ct.FRAMEBUFFER,a),s=!0);try{const a=t.texture,c=a.format,l=a.type;if(c!==vl&&st.convert(c)!==ct.getParameter(ct.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===rl||st.convert(l)===ct.getParameter(ct.IMPLEMENTATION_COLOR_READ_TYPE)||l===ll&&(G.isWebGL2||H.get("OES_texture_float")||H.get("WEBGL_color_buffer_float"))||l===ul&&(G.isWebGL2?H.get("EXT_color_buffer_float"):H.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ct.checkFramebufferStatus(ct.FRAMEBUFFER)===ct.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&ct.readPixels(e,n,r,i,st.convert(c),st.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ct.bindFramebuffer(ct.FRAMEBUFFER,x)}}},this.copyFramebufferToTexture=function(t,e,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r),s=st.convert(e.format);q.setTexture2D(e,0),ct.copyTexImage2D(ct.TEXTURE_2D,n,s,t.x,t.y,i,o,0),j.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,o=e.image.height,s=st.convert(n.format),a=st.convert(n.type);q.setTexture2D(n,0),ct.pixelStorei(ct.UNPACK_FLIP_Y_WEBGL,n.flipY),ct.pixelStorei(ct.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ct.pixelStorei(ct.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?ct.texSubImage2D(ct.TEXTURE_2D,r,t.x,t.y,i,o,s,a,e.image.data):e.isCompressedTexture?ct.compressedTexSubImage2D(ct.TEXTURE_2D,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,s,e.mipmaps[0].data):ct.texSubImage2D(ct.TEXTURE_2D,r,t.x,t.y,s,a,e.image),0===r&&n.generateMipmaps&&ct.generateMipmap(ct.TEXTURE_2D),j.unbindTexture()},this.initTexture=function(t){q.setTexture2D(t,0),j.unbindTexture()},this.resetState=function(){j.reset(),at.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function YC(t=-1,e=1,n=1,r=-1,i=.1,o=2e3){yR.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}function ZC(t){rT.call(this,t),this.type="RawShaderMaterial"}GC.prototype=Object.assign(Object.create(bR.prototype),{constructor:GC,isArrayCamera:!0}),jC.prototype=Object.assign(Object.create(os.prototype),{constructor:jC,isGroup:!0}),Object.assign(VC.prototype,{constructor:VC,getHandSpace:function(){if(null===this._hand&&(this._hand=new jC,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){const t=new jC;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new jC,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new jC,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(c&&t.hand){o=!0;for(let r=0;r<=window.XRHand.LITTLE_PHALANX_TIP;r++)if(t.hand[r]){const i=e.getJointPose(t.hand[r],n),o=c.joints[r];null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=i.radius),o.visible=null!==i;const s=c.joints[window.XRHand.INDEX_PHALANX_TIP],a=c.joints[window.XRHand.THUMB_PHALANX_TIP],l=s.position.distanceTo(a.position),u=.02,h=.005;c.inputState.pinching&&l>u+h?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&l<=u-h&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==s&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==o),this}}),Object.assign(WC.prototype,zo.prototype),YC.prototype=Object.assign(Object.create(yR.prototype),{constructor:YC,isOrthographicCamera:!0,copy:function(t,e){return yR.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,o=n+t,s=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,o=i+t*this.view.width,s-=e*this.view.offsetY,a=s-e*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=os.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),ZC.prototype=Object.create(rT.prototype),ZC.prototype.constructor=ZC,ZC.prototype.isRawShaderMaterial=!0;const JC=Math.pow(2,8),$C=[.125,.215,.35,.446,.526,.582],KC=5+$C.length,QC={[Lu]:0,[Cu]:1,[Ou]:2,[Iu]:3,[Du]:4,[Fu]:5,[Pu]:6},tP=new YC,{_lodPlanes:eP,_sizeLods:nP,_sigmas:rP}=hP(),iP=new Mh;let oP=null;const sP=(1+Math.sqrt(5))/2,aP=1/sP,cP=[new Lo(1,1,1),new Lo(-1,1,1),new Lo(1,1,-1),new Lo(-1,1,-1),new Lo(0,sP,aP),new Lo(0,sP,-aP),new Lo(aP,0,sP),new Lo(-aP,0,sP),new Lo(sP,aP,0),new Lo(-sP,aP,0)];class lP{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),n=new Lo(0,1,0);return new ZC({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:QC[Lu]},outputEncoding:{value:QC[Lu]}},vertexShader:gP(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${vP()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:Ka,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){oP=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=mP(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=fP(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<eP.length;t++)eP[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(oP),t.scissorTest=!1,pP(t,0,0,t.width,t.height)}_fromTexture(t){oP=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:Xc,minFilter:Xc,generateMipmaps:!1,type:rl,format:xl,encoding:uP(t)?t.encoding:Ou,depthBuffer:!1},n=dP(e);return n.depthBuffer=!t,this._pingPongRenderTarget=dP(e),n}_compileMaterial(t){const e=new nf(eP[0],t);this._renderer.compile(e,tP)}_sceneToCubeUV(t,e,n,r){const i=new bR(90,1,e,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,c=a.outputEncoding,l=a.toneMapping;a.getClearColor(iP);const u=a.getClearAlpha();a.toneMapping=Pc,a.outputEncoding=Lu;let h=t.background;if(h&&h.isColor){h.convertSRGBToLinear();const e=Math.max(h.r,h.g,h.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);h=h.multiplyScalar(Math.pow(2,-n));const r=(n+128)/255;a.setClearColor(h,r),t.background=null}for(let e=0;e<6;e++){const n=e%3;0==n?(i.up.set(0,o[e],0),i.lookAt(s[e],0,0)):1==n?(i.up.set(0,0,o[e]),i.lookAt(0,s[e],0)):(i.up.set(0,o[e],0),i.lookAt(0,0,s[e])),pP(r,n*JC,e>2?JC:0,JC,JC),a.setRenderTarget(r),a.render(t,i)}a.toneMapping=l,a.outputEncoding=c,a.setClearColor(iP,u)}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=mP()):null==this._equirectShader&&(this._equirectShader=fP());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new nf(eP[0],r),o=r.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=QC[t.encoding],o.outputEncoding.value=QC[e.texture.encoding],pP(e,0,0,3*JC,2*JC),n.setRenderTarget(e),n.render(i,tP)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<KC;e++){const n=Math.sqrt(rP[e]*rP[e]-rP[e-1]*rP[e-1]),r=cP[(e-1)%cP.length];this._blur(t,e-1,e,n,r)}e.autoClear=n}_blur(t,e,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,o,s){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new nf(eP[r],c),u=c.uniforms,h=nP[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0==t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s),u.dTheta.value=d,u.mipInt.value=8-n,u.inputEncoding.value=QC[t.texture.encoding],u.outputEncoding.value=QC[t.texture.encoding];const v=nP[r];pP(e,3*Math.max(0,JC-2*v),(0===r?0:2*JC)+2*v*(r>4?r-8+4:0),3*v,2*v),a.setRenderTarget(e),a.render(l,tP)}}function uP(t){return void 0!==t&&t.type===rl&&(t.encoding===Lu||t.encoding===Cu||t.encoding===Pu)}function hP(){const t=[],e=[],n=[];let r=8;for(let i=0;i<KC;i++){const o=Math.pow(2,r);e.push(o);let s=1/o;i>4?s=$C[i-8+4-1]:0==i&&(s=0),n.push(s);const a=1/(o-1),c=-a/2,l=1+a/2,u=[c,c,l,c,l,l,c,c,l,l,c,l],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(r,p*d*t),v.set(u,f*d*t);const i=[t,t,t,t,t,t];y.set(i,m*d*t)}const b=new dp;b.setAttribute("position",new Vd(g,p)),b.setAttribute("uv",new Vd(v,f)),b.setAttribute("faceIndex",new Vd(y,m)),t.push(b),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function dP(t){const e=new YR(3*JC,3*JC,t);return e.texture.mapping=Gc,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function pP(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function fP(){return new ZC({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new gh(1,1)},inputEncoding:{value:QC[Lu]},outputEncoding:{value:QC[Lu]}},vertexShader:gP(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${vP()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:Ka,depthTest:!1,depthWrite:!1})}function mP(){return new ZC({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:QC[Lu]},outputEncoding:{value:QC[Lu]}},vertexShader:gP(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${vP()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:Ka,depthTest:!1,depthWrite:!1})}function gP(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function vP(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}var yP,bP,xP,_P,wP,MP=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},EP=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};const SP=new WeakMap;let TP=null,AP=!1;class RP{constructor(){if(yP.add(this),bP.set(this,0),_P.set(this,0),!AP)throw new Error("class is a singleton, use the static .singleton() method to get an instance")}static singleton(){if(TP)return TP;try{return AP=!0,TP=new RP}catch(t){throw t}finally{AP=!1}}initialize(t){let e=SP.get(t);if(e)return;const n=new XC({alpha:!0,antialias:!0});n.xr.enabled=!0,n.setPixelRatio(window.devicePixelRatio),n.shadowMap.enabled=!0,n.shadowMap.type=Wa,SP.set(t,e={renderer:n,sizeChangeHandler:()=>this.updateResolution(t)}),this.updateResolution(t),t.on("sizechange",e.sizeChangeHandler),t._glLayer.appendChild(n.domElement)}uninitialize(t){var e,n;const r=SP.get(t);r&&(t.off("sizechange",r.sizeChangeHandler),null===(e=t._glLayer)||void 0===e||e.removeChild(r.renderer.domElement),r.renderer.dispose(),null===(n=r.pmremgen)||void 0===n||n.dispose(),SP.delete(t))}drawScene(t){const e=SP.get(t);if(!e)throw new ReferenceError("Can not draw scene. Scene state should be initialized first.");const{renderer:n}=e;n.render(t.three,t.threeCamera)}updateResolution(t){const e=SP.get(t);if(!e)throw new ReferenceError("Unable to update resolution. Scene state should be initialized first.");t._updateCameraAspect(),t._updateCameraPerspective(),t._updateCameraProjection();const{x:n,y:r}=t.calculatedSize;e.renderer.setSize(n,r),t.needsUpdate()}setClearColor(t,e,n){const r=SP.get(t);if(!r)throw new ReferenceError("Unable to set clear color. Scene state should be initialized first.");r.renderer.setClearColor(e,n)}setClearAlpha(t,e){const n=SP.get(t);if(!n)throw new ReferenceError("Unable to set clear alpha. Scene state should be initialized first.");n.renderer.setClearAlpha(e)}setShadowMapType(t,e){const n=SP.get(t);if(!n)throw new ReferenceError("Unable to set clear alpha. Scene state should be initialized first.");e=e.toLowerCase(),n.renderer.shadowMap.type="pcf"==e?Va:"pcfsoft"==e?Wa:"basic"==e?ja:Va}enableBackground(t,e,n){const r=SP.get(t);if(!r)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");EP(this,bP,MP(this,bP,"f")+1,"f"),r.backgroundIsEquirectangular=e,e&&(r.pmremgen||(r.pmremgen=new lP(r.renderer),r.pmremgen.compileCubemapShader())),r.hasBackground=!0,MP(this,yP,"m",xP).call(this,t,n)}disableBackground(t){var e;const n=SP.get(t);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");EP(this,bP,MP(this,bP,"f")+1,"f"),n.hasBackground||n.hasEnvironment||(null===(e=n.pmremgen)||void 0===e||e.dispose(),n.pmremgen=void 0)}enableEnvironment(t,e){const n=SP.get(t);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");EP(this,_P,MP(this,_P,"f")+1,"f"),n.pmremgen||(n.pmremgen=new lP(n.renderer),n.pmremgen.compileCubemapShader()),n.hasEnvironment=!0,MP(this,yP,"m",wP).call(this,t,e)}disableEnvironment(t){var e;const n=SP.get(t);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");EP(this,_P,MP(this,_P,"f")+1,"f"),n.hasBackground||n.hasEnvironment||(null===(e=n.pmremgen)||void 0===e||e.dispose(),n.pmremgen=void 0)}requestFrame(t,e){const n=SP.get(t);if(!n)throw new ReferenceError("Unable to request frame. Scene state should be initialized first.");const{renderer:r}=n;r.setAnimationLoop?r.setAnimationLoop(e):r.animate&&r.animate(e)}enableVR(t,e){const n=SP.get(t);if(!n)throw new ReferenceError("Unable to enable VR. Scene state should be initialized first.");const{renderer:r}=n;r.xr.enabled=e}createDefaultVRButton(t){const e=SP.get(t);if(!e)throw new ReferenceError("Unable to create VR button. Scene state should be initialized first.");const{renderer:n}=e;return class{static createButton(t,e){e&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=document.createElement("button");function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null,n.textContent="VR NOT SUPPORTED"}function i(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",i(n),navigator.xr.isSessionSupported("immersive-vr").then((function(e){e?function(){let e=null;function r(r){r.addEventListener("end",i),t.xr.setSession(r),n.textContent="EXIT VR",e=r}function i(){e.removeEventListener("end",i),n.textContent="ENTER VR",e=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(null===e){const t={optionalFeatures:["local-floor","bounded-floor","hand-tracking"]};navigator.xr.requestSession("immersive-vr",t).then(r)}else e.end()}}():r()})),n;{const t=document.createElement("a");return!1===window.isSecureContext?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",i(t),t}}}.createButton(n)}}function LP(){TP=null}bP=new WeakMap,_P=new WeakMap,yP=new WeakSet,xP=function(t,e){const n=SP.get(t);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");const r=MP(this,bP,"f");(new kS).load(t.background,t=>{r===MP(this,bP,"f")&&(n.backgroundIsEquirectangular?e(n.pmremgen.fromEquirectangular(t).texture):e(t))})},wP=function(t,e){const n=SP.get(t);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");const r=MP(this,_P,"f");(new kS).load(t.environment,t=>{r===MP(this,_P,"f")&&(e(n.pmremgen.fromEquirectangular(t).texture),t.dispose())})};const CP=new WeakMap;let PP=null,OP=!1;class NP{static singleton(){if(PP)return PP;try{return OP=!0,PP=new NP}catch(t){throw t}finally{OP=!1}}constructor(){if(!OP)throw new Error("class is a singleton, use the static .singleton() method to get an instance")}initialize(t){let e=CP.get(t);if(e)return;CP.set(t,e={renderer:new Jh,sizeChangeHandler:()=>this.updateResolution(t)});const{renderer:n}=e;this.updateResolution(t),t.on("sizechange",e.sizeChangeHandler),t._cssLayer.appendChild(n.domElement)}uninitialize(t){var e;const n=CP.get(t);n&&(t.off("sizechange",n.sizeChangeHandler),null===(e=t._cssLayer)||void 0===e||e.removeChild(n.renderer.domElement),CP.delete(t))}drawScene(t){const e=CP.get(t);if(!e)throw new ReferenceError("Can not draw scene. Scene state should be initialized first.");const{renderer:n}=e;n.render(t.threeCSS,t.threeCamera)}updateResolution(t){const e=CP.get(t);if(!e)throw new ReferenceError("Unable to update resolution. Scene state should be initialized first.");t._updateCameraAspect(),t._updateCameraPerspective(),t._updateCameraProjection();const{x:n,y:r}=t.calculatedSize;e.renderer.setSize(n,r),t.needsUpdate()}requestFrame(t,e){requestAnimationFrame(e)}}function IP(){PP=null}var DP,FP,UP,BP,kP,zP,HP,GP,jP,VP,WP,qP,XP,YP,ZP,JP,$P=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},KP=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},QP=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n},tO=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};let eO=class extends RR{constructor(){super(),DP.add(this),this.isScene=!0,this.enableCss=!0,this.webgl=!1,this.shadowmapType="basic",this.vr=!1,this.backgroundColor=new Mh("white"),this.backgroundOpacity=0,this.background="",this.equirectangularBackground=!1,this.environment="",this.fogMode="none",this.fogNear=0,this.fogFar=1e3,this.fogColor="gray",this.fogDensity=.0025,this.cameraNear=.1,this.cameraFar=1e4,FP.set(this,400),UP.set(this,void 0),this._scene=this,this._mounted=!1,BP.set(this,new Set),kP.set(this,null),zP.set(this,null),VP.set(this,{x:0,y:0,z:0}),qP.set(this,null),this.sizeMode.set("proportional","proportional","literal"),this.size.set(1,1,0),this._elementOperations.shouldRender=!0,this._elementParentSize={x:0,y:0,z:0},this._createDefaultCamera(),this._calcSize(),this.needsUpdate()}set perspective(t){QP(this,FP,t,"f"),this._updateCameraPerspective(),this._updateCameraProjection(),this.needsUpdate()}get perspective(){return tO(this,FP,"f")}get threeCamera(){return tO(this,UP,"f")}drawScene(){tO(this,kP,"f")&&tO(this,kP,"f").drawScene(this),tO(this,zP,"f")&&tO(this,zP,"f").drawScene(this)}async mount(t){let e=t;if(void 0===e)document.body||await no(),e=document.body;else if("string"==typeof e){const t=e;e=document.querySelector(t),e||"loading"!==document.readyState||(await function(){if("loading"===document.readyState)return new Promise(t=>{document.addEventListener("DOMContentLoaded",()=>t())});return Promise.resolve()}(),e=document.querySelector(t))}if(!(e instanceof HTMLElement||e instanceof ShadowRoot))throw new Error(so(`\n\t\t\t\t\t\tInvalid mount point specified in Scene.mount() call\n\t\t\t\t\t\t(${e}). Pass a selector or an HTMLElement. Not\n\t\t\t\t\t\tpassing any argument will cause the Scene to be mounted\n\t\t\t\t\t\tto the <body>.\n\t\t\t\t\t`));this._mounted&&this.unmount(),e!==this.parentNode&&e.appendChild(this),this._mounted=!0}unmount(){this._mounted&&(this.parentNode&&this.parentNode.removeChild(this),this._mounted=!1)}connectedCallback(){super.connectedCallback(),this._stopFns.push(Zr(()=>{this.webgl?this._triggerLoadGL():this._triggerUnloadGL(),this.needsUpdate()}),Zr(()=>{var t;if(!this.webgl||!this.background)return Dh(this.three.background)&&this.three.background.dispose(),void(null===(t=tO(this,kP,"f"))||void 0===t||t.disableBackground(this));this.background.match(/\.(jpg|jpeg|png)$/)?(Dh(this.three.background)&&this.three.background.dispose(),tO(this,kP,"f").disableBackground(this),tO(this,kP,"f").enableBackground(this,this.equirectangularBackground,t=>{this.three.background=t||null,this.needsUpdate()})):console.warn(`<${this.tagName.toLowerCase()}> background attribute ignored, the given image type is not currently supported.`)}),Zr(()=>{var t;if(!this.webgl||!this.environment)return Dh(this.three.environment)&&this.three.environment.dispose(),void(null===(t=tO(this,kP,"f"))||void 0===t||t.disableEnvironment(this));this.environment.match(/\.(jpg|jpeg|png)$/)?(Dh(this.three.environment)&&this.three.environment.dispose(),tO(this,kP,"f").disableEnvironment(this),tO(this,kP,"f").enableEnvironment(this,t=>{this.three.environment=t,this.needsUpdate()})):console.warn(`<${this.tagName.toLowerCase()}> environment attribute ignored, the given image type is not currently supported.`)}),Zr(()=>{this.enableCss?this._triggerLoadCSS():this._triggerUnloadCSS(),this.needsUpdate()}),Zr(()=>{this.sizeMode,tO(this,DP,"m",WP).call(this)}))}disconnectedCallback(){super.disconnectedCallback(),tO(this,DP,"m",YP).call(this)}makeThreeObject3d(){return new wA}makeThreeCSSObject(){return new wA}_createDefaultCamera(){ri(()=>{const t=this.calculatedSize;QP(this,UP,new bR(45,t.x/t.y||1,.1,1e4),"f"),this.perspective=this.perspective})}_updateCameraPerspective(){const t=tO(this,FP,"f");tO(this,UP,"f").fov=2*Math.atan(this.calculatedSize.y/2/t)*180/Math.PI,tO(this,UP,"f").position.z=t}_updateCameraAspect(){tO(this,UP,"f").aspect=this.calculatedSize.x/this.calculatedSize.y||1}_updateCameraProjection(){tO(this,UP,"f").updateProjectionMatrix()}_addCamera(t){tO(this,BP,"f").add(t),tO(this,DP,"m",jP).call(this,t)}_removeCamera(t){tO(this,BP,"f").delete(t),tO(this,BP,"f").size?(tO(this,BP,"f").forEach(e=>t=e),tO(this,DP,"m",jP).call(this,t)):tO(this,DP,"m",jP).call(this)}_getParentSize(){return this.parent?this.parent.calculatedSize:this._elementParentSize}_loadGL(){return!!super._loadGL()&&(this._composedChildren,this.three.autoUpdate=!1,QP(this,kP,tO(this,DP,"m",HP).call(this,"three"),"f"),this._glStopFns.push(Zr(()=>{"none"===this.fogMode?this.three.fog=null:"linear"===this.fogMode?this.three.fog=new OR("deeppink"):"expo2"===this.fogMode&&(this.three.fog=new NR(new Mh("deeppink").getHex())),this.needsUpdate()}),Zr(()=>{if("none"===this.fogMode);else if("linear"===this.fogMode){const t=this.three.fog;t.near=this.fogNear,t.far=this.fogFar,t.color.set(this.fogColor)}else if("expo2"===this.fogMode){const t=this.three.fog;t.color.set(this.fogColor),t.density=this.fogDensity}}),Zr(()=>{tO(this,kP,"f").setClearColor(this,this.backgroundColor,this.backgroundOpacity),this.needsUpdate()}),Zr(()=>{tO(this,kP,"f").setClearAlpha(this,this.backgroundOpacity),this.needsUpdate()}),Zr(()=>{tO(this,kP,"f").setShadowMapType(this,this.shadowmapType),this.needsUpdate()}),Zr(()=>{if(console.log("enable vr",this.vr),tO(this,kP,"f").enableVR(this,this.vr),this.vr){console.log("set vr frame requester!"),$s.setFrameRequester(t=>(tO(this,kP,"f").requestFrame(this,t),0));const t=tO(this,kP,"f").createDefaultVRButton(this);t.classList.add("vrButton"),this._miscLayer.appendChild(t)}else this.xr}),Zr(()=>{tO(this,UP,"f").near=this.cameraNear,tO(this,UP,"f").far=this.cameraFar,this.needsUpdate()})),this.traverse(t=>{t!==this&&t._triggerLoadGL()}),!0)}_unloadGL(){var t;return!!super._unloadGL()&&(tO(this,kP,"f")&&(tO(this,kP,"f").uninitialize(this),QP(this,kP,null,"f")),this.traverse(t=>{t!==this&&t._triggerUnloadGL()}),null===(t=this.three.environment)||void 0===t||t.dispose(),Dh(this.three.background)&&this.three.background.dispose(),!0)}_loadCSS(){return!!super._loadCSS()&&(QP(this,zP,tO(this,DP,"m",GP).call(this,"three"),"f"),this.traverse(t=>{t!==this&&t._loadCSS()}),!0)}_unloadCSS(){return!!super._unloadCSS()&&(tO(this,zP,"f")&&(tO(this,zP,"f").uninitialize(this),QP(this,zP,null,"f")),this.traverse(t=>{t!==this&&t._unloadCSS()}),!0)}};FP=new WeakMap,UP=new WeakMap,BP=new WeakMap,kP=new WeakMap,zP=new WeakMap,VP=new WeakMap,qP=new WeakMap,DP=new WeakSet,HP=function(t){if(tO(this,kP,"f"))return tO(this,kP,"f");let e;if("three"!==t)throw new Error("invalid WebGL renderer");return e=RP.singleton(),e.initialize(this),e},GP=function(t){if(tO(this,zP,"f"))return tO(this,zP,"f");let e;if("three"!==t)throw new Error('invalid CSS renderer. The only type supported is currently "three" (i.e. Three.js).');return e=NP.singleton(),e.initialize(this),e},jP=function(t){t?(QP(this,UP,t.three,"f"),this._updateCameraAspect(),this._updateCameraProjection(),this.needsUpdate()):this._createDefaultCamera()},WP=function(){!this.enableCss&&!this.webgl||"proportional"!=this.sizeMode.x&&"proportional"!=this.sizeMode.y?tO(this,DP,"m",YP).call(this):tO(this,DP,"m",XP).call(this)},XP=function(){const t=this.parentNode instanceof HTMLElement?this.parentNode:this.parentNode instanceof ShadowRoot?this.parentNode.host:oo("A Scene can only be child of an HTMLElement or ShadowRoot (and f.e. not an SVGElement).");PR(),QP(this,qP,new ResizeObserver(e=>{for(const n of e)if(n.contentBoxSize){const{inlineSize:e,blockSize:r}=n.contentBoxSize[0];getComputedStyle(t).writingMode.includes("horizontal")?tO(this,DP,"m",ZP).call(this,e,r):tO(this,DP,"m",ZP).call(this,r,e)}else{const{width:t,height:e}=n.contentRect;tO(this,DP,"m",ZP).call(this,t,e)}}),"f"),tO(this,qP,"f").observe(t)},YP=function(){var t;null===(t=tO(this,qP,"f"))||void 0===t||t.disconnect(),QP(this,qP,null,"f")},ZP=function(t,e){const n=tO(this,VP,"f");n.x==t&&n.y==e||(n.x=t,n.y=e,tO(this,DP,"m",JP).call(this,n))},JP=function(t){this._elementParentSize=t,this._calcSize(),this.needsUpdate()},eO.defaultElementName="lume-scene",eO.css=`\n\t\t${RR.css}\n\t\t.vrButton {\n\t\t\tcolor: black;\n\t\t\tborder-color: black;\n\t\t}\n\t`,$P([J("propertychange"),li(!0),KP("design:type",Object)],eO.prototype,"enableCss",void 0),$P([J("propertychange"),li(!1),KP("design:type",Object)],eO.prototype,"webgl",void 0),$P([J("propertychange"),oi,KP("design:type",String)],eO.prototype,"shadowmapType",void 0),$P([J("propertychange"),li(!1),KP("design:type",Object)],eO.prototype,"vr",void 0),$P([J("propertychange"),oi,KP("design:type",Object)],eO.prototype,"backgroundColor",void 0),$P([J("propertychange"),ci(0),KP("design:type",Object)],eO.prototype,"backgroundOpacity",void 0),$P([J("propertychange"),oi,KP("design:type",Object)],eO.prototype,"background",void 0),$P([J("propertychange"),li(!1),KP("design:type",Object)],eO.prototype,"equirectangularBackground",void 0),$P([J("propertychange"),oi,KP("design:type",Object)],eO.prototype,"environment",void 0),$P([ai("none"),KP("design:type",String)],eO.prototype,"fogMode",void 0),$P([ci(0),KP("design:type",Object)],eO.prototype,"fogNear",void 0),$P([ci(1e3),KP("design:type",Object)],eO.prototype,"fogFar",void 0),$P([ai("gray"),KP("design:type",String)],eO.prototype,"fogColor",void 0),$P([ci(.0025),KP("design:type",Object)],eO.prototype,"fogDensity",void 0),$P([ci(.1),KP("design:type",Object)],eO.prototype,"cameraNear",void 0),$P([ci(1e4),KP("design:type",Object)],eO.prototype,"cameraFar",void 0),$P([ci(400),KP("design:type",Object),KP("design:paramtypes",[Object])],eO.prototype,"perspective",null),eO=$P([ui,KP("design:paramtypes",[])],eO);var nO=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},rO=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let iO=class extends gd{constructor(){super(...arguments),this.color="royalblue",this.intensity=1.3,this.shadowBias=0,this.template=()=>Di`
		<lume-point-light
			ref=${t=>this.light=t}
			attr:color=${()=>this.color}
			attr:intensity=${()=>this.intensity}
			attr:shadow-bias=${()=>this.shadowBias}
			distance="10000"
		>
			<lume-sphere
				ref=${t=>this.sphere=t}
				has="basic-material"
				attr:color=${()=>this.color}
				opacity="0.5"
				mount-point="0.5 0.5 0.5"
				size="10 10 10"
				cast-shadow="false"
				receive-shadow="false"
			></lume-sphere>
		</lume-point-light>
	`}connectedCallback(){super.connectedCallback();const t=this.intensity,e=this.getOpacity(),n=()=>{const r=.4*(Math.random()-1);this.light.intensity=t+r,this.sphere.opacity=e+r,setTimeout(()=>$s.once(n),100*Math.random())};$s.once(n)}};nO([ai("royalblue"),rO("design:type",Object)],iO.prototype,"color",void 0),nO([ci(1.3),rO("design:type",Object)],iO.prototype,"intensity",void 0),nO([ci(0),rO("design:type",Object)],iO.prototype,"shadowBias",void 0),iO=nO([ui("flickering-orb",yf)],iO);var oO=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},sO=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let aO=class extends gd{constructor(){super(...arguments),this.shadowBias=0,this.template=()=>Di`
		<>
			<flickering-orb color="yellow" position="500 0 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="deeppink" position="-500 0 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="cyan" position="0 0 500" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="limegreen" position="0 0 -500" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="white" position="0 -500 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="white" position="0 250 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
		</>
	`}};oO([ci(0),sO("design:type",Object)],aO.prototype,"shadowBias",void 0),aO=oO([ui("flickering-orbs",yf)],aO);var cO=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},lO=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let uO=class extends Br{constructor(){super(...arguments),this.color="120,130,140",this.template=()=>Di`
		<>
			<div class="top"></div>
			<div class="right"></div>
			<div class="bottom"></div>
			<div class="left"></div>
		</>
	`,this.css=`\n\t\t:host {\n\t\t\t--loading-icon-color: ${this.color};\n\t\t}\n\n\t\t.top, .right, .bottom, .left {\n\t\t\tposition: absolute;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tborder-radius: 50%;\n\t\t\topacity: 0;\n\t\t\tborder: 8px solid rgba(var(--loading-icon-color), 0);\n\t\t}\n\t\t.top {\n\t\t\tborder-top-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0s infinite;\n\t\t}\n\t\t.right {\n\t\t\tborder-right-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0.25s infinite;\n\t\t}\n\t\t.bottom {\n\t\t\tborder-bottom-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0.5s infinite;\n\t\t}\n\t\t.left {\n\t\t\tborder-left-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0.75s infinite;\n\t\t}\n\t\t@keyframes fade {\n\t\t\t0% { opacity: 0; }\n\t\t\t50% { opacity: 1; }\n\t\t\t100% { opacity: 0; }\n\t\t}\n\t`}};cO([ai("120,130,140"),lO("design:type",Object)],uO.prototype,"color",void 0),uO=cO([ui("loading-icon",yf)],uO);var hO={CONST:"const",NOTANATTRIBUTE:"const",VARIABLE:"var",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",WIDTH:"width",HEIGHT:"height",CENTERX:"centerX",CENTERY:"centerY",ZINDEX:"zIndex"},dO={LEQ:"leq",EQU:"equ",GEQ:"geq"},pO={REQUIRED:1e3,DEFAULTHIGH:750,DEFAULTLOW:250},fO=function(){function t(t,e,n,r,i,o){this.message=t,this.expected=e,this.found=n,this.offset=r,this.line=i,this.column=o,this.name="SyntaxError"}return function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(t,Error),{SyntaxError:t,parse:function(e){var n,r=arguments.length>1?arguments[1]:{},i={},o={visualFormatString:_t},s=_t,a=i,c=null,l=":",u={type:"literal",value:":",description:'":"'},h=function(t,e,n,r,i){return{orientation:t?t[0]:"horizontal",cascade:(e||[]).concat([n],[].concat.apply([],r),i||[])}},d="H",p={type:"literal",value:"H",description:'"H"'},f="V",m={type:"literal",value:"V",description:'"V"'},g=function(t){return"H"==t?"horizontal":"vertical"},v="|",y={type:"literal",value:"|",description:'"|"'},b=function(){return{view:null}},x="[",_={type:"literal",value:"[",description:'"["'},w="]",M={type:"literal",value:"]",description:'"]"'},E=function(t,e){return Ft(t,e?{constraints:e}:{})},S="-",T={type:"literal",value:"-",description:'"-"'},A=function(t){return t},R=function(){return[{relation:"equ",constant:"default",$parserOffset:vt()}]},L="",C=function(){return[{relation:"equ",constant:0,$parserOffset:vt()}]},P=function(t){return[{relation:"equ",constant:t,$parserOffset:vt()}]},O="(",N={type:"literal",value:"(",description:'"("'},I=",",D={type:"literal",value:",",description:'","'},F=")",U={type:"literal",value:")",description:'")"'},B=function(t,e){return[t].concat(e.map((function(t){return t[1]})))},k="@",z={type:"literal",value:"@",description:'"@"'},H=function(t,e,n){return Ft({relation:"equ"},t||{},e,n?n[1]:{})},G="==",j={type:"literal",value:"==",description:'"=="'},V=function(){return{relation:"equ",$parserOffset:vt()}},W="<=",q={type:"literal",value:"<=",description:'"<="'},X=function(){return{relation:"leq",$parserOffset:vt()}},Y=">=",Z={type:"literal",value:">=",description:'">="'},J=function(){return{relation:"geq",$parserOffset:vt()}},$=/^[0-9]/,K={type:"class",value:"[0-9]",description:"[0-9]"},Q=function(t){return{priority:parseInt(t.join(""),10)}},tt=function(t){return{constant:t}},et=/^[a-zA-Z_]/,nt={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},rt=/^[a-zA-Z0-9_]/,it={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},ot=function(t,e){return{view:t+e}},st=".",at={type:"literal",value:".",description:'"."'},ct=function(t,e){return parseFloat(t.concat(".").concat(e).join(""))},lt=function(t){return parseInt(t.join(""),10)},ut=0,ht=0,dt=0,pt={line:1,column:1,seenCR:!1},ft=0,mt=[],gt=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=o[r.startRule]}function vt(){return ht}function yt(t){return dt!==t&&(dt>t&&(dt=0,pt={line:1,column:1,seenCR:!1}),function(t,n,r){var i,o;for(i=n;i<r;i++)"\n"===(o=e.charAt(i))?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}(pt,dt,t),dt=t),pt}function bt(t){ut<ft||(ut>ft&&(ft=ut,mt=[]),mt.push(t))}function xt(n,r,i){var o=yt(i),s=i<e.length?e.charAt(i):null;return null!==r&&function(t){var e=1;for(t.sort((function(t,e){return t.description<e.description?-1:t.description>e.description?1:0}));e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}(r),new t(null!==n?n:function(t,e){var n,r=new Array(t.length);for(n=0;n<t.length;n++)r[n]=t[n].description;return"Expected "+(t.length>1?r.slice(0,-1).join(", ")+" or "+r[t.length-1]:r[0])+" but "+(e?'"'+function(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(t){return"\\x0"+e(t)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(t){return"\\x"+e(t)})).replace(/[\u0180-\u0FFF]/g,(function(t){return"\\u0"+e(t)})).replace(/[\u1080-\uFFFF]/g,(function(t){return"\\u"+e(t)}))}(e)+'"':"end of input")+" found."}(r,s),r,s,i,o.line,o.column)}function _t(){var t,n,r,o,s,d,p,f;if(t=ut,n=ut,(r=wt())!==i?(58===e.charCodeAt(ut)?(o=l,ut++):(o=i,0===gt&&bt(u)),o!==i?n=r=[r,o]:(ut=n,n=a)):(ut=n,n=a),n===i&&(n=c),n!==i)if(r=ut,(o=Mt())!==i&&(s=St())!==i?r=o=[o,s]:(ut=r,r=a),r===i&&(r=c),r!==i)if((o=Et())!==i){for(s=[],d=ut,(p=St())!==i&&(f=Et())!==i?d=p=[p,f]:(ut=d,d=a);d!==i;)s.push(d),d=ut,(p=St())!==i&&(f=Et())!==i?d=p=[p,f]:(ut=d,d=a);s!==i?(d=ut,(p=St())!==i&&(f=Mt())!==i?d=p=[p,f]:(ut=d,d=a),d===i&&(d=c),d!==i?(ht=t,t=n=h(n,r,o,s,d)):(ut=t,t=a)):(ut=t,t=a)}else ut=t,t=a;else ut=t,t=a;else ut=t,t=a;return t}function wt(){var t,n;return t=ut,72===e.charCodeAt(ut)?(n=d,ut++):(n=i,0===gt&&bt(p)),n===i&&(86===e.charCodeAt(ut)?(n=f,ut++):(n=i,0===gt&&bt(m))),n!==i&&(ht=t,n=g(n)),t=n}function Mt(){var t,n;return t=ut,124===e.charCodeAt(ut)?(n=v,ut++):(n=i,0===gt&&bt(y)),n!==i&&(ht=t,n=b()),t=n}function Et(){var t,n,r,o,s;return t=ut,91===e.charCodeAt(ut)?(n=x,ut++):(n=i,0===gt&&bt(_)),n!==i&&(r=It())!==i?((o=Rt())===i&&(o=c),o!==i?(93===e.charCodeAt(ut)?(s=w,ut++):(s=i,0===gt&&bt(M)),s!==i?(ht=t,t=n=E(r,o)):(ut=t,t=a)):(ut=t,t=a)):(ut=t,t=a),t}function St(){var t,n,r,o;return t=ut,45===e.charCodeAt(ut)?(n=S,ut++):(n=i,0===gt&&bt(T)),n!==i&&(r=Tt())!==i?(45===e.charCodeAt(ut)?(o=S,ut++):(o=i,0===gt&&bt(T)),o!==i?(ht=t,t=n=A(r)):(ut=t,t=a)):(ut=t,t=a),t===i&&(t=ut,45===e.charCodeAt(ut)?(n=S,ut++):(n=i,0===gt&&bt(T)),n!==i&&(ht=t,n=R()),(t=n)===i&&(t=ut,(n=L)!==i&&(ht=t,n=C()),t=n)),t}function Tt(){var t;return(t=At())===i&&(t=Rt()),t}function At(){var t,e;return t=ut,(e=Dt())!==i&&(ht=t,e=P(e)),t=e}function Rt(){var t,n,r,o,s,c,l;if(t=ut,40===e.charCodeAt(ut)?(n=O,ut++):(n=i,0===gt&&bt(N)),n!==i)if((r=Lt())!==i){for(o=[],s=ut,44===e.charCodeAt(ut)?(c=I,ut++):(c=i,0===gt&&bt(D)),c!==i&&(l=Lt())!==i?s=c=[c,l]:(ut=s,s=a);s!==i;)o.push(s),s=ut,44===e.charCodeAt(ut)?(c=I,ut++):(c=i,0===gt&&bt(D)),c!==i&&(l=Lt())!==i?s=c=[c,l]:(ut=s,s=a);o!==i?(41===e.charCodeAt(ut)?(s=F,ut++):(s=i,0===gt&&bt(U)),s!==i?(ht=t,t=n=B(r,o)):(ut=t,t=a)):(ut=t,t=a)}else ut=t,t=a;else ut=t,t=a;return t}function Lt(){var t,n,r,o,s,l;return t=ut,(n=Ct())===i&&(n=c),n!==i&&(r=Pt())!==i?(o=ut,64===e.charCodeAt(ut)?(s=k,ut++):(s=i,0===gt&&bt(z)),s!==i&&(l=Ot())!==i?o=s=[s,l]:(ut=o,o=a),o===i&&(o=c),o!==i?(ht=t,t=n=H(n,r,o)):(ut=t,t=a)):(ut=t,t=a),t}function Ct(){var t,n;return t=ut,e.substr(ut,2)===G?(n=G,ut+=2):(n=i,0===gt&&bt(j)),n!==i&&(ht=t,n=V()),(t=n)===i&&(t=ut,e.substr(ut,2)===W?(n=W,ut+=2):(n=i,0===gt&&bt(q)),n!==i&&(ht=t,n=X()),(t=n)===i&&(t=ut,e.substr(ut,2)===Y?(n=Y,ut+=2):(n=i,0===gt&&bt(Z)),n!==i&&(ht=t,n=J()),t=n)),t}function Pt(){var t;return(t=Nt())===i&&(t=It()),t}function Ot(){var t,n,r;if(t=ut,n=[],$.test(e.charAt(ut))?(r=e.charAt(ut),ut++):(r=i,0===gt&&bt(K)),r!==i)for(;r!==i;)n.push(r),$.test(e.charAt(ut))?(r=e.charAt(ut),ut++):(r=i,0===gt&&bt(K));else n=a;return n!==i&&(ht=t,n=Q(n)),t=n}function Nt(){var t,e;return t=ut,(e=Dt())!==i&&(ht=t,e=tt(e)),t=e}function It(){var t,n,r,o,s;if(t=ut,n=ut,r=[],et.test(e.charAt(ut))?(o=e.charAt(ut),ut++):(o=i,0===gt&&bt(nt)),o!==i)for(;o!==i;)r.push(o),et.test(e.charAt(ut))?(o=e.charAt(ut),ut++):(o=i,0===gt&&bt(nt));else r=a;if(r!==i&&(r=e.substring(n,ut)),(n=r)!==i){for(r=ut,o=[],rt.test(e.charAt(ut))?(s=e.charAt(ut),ut++):(s=i,0===gt&&bt(it));s!==i;)o.push(s),rt.test(e.charAt(ut))?(s=e.charAt(ut),ut++):(s=i,0===gt&&bt(it));o!==i&&(o=e.substring(r,ut)),(r=o)!==i?(ht=t,t=n=ot(n,r)):(ut=t,t=a)}else ut=t,t=a;return t}function Dt(){var t,n,r,o,s;if(t=ut,n=[],$.test(e.charAt(ut))?(r=e.charAt(ut),ut++):(r=i,0===gt&&bt(K)),r!==i)for(;r!==i;)n.push(r),$.test(e.charAt(ut))?(r=e.charAt(ut),ut++):(r=i,0===gt&&bt(K));else n=a;if(n!==i)if(46===e.charCodeAt(ut)?(r=st,ut++):(r=i,0===gt&&bt(at)),r!==i){if(o=[],$.test(e.charAt(ut))?(s=e.charAt(ut),ut++):(s=i,0===gt&&bt(K)),s!==i)for(;s!==i;)o.push(s),$.test(e.charAt(ut))?(s=e.charAt(ut),ut++):(s=i,0===gt&&bt(K));else o=a;o!==i?(ht=t,t=n=ct(n,o)):(ut=t,t=a)}else ut=t,t=a;else ut=t,t=a;if(t===i){if(t=ut,n=[],$.test(e.charAt(ut))?(r=e.charAt(ut),ut++):(r=i,0===gt&&bt(K)),r!==i)for(;r!==i;)n.push(r),$.test(e.charAt(ut))?(r=e.charAt(ut),ut++):(r=i,0===gt&&bt(K));else n=a;n!==i&&(ht=t,n=lt(n)),t=n}return t}function Ft(t,...e){for(var n=1;n<arguments.length;n++)for(var r in arguments[n])t[r]=arguments[n][r];return t}if((n=s())!==i&&ut===e.length)return n;throw n!==i&&ut<e.length&&bt({type:"end",description:"end of input"}),xt(null,mt,ft)}}}(),mO=function(){function t(t,e,n,r,i,o){this.message=t,this.expected=e,this.found=n,this.offset=r,this.line=i,this.column=o,this.name="SyntaxError"}return function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(t,Error),{SyntaxError:t,parse:function(e){var n,r=arguments.length>1?arguments[1]:{},i={},o={visualFormatStringExt:We},s=We,a=i,c="C:",l={type:"literal",value:"C:",description:'"C:"'},u=null,h=function(t,e,n,r){return{type:"attribute",view:t.view,attributes:[e].concat(n)}},d=function(t,e){return{attr:t,predicates:e}},p=":",f={type:"literal",value:":",description:'":"'},m=function(t,e,n,r,i,o){return{type:"vfl",orientation:t?t[0]:"horizontal",cascade:(e||[]).concat(n,[].concat.apply([],r),i||[])}},g="HV",v={type:"literal",value:"HV",description:'"HV"'},y=function(){return"horzvert"},b="H",x={type:"literal",value:"H",description:'"H"'},_=function(){return"horizontal"},w="V",M={type:"literal",value:"V",description:'"V"'},E=function(){return"vertical"},S="Z",T={type:"literal",value:"Z",description:'"Z"'},A=function(){return"zIndex"},R=" ",L={type:"literal",value:" ",description:'" "'},C="//",P={type:"literal",value:"//",description:'"//"'},O={type:"any",description:"any character"},N="|",I={type:"literal",value:"|",description:'"|"'},D=function(){return{view:null}},F="[",U={type:"literal",value:"[",description:'"["'},B=",",k={type:"literal",value:",",description:'","'},z="]",H={type:"literal",value:"]",description:'"]"'},G=function(t,e){return e.length?[t].concat([].concat.apply([],e)):t},j=function(t,e,n){return wn(wn(t,e?{constraints:e}:{}),n?{cascade:n}:{})},V=function(t,e){return[].concat([].concat.apply([],t),[e])},W="->",q={type:"literal",value:"->",description:'"->"'},X=function(){return[{relation:"none"}]},Y="-",Z={type:"literal",value:"-",description:'"-"'},J=function(t){return t},$=function(){return[{relation:"equ",constant:"default"}]},K="~",Q={type:"literal",value:"~",description:'"~"'},tt=function(){return[{relation:"equ",equalSpacing:!0}]},et="",nt=function(){return[{relation:"equ",constant:0}]},rt=function(t){return[{relation:"equ",multiplier:t.multiplier}]},it=function(t){return[{relation:"equ",constant:t}]},ot="(",st={type:"literal",value:"(",description:'"("'},at=")",ct={type:"literal",value:")",description:'")"'},lt=function(t,e){return[t].concat(e.map((function(t){return t[1]})))},ut="@",ht={type:"literal",value:"@",description:'"@"'},dt=function(t,e,n){return wn({relation:"equ"},t||{},e,n?n[1]:{})},pt=function(t,e,n){return wn({relation:"equ",equalSpacing:!0},t||{},e,n?n[1]:{})},ft="==",mt={type:"literal",value:"==",description:'"=="'},gt=function(){return{relation:"equ"}},vt="<=",yt={type:"literal",value:"<=",description:'"<="'},bt=function(){return{relation:"leq"}},xt=">=",_t={type:"literal",value:">=",description:'">="'},wt=function(){return{relation:"geq"}},Mt=/^[0-9]/,Et={type:"class",value:"[0-9]",description:"[0-9]"},St=function(t){return{priority:parseInt(t.join(""),10)}},Tt=function(t){return{constant:t}},At=function(t){return{constant:-t}},Rt="+",Lt={type:"literal",value:"+",description:'"+"'},Ct="%",Pt={type:"literal",value:"%",description:'"%"'},Ot=function(t){return{view:null,multiplier:t/100}},Nt=function(t){return{view:null,multiplier:t/-100}},It=function(t,e,n,r){return{view:t.view,attribute:e||void 0,multiplier:n||1,constant:r||void 0}},Dt=".left",Ft={type:"literal",value:".left",description:'".left"'},Ut=function(){return"left"},Bt=".right",kt={type:"literal",value:".right",description:'".right"'},zt=function(){return"right"},Ht=".top",Gt={type:"literal",value:".top",description:'".top"'},jt=function(){return"top"},Vt=".bottom",Wt={type:"literal",value:".bottom",description:'".bottom"'},qt=function(){return"bottom"},Xt=".width",Yt={type:"literal",value:".width",description:'".width"'},Zt=function(){return"width"},Jt=".height",$t={type:"literal",value:".height",description:'".height"'},Kt=function(){return"height"},Qt=".centerX",te={type:"literal",value:".centerX",description:'".centerX"'},ee=function(){return"centerX"},ne=".centerY",re={type:"literal",value:".centerY",description:'".centerY"'},ie=function(){return"centerY"},oe="/",se={type:"literal",value:"/",description:'"/"'},ae=function(t){return 1/t},ce="/+",le={type:"literal",value:"/+",description:'"/+"'},ue="/-",he={type:"literal",value:"/-",description:'"/-"'},de=function(t){return-1/t},pe="*",fe={type:"literal",value:"*",description:'"*"'},me=function(t){return t},ge="*+",ve={type:"literal",value:"*+",description:'"*+"'},ye="*-",be={type:"literal",value:"*-",description:'"*-"'},xe=function(t){return-t},_e=/^[a-zA-Z_]/,we={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},Me=/^[a-zA-Z0-9_]/,Ee={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},Se=function(t,e,n){return{view:t+e,range:n,$parserOffset:He()}},Te=function(t,e){return{view:t+e,$parserOffset:He()}},Ae="..",Re={type:"literal",value:"..",description:'".."'},Le=function(t){return parseInt(t)},Ce=".",Pe={type:"literal",value:".",description:'"."'},Oe=function(t,e){return parseFloat(t.concat(".").concat(e).join(""))},Ne=function(t){return parseInt(t.join(""),10)},Ie=0,De=0,Fe=0,Ue={line:1,column:1,seenCR:!1},Be=0,ke=[],ze=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=o[r.startRule]}function He(){return De}function Ge(t){return Fe!==t&&(Fe>t&&(Fe=0,Ue={line:1,column:1,seenCR:!1}),function(t,n,r){var i,o;for(i=n;i<r;i++)"\n"===(o=e.charAt(i))?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}(Ue,Fe,t),Fe=t),Ue}function je(t){Ie<Be||(Ie>Be&&(Be=Ie,ke=[]),ke.push(t))}function Ve(n,r,i){var o=Ge(i),s=i<e.length?e.charAt(i):null;return null!==r&&function(t){var e=1;for(t.sort((function(t,e){return t.description<e.description?-1:t.description>e.description?1:0}));e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}(r),new t(null!==n?n:function(t,e){var n,r=new Array(t.length);for(n=0;n<t.length;n++)r[n]=t[n].description;return"Expected "+(t.length>1?r.slice(0,-1).join(", ")+" or "+r[t.length-1]:r[0])+" but "+(e?'"'+function(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(t){return"\\x0"+e(t)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(t){return"\\x"+e(t)})).replace(/[\u0180-\u0FFF]/g,(function(t){return"\\u0"+e(t)})).replace(/[\u1080-\uFFFF]/g,(function(t){return"\\u"+e(t)}))}(e)+'"':"end of input")+" found."}(r,s),r,s,i,o.line,o.column)}function We(){var t;return(t=Ye())===i&&(t=qe()),t}function qe(){var t,n,r,o,s,d;if(t=Ie,e.substr(Ie,2)===c?(n=c,Ie+=2):(n=i,0===ze&&je(l)),n!==i)if((r=bn())!==i)if((o=Xe())!==i){for(s=[],d=Xe();d!==i;)s.push(d),d=Xe();s!==i?((d=Je())===i&&(d=u),d!==i?(De=t,t=n=h(r,o,s,d)):(Ie=t,t=a)):(Ie=t,t=a)}else Ie=t,t=a;else Ie=t,t=a;else Ie=t,t=a;return t}function Xe(){var t,e,n;return t=Ie,(e=mn())!==i&&(n=on())!==i?(De=t,t=e=d(e,n)):(Ie=t,t=a),t}function Ye(){var t,n,r,o,s,c,l,h;if(t=Ie,n=Ie,(r=Ze())!==i?(58===e.charCodeAt(Ie)?(o=p,Ie++):(o=i,0===ze&&je(f)),o!==i?n=r=[r,o]:(Ie=n,n=a)):(Ie=n,n=a),n===i&&(n=u),n!==i)if(r=Ie,(o=$e())!==i&&(s=en())!==i?r=o=[o,s]:(Ie=r,r=a),r===i&&(r=u),r!==i)if((o=Ke())!==i){for(s=[],c=Ie,(l=en())!==i&&(h=Ke())!==i?c=l=[l,h]:(Ie=c,c=a);c!==i;)s.push(c),c=Ie,(l=en())!==i&&(h=Ke())!==i?c=l=[l,h]:(Ie=c,c=a);s!==i?(c=Ie,(l=en())!==i&&(h=$e())!==i?c=l=[l,h]:(Ie=c,c=a),c===i&&(c=u),c!==i?((l=Je())===i&&(l=u),l!==i?(De=t,t=n=m(n,r,o,s,c,l)):(Ie=t,t=a)):(Ie=t,t=a)):(Ie=t,t=a)}else Ie=t,t=a;else Ie=t,t=a;else Ie=t,t=a;return t}function Ze(){var t,n;return t=Ie,e.substr(Ie,2)===g?(n=g,Ie+=2):(n=i,0===ze&&je(v)),n!==i&&(De=t,n=y()),(t=n)===i&&(t=Ie,72===e.charCodeAt(Ie)?(n=b,Ie++):(n=i,0===ze&&je(x)),n!==i&&(De=t,n=_()),(t=n)===i&&(t=Ie,86===e.charCodeAt(Ie)?(n=w,Ie++):(n=i,0===ze&&je(M)),n!==i&&(De=t,n=E()),(t=n)===i&&(t=Ie,90===e.charCodeAt(Ie)?(n=S,Ie++):(n=i,0===ze&&je(T)),n!==i&&(De=t,n=A()),t=n))),t}function Je(){var t,n,r,o,s;for(t=Ie,n=[],32===e.charCodeAt(Ie)?(r=R,Ie++):(r=i,0===ze&&je(L));r!==i;)n.push(r),32===e.charCodeAt(Ie)?(r=R,Ie++):(r=i,0===ze&&je(L));if(n!==i)if(e.substr(Ie,2)===C?(r=C,Ie+=2):(r=i,0===ze&&je(P)),r!==i){for(o=[],e.length>Ie?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(O));s!==i;)o.push(s),e.length>Ie?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(O));o!==i?t=n=[n,r,o]:(Ie=t,t=a)}else Ie=t,t=a;else Ie=t,t=a;return t}function $e(){var t,n;return t=Ie,124===e.charCodeAt(Ie)?(n=N,Ie++):(n=i,0===ze&&je(I)),n!==i&&(De=t,n=D()),t=n}function Ke(){var t,n,r,o,s,c,l;if(t=Ie,91===e.charCodeAt(Ie)?(n=F,Ie++):(n=i,0===ze&&je(U)),n!==i)if((r=Qe())!==i){for(o=[],s=Ie,44===e.charCodeAt(Ie)?(c=B,Ie++):(c=i,0===ze&&je(k)),c!==i&&(l=Qe())!==i?s=c=[c,l]:(Ie=s,s=a);s!==i;)o.push(s),s=Ie,44===e.charCodeAt(Ie)?(c=B,Ie++):(c=i,0===ze&&je(k)),c!==i&&(l=Qe())!==i?s=c=[c,l]:(Ie=s,s=a);o!==i?(93===e.charCodeAt(Ie)?(s=z,Ie++):(s=i,0===ze&&je(H)),s!==i?(De=t,t=n=G(r,o)):(Ie=t,t=a)):(Ie=t,t=a)}else Ie=t,t=a;else Ie=t,t=a;return t}function Qe(){var t,e,n,r;return t=Ie,(e=yn())!==i?((n=on())===i&&(n=u),n!==i?((r=tn())===i&&(r=u),r!==i?(De=t,t=e=j(e,n,r)):(Ie=t,t=a)):(Ie=t,t=a)):(Ie=t,t=a),t}function tn(){var t,n,r,o,s,c;if(t=Ie,58===e.charCodeAt(Ie)?(n=p,Ie++):(n=i,0===ze&&je(f)),n!==i){if(r=[],o=Ie,(s=en())!==i&&(c=Ke())!==i?o=s=[s,c]:(Ie=o,o=a),o!==i)for(;o!==i;)r.push(o),o=Ie,(s=en())!==i&&(c=Ke())!==i?o=s=[s,c]:(Ie=o,o=a);else r=a;r!==i&&(o=en())!==i?(De=t,t=n=V(r,o)):(Ie=t,t=a)}else Ie=t,t=a;return t}function en(){var t,n,r,o;return t=Ie,e.substr(Ie,2)===W?(n=W,Ie+=2):(n=i,0===ze&&je(q)),n!==i&&(De=t,n=X()),(t=n)===i&&(t=Ie,45===e.charCodeAt(Ie)?(n=Y,Ie++):(n=i,0===ze&&je(Z)),n!==i&&(r=nn())!==i?(45===e.charCodeAt(Ie)?(o=Y,Ie++):(o=i,0===ze&&je(Z)),o!==i?(De=t,t=n=J(r)):(Ie=t,t=a)):(Ie=t,t=a),t===i&&(t=Ie,45===e.charCodeAt(Ie)?(n=Y,Ie++):(n=i,0===ze&&je(Z)),n!==i&&(De=t,n=$()),(t=n)===i&&(t=Ie,126===e.charCodeAt(Ie)?(n=K,Ie++):(n=i,0===ze&&je(Q)),n!==i&&(r=an())!==i?(126===e.charCodeAt(Ie)?(o=K,Ie++):(o=i,0===ze&&je(Q)),o!==i?(De=t,t=n=J(r)):(Ie=t,t=a)):(Ie=t,t=a),t===i&&(t=Ie,126===e.charCodeAt(Ie)?(n=K,Ie++):(n=i,0===ze&&je(Q)),n!==i&&(De=t,n=tt()),(t=n)===i&&(t=Ie,(n=et)!==i&&(De=t,n=nt()),t=n))))),t}function nn(){var t;return(t=rn())===i&&(t=on()),t}function rn(){var t,e;return t=Ie,(e=pn())!==i&&(De=t,e=rt(e)),(t=e)===i&&(t=Ie,(e=_n())!==i&&(De=t,e=it(e)),t=e),t}function on(){var t,n,r,o,s,c,l;if(t=Ie,40===e.charCodeAt(Ie)?(n=ot,Ie++):(n=i,0===ze&&je(st)),n!==i)if((r=sn())!==i){for(o=[],s=Ie,44===e.charCodeAt(Ie)?(c=B,Ie++):(c=i,0===ze&&je(k)),c!==i&&(l=sn())!==i?s=c=[c,l]:(Ie=s,s=a);s!==i;)o.push(s),s=Ie,44===e.charCodeAt(Ie)?(c=B,Ie++):(c=i,0===ze&&je(k)),c!==i&&(l=sn())!==i?s=c=[c,l]:(Ie=s,s=a);o!==i?(41===e.charCodeAt(Ie)?(s=at,Ie++):(s=i,0===ze&&je(ct)),s!==i?(De=t,t=n=lt(r,o)):(Ie=t,t=a)):(Ie=t,t=a)}else Ie=t,t=a;else Ie=t,t=a;return t}function sn(){var t,n,r,o,s,c;return t=Ie,(n=ln())===i&&(n=u),n!==i&&(r=un())!==i?(o=Ie,64===e.charCodeAt(Ie)?(s=ut,Ie++):(s=i,0===ze&&je(ht)),s!==i&&(c=hn())!==i?o=s=[s,c]:(Ie=o,o=a),o===i&&(o=u),o!==i?(De=t,t=n=dt(n,r,o)):(Ie=t,t=a)):(Ie=t,t=a),t}function an(){var t,n,r,o,s,c,l;if(t=Ie,40===e.charCodeAt(Ie)?(n=ot,Ie++):(n=i,0===ze&&je(st)),n!==i)if((r=cn())!==i){for(o=[],s=Ie,44===e.charCodeAt(Ie)?(c=B,Ie++):(c=i,0===ze&&je(k)),c!==i&&(l=cn())!==i?s=c=[c,l]:(Ie=s,s=a);s!==i;)o.push(s),s=Ie,44===e.charCodeAt(Ie)?(c=B,Ie++):(c=i,0===ze&&je(k)),c!==i&&(l=cn())!==i?s=c=[c,l]:(Ie=s,s=a);o!==i?(41===e.charCodeAt(Ie)?(s=at,Ie++):(s=i,0===ze&&je(ct)),s!==i?(De=t,t=n=lt(r,o)):(Ie=t,t=a)):(Ie=t,t=a)}else Ie=t,t=a;else Ie=t,t=a;return t}function cn(){var t,n,r,o,s,c;return t=Ie,(n=ln())===i&&(n=u),n!==i&&(r=un())!==i?(o=Ie,64===e.charCodeAt(Ie)?(s=ut,Ie++):(s=i,0===ze&&je(ht)),s!==i&&(c=hn())!==i?o=s=[s,c]:(Ie=o,o=a),o===i&&(o=u),o!==i?(De=t,t=n=pt(n,r,o)):(Ie=t,t=a)):(Ie=t,t=a),t}function ln(){var t,n;return t=Ie,e.substr(Ie,2)===ft?(n=ft,Ie+=2):(n=i,0===ze&&je(mt)),n!==i&&(De=t,n=gt()),(t=n)===i&&(t=Ie,e.substr(Ie,2)===vt?(n=vt,Ie+=2):(n=i,0===ze&&je(yt)),n!==i&&(De=t,n=bt()),(t=n)===i&&(t=Ie,e.substr(Ie,2)===xt?(n=xt,Ie+=2):(n=i,0===ze&&je(_t)),n!==i&&(De=t,n=wt()),t=n)),t}function un(){var t;return(t=pn())===i&&(t=dn())===i&&(t=fn()),t}function hn(){var t,n,r;if(t=Ie,n=[],Mt.test(e.charAt(Ie))?(r=e.charAt(Ie),Ie++):(r=i,0===ze&&je(Et)),r!==i)for(;r!==i;)n.push(r),Mt.test(e.charAt(Ie))?(r=e.charAt(Ie),Ie++):(r=i,0===ze&&je(Et));else n=a;return n!==i&&(De=t,n=St(n)),t=n}function dn(){var t,n,r;return t=Ie,(n=_n())!==i&&(De=t,n=Tt(n)),(t=n)===i&&(t=Ie,45===e.charCodeAt(Ie)?(n=Y,Ie++):(n=i,0===ze&&je(Z)),n!==i&&(r=_n())!==i?(De=t,t=n=At(r)):(Ie=t,t=a),t===i&&(t=Ie,43===e.charCodeAt(Ie)?(n=Rt,Ie++):(n=i,0===ze&&je(Lt)),n!==i&&(r=_n())!==i?(De=t,t=n=Tt(r)):(Ie=t,t=a))),t}function pn(){var t,n,r,o;return t=Ie,(n=_n())!==i?(37===e.charCodeAt(Ie)?(r=Ct,Ie++):(r=i,0===ze&&je(Pt)),r!==i?(De=t,t=n=Ot(n)):(Ie=t,t=a)):(Ie=t,t=a),t===i&&(t=Ie,45===e.charCodeAt(Ie)?(n=Y,Ie++):(n=i,0===ze&&je(Z)),n!==i&&(r=_n())!==i?(37===e.charCodeAt(Ie)?(o=Ct,Ie++):(o=i,0===ze&&je(Pt)),o!==i?(De=t,t=n=Nt(r)):(Ie=t,t=a)):(Ie=t,t=a),t===i&&(t=Ie,43===e.charCodeAt(Ie)?(n=Rt,Ie++):(n=i,0===ze&&je(Lt)),n!==i&&(r=_n())!==i?(37===e.charCodeAt(Ie)?(o=Ct,Ie++):(o=i,0===ze&&je(Pt)),o!==i?(De=t,t=n=Ot(r)):(Ie=t,t=a)):(Ie=t,t=a))),t}function fn(){var t,e,n,r,o;return t=Ie,(e=bn())!==i?((n=mn())===i&&(n=u),n!==i?((r=gn())===i&&(r=u),r!==i?((o=vn())===i&&(o=u),o!==i?(De=t,t=e=It(e,n,r,o)):(Ie=t,t=a)):(Ie=t,t=a)):(Ie=t,t=a)):(Ie=t,t=a),t}function mn(){var t,n;return t=Ie,e.substr(Ie,5)===Dt?(n=Dt,Ie+=5):(n=i,0===ze&&je(Ft)),n!==i&&(De=t,n=Ut()),(t=n)===i&&(t=Ie,e.substr(Ie,6)===Bt?(n=Bt,Ie+=6):(n=i,0===ze&&je(kt)),n!==i&&(De=t,n=zt()),(t=n)===i&&(t=Ie,e.substr(Ie,4)===Ht?(n=Ht,Ie+=4):(n=i,0===ze&&je(Gt)),n!==i&&(De=t,n=jt()),(t=n)===i&&(t=Ie,e.substr(Ie,7)===Vt?(n=Vt,Ie+=7):(n=i,0===ze&&je(Wt)),n!==i&&(De=t,n=qt()),(t=n)===i&&(t=Ie,e.substr(Ie,6)===Xt?(n=Xt,Ie+=6):(n=i,0===ze&&je(Yt)),n!==i&&(De=t,n=Zt()),(t=n)===i&&(t=Ie,e.substr(Ie,7)===Jt?(n=Jt,Ie+=7):(n=i,0===ze&&je($t)),n!==i&&(De=t,n=Kt()),(t=n)===i&&(t=Ie,e.substr(Ie,8)===Qt?(n=Qt,Ie+=8):(n=i,0===ze&&je(te)),n!==i&&(De=t,n=ee()),(t=n)===i&&(t=Ie,e.substr(Ie,8)===ne?(n=ne,Ie+=8):(n=i,0===ze&&je(re)),n!==i&&(De=t,n=ie()),t=n))))))),t}function gn(){var t,n,r;return t=Ie,47===e.charCodeAt(Ie)?(n=oe,Ie++):(n=i,0===ze&&je(se)),n!==i&&(r=_n())!==i?(De=t,t=n=ae(r)):(Ie=t,t=a),t===i&&(t=Ie,e.substr(Ie,2)===ce?(n=ce,Ie+=2):(n=i,0===ze&&je(le)),n!==i&&(r=_n())!==i?(De=t,t=n=ae(r)):(Ie=t,t=a),t===i&&(t=Ie,e.substr(Ie,2)===ue?(n=ue,Ie+=2):(n=i,0===ze&&je(he)),n!==i&&(r=_n())!==i?(De=t,t=n=de(r)):(Ie=t,t=a),t===i&&(t=Ie,42===e.charCodeAt(Ie)?(n=pe,Ie++):(n=i,0===ze&&je(fe)),n!==i&&(r=_n())!==i?(De=t,t=n=me(r)):(Ie=t,t=a),t===i&&(t=Ie,e.substr(Ie,2)===ge?(n=ge,Ie+=2):(n=i,0===ze&&je(ve)),n!==i&&(r=_n())!==i?(De=t,t=n=me(r)):(Ie=t,t=a),t===i&&(t=Ie,e.substr(Ie,2)===ye?(n=ye,Ie+=2):(n=i,0===ze&&je(be)),n!==i&&(r=_n())!==i?(De=t,t=n=xe(r)):(Ie=t,t=a)))))),t}function vn(){var t,n,r;return t=Ie,45===e.charCodeAt(Ie)?(n=Y,Ie++):(n=i,0===ze&&je(Z)),n!==i&&(r=_n())!==i?(De=t,t=n=xe(r)):(Ie=t,t=a),t===i&&(t=Ie,43===e.charCodeAt(Ie)?(n=Rt,Ie++):(n=i,0===ze&&je(Lt)),n!==i&&(r=_n())!==i?(De=t,t=n=me(r)):(Ie=t,t=a)),t}function yn(){var t,n,r,o,s;if(t=Ie,n=Ie,r=[],_e.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(we)),o!==i)for(;o!==i;)r.push(o),_e.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(we));else r=a;if(r!==i&&(r=e.substring(n,Ie)),(n=r)!==i){for(r=Ie,o=[],Me.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Ee));s!==i;)o.push(s),Me.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Ee));o!==i&&(o=e.substring(r,Ie)),(r=o)!==i&&(o=xn())!==i?(De=t,t=n=Se(n,r,o)):(Ie=t,t=a)}else Ie=t,t=a;if(t===i){if(t=Ie,n=Ie,r=[],_e.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(we)),o!==i)for(;o!==i;)r.push(o),_e.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(we));else r=a;if(r!==i&&(r=e.substring(n,Ie)),(n=r)!==i){for(r=Ie,o=[],Me.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Ee));s!==i;)o.push(s),Me.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Ee));o!==i&&(o=e.substring(r,Ie)),(r=o)!==i?(De=t,t=n=Te(n,r)):(Ie=t,t=a)}else Ie=t,t=a}return t}function bn(){var t,n,r,o,s;if(t=Ie,n=Ie,r=[],_e.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(we)),o!==i)for(;o!==i;)r.push(o),_e.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(we));else r=a;if(r!==i&&(r=e.substring(n,Ie)),(n=r)!==i){for(r=Ie,o=[],Me.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Ee));s!==i;)o.push(s),Me.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Ee));o!==i&&(o=e.substring(r,Ie)),(r=o)!==i?(De=t,t=n=Te(n,r)):(Ie=t,t=a)}else Ie=t,t=a;return t}function xn(){var t,n,r,o;if(t=Ie,e.substr(Ie,2)===Ae?(n=Ae,Ie+=2):(n=i,0===ze&&je(Re)),n!==i){if(r=[],Mt.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(Et)),o!==i)for(;o!==i;)r.push(o),Mt.test(e.charAt(Ie))?(o=e.charAt(Ie),Ie++):(o=i,0===ze&&je(Et));else r=a;r!==i?(De=t,t=n=Le(r)):(Ie=t,t=a)}else Ie=t,t=a;return t}function _n(){var t,n,r,o,s;if(t=Ie,n=[],Mt.test(e.charAt(Ie))?(r=e.charAt(Ie),Ie++):(r=i,0===ze&&je(Et)),r!==i)for(;r!==i;)n.push(r),Mt.test(e.charAt(Ie))?(r=e.charAt(Ie),Ie++):(r=i,0===ze&&je(Et));else n=a;if(n!==i)if(46===e.charCodeAt(Ie)?(r=Ce,Ie++):(r=i,0===ze&&je(Pe)),r!==i){if(o=[],Mt.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Et)),s!==i)for(;s!==i;)o.push(s),Mt.test(e.charAt(Ie))?(s=e.charAt(Ie),Ie++):(s=i,0===ze&&je(Et));else o=a;o!==i?(De=t,t=n=Oe(n,o)):(Ie=t,t=a)}else Ie=t,t=a;else Ie=t,t=a;if(t===i){if(t=Ie,n=[],Mt.test(e.charAt(Ie))?(r=e.charAt(Ie),Ie++):(r=i,0===ze&&je(Et)),r!==i)for(;r!==i;)n.push(r),Mt.test(e.charAt(Ie))?(r=e.charAt(Ie),Ie++):(r=i,0===ze&&je(Et));else n=a;n!==i&&(De=t,n=Ne(n)),t=n}return t}function wn(t,...e){for(var n=1;n<arguments.length;n++)for(var r in arguments[n])t[r]=arguments[n][r];return t}if((n=s())!==i&&Ie===e.length)return n;throw n!==i&&Ie<e.length&&je({type:"end",description:"end of input"}),Ve(null,ke,Be)}}}();const gO=1,vO=2,yO=4;function bO(t,e){t.equalSpacerIndex=t.equalSpacerIndex||1;const n="_~"+t.lineIndex+":"+t.equalSpacerIndex+"~";t.equalSpacerIndex>1&&t.constraints.push({view1:"_~"+t.lineIndex+":1~",attr1:t.horizontal?hO.WIDTH:hO.HEIGHT,relation:t.relation.relation||dO.EQU,view2:n,attr2:t.horizontal?hO.WIDTH:hO.HEIGHT,priority:t.relation.priority}),t.equalSpacerIndex++,t.relation.view||t.relation.multiplier&&1!==t.relation.multiplier?(t.constraints.push({view1:n,attr1:t.horizontal?hO.WIDTH:hO.HEIGHT,relation:t.relation.relation||dO.EQU,view2:t.relation.view,attr2:t.horizontal?hO.WIDTH:hO.HEIGHT,priority:t.relation.priority,multiplier:t.relation.multiplier}),t.relation.multiplier=void 0):t.relation.constant&&(t.constraints.push({view1:n,attr1:t.horizontal?hO.WIDTH:hO.HEIGHT,relation:dO.EQU,view2:null,attr2:hO.CONST,priority:t.relation.priority,constant:t.relation.constant}),t.relation.constant=void 0);for(var r=0;r<t.prevViews.length;r++){const i=t.prevViews[r];switch(t.orientation){case gO:t.prevAttr=i!==e?hO.RIGHT:hO.LEFT,t.curAttr=hO.LEFT;break;case vO:t.prevAttr=i!==e?hO.BOTTOM:hO.TOP,t.curAttr=hO.TOP;break;case yO:t.prevAttr=hO.ZINDEX,t.curAttr=hO.ZINDEX,t.relation.constant=i!==e?"default":0}t.constraints.push({view1:i,attr1:t.prevAttr,relation:t.relation.relation,view2:n,attr2:t.curAttr,priority:t.relation.priority})}t.prevViews=[n]}function xO(t,e){t.proportionalSpacerIndex=t.proportionalSpacerIndex||1;const n="_-"+t.lineIndex+":"+t.proportionalSpacerIndex+"-";t.proportionalSpacerIndex++,t.constraints.push({view1:n,attr1:t.horizontal?hO.WIDTH:hO.HEIGHT,relation:t.relation.relation||dO.EQU,view2:t.relation.view,attr2:t.horizontal?hO.WIDTH:hO.HEIGHT,priority:t.relation.priority,multiplier:t.relation.multiplier}),t.relation.multiplier=void 0;for(var r=0;r<t.prevViews.length;r++){const i=t.prevViews[r];switch(t.orientation){case gO:t.prevAttr=i!==e?hO.RIGHT:hO.LEFT,t.curAttr=hO.LEFT;break;case vO:t.prevAttr=i!==e?hO.BOTTOM:hO.TOP,t.curAttr=hO.TOP;break;case yO:t.prevAttr=hO.ZINDEX,t.curAttr=hO.ZINDEX,t.relation.constant=i!==e?"default":0}t.constraints.push({view1:i,attr1:t.prevAttr,relation:t.relation.relation,view2:n,attr2:t.curAttr,priority:t.relation.priority})}t.prevViews=[n]}function _O(t,e,n){let r;for(var i=1;i<=4;i*=2)if(n.orientations&i&&n.stack.orientation!==i&&!(n.stack.processedOrientations&i)){n.stack.processedOrientations=n.stack.processedOrientations|i,r=r||{name:e,type:"stack"};for(var o=0,s=n.stack.subViews.length;o<s;o++)i===yO?t.constraints.push({view1:r,attr1:hO.ZINDEX,relation:dO.EQU,view2:n.stack.subViews[o],attr2:hO.ZINDEX}):(t.constraints.push({view1:r,attr1:i===vO?hO.HEIGHT:hO.WIDTH,relation:dO.EQU,view2:n.stack.subViews[o],attr2:i===vO?hO.HEIGHT:hO.WIDTH}),t.constraints.push({view1:r,attr1:i===vO?hO.TOP:hO.LEFT,relation:dO.EQU,view2:n.stack.subViews[o],attr2:i===vO?hO.TOP:hO.LEFT}))}}function wO(t,e){if(!0===e&&(e=t.match(/\.\.\d+$/))&&(t=t.substring(0,t.length-e[0].length),e=parseInt(e[0].substring(2))),!e)return[t];var n,r=t.match(/\d+$/),i=[];if(r)for(t=t.substring(0,t.length-r[0].length),n=parseInt(r);n<=e;n++)i.push(t+n);else for(i.push(t),n=2;n<=e;n++)i.push(t+n);return i}function MO(t,e,n){const r=n?n.view:null,i=[];let o,s=[];r&&(e.push({view:r}),s.push(r));for(var a=0;a<e.length;a++){let n=e[a];if(!Array.isArray(n)&&n.hasOwnProperty("view")||Array.isArray(n)&&n[0].view&&!n[0].relation){const e=Array.isArray(n)?n:[n];for(var c=0;c<e.length;c++){n=e[c];const a=","===n?[]:n.view?wO(n.view,n.range):[null];for(var l=0;l<a.length;l++){const e=a[l];if(s.push(e),e!==r&&(i.push(e),o=t.subViews[e],o||(o={orientations:0},t.subViews[e]=o),o.orientations=o.orientations|t.orientation,o.stack&&_O(t,e,o)),void 0!==t.prevViews&&void 0!==e&&t.relation&&"none"!==t.relation.relation)for(var u=0;u<t.prevViews.length;u++){const n=t.prevViews[u];switch(t.orientation){case gO:t.prevAttr=n!==r?hO.RIGHT:hO.LEFT,t.curAttr=e!==r?hO.LEFT:hO.RIGHT;break;case vO:t.prevAttr=n!==r?hO.BOTTOM:hO.TOP,t.curAttr=e!==r?hO.TOP:hO.BOTTOM;break;case yO:t.prevAttr=hO.ZINDEX,t.curAttr=hO.ZINDEX,t.relation.constant=n?t.relation.constant||"default":0}t.constraints.push({view1:n,attr1:t.prevAttr,relation:t.relation.relation,view2:e,attr2:t.curAttr,multiplier:t.relation.multiplier,constant:"default"!==t.relation.constant&&t.relation.constant?-t.relation.constant:t.relation.constant,priority:t.relation.priority})}const c=n.constraints;if(c)for(var h=0;h<c.length;h++)t.prevAttr=t.horizontal?hO.WIDTH:hO.HEIGHT,t.curAttr=c[h].view||c[h].multiplier?c[h].attribute||t.prevAttr:c[h].variable?hO.VARIABLE:hO.CONST,t.constraints.push({view1:e,attr1:t.prevAttr,relation:c[h].relation,view2:c[h].view,attr2:t.curAttr,multiplier:c[h].multiplier,constant:c[h].constant,priority:c[h].priority});n.cascade&&MO(t,n.cascade,n)}}}else","!==n&&(t.prevViews=s,s=[],t.relation=n[0],void 0!==t.prevViews&&(t.relation.equalSpacing&&bO(t,r),t.relation.multiplier&&xO(t,r)))}if(r){if(o=t.subViews[r],o){if(o.stack){const t=new Error('A stack named "'+r+'" has already been created');throw t.column=n.$parserOffset+1,t}}else o={orientations:t.orientation},t.subViews[r]=o;o.stack={orientation:t.orientation,processedOrientations:t.orientation,subViews:i},_O(t,r,o)}}const EO=["viewport","spacing","colors","shapes","widths","heights"];var SO=class{static parseLine(t,e){if(0===t.length||e&&e.extended&&0===t.indexOf("//"))return[];const n=e&&e.extended?mO.parse(t):fO.parse(t);if(e&&"raw"===e.outFormat)return[n];let r={constraints:[],lineIndex:(e?e.lineIndex:void 0)||1,subViews:(e?e.subViews:void 0)||{}};if("attribute"===n.type)for(let t=0;t<n.attributes.length;t++){const e=n.attributes[t];for(let t=0;t<e.predicates.length;t++){const i=e.predicates[t];r.constraints.push({view1:n.view,attr1:e.attr,relation:i.relation,view2:i.view,attr2:i.attribute||e.attr,multiplier:i.multiplier,constant:i.constant,priority:i.priority})}}else switch(n.orientation){case"horizontal":r.orientation=gO,r.horizontal=!0,MO(r,n.cascade,null);break;case"vertical":r.orientation=vO,MO(r,n.cascade,null);break;case"horzvert":r.orientation=gO,r.horizontal=!0,MO(r,n.cascade,null),r={constraints:r.constraints,lineIndex:r.lineIndex,subViews:r.subViews,orientation:vO},MO(r,n.cascade,null);break;case"zIndex":r.orientation=yO,MO(r,n.cascade,null)}return r.constraints}static parse(t,e){const n=e&&e.lineSeparator?e.lineSeparator:"\n";if(!Array.isArray(t)&&t.indexOf(n)<0)try{return this.parseLine(t,e)}catch(e){throw e.source=t,e}let r;t=Array.isArray(t)?t:[t];let i,o=[],s=0;const a={lineIndex:s,extended:e&&e.extended,strict:!e||void 0===e.strict||e.strict,outFormat:e?e.outFormat:void 0,subViews:{}};try{for(var c=0;c<t.length;c++){r=t[c].split(n);for(var l=0;l<r.length;l++)i=r[l],s++,a.lineIndex=s,a.strict||(i=i.trim()),(a.strict||i.length)&&(o=o.concat(this.parseLine(i,a)))}}catch(t){throw t.source=i,t.line=s,t}return o}static parseMetaInfo(t,e){const n=e&&e.lineSeparator?e.lineSeparator:"\n",r=e?e.prefix:void 0;t=Array.isArray(t)?t:[t];const i={};for(var o,s=0;s<t.length;s++){const e=t[s].split(n);for(var a=0;a<e.length;a++){const t=e[a];for(var c=0;c<EO.length;c++)for(var l=0;l<(r?2:1);l++){const e=EO[c],n=(0===l?"":r)+e;if(0===t.indexOf("//"+n+" ")){const r=t.substring(3+n.length).split(" ");for(var u=0;u<r.length;u++){i[e]=i[e]||{};const t=r[u].split(":"),n=wO(t[0],!0);for(var h=0;h<n.length;h++)i[e][n[h]]=t.length>1?t[1]:""}}else 0===t.indexOf("//"+n+":")&&(i[e]=t.substring(3+n.length))}}}if(i.viewport){const t=i.viewport;var d=t["aspect-ratio"];d&&(d=d.split("/"),t["aspect-ratio"]=parseInt(d[0])/parseInt(d[1])),void 0!==t.height&&(t.height="intrinsic"===t.height||parseInt(t.height)),void 0!==t.width&&(t.width="intrinsic"===t.width||parseInt(t.width)),void 0!==t["max-height"]&&(t["max-height"]=parseInt(t["max-height"])),void 0!==t["max-width"]&&(t["max-width"]=parseInt(t["max-width"])),void 0!==t["min-height"]&&(t["min-height"]=parseInt(t["min-height"])),void 0!==t["min-width"]&&(t["min-width"]=parseInt(t["min-width"]))}if(i.widths)for(o in i.widths){const t="intrinsic"===i.widths[o]||parseInt(i.widths[o]);i.widths[o]=t,(void 0===t||isNaN(t))&&delete i.widths[o]}if(i.heights)for(o in i.heights){const t="intrinsic"===i.heights[o]||parseInt(i.heights[o]);i.heights[o]=t,(void 0===t||isNaN(t))&&delete i.heights[o]}if(i.spacing){const t=JSON.parse(i.spacing);if(i.spacing=t,Array.isArray(t)){for(var p=0,f=t.length;p<f;p++)if(isNaN(t[p])){delete i.spacing;break}}else(void 0===t||isNaN(t))&&delete i.spacing}return i}};function TO(){return new AO}var AO=function(){function t(){this.index={},this.array=[]}return t.prototype.size=function(){return this.array.length},t.prototype.empty=function(){return 0===this.array.length},t.prototype.itemAt=function(t){return this.array[t]},t.prototype.contains=function(t){return void 0!==this.index[t.id()]},t.prototype.find=function(t){var e=this.index[t.id()];return void 0===e?void 0:this.array[e]},t.prototype.setDefault=function(t,e){var n=this.index[t.id()];if(void 0===n){var r=new RO(t,e());return this.index[t.id()]=this.array.length,this.array.push(r),r}return this.array[n]},t.prototype.insert=function(t,e){var n=new RO(t,e),r=this.index[t.id()];return void 0===r?(this.index[t.id()]=this.array.length,this.array.push(n)):this.array[r]=n,n},t.prototype.erase=function(t){var e=this.index[t.id()];if(void 0!==e){this.index[t.id()]=void 0;var n=this.array[e],r=this.array.pop();return n!==r&&(this.array[e]=r,this.index[r.first.id()]=e),n}},t.prototype.copy=function(){for(var e=new t,n=0;n<this.array.length;n++){var r=this.array[n].copy();e.array[n]=r,e.index[r.first.id()]=n}return e},t}(),RO=function(){function t(t,e){this.first=t,this.second=e}return t.prototype.copy=function(){return new t(this.first,this.second)},t}(),LO=function(){function t(t){void 0===t&&(t=""),this._value=0,this._context=null,this._id=CO++,this._name=t}return t.prototype.id=function(){return this._id},t.prototype.name=function(){return this._name},t.prototype.setName=function(t){this._name=t},t.prototype.context=function(){return this._context},t.prototype.setContext=function(t){this._context=t},t.prototype.value=function(){return this._value},t.prototype.setValue=function(t){this._value=t},t.prototype.plus=function(t){return new PO(this,t)},t.prototype.minus=function(t){return new PO(this,"number"==typeof t?-t:[-1,t])},t.prototype.multiply=function(t){return new PO([t,this])},t.prototype.divide=function(t){return new PO([1/t,this])},t.prototype.toJSON=function(){return{name:this._name,value:this._value}},t.prototype.toString=function(){return this._context+"["+this._name+":"+this._value+"]"},t}(),CO=0,PO=function(){function t(){var t=OO(arguments);this._terms=t.terms,this._constant=t.constant}return t.prototype.terms=function(){return this._terms},t.prototype.constant=function(){return this._constant},t.prototype.value=function(){for(var t=this._constant,e=0,n=this._terms.size();e<n;e++){var r=this._terms.itemAt(e);t+=r.first.value()*r.second}return t},t.prototype.plus=function(e){return new t(this,e)},t.prototype.minus=function(e){return new t(this,"number"==typeof e?-e:[-1,e])},t.prototype.multiply=function(e){return new t([e,this])},t.prototype.divide=function(e){return new t([1/e,this])},t.prototype.isConstant=function(){return 0==this._terms.size()},t.prototype.toString=function(){var t=this._terms.array.map((function(t){return t.second+"*"+t.first.toString()})).join(" + ");return this.isConstant()||0===this._constant||(t+=" + "),t+=this._constant},t}();function OO(t){for(var e=0,n=function(){return 0},r=TO(),i=0,o=t.length;i<o;++i){var s=t[i];if("number"==typeof s)e+=s;else if(s instanceof LO)r.setDefault(s,n).second+=1;else if(s instanceof PO){e+=s.constant();for(var a=0,c=(d=s.terms()).size();a<c;a++){var l=d.itemAt(a);r.setDefault(l.first,n).second+=l.second}}else{if(!(s instanceof Array))throw new Error("invalid Expression argument: "+s);if(2!==s.length)throw new Error("array must have length 2");var u=s[0],h=s[1];if("number"!=typeof u)throw new Error("array item 0 must be a number");if(h instanceof LO)r.setDefault(h,n).second+=u;else{if(!(h instanceof PO))throw new Error("array item 1 must be a variable or expression");e+=h.constant()*u;var d;for(a=0,c=(d=h.terms()).size();a<c;a++){l=d.itemAt(a);r.setDefault(l.first,n).second+=l.second*u}}}}return{terms:r,constant:e}}var NO,IO=function(){function t(){}return t.create=function(t,e,n,r){void 0===r&&(r=1);var i=0;return i+=1e6*Math.max(0,Math.min(1e3,t*r)),i+=1e3*Math.max(0,Math.min(1e3,e*r)),i+=Math.max(0,Math.min(1e3,n*r))},t.clip=function(e){return Math.max(0,Math.min(t.required,e))},t.required=t.create(1e3,1e3,1e3),t.strong=t.create(1,0,0),t.medium=t.create(0,1,0),t.weak=t.create(0,0,1),t}();!function(t){t[t.Le=0]="Le",t[t.Ge=1]="Ge",t[t.Eq=2]="Eq"}(NO||(NO={}));var DO,FO=function(){function t(t,e,n,r){void 0===r&&(r=IO.required),this._id=UO++,this._operator=e,this._strength=IO.clip(r),this._expression=void 0===n&&t instanceof PO?t:t.minus(n)}return t.prototype.id=function(){return this._id},t.prototype.expression=function(){return this._expression},t.prototype.op=function(){return this._operator},t.prototype.strength=function(){return this._strength},t.prototype.toString=function(){return this._expression.toString()+" "+["<=",">=","="][this._operator]+" 0 ("+this._strength.toString()+")"},t}(),UO=0,BO=function(){function t(){this._cnMap=TO(),this._rowMap=TO(),this._varMap=TO(),this._editMap=TO(),this._infeasibleRows=[],this._objective=new GO,this._artificial=null,this._idTick=0}return t.prototype.createConstraint=function(t,e,n,r){void 0===r&&(r=IO.required);var i=new FO(t,e,n,r);return this.addConstraint(i),i},t.prototype.addConstraint=function(t){if(void 0!==this._cnMap.find(t))throw new Error("duplicate constraint");var e=this._createRow(t),n=e.row,r=e.tag,i=this._chooseSubject(n,r);if(i.type()===DO.Invalid&&n.allDummies()){if(!kO(n.constant()))throw new Error("unsatisfiable constraint");i=r.marker}if(i.type()===DO.Invalid){if(!this._addWithArtificialVariable(n))throw new Error("unsatisfiable constraint")}else n.solveFor(i),this._substitute(i,n),this._rowMap.insert(i,n);this._cnMap.insert(t,r),this._optimize(this._objective)},t.prototype.removeConstraint=function(t){var e=this._cnMap.erase(t);if(void 0===e)throw new Error("unknown constraint");this._removeConstraintEffects(t,e.second);var n=e.second.marker,r=this._rowMap.erase(n);if(void 0===r){var i=this._getMarkerLeavingSymbol(n);if(i.type()===DO.Invalid)throw new Error("failed to find leaving row");(r=this._rowMap.erase(i)).second.solveForEx(i,n),this._substitute(n,r.second)}this._optimize(this._objective)},t.prototype.hasConstraint=function(t){return this._cnMap.contains(t)},t.prototype.addEditVariable=function(t,e){if(void 0!==this._editMap.find(t))throw new Error("duplicate edit variable");if((e=IO.clip(e))===IO.required)throw new Error("bad required strength");var n=new PO(t),r=new FO(n,NO.Eq,void 0,e);this.addConstraint(r);var i={tag:this._cnMap.find(r).second,constraint:r,constant:0};this._editMap.insert(t,i)},t.prototype.removeEditVariable=function(t){var e=this._editMap.erase(t);if(void 0===e)throw new Error("unknown edit variable");this.removeConstraint(e.second.constraint)},t.prototype.hasEditVariable=function(t){return this._editMap.contains(t)},t.prototype.suggestValue=function(t,e){var n=this._editMap.find(t);if(void 0===n)throw new Error("unknown edit variable");var r=this._rowMap,i=n.second,o=e-i.constant;i.constant=e;var s=i.tag.marker,a=r.find(s);if(void 0!==a)return a.second.add(-o)<0&&this._infeasibleRows.push(s),void this._dualOptimize();var c=i.tag.other;if(void 0!==(a=r.find(c)))return a.second.add(o)<0&&this._infeasibleRows.push(c),void this._dualOptimize();for(var l=0,u=r.size();l<u;++l){var h=r.itemAt(l),d=h.second,p=d.coefficientFor(s);0!==p&&d.add(o*p)<0&&h.first.type()!==DO.External&&this._infeasibleRows.push(h.first)}this._dualOptimize()},t.prototype.updateVariables=function(){for(var t=this._varMap,e=this._rowMap,n=0,r=t.size();n<r;++n){var i=t.itemAt(n),o=e.find(i.second);void 0!==o?i.first.setValue(o.second.constant()):i.first.setValue(0)}},t.prototype._getVarSymbol=function(t){var e=this;return this._varMap.setDefault(t,(function(){return e._makeSymbol(DO.External)})).second},t.prototype._createRow=function(t){for(var e=t.expression(),n=new GO(e.constant()),r=e.terms(),i=0,o=r.size();i<o;++i){var s=r.itemAt(i);if(!kO(s.second)){var a=this._getVarSymbol(s.first),c=this._rowMap.find(a);void 0!==c?n.insertRow(c.second,s.second):n.insertSymbol(a,s.second)}}var l=this._objective,u=t.strength(),h={marker:HO,other:HO};switch(t.op()){case NO.Le:case NO.Ge:var d=t.op()===NO.Le?1:-1,p=this._makeSymbol(DO.Slack);if(h.marker=p,n.insertSymbol(p,d),u<IO.required){var f=this._makeSymbol(DO.Error);h.other=f,n.insertSymbol(f,-d),l.insertSymbol(f,u)}break;case NO.Eq:if(u<IO.required){var m=this._makeSymbol(DO.Error),g=this._makeSymbol(DO.Error);h.marker=m,h.other=g,n.insertSymbol(m,-1),n.insertSymbol(g,1),l.insertSymbol(m,u),l.insertSymbol(g,u)}else{var v=this._makeSymbol(DO.Dummy);h.marker=v,n.insertSymbol(v)}}return n.constant()<0&&n.reverseSign(),{row:n,tag:h}},t.prototype._chooseSubject=function(t,e){for(var n=t.cells(),r=0,i=n.size();r<i;++r){var o=n.itemAt(r);if(o.first.type()===DO.External)return o.first}var s=e.marker.type();return(s===DO.Slack||s===DO.Error)&&t.coefficientFor(e.marker)<0?e.marker:((s=e.other.type())===DO.Slack||s===DO.Error)&&t.coefficientFor(e.other)<0?e.other:HO},t.prototype._addWithArtificialVariable=function(t){var e=this._makeSymbol(DO.Slack);this._rowMap.insert(e,t.copy()),this._artificial=t.copy(),this._optimize(this._artificial);var n=kO(this._artificial.constant());this._artificial=null;var r=this._rowMap.erase(e);if(void 0!==r){var i=r.second;if(i.isConstant())return n;var o=this._anyPivotableSymbol(i);if(o.type()===DO.Invalid)return!1;i.solveForEx(e,o),this._substitute(o,i),this._rowMap.insert(o,i)}for(var s=this._rowMap,a=0,c=s.size();a<c;++a)s.itemAt(a).second.removeSymbol(e);return this._objective.removeSymbol(e),n},t.prototype._substitute=function(t,e){for(var n=this._rowMap,r=0,i=n.size();r<i;++r){var o=n.itemAt(r);o.second.substitute(t,e),o.second.constant()<0&&o.first.type()!==DO.External&&this._infeasibleRows.push(o.first)}this._objective.substitute(t,e),this._artificial&&this._artificial.substitute(t,e)},t.prototype._optimize=function(t){for(;;){var e=this._getEnteringSymbol(t);if(e.type()===DO.Invalid)return;var n=this._getLeavingSymbol(e);if(n.type()===DO.Invalid)throw new Error("the objective is unbounded");var r=this._rowMap.erase(n).second;r.solveForEx(n,e),this._substitute(e,r),this._rowMap.insert(e,r)}},t.prototype._dualOptimize=function(){for(var t=this._rowMap,e=this._infeasibleRows;0!==e.length;){var n=e.pop(),r=t.find(n);if(void 0!==r&&r.second.constant()<0){var i=this._getDualEnteringSymbol(r.second);if(i.type()===DO.Invalid)throw new Error("dual optimize failed");var o=r.second;t.erase(n),o.solveForEx(n,i),this._substitute(i,o),t.insert(i,o)}}},t.prototype._getEnteringSymbol=function(t){for(var e=t.cells(),n=0,r=e.size();n<r;++n){var i=e.itemAt(n),o=i.first;if(i.second<0&&o.type()!==DO.Dummy)return o}return HO},t.prototype._getDualEnteringSymbol=function(t){for(var e=Number.MAX_VALUE,n=HO,r=t.cells(),i=0,o=r.size();i<o;++i){var s=r.itemAt(i),a=s.first,c=s.second;if(c>0&&a.type()!==DO.Dummy){var l=this._objective.coefficientFor(a)/c;l<e&&(e=l,n=a)}}return n},t.prototype._getLeavingSymbol=function(t){for(var e=Number.MAX_VALUE,n=HO,r=this._rowMap,i=0,o=r.size();i<o;++i){var s=r.itemAt(i),a=s.first;if(a.type()!==DO.External){var c=s.second,l=c.coefficientFor(t);if(l<0){var u=-c.constant()/l;u<e&&(e=u,n=a)}}}return n},t.prototype._getMarkerLeavingSymbol=function(t){for(var e=Number.MAX_VALUE,n=e,r=e,i=HO,o=i,s=i,a=i,c=this._rowMap,l=0,u=c.size();l<u;++l){var h=c.itemAt(l),d=h.second,p=d.coefficientFor(t);if(0!==p){var f=h.first;if(f.type()===DO.External)a=f;else if(p<0){(m=-d.constant()/p)<n&&(n=m,o=f)}else{var m;(m=d.constant()/p)<r&&(r=m,s=f)}}}return o!==i?o:s!==i?s:a},t.prototype._removeConstraintEffects=function(t,e){e.marker.type()===DO.Error&&this._removeMarkerEffects(e.marker,t.strength()),e.other.type()===DO.Error&&this._removeMarkerEffects(e.other,t.strength())},t.prototype._removeMarkerEffects=function(t,e){var n=this._rowMap.find(t);void 0!==n?this._objective.insertRow(n.second,-e):this._objective.insertSymbol(t,-e)},t.prototype._anyPivotableSymbol=function(t){for(var e=t.cells(),n=0,r=e.size();n<r;++n){var i=e.itemAt(n),o=i.first.type();if(o===DO.Slack||o===DO.Error)return i.first}return HO},t.prototype._makeSymbol=function(t){return new zO(t,this._idTick++)},t}();function kO(t){return t<0?-t<1e-8:t<1e-8}!function(t){t[t.Invalid=0]="Invalid",t[t.External=1]="External",t[t.Slack=2]="Slack",t[t.Error=3]="Error",t[t.Dummy=4]="Dummy"}(DO||(DO={}));var zO=function(){function t(t,e){this._id=e,this._type=t}return t.prototype.id=function(){return this._id},t.prototype.type=function(){return this._type},t}(),HO=new zO(DO.Invalid,-1),GO=function(){function t(t){void 0===t&&(t=0),this._cellMap=TO(),this._constant=t}return t.prototype.cells=function(){return this._cellMap},t.prototype.constant=function(){return this._constant},t.prototype.isConstant=function(){return this._cellMap.empty()},t.prototype.allDummies=function(){for(var t=this._cellMap,e=0,n=t.size();e<n;++e){if(t.itemAt(e).first.type()!==DO.Dummy)return!1}return!0},t.prototype.copy=function(){var e=new t(this._constant);return e._cellMap=this._cellMap.copy(),e},t.prototype.add=function(t){return this._constant+=t},t.prototype.insertSymbol=function(t,e){void 0===e&&(e=1),kO(this._cellMap.setDefault(t,(function(){return 0})).second+=e)&&this._cellMap.erase(t)},t.prototype.insertRow=function(t,e){void 0===e&&(e=1),this._constant+=t._constant*e;for(var n=t._cellMap,r=0,i=n.size();r<i;++r){var o=n.itemAt(r);this.insertSymbol(o.first,o.second*e)}},t.prototype.removeSymbol=function(t){this._cellMap.erase(t)},t.prototype.reverseSign=function(){this._constant=-this._constant;for(var t=this._cellMap,e=0,n=t.size();e<n;++e){var r=t.itemAt(e);r.second=-r.second}},t.prototype.solveFor=function(t){var e=this._cellMap,n=-1/e.erase(t).second;this._constant*=n;for(var r=0,i=e.size();r<i;++r)e.itemAt(r).second*=n},t.prototype.solveForEx=function(t,e){this.insertSymbol(t,-1),this.solveFor(e)},t.prototype.coefficientFor=function(t){var e=this._cellMap.find(t);return void 0!==e?e.second:0},t.prototype.substitute=function(t,e){var n=this._cellMap.erase(t);void 0!==n&&this.insertRow(e,n.second)},t}();var jO=class{constructor(t){this._name=t.name,this._type=t.type,this._solver=t.solver,this._attr={},t.name||(this._attr[hO.LEFT]=new LO,this._solver.addConstraint(new FO(this._attr[hO.LEFT],NO.Eq,0)),this._attr[hO.TOP]=new LO,this._solver.addConstraint(new FO(this._attr[hO.TOP],NO.Eq,0)),this._attr[hO.ZINDEX]=new LO,this._solver.addConstraint(new FO(this._attr[hO.ZINDEX],NO.Eq,0)))}toJSON(){return{name:this.name,left:this.left,top:this.top,width:this.width,height:this.height}}toString(){JSON.stringify(this.toJSON(),void 0,2)}get name(){return this._name}get left(){return this._getAttrValue(hO.LEFT)}get right(){return this._getAttrValue(hO.RIGHT)}get width(){return this._getAttrValue(hO.WIDTH)}get height(){return this._getAttrValue(hO.HEIGHT)}get intrinsicWidth(){return this._intrinsicWidth}set intrinsicWidth(t){if(void 0!==t&&t!==this._intrinsicWidth){const e=this._getAttr(hO.WIDTH);void 0===this._intrinsicWidth&&this._solver.addEditVariable(e,IO.create(this._name?998:999,1e3,1e3)),this._intrinsicWidth=t,this._solver.suggestValue(e,t),this._solver.updateVariables()}}get intrinsicHeight(){return this._intrinsicHeight}set intrinsicHeight(t){if(void 0!==t&&t!==this._intrinsicHeight){const e=this._getAttr(hO.HEIGHT);void 0===this._intrinsicHeight&&this._solver.addEditVariable(e,IO.create(this._name?998:999,1e3,1e3)),this._intrinsicHeight=t,this._solver.suggestValue(e,t),this._solver.updateVariables()}}get top(){return this._getAttrValue(hO.TOP)}get bottom(){return this._getAttrValue(hO.BOTTOM)}get centerX(){return this._getAttrValue(hO.CENTERX)}get centerY(){return this._getAttrValue(hO.CENTERY)}get zIndex(){return this._getAttrValue(hO.ZINDEX)}get type(){return this._type}getValue(t){return this._attr[t]?this._attr[t].value():void 0}_getAttr(t){if(this._attr[t])return this._attr[t];switch(this._attr[t]=new LO,t){case hO.RIGHT:this._getAttr(hO.LEFT),this._getAttr(hO.WIDTH),this._solver.addConstraint(new FO(this._attr[t],NO.Eq,this._attr[hO.LEFT].plus(this._attr[hO.WIDTH])));break;case hO.BOTTOM:this._getAttr(hO.TOP),this._getAttr(hO.HEIGHT),this._solver.addConstraint(new FO(this._attr[t],NO.Eq,this._attr[hO.TOP].plus(this._attr[hO.HEIGHT])));break;case hO.CENTERX:this._getAttr(hO.LEFT),this._getAttr(hO.WIDTH),this._solver.addConstraint(new FO(this._attr[t],NO.Eq,this._attr[hO.LEFT].plus(this._attr[hO.WIDTH].divide(2))));break;case hO.CENTERY:this._getAttr(hO.TOP),this._getAttr(hO.HEIGHT),this._solver.addConstraint(new FO(this._attr[t],NO.Eq,this._attr[hO.TOP].plus(this._attr[hO.HEIGHT].divide(2))))}return this._solver.updateVariables(),this._attr[t]}_getAttrValue(t){return this._getAttr(t).value()}};const VO=IO.create(0,1e3,1e3);var WO,qO,XO,YO,ZO,JO,$O,KO,QO,tN,eN,nN,rN,iN,oN={Attribute:hO,Relation:dO,Priority:pO,VisualFormat:SO,View:class{constructor(t){this._solver=new BO,this._subViews={},this._parentSubView=new jO({solver:this._solver}),this.setSpacing(t&&void 0!==t.spacing?t.spacing:8),t&&(void 0===t.width&&void 0===t.height||this.setSize(t.width,t.height),t.constraints&&this.addConstraints(t.constraints))}setSize(t,e){return this._parentSubView.intrinsicWidth=t,this._parentSubView.intrinsicHeight=e,this}get width(){return this._parentSubView.intrinsicWidth}get height(){return this._parentSubView.intrinsicHeight}get fittingWidth(){return this._parentSubView.width}get fittingHeight(){return this._parentSubView.height}setSpacing(t){if(Array.isArray(t))switch(t.length){case 1:t=[t[0],t[0],t[0],t[0],t[0],t[0],1];break;case 2:t=[t[1],t[0],t[1],t[0],t[0],t[1],1];break;case 3:t=[t[1],t[0],t[1],t[0],t[0],t[1],t[2]];break;case 6:t=[t[0],t[1],t[2],t[3],t[4],t[5],1];break;case 7:break;default:throw"Invalid spacing syntax"}else t=[t,t,t,t,t,t,1];if(!this._compareSpacing(this._spacing,t)&&(this._spacing=t,this._spacingVars)){for(var e=0;e<this._spacingVars.length;e++)this._spacingVars[e]&&this._solver.suggestValue(this._spacingVars[e],this._spacing[e]);this._solver.updateVariables()}return this}_compareSpacing(t,e){if(t===e)return!0;if(!t||!e)return!1;for(var n=0;n<7;n++)if(t[n]!==e[n])return!1;return!0}addConstraint(t){return this._addConstraint(t),this._solver.updateVariables(),this}addConstraints(t){for(var e=0;e<t.length;e++)this._addConstraint(t[e]);return this._solver.updateVariables(),this}_addConstraint(t){let e;const n=void 0!==t.multiplier?t.multiplier:1;let r=void 0!==t.constant?t.constant:0;"default"===r&&(r=this._getSpacing(t));const i=this._getSubView(t.view1)._getAttr(t.attr1);let o;t.attr2===hO.CONST?o=this._getConst(void 0,t.constant):(o=this._getSubView(t.view2)._getAttr(t.attr2),1!==n&&r?o=o.multiply(n).plus(r):r?o=o.plus(r):1!==n&&(o=o.multiply(n)));const s=void 0!==t.priority&&t.priority<1e3?IO.create(0,t.priority,1e3):VO;switch(t.relation){case dO.EQU:e=new FO(i,NO.Eq,o,s);break;case dO.GEQ:e=new FO(i,NO.Ge,o,s);break;case dO.LEQ:e=new FO(i,NO.Le,o,s);break;default:throw"Invalid relation specified: "+t.relation}this._solver.addConstraint(e)}_getSpacing(t){let e=4;if(t.view1||"left"!==t.attr1)if(t.view1||"top"!==t.attr1)if(t.view2||"right"!==t.attr2)if(t.view2||"bottom"!==t.attr2)switch(t.attr1){case"left":case"right":case"centerX":case"leading":case"trailing":e=4;break;case"zIndex":e=6;break;default:e=5}else e=2;else e=1;else e=0;else e=3;return this._spacingVars=this._spacingVars||new Array(7),this._spacingExpr=this._spacingExpr||new Array(7),this._spacingVars[e]||(this._spacingVars[e]=new LO,this._solver.addEditVariable(this._spacingVars[e],IO.create(999,1e3,1e3)),this._spacingExpr[e]=this._spacingVars[e].multiply(-1),this._solver.suggestValue(this._spacingVars[e],this._spacing[e])),this._spacingExpr[e]}_getSubView(t){return t?t.name?(this._subViews[t.name]=this._subViews[t.name]||new jO({name:t.name,solver:this._solver}),this._subViews[t.name]._type=this._subViews[t.name]._type||t.type,this._subViews[t.name]):(this._subViews[t]=this._subViews[t]||new jO({name:t,solver:this._solver}),this._subViews[t]):this._parentSubView}_getConst(t,e){const n=new LO;return this._solver.addConstraint(new FO(n,NO.Eq,e)),n}get subViews(){return this._subViews}},SubView:jO},sN=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},aN=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cN=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},lN=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};let uN=iN=class extends gd{constructor(t){super(),WO.add(this),this.visualFormat="",qO.set(this,void 0),XO.set(this,{}),YO.set(this,{}),ZO.set(this,!1),JO.set(this,void 0),tN.set(this,()=>{if(cN(this,qO,"f")){var t,e,n=this.getSize().toArray();(cN(this,XO,"f").spacing||cN(this,JO,"f").spacing)&&cN(this,qO,"f").setSpacing(cN(this,XO,"f").spacing||cN(this,JO,"f").spacing);var r=cN(this,XO,"f").widths||cN(this,JO,"f").widths;r&&cN(this,WO,"m",$O).call(this,r);var i=cN(this,XO,"f").heights||cN(this,JO,"f").heights;if(i&&cN(this,WO,"m",KO).call(this,i),cN(this,XO,"f").viewport||cN(this,JO,"f").viewport){var o=cN(this,WO,"m",QO).call(this,n,cN(this,XO,"f").viewport||cN(this,JO,"f").viewport);t=(n[0]-o[0])/2,e=(n[1]-o[1])/2}else cN(this,qO,"f").setSize(n[0],n[1]),t=0,e=0;for(var s in cN(this,qO,"f").subViews){var a=cN(this,qO,"f").subViews[s];if(0!==s.indexOf("_")&&"stack"!==a.type){var c=cN(this,YO,"f")[s];c&&cN(this,WO,"m",eN).call(this,c,a,t,e,r,i)}}cN(this,ZO,"f")&&lN(this,ZO,!1,"f")}}),this.on("sizechange",cN(this,tN,"f")),this.on("reflow",cN(this,tN,"f")),t&&(t.visualFormat&&this.setVisualFormat(t.visualFormat),t.layoutOptions&&this.setLayoutOptions(t.layoutOptions))}connectedCallback(){super.connectedCallback(),this._stopFns.push(Zr(()=>{this.setVisualFormat(this.visualFormat||"")}))}childConnected(t){super.childConnected(t),cN(this,qO,"f")&&cN(this,WO,"m",nN).call(this)}childDisconnected(t){if(super.childDisconnected(t),!cN(this,qO,"f"))return;const e=cN(this,YO,"f");for(const n in e)if(e[n]===t){delete e[n];break}cN(this,WO,"m",nN).call(this)}reflowLayout(){return cN(this,ZO,"f")||(lN(this,ZO,!0,"f"),$s.once(()=>this.emit("reflow"))),this}setVisualFormat(t,e){this._visualFormat=t;var n=oN.VisualFormat.parse(t,e||iN.DEFAULT_PARSE_OPTIONS);return lN(this,JO,oN.VisualFormat.parseMetaInfo(t),"f"),lN(this,qO,new oN.View({constraints:n}),"f"),cN(this,WO,"m",nN).call(this),this.reflowLayout(),this}setLayoutOptions(t){return lN(this,XO,t||{},"f"),this.reflowLayout(),this}addToLayout(t,e){return this.add(t),e&&(cN(this,YO,"f")[e]=t),this.reflowLayout(),t}removeFromLayout(t,e){if(t&&e)this.removeNode(t),delete cN(this,YO,"f")[e];else if(t){for(e in cN(this,YO,"f"))if(cN(this,YO,"f")[e]===t){delete cN(this,YO,"f")[e];break}this.removeNode(t)}else e&&(this.removeNode(cN(this,YO,"f")[e]),delete cN(this,YO,"f")[e]);this.reflowLayout()}};qO=new WeakMap,XO=new WeakMap,YO=new WeakMap,ZO=new WeakMap,JO=new WeakMap,tN=new WeakMap,WO=new WeakSet,$O=function(t){for(var e in t){var n=cN(this,qO,"f").subViews[e],r=cN(this,YO,"f")[e];n&&r&&(n.intrinsicWidth=r.calculatedSize.x)}},KO=function(t){for(var e in t){var n=cN(this,qO,"f").subViews[e],r=cN(this,YO,"f")[e];n&&r&&(n.intrinsicHeight=r.calculatedSize.y)}},QO=function(t,e){return t=[void 0!==e.width&&!0!==e.width?e.width:Math.max(Math.min(t[0],e["max-width"]||t[0]),e["min-width"]||0),void 0!==e.height&&!0!==e.height?e.height:Math.max(Math.min(t[1],e["max-height"]||t[1]),e["min-height"]||0)],!0===e.width&&!0===e.height?(t[0]=cN(this,qO,"f").fittingWidth,t[1]=cN(this,qO,"f").fittingHeight):!0===e.width?(cN(this,qO,"f").setSize(void 0,t[1]),t[0]=cN(this,qO,"f").fittingWidth):!0===e.height?(cN(this,qO,"f").setSize(t[0],void 0),t[1]=cN(this,qO,"f").fittingHeight):(t=e["aspect-ratio"]?[Math.min(t[0],t[1]*e["aspect-ratio"]),Math.min(t[1],t[0]/e["aspect-ratio"])]:t,cN(this,qO,"f").setSize(t[0],t[1])),t},eN=function(t,e,n,r,i,o){t.sizeMode=[i&&!0===i[key]?"proportional":"literal",o&&!0===o[key]?"proportional":"literal"],t.size=[i&&!0===i[key]?1:e.width,o&&!0===o[key]?1:e.height],t.position=[n+e.left,r+e.top,5*e.zIndex]},nN=function(){const t=cN(this,qO,"f").subViews,e=Object.keys(t),n=cN(this,YO,"f");for(var r of e){var i=t[r];if(0!==r.indexOf("_")&&"stack"!==i.type){var o=n[r];o||(o=this.querySelector("."+r))&&o.parentElement===this&&(n[r]=o)}}cN(this,WO,"m",rN).call(this)},rN=function(){const t=cN(this,qO,"f").subViews,e=Object.keys(t),n=cN(this,YO,"f"),r=Object.keys(n);for(const t of r)e.includes(t)?n[t].visible=!0:n[t].visible=!1},uN.defaultElementName="lume-autolayout-node",uN.DEFAULT_PARSE_OPTIONS={extended:!0,strict:!1},sN([oi,J("propertychange"),aN("design:type",Object)],uN.prototype,"visualFormat",void 0),uN=iN=sN([ui,aN("design:paramtypes",[Object])],uN);class hN extends gd{constructor(t,e){super(),this.sides=[],this.set({size:new Ds(t,t,t),...e});for(let t=0;t<6;t+=1)this._createCubeSide(t)}_createCubeSide(t){const e=(new gd).set({alignPoint:new xs(.5,.5),mountPoint:new xs(.5,.5)}),n=(new gd).set({alignPoint:new xs(.5,.5),mountPoint:new xs(.5,.5),size:new Ds(this.getSize().x,this.getSize().x)});this.sides.push(n),e.add(n),t<4?e.getRotation().y=90*t:e.getRotation().x=90*(t%2?-1:1),n.getPosition().z=this.getSize().x/2,this.add(e)}setContent(t){for(let e=0;e<6;e+=1)this.sides[e].add(t[e]);return this}}class dN extends gd{constructor(){super(),console.log(" -- PushPaneLayout created (TODO)")}}function pN(t,e=1){os.call(this),this.type="Light",this.color=new Mh(t),this.intensity=e}dN.defaultElementName="lume-push-pane-layout",pN.prototype=Object.assign(Object.create(os.prototype),{constructor:pN,isLight:!0,copy:function(t){return os.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=os.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}});var fN=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},mN=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let gN=class extends gd{constructor(){super(...arguments),this.color="white",this.intensity=1}makeThreeObject3d(){return new pN}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Zr(()=>{"object"==typeof this.color&&(this.three.color=this.color),this.three.color=new Mh(this.color),this.needsUpdate()}),Zr(()=>{this.three.intensity=this.intensity,this.needsUpdate()})),!0)}};function vN(t,e){pN.call(this,t,e),this.type="AmbientLight"}fN([oi,J("propertychange"),mN("design:type",Object)],gN.prototype,"color",void 0),fN([ci(1),J("propertychange"),mN("design:type",Number)],gN.prototype,"intensity",void 0),gN=fN([ui],gN),vN.prototype=Object.assign(Object.create(pN.prototype),{constructor:vN,isAmbientLight:!0});class yN extends gN{makeThreeObject3d(){return new vN}}function bN(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new gh(512,512),this.map=null,this.mapPass=null,this.matrix=new Oo,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new UR,this._frameExtents=new gh(1,1),this._viewportCount=1,this._viewports=[new Hd(0,0,1,1)]}function xN(){bN.call(this,new bR(90,1,.5,500)),this._frameExtents=new gh(4,2),this._viewportCount=6,this._viewports=[new Hd(2,1,1,1),new Hd(0,1,1,1),new Hd(3,1,1,1),new Hd(1,1,1,1),new Hd(3,0,1,1),new Hd(1,0,1,1)],this._cubeDirections=[new Lo(1,0,0),new Lo(-1,0,0),new Lo(0,0,1),new Lo(0,0,-1),new Lo(0,1,0),new Lo(0,-1,0)],this._cubeUps=[new Lo(0,1,0),new Lo(0,1,0),new Lo(0,1,0),new Lo(0,1,0),new Lo(0,0,1),new Lo(0,0,-1)]}function _N(t,e,n,r){pN.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new xN}yN.defaultElementName="lume-ambient-light",Object.assign(bN.prototype,{_projScreenMatrix:new Oo,_lightPositionWorld:new Lo,_lookTarget:new Lo,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),xN.prototype=Object.assign(Object.create(bN.prototype),{constructor:xN,isPointLightShadow:!0,updateMatrices:function(t,e=0){const n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),_N.prototype=Object.assign(Object.create(pN.prototype),{constructor:_N,isPointLight:!0,copy:function(t){return pN.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}});var wN=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},MN=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let EN=class extends gN{constructor(){super(...arguments),this.distance=0,this.decay=1,this.castShadow=!0,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowRadius=3,this.shadowBias=0,this.shadowCameraNear=1,this.shadowCameraFar=2e3}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Zr(()=>{const t=this.three;t.distance=this.distance,t.decay=this.decay,t.castShadow=this.castShadow;const e=this.three.shadow;e.mapSize.width=this.shadowMapWidth,e.mapSize.height=this.shadowMapHeight,e.radius=this.shadowRadius,e.bias=this.shadowBias,e.camera.near=this.shadowCameraNear,e.camera.far=this.shadowCameraFar,e.needsUpdate=!0,this.needsUpdate()})),!0)}makeThreeObject3d(){return new _N}};function SN(){bN.call(this,new YC(-5,5,5,-5,.5,500))}function TN(t,e){pN.call(this,t,e),this.type="DirectionalLight",this.position.copy(os.DefaultUp),this.updateMatrix(),this.target=new os,this.shadow=new SN}EN.defaultElementName="lume-point-light",wN([ci(0),J("propertychange"),MN("design:type",Object)],EN.prototype,"distance",void 0),wN([ci(1),J("propertychange"),MN("design:type",Object)],EN.prototype,"decay",void 0),wN([li(!0),J("propertychange"),MN("design:type",Object)],EN.prototype,"castShadow",void 0),wN([ci(512),J("propertychange"),MN("design:type",Object)],EN.prototype,"shadowMapWidth",void 0),wN([ci(512),J("propertychange"),MN("design:type",Object)],EN.prototype,"shadowMapHeight",void 0),wN([ci(3),J("propertychange"),MN("design:type",Object)],EN.prototype,"shadowRadius",void 0),wN([ci(0),J("propertychange"),MN("design:type",Object)],EN.prototype,"shadowBias",void 0),wN([ci(1),J("propertychange"),MN("design:type",Object)],EN.prototype,"shadowCameraNear",void 0),wN([ci(2e3),J("propertychange"),MN("design:type",Object)],EN.prototype,"shadowCameraFar",void 0),EN=wN([ui],EN),SN.prototype=Object.assign(Object.create(bN.prototype),{constructor:SN,isDirectionalLightShadow:!0,updateMatrices:function(t){bN.prototype.updateMatrices.call(this,t)}}),TN.prototype=Object.assign(Object.create(pN.prototype),{constructor:TN,isDirectionalLight:!0,copy:function(t){return pN.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});var AN=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},RN=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let LN=class extends gN{constructor(){super(...arguments),this.castShadow=!0,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowRadius=3,this.shadowBias=0,this.shadowCameraNear=1,this.shadowCameraFar=2e3,this.shadowCameraTop=1e3,this.shadowCameraRight=1e3,this.shadowCameraBottom=-1e3,this.shadowCameraLeft=-1e3}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Zr(()=>{this.three.castShadow=this.castShadow;const t=this.three.shadow;t.mapSize.width=this.shadowMapWidth,t.mapSize.height=this.shadowMapHeight,t.radius=this.shadowRadius,t.bias=this.shadowBias,t.camera.near=this.shadowCameraNear,t.camera.far=this.shadowCameraFar,t.camera.top=this.shadowCameraTop,t.camera.right=this.shadowCameraRight,t.camera.bottom=this.shadowCameraBottom,t.camera.left=this.shadowCameraLeft,t.needsUpdate=!0,this.needsUpdate()})),!0)}makeThreeObject3d(){return new TN}};LN.defaultElementName="lume-directional-light",AN([li(!0),RN("design:type",Object)],LN.prototype,"castShadow",void 0),AN([ci(512),RN("design:type",Object)],LN.prototype,"shadowMapWidth",void 0),AN([ci(512),RN("design:type",Object)],LN.prototype,"shadowMapHeight",void 0),AN([ci(3),RN("design:type",Object)],LN.prototype,"shadowRadius",void 0),AN([ci(0),RN("design:type",Object)],LN.prototype,"shadowBias",void 0),AN([ci(1),RN("design:type",Object)],LN.prototype,"shadowCameraNear",void 0),AN([ci(2e3),RN("design:type",Object)],LN.prototype,"shadowCameraFar",void 0),AN([ci(1),RN("design:type",Object)],LN.prototype,"shadowCameraTop",void 0),AN([ci(1),RN("design:type",Object)],LN.prototype,"shadowCameraRight",void 0),AN([ci(1),RN("design:type",Object)],LN.prototype,"shadowCameraBottom",void 0),AN([ci(1),RN("design:type",Object)],LN.prototype,"shadowCameraLeft",void 0),LN=AN([ui],LN);class CN extends cf{}CN.defaultElementName="lume-box",CN.defaultBehaviors={"box-geometry":t=>!t.some(t=>t.endsWith("-geometry")),"phong-material":t=>!t.some(t=>t.endsWith("-material"))};class PN extends cf{get isMixedPlane(){return!0}}PN.defaultElementName="lume-mixed-plane",PN.defaultBehaviors={"mixedplane-geometry":t=>!t.some(t=>t.endsWith("-geometry")),"mixedplane-material":t=>!t.some(t=>t.endsWith("-material"))};class ON extends cf{}ON.defaultElementName="lume-plane",ON.defaultBehaviors={"plane-geometry":t=>!t.some(t=>t.endsWith("-geometry")),"phong-material":t=>!t.some(t=>t.endsWith("-material"))};class NN extends cf{}NN.defaultElementName="lume-rounded-rectangle",NN.defaultBehaviors={"rounded-rectangle-geometry":t=>!t.some(t=>t.endsWith("-geometry")),"phong-material":t=>!t.some(t=>t.endsWith("-material"))};class IN extends cf{}IN.defaultElementName="lume-sphere",IN.defaultBehaviors={"sphere-geometry":t=>!t.some(t=>t.endsWith("-geometry")),"phong-material":t=>!t.some(t=>t.endsWith("-material"))};class DN extends gd{}DN.defaultElementName="lume-collada-model",DN.defaultBehaviors=["collada-model"];var FN=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};let UN=class extends gd{};UN.defaultBehaviors=["fbx-model"],UN=FN([ui("lume-fbx-model",yf)],UN);class BN extends gd{}BN.defaultElementName="lume-gltf-model",BN.defaultBehaviors=["gltf-model"];class kN extends gd{}kN.defaultElementName="lume-obj-model",kN.defaultBehaviors=["obj-model"];class zN extends bs{get default(){return{x:void 0,y:void 0,z:void 0}}}function HN(){var t;for(const e in l){const n=l[e];(null==n?void 0:n.elementName)&&(null===(t=null==n?void 0:n.defineElement)||void 0===t||t.call(n))}}function GN(){!function(){const t=[eO,gd,cf,CN,IN,ON,EN,LN,PN,yN,AR,uN,kN,BN,DN,NN];for(const e of t)customElements.get(e.defaultElementName)||e.define()}(),HN()}function jN(t,e,n){YR.call(this,t,e,n),this.samples=4}function VN(t){XC.call(this,t)}function WN(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=rh,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ao.generateUUID()}jN.prototype=Object.assign(Object.create(YR.prototype),{constructor:jN,isWebGLMultisampleRenderTarget:!0,copy:function(t){return YR.prototype.copy.call(this,t),this.samples=t.samples,this}}),VN.prototype=Object.assign(Object.create(XC.prototype),{constructor:VN,isWebGL1Renderer:!0}),Object.defineProperty(WN.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(WN.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e=0){return this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ao.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new WN(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ao.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const qN=new Lo;function XN(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function YN(t){mh.call(this),this.type="SpriteMaterial",this.color=new Mh(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let ZN;Object.defineProperties(XN.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(XN.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)qN.x=this.getX(e),qN.y=this.getY(e),qN.z=this.getZ(e),qN.applyMatrix4(t),this.setXYZ(e,qN.x,qN.y,qN.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Vd(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new XN(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),YN.prototype=Object.create(mh.prototype),YN.prototype.constructor=YN,YN.prototype.isSpriteMaterial=!0,YN.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const JN=new Lo,$N=new Lo,KN=new Lo,QN=new gh,tI=new gh,eI=new Oo,nI=new Lo,rI=new Lo,iI=new Lo,oI=new gh,sI=new gh,aI=new gh;function cI(t){if(os.call(this),this.type="Sprite",void 0===ZN){ZN=new dp;const t=new WN(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);ZN.setIndex([0,1,2,0,2,3]),ZN.setAttribute("position",new XN(t,3,0,!1)),ZN.setAttribute("uv",new XN(t,2,3,!1))}this.geometry=ZN,this.material=void 0!==t?t:new YN,this.center=new gh(.5,.5)}function lI(t,e,n,r,i,o){QN.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(tI.x=o*QN.x-i*QN.y,tI.y=i*QN.x+o*QN.y):tI.copy(QN),t.copy(e),t.x+=tI.x,t.y+=tI.y,t.applyMatrix4(eI)}cI.prototype=Object.assign(Object.create(os.prototype),{constructor:cI,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),$N.setFromMatrixScale(this.matrixWorld),eI.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),KN.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&$N.multiplyScalar(-KN.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;lI(nI.set(-.5,-.5,0),KN,o,$N,r,i),lI(rI.set(.5,-.5,0),KN,o,$N,r,i),lI(iI.set(.5,.5,0),KN,o,$N,r,i),oI.set(0,0),sI.set(1,0),aI.set(1,1);let s=t.ray.intersectTriangle(nI,rI,iI,!1,JN);if(null===s&&(lI(rI.set(-.5,.5,0),KN,o,$N,r,i),sI.set(0,1),s=t.ray.intersectTriangle(nI,iI,rI,!1,JN),null===s))return;const a=t.ray.origin.distanceTo(JN);a<t.near||a>t.far||e.push({distance:a,point:JN.clone(),uv:Up.getUV(JN,nI,rI,iI,oI,sI,aI,new gh),face:null,object:this})},copy:function(t){return os.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const uI=new Lo,hI=new Lo;function dI(){os.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}dI.prototype=Object.assign(Object.create(os.prototype),{constructor:dI,isLOD:!0,copy:function(t){os.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){uI.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(uI);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){uI.setFromMatrixPosition(t.matrixWorld),hI.setFromMatrixPosition(this.matrixWorld);const n=uI.distanceTo(hI)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}},toJSON:function(t){const e=os.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}});const pI=new Lo,fI=new Hd,mI=new Hd,gI=new Lo,vI=new Oo;function yI(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),nf.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Oo,this.bindMatrixInverse=new Oo}function bI(){os.call(this),this.type="Bone"}yI.prototype=Object.assign(Object.create(nf.prototype),{constructor:yI,isSkinnedMesh:!0,copy:function(t){return nf.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Hd,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){nf.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,e){const n=this.skeleton,r=this.geometry;fI.fromBufferAttribute(r.attributes.skinIndex,t),mI.fromBufferAttribute(r.attributes.skinWeight,t),pI.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=mI.getComponent(t);if(0!==r){const i=fI.getComponent(t);vI.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(gI.copy(pI).applyMatrix4(vI),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}),bI.prototype=Object.assign(Object.create(os.prototype),{constructor:bI,isBone:!0});const xI=new Oo,_I=new Oo;function wI(t=[],e=[]){this.uuid=Ao.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(wI.prototype,{init:function(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Oo)}},calculateInverses:function(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Oo;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:_I;xI.multiplyMatrices(i,e[r]),xI.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new wI(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new bI),this.bones.push(i),this.boneInverses.push((new Oo).fromArray(t.boneInverses[n]))}return this.init(),this},toJSON:function(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const o=n[r];t.boneInverses.push(o.toArray())}return t}});const MI=new Oo,EI=new Oo,SI=[],TI=new nf;function AI(t,e,n){nf.call(this,t,e),this.instanceMatrix=new Vd(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function RI(t){mh.call(this),this.type="LineBasicMaterial",this.color=new Mh(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}AI.prototype=Object.assign(Object.create(nf.prototype),{constructor:AI,isInstancedMesh:!0,copy:function(t){return nf.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getColorAt:function(t,e){e.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,r=this.count;if(TI.geometry=this.geometry,TI.material=this.material,void 0!==TI.material)for(let i=0;i<r;i++){this.getMatrixAt(i,MI),EI.multiplyMatrices(n,MI),TI.matrixWorld=EI,TI.raycast(t,SI);for(let t=0,n=SI.length;t<n;t++){const n=SI[t];n.instanceId=i,n.object=this,e.push(n)}SI.length=0}},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new Vd(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),RI.prototype=Object.create(mh.prototype),RI.prototype.constructor=RI,RI.prototype.isLineBasicMaterial=!0,RI.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const LI=new Lo,CI=new Lo,PI=new Oo,OI=new wp,NI=new Dd;function II(t=new dp,e=new RI){os.call(this),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}II.prototype=Object.assign(Object.create(os.prototype),{constructor:II,isLine:!0,copy:function(t){return os.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)LI.fromBufferAttribute(e,t-1),CI.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=LI.distanceTo(CI);t.setAttribute("lineDistance",new Qd(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;n[0]=0;for(let t=1,r=e.length;t<r;t++)n[t]=n[t-1],n[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),NI.copy(n.boundingSphere),NI.applyMatrix4(r),NI.radius+=i,!1===t.ray.intersectsSphere(NI))return;PI.copy(r).invert(),OI.copy(t.ray).applyMatrix4(PI);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new Lo,c=new Lo,l=new Lo,u=new Lo,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,o=n.length-1;r<o;r+=h){const o=n[r],h=n[r+1];a.fromBufferAttribute(i,o),c.fromBufferAttribute(i,h);if(OI.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:l.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.count-1;n<r;n+=h){a.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1);if(OI.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const r=n.vertices,i=r.length;for(let n=0;n<i-1;n+=h){if(OI.distanceSqToSegment(r[n],r[n+1],u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const DI=new Lo,FI=new Lo;function UI(t,e){II.call(this,t,e),this.type="LineSegments"}function BI(t,e){II.call(this,t,e),this.type="LineLoop"}function kI(t,e,n,r,i,o,s,a,c){US.call(this,t,e,n,r,i,o,s,a,c),this.format=void 0!==s?s:gl,this.minFilter=void 0!==o?o:Kc,this.magFilter=void 0!==i?i:Kc,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}function zI(t,e,n,r,i,o,s,a,c,l,u,h){US.call(this,null,o,s,a,c,l,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function HI(t,e,n,r,i,o,s,a,c){US.call(this,t,e,n,r,i,o,s,a,c),this.needsUpdate=!0}function GI(t,e,n,r,i,o,s,a,c,l){if((l=void 0!==l?l:_l)!==_l&&l!==wl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===_l&&(n=sl),void 0===n&&l===wl&&(n=fl),US.call(this,null,r,i,o,s,a,l,n,c),this.image={width:t,height:e},this.magFilter=void 0!==s?s:Xc,this.minFilter=void 0!==a?a:Xc,this.flipY=!1,this.generateMipmaps=!1}UI.prototype=Object.assign(Object.create(II.prototype),{constructor:UI,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)DI.fromBufferAttribute(e,t),FI.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+DI.distanceTo(FI);t.setAttribute("lineDistance",new Qd(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;for(let t=0,r=e.length;t<r;t+=2)DI.copy(e[t]),FI.copy(e[t+1]),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+DI.distanceTo(FI)}return this}}),BI.prototype=Object.assign(Object.create(II.prototype),{constructor:BI,isLineLoop:!0}),kI.prototype=Object.assign(Object.create(US.prototype),{constructor:kI,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),zI.prototype=Object.create(US.prototype),zI.prototype.constructor=zI,zI.prototype.isCompressedTexture=!0,HI.prototype=Object.create(US.prototype),HI.prototype.constructor=HI,HI.prototype.isCanvasTexture=!0,GI.prototype=Object.create(US.prototype),GI.prototype.constructor=GI,GI.prototype.isDepthTexture=!0;class jI extends dp{constructor(t=1,e=8,n=0,r=2*Math.PI){super(),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},e=Math.max(3,e);const i=[],o=[],s=[],a=[],c=new Lo,l=new gh;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=e;i++,u+=3){const h=n+i/e*r;c.x=t*Math.cos(h),c.y=t*Math.sin(h),o.push(c.x,c.y,c.z),s.push(0,0,1),l.x=(o[u]/t+1)/2,l.y=(o[u+1]/t+1)/2,a.push(l.x,l.y)}for(let t=1;t<=e;t++)i.push(t,t+1,0);this.setIndex(i),this.setAttribute("position",new Qd(o,3)),this.setAttribute("normal",new Qd(s,3)),this.setAttribute("uv",new Qd(a,2))}}class VI extends zd{constructor(t,e,n,r){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new jI(t,e,n,r)),this.mergeVertices()}}class WI extends dp{constructor(t=1,e=1,n=1,r=8,i=1,o=!1,s=0,a=2*Math.PI){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};const c=this;r=Math.floor(r),i=Math.floor(i);const l=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,o=new gh,f=new Lo;let v=0;const y=!0===n?t:e,b=!0===n?1:-1;for(let t=1;t<=r;t++)u.push(0,m*b,0),h.push(0,b,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=r;t++){const e=t/r*a+s,n=Math.cos(e),i=Math.sin(e);f.x=y*i,f.y=m*b,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,b,0),o.x=.5*n+.5,o.y=.5*i*b+.5,d.push(o.x,o.y),p++}for(let t=0;t<r;t++){const e=i+t,r=x+t;!0===n?l.push(r,r+1,e):l.push(r+1,r,e),v+=3}c.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new Lo,v=new Lo;let y=0;const b=(e-t)/n;for(let c=0;c<=i;c++){const l=[],g=c/i,y=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+s,c=Math.sin(i),f=Math.cos(i);v.x=y*c,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),o.set(c,b,f).normalize(),h.push(o.x,o.y,o.z),d.push(e,1-g),l.push(p++)}f.push(l)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=f[e][t],r=f[e+1][t],i=f[e+1][t+1],o=f[e][t+1];l.push(n,r,o),l.push(r,i,o),y+=6}c.addGroup(g,y,0),g+=y}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new Qd(u,3)),this.setAttribute("normal",new Qd(h,3)),this.setAttribute("uv",new Qd(d,2))}}class qI extends zd{constructor(t,e,n,r,i,o,s,a){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new WI(t,e,n,r,i,o,s,a)),this.mergeVertices()}}class XI extends qI{constructor(t,e,n,r,i,o,s){super(0,t,e,n,r,i,o,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}}class YI extends WI{constructor(t=1,e=1,n=8,r=1,i=!1,o=0,s=2*Math.PI){super(0,t,e,n,r,i,o,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}}class ZI extends dp{constructor(t,e,n=1,r=0){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r};const i=[],o=[];function s(t,e,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const s=t.clone().lerp(n,r/i),a=e.clone().lerp(n,r/i),c=i-r;for(let t=0;t<=c;t++)o[r][t]=0===t&&r===i?s:s.clone().lerp(a,t/c)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(o[t][n+1]),a(o[t+1][n]),a(o[t][n])):(a(o[t][n+1]),a(o[t+1][n+1]),a(o[t+1][n]))}}function a(t){i.push(t.x,t.y,t.z)}function c(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function l(t,e,n,r){r<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=r/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Lo,r=new Lo,i=new Lo;for(let o=0;o<e.length;o+=3)c(e[o+0],n),c(e[o+1],r),c(e[o+2],i),s(n,r,i,t)}(r),function(t){const e=new Lo;for(let n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){const t=new Lo;for(let n=0;n<i.length;n+=3){t.x=i[n+0],t.y=i[n+1],t.z=i[n+2];const r=u(t)/2/Math.PI+.5,s=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);o.push(r,1-s)}var e;(function(){const t=new Lo,e=new Lo,n=new Lo,r=new Lo,s=new gh,a=new gh,c=new gh;for(let h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),c.set(o[d+4],o[d+5]),r.copy(t).add(e).add(n).divideScalar(3);const p=u(r);l(s,d+0,t,p),l(a,d+2,e,p),l(c,d+4,n,p)}})(),function(){for(let t=0;t<o.length;t+=6){const e=o[t+0],n=o[t+2],r=o[t+4],i=Math.max(e,n,r),s=Math.min(e,n,r);i>.9&&s<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),r<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new Qd(i,3)),this.setAttribute("normal",new Qd(i.slice(),3)),this.setAttribute("uv",new Qd(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}}class JI extends ZI{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class $I extends zd{constructor(t,e){super(),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new JI(t,e)),this.mergeVertices()}}const KI=new Lo,QI=new Lo,tD=new Lo,eD=new Up;class nD extends dp{constructor(t,e){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,t.isGeometry&&(t=(new dp).fromGeometry(t));const n=Math.pow(10,4),r=Math.cos(Ao.DEG2RAD*e),i=t.getIndex(),o=t.getAttribute("position"),s=i?i.count:o.count,a=[0,0,0],c=["a","b","c"],l=new Array(3),u={},h=[];for(let t=0;t<s;t+=3){i?(a[0]=i.getX(t),a[1]=i.getX(t+1),a[2]=i.getX(t+2)):(a[0]=t,a[1]=t+1,a[2]=t+2);const{a:e,b:s,c:d}=eD;if(e.fromBufferAttribute(o,a[0]),s.fromBufferAttribute(o,a[1]),d.fromBufferAttribute(o,a[2]),eD.getNormal(tD),l[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,l[1]=`${Math.round(s.x*n)},${Math.round(s.y*n)},${Math.round(s.z*n)}`,l[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=l[t],i=l[e],o=eD[c[t]],s=eD[c[e]],d=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(tD.dot(u[p].normal)<=r&&(h.push(o.x,o.y,o.z),h.push(s.x,s.y,s.z)),u[p]=null):d in u||(u[d]={index0:a[t],index1:a[e],normal:tD.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];KI.fromBufferAttribute(o,e),QI.fromBufferAttribute(o,n),h.push(KI.x,KI.y,KI.z),h.push(QI.x,QI.y,QI.z)}this.setAttribute("position",new Qd(h,3))}}class rD extends ZI{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class iD extends zd{constructor(t,e){super(),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new rD(t,e)),this.mergeVertices()}}class oD extends dp{constructor(t,e=12,n=0,r=2*Math.PI){super(),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e),r=Ao.clamp(r,0,2*Math.PI);const i=[],o=[],s=[],a=1/e,c=new Lo,l=new gh;for(let i=0;i<=e;i++){const u=n+i*a*r,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=t.length-1;n++)c.x=t[n].x*h,c.y=t[n].y,c.z=t[n].x*d,o.push(c.x,c.y,c.z),l.x=i/e,l.y=n/(t.length-1),s.push(l.x,l.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const r=e+n*t.length,o=r,s=r+t.length,a=r+t.length+1,c=r+1;i.push(o,s,c),i.push(s,a,c)}if(this.setIndex(i),this.setAttribute("position",new Qd(o,3)),this.setAttribute("uv",new Qd(s,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new Lo,i=new Lo,o=new Lo,s=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[s+a+0],i.y=n[s+a+1],i.z=n[s+a+2],o.addVectors(r,i).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}}class sD extends zd{constructor(t,e,n,r){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new oD(t,e,n,r)),this.mergeVertices()}}class aD extends ZI{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class cD extends zd{constructor(t,e){super(),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new aD(t,e)),this.mergeVertices()}}function lD(t,e,n){dp.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],i=[],o=[],s=[],a=1e-5,c=new Lo,l=new Lo,u=new Lo,h=new Lo,d=new Lo;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=e;n++){const r=n/e;t(r,p,l),i.push(l.x,l.y,l.z),r-a>=0?(t(r-a,p,u),h.subVectors(l,u)):(t(r+a,p,u),h.subVectors(u,l)),p-a>=0?(t(r,p-a,u),d.subVectors(l,u)):(t(r,p+a,u),d.subVectors(u,l)),c.crossVectors(h,d).normalize(),o.push(c.x,c.y,c.z),s.push(r,p)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*p+n,i=t*p+n+1,o=(t+1)*p+n+1,s=(t+1)*p+n;r.push(e,i,s),r.push(i,o,s)}this.setIndex(r),this.setAttribute("position",new Qd(i,3)),this.setAttribute("normal",new Qd(o,3)),this.setAttribute("uv",new Qd(s,2))}function uD(t,e,n){zd.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new lD(t,e,n)),this.mergeVertices()}lD.prototype=Object.create(dp.prototype),lD.prototype.constructor=lD,uD.prototype=Object.create(zd.prototype),uD.prototype.constructor=uD;class hD extends zd{constructor(t,e,n,r){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new ZI(t,e,n,r)),this.mergeVertices()}}class dD extends dp{constructor(t=.5,e=1,n=8,r=1,i=0,o=2*Math.PI){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const s=[],a=[],c=[],l=[];let u=t;const h=(e-t)/(r=Math.max(1,r)),d=new Lo,p=new gh;for(let t=0;t<=r;t++){for(let t=0;t<=n;t++){const r=i+t/n*o;d.x=u*Math.cos(r),d.y=u*Math.sin(r),a.push(d.x,d.y,d.z),c.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,l.push(p.x,p.y)}u+=h}for(let t=0;t<r;t++){const e=t*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,o=r+n+1,a=r+n+2,c=r+1;s.push(i,o,c),s.push(o,a,c)}}this.setIndex(s),this.setAttribute("position",new Qd(a,3)),this.setAttribute("normal",new Qd(c,3)),this.setAttribute("uv",new Qd(l,2))}}class pD extends zd{constructor(t,e,n,r,i,o){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new dD(t,e,n,r,i,o)),this.mergeVertices()}}class fD extends ZI{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class mD extends zd{constructor(t,e){super(),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new fD(t,e)),this.mergeVertices()}}class gD extends cS{constructor(t,e={}){const n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new dp;const r=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(r,e),this.type="TextBufferGeometry"}}class vD extends zd{constructor(t,e){super(),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new gD(t,e)),this.mergeVertices()}}class yD extends dp{constructor(t=1,e=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],a=[],c=[],l=new Lo,u=new Lo,h=new Lo;for(let o=0;o<=n;o++)for(let d=0;d<=r;d++){const p=d/r*i,f=o/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(p),u.y=(t+e*Math.cos(f))*Math.sin(p),u.z=e*Math.sin(f),s.push(u.x,u.y,u.z),l.x=t*Math.cos(p),l.y=t*Math.sin(p),h.subVectors(u,l).normalize(),a.push(h.x,h.y,h.z),c.push(d/r),c.push(o/n)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,s=(r+1)*(t-1)+e,a=(r+1)*t+e;o.push(n,i,a),o.push(i,s,a)}this.setIndex(o),this.setAttribute("position",new Qd(s,3)),this.setAttribute("normal",new Qd(a,3)),this.setAttribute("uv",new Qd(c,2))}}class bD extends zd{constructor(t,e,n,r,i){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new yD(t,e,n,r,i)),this.mergeVertices()}}class xD extends dp{constructor(t=1,e=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],c=[],l=[],u=new Lo,h=new Lo,d=new Lo,p=new Lo,f=new Lo,m=new Lo,g=new Lo;for(let s=0;s<=n;++s){const y=s/n*i*Math.PI*2;v(y,i,o,t,d),v(y+.01,i,o,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=r;++t){const i=t/r*Math.PI*2,o=-e*Math.cos(i),p=e*Math.sin(i);u.x=d.x+(o*g.x+p*f.x),u.y=d.y+(o*g.y+p*f.y),u.z=d.z+(o*g.z+p*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),c.push(h.x,h.y,h.z),l.push(s/n),l.push(t/r)}}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),o=(r+1)*t+e,a=(r+1)*(t-1)+e;s.push(n,i,a),s.push(i,o,a)}function v(t,e,n,r,i){const o=Math.cos(t),s=Math.sin(t),a=n/e*t,c=Math.cos(a);i.x=r*(2+c)*.5*o,i.y=r*(2+c)*s*.5,i.z=r*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new Qd(a,3)),this.setAttribute("normal",new Qd(c,3)),this.setAttribute("uv",new Qd(l,2))}}class _D extends zd{constructor(t,e,n,r,i,o,s){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new xD(t,e,n,r,i,o)),this.mergeVertices()}}class wD extends dp{constructor(t,e=64,n=1,r=8,i=!1){super(),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const o=t.computeFrenetFrames(e,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Lo,a=new Lo,c=new gh;let l=new Lo;const u=[],h=[],d=[],p=[];function f(i){l=t.getPointAt(i/e,l);const c=o.normals[i],d=o.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),o=-Math.cos(e);a.x=o*c.x+i*d.x,a.y=o*c.y+i*d.y,a.z=o*c.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=l.x+n*a.x,s.y=l.y+n*a.y,s.z=l.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)c.x=t/e,c.y=n/r,d.push(c.x,c.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),o=(r+1)*t+e,s=(r+1)*(t-1)+e;p.push(n,i,s),p.push(i,o,s)}}()}(),this.setIndex(p),this.setAttribute("position",new Qd(u,3)),this.setAttribute("normal",new Qd(h,3)),this.setAttribute("uv",new Qd(d,2))}toJSON(){const t=dp.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class MD extends zd{constructor(t,e,n,r,i,o){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const s=new wD(t,e,n,r,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}}class ED extends dp{constructor(t){super(),this.type="WireframeGeometry";const e=[],n=[0,0],r={},i=["a","b","c"];if(t&&t.isGeometry){const o=t.faces;for(let t=0,e=o.length;t<e;t++){const e=o[t];for(let t=0;t<3;t++){const o=e[i[t]],s=e[i[(t+1)%3]];n[0]=Math.min(o,s),n[1]=Math.max(o,s);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const n in r){const i=r[n];let o=t.vertices[i.index1];e.push(o.x,o.y,o.z),o=t.vertices[i.index2],e.push(o.x,o.y,o.z)}}else if(t&&t.isBufferGeometry){const i=new Lo;if(null!==t.index){const o=t.attributes.position,s=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let t=0,e=a.length;t<e;++t){const e=a[t],i=e.start;for(let t=i,o=i+e.count;t<o;t+=3)for(let e=0;e<3;e++){const i=s.getX(t+e),o=s.getX(t+(e+1)%3);n[0]=Math.min(i,o),n[1]=Math.max(i,o);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const t in r){const n=r[t];i.fromBufferAttribute(o,n.index1),e.push(i.x,i.y,i.z),i.fromBufferAttribute(o,n.index2),e.push(i.x,i.y,i.z)}}else{const n=t.attributes.position;for(let t=0,r=n.count/3;t<r;t++)for(let r=0;r<3;r++){const o=3*t+r;i.fromBufferAttribute(n,o),e.push(i.x,i.y,i.z);const s=3*t+(r+1)%3;i.fromBufferAttribute(n,s),e.push(i.x,i.y,i.z)}}}this.setAttribute("position",new Qd(e,3))}}function SD(t){mh.call(this),this.type="ShadowMaterial",this.color=new Mh(0),this.transparent=!0,this.setValues(t)}function TD(t){mh.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Mh(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ku,this.normalScale=new gh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function AD(t){TD.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new gh(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Ao.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function RD(t){mh.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Mh(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ku,this.normalScale=new gh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function LD(t){mh.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ku,this.normalScale=new gh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function CD(t){mh.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Mh(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ku,this.normalScale=new gh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function PD(t){RI.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}SD.prototype=Object.create(mh.prototype),SD.prototype.constructor=SD,SD.prototype.isShadowMaterial=!0,SD.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this},TD.prototype=Object.create(mh.prototype),TD.prototype.constructor=TD,TD.prototype.isMeshStandardMaterial=!0,TD.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},AD.prototype=Object.create(TD.prototype),AD.prototype.constructor=AD,AD.prototype.isMeshPhysicalMaterial=!0,AD.prototype.copy=function(t){return TD.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Mh).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},RD.prototype=Object.create(mh.prototype),RD.prototype.constructor=RD,RD.prototype.isMeshToonMaterial=!0,RD.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},LD.prototype=Object.create(mh.prototype),LD.prototype.constructor=LD,LD.prototype.isMeshNormalMaterial=!0,LD.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},CD.prototype=Object.create(mh.prototype),CD.prototype.constructor=CD,CD.prototype.isMeshMatcapMaterial=!0,CD.prototype.copy=function(t){return mh.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},PD.prototype=Object.create(RI.prototype),PD.prototype.constructor=PD,PD.prototype.isLineDashedMaterial=!0,PD.prototype.copy=function(t){return RI.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};const OD={arraySlice:function(t,e,n){return OD.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*e;for(let n=0;n!==e;++n)i[s++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,o=t[0];for(;void 0!==o&&void 0===o[r];)o=t[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(e.push(o.time),n.push.apply(n,s)),o=t[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(e.push(o.time),s.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(e.push(o.time),n.push(s)),o=t[i++]}while(void 0!==o)},subclip:function(t,e,n,r,i=30){const o=t.clone();o.name=e;const s=[];for(let t=0;t<o.tracks.length;++t){const e=o.tracks[t],a=e.getValueSize(),c=[],l=[];for(let t=0;t<e.times.length;++t){const o=e.times[t]*i;if(!(o<n||o>=r)){c.push(e.times[t]);for(let n=0;n<a;++n)l.push(e.values[t*a+n])}}0!==c.length&&(e.times=OD.convertArray(c,e.times.constructor),e.values=OD.convertArray(l,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let t=0;t<o.tracks.length;++t)a>o.tracks[t].times[0]&&(a=o.tracks[t].times[0]);for(let t=0;t<o.tracks.length;++t)o.tracks[t].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,o=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const s=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===s)continue;let a=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const h=r.times.length-1;let d;if(o<=r.times[0]){const t=a,e=c-a;d=OD.arraySlice(r.values,t,e)}else if(o>=r.times[h]){const t=h*c+a,e=t+c-a;d=OD.arraySlice(r.values,t,e)}else{const t=r.createInterpolant(),e=a,n=c-a;t.evaluate(o),d=OD.arraySlice(t.resultBuffer,e,n)}if("quaternion"===i){(new Ro).fromArray(d).normalize().conjugate().toArray(d)}const p=s.times.length;for(let t=0;t<p;++t){const e=t*u+l;if("quaternion"===i)Ro.multiplyQuaternionsFlat(s.values,e,d,0,s.values,e);else{const t=u-2*l;for(let n=0;n<t;++n)s.values[e+n]-=d[n]}}}return t.blendMode=Su,t}};function ND(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function ID(t,e,n,r){ND.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function DD(t,e,n,r){ND.call(this,t,e,n,r)}function FD(t,e,n,r){ND.call(this,t,e,n,r)}function UD(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=OD.convertArray(e,this.TimeBufferType),this.values=OD.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function BD(t,e,n){UD.call(this,t,e,n)}function kD(t,e,n,r){UD.call(this,t,e,n,r)}function zD(t,e,n,r){UD.call(this,t,e,n,r)}function HD(t,e,n,r){ND.call(this,t,e,n,r)}function GD(t,e,n,r){UD.call(this,t,e,n,r)}function jD(t,e,n,r){UD.call(this,t,e,n,r)}function VD(t,e,n,r){UD.call(this,t,e,n,r)}function WD(t,e=-1,n,r=Eu){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=Ao.generateUUID(),this.duration<0&&this.resetDuration()}function qD(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return zD;case"vector":case"vector2":case"vector3":case"vector4":return VD;case"color":return kD;case"quaternion":return GD;case"bool":case"boolean":return BD;case"string":return jD}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];OD.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(ND.prototype,{evaluate:function(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let o;n:{r:if(!(t<r)){for(let o=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,r=e[++n],t<r)break e}o=e.length;break n}if(t>=i)break t;{const s=e[1];t<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break e}o=n,n=0}}for(;n<o;){const r=n+o>>>1;t<e[r]?o=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ND.prototype,{beforeStart_:ND.prototype.copySampleValue_,afterEnd_:ND.prototype.copySampleValue_}),ID.prototype=Object.assign(Object.create(ND.prototype),{constructor:ID,DefaultSettings_:{endingStart:_u,endingEnd:_u},intervalChanged_:function(t,e,n){const r=this.parameterPositions;let i=t-2,o=t+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case wu:i=t,s=2*e-n;break;case Mu:i=r.length-2,s=e+r[i]-r[i+1];break;default:i=t,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case wu:o=t,a=2*n-e;break;case Mu:o=1,a=n+r[1]-r[0];break;default:o=t-1,a=e}const c=.5*(n-e),l=this.valueSize;this._weightPrev=c/(e-s),this._weightNext=c/(a-n),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let t=0;t!==s;++t)i[t]=g*o[l+t]+v*o[c+t]+y*o[a+t]+b*o[u+t];return i}}),DD.prototype=Object.assign(Object.create(ND.prototype),{constructor:DD,interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=(n-e)/(r-e),u=1-l;for(let t=0;t!==s;++t)i[t]=o[c+t]*u+o[a+t]*l;return i}}),FD.prototype=Object.assign(Object.create(ND.prototype),{constructor:FD,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(UD,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:OD.convertArray(t.times,Array),values:OD.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(UD.prototype,{constructor:UD,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:bu,InterpolantFactoryMethodDiscrete:function(t){return new FD(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new DD(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new ID(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case yu:e=this.InterpolantFactoryMethodDiscrete;break;case bu:e=this.InterpolantFactoryMethodLinear;break;case xu:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return yu;case this.InterpolantFactoryMethodLinear:return bu;case this.InterpolantFactoryMethodSmooth:return xu}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const t=this.getValueSize();this.times=OD.arraySlice(n,i,o),this.values=OD.arraySlice(this.values,i*t,o*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,o),t=!1;break}o=r}if(void 0!==r&&OD.isTypedArray(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t},optimize:function(){const t=OD.arraySlice(this.times),e=OD.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===xu,i=t.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=t[s];if(a!==t[s+1]&&(1!==s||a!==a[0]))if(r)i=!0;else{const t=s*n,r=t-n,o=t+n;for(let s=0;s!==n;++s){const n=e[t+s];if(n!==e[r+s]||n!==e[o+s]){i=!0;break}}}if(i){if(s!==o){t[o]=t[s];const r=s*n,i=o*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++o}}if(i>0){t[o]=t[i];for(let t=i*n,r=o*n,s=0;s!==n;++s)e[r+s]=e[t+s];++o}return o!==t.length?(this.times=OD.arraySlice(t,0,o),this.values=OD.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this},clone:function(){const t=OD.arraySlice(this.times,0),e=OD.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),BD.prototype=Object.assign(Object.create(UD.prototype),{constructor:BD,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:yu,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),kD.prototype=Object.assign(Object.create(UD.prototype),{constructor:kD,ValueTypeName:"color"}),zD.prototype=Object.assign(Object.create(UD.prototype),{constructor:zD,ValueTypeName:"number"}),HD.prototype=Object.assign(Object.create(ND.prototype),{constructor:HD,interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-e)/(r-e);let c=t*s;for(let t=c+s;c!==t;c+=4)Ro.slerpFlat(i,0,o,c-s,o,c,a);return i}}),GD.prototype=Object.assign(Object.create(UD.prototype),{constructor:GD,ValueTypeName:"quaternion",DefaultInterpolation:bu,InterpolantFactoryMethodLinear:function(t){return new HD(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),jD.prototype=Object.assign(Object.create(UD.prototype),{constructor:jD,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:yu,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VD.prototype=Object.assign(Object.create(UD.prototype),{constructor:VD,ValueTypeName:"vector"}),Object.assign(WD,{parse:function(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(qD(n[t]).scale(r));const i=new WD(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i},toJSON:function(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(UD.toJSON(n[t]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){const i=e.length,o=[];for(let t=0;t<i;t++){let s=[],a=[];s.push((t+i-1)%i,t,(t+1)%i),a.push(0,1,0);const c=OD.getKeyframeOrder(s);s=OD.sortedArray(s,1,c),a=OD.sortedArray(a,1,c),r||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new zD(".morphTargetInfluences["+e[t].name+"]",s,a).scale(1/n))}return new WD(t,-1,o)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],o=n.name.match(i);if(o&&o.length>1){const t=o[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const o=[];for(const t in r)o.push(WD.CreateFromMorphTargetSequence(t,r[t],e,n));return o},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const o=[],s=[];OD.flattenJSON(n,o,s,r),0!==o.length&&i.push(new t(e,o,s))}},r=[],i=t.name||"default",o=t.fps||30,s=t.blendMode;let a=t.length||-1;const c=t.hierarchy||[];for(let t=0;t<c.length;t++){const i=c[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],o=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new zD(".morphTargetInfluence["+n+"]",t,o))}a=t.length*(o||1)}else{const o=".bones["+e[t].name+"]";n(VD,o+".position",i,"pos",r),n(GD,o+".quaternion",i,"rot",r),n(VD,o+".scale",i,"scl",r)}}if(0===r.length)return null;return new WD(i,a,r,s)}}),Object.assign(WD.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new WD(this.name,this.duration,t,this.blendMode)},toJSON:function(){return WD.toJSON(this)}});const XD={};function YD(t){OS.call(this,t)}function ZD(t){OS.call(this,t)}function JD(t){OS.call(this,t)}function $D(t){OS.call(this,t)}function KD(t){OS.call(this,t)}function QD(t,e,n){pN.call(this,t,n),this.type="HemisphereLight",this.position.copy(os.DefaultUp),this.updateMatrix(),this.groundColor=new Mh(e)}function tF(){bN.call(this,new bR(50,1,.5,500)),this.focus=1}function eF(t,e,n,r,i,o){pN.call(this,t,e),this.type="SpotLight",this.position.copy(os.DefaultUp),this.updateMatrix(),this.target=new os,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new tF}function nF(t,e,n,r){pN.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}YD.prototype=Object.assign(Object.create(OS.prototype),{constructor:YD,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=LS.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0!==XD[t])return void XD[t].push({onLoad:e,onProgress:n,onError:r});const s=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);r="blob"===o?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;r=e.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){e&&e(r),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{XD[t]=[],XD[t].push({onLoad:e,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const n=this.response,r=XD[t];if(delete XD[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),LS.add(t,n);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onLoad&&e.onLoad(n)}i.manager.itemEnd(t)}else{for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const n=XD[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onProgress&&r.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const n=XD[t];delete XD[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const n=XD[t];delete XD[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return i.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),ZD.prototype=Object.assign(Object.create(OS.prototype),{constructor:ZD,load:function(t,e,n,r){const i=this,o=new YD(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const r=WD.parse(t[n]);e.push(r)}return e}}),JD.prototype=Object.assign(Object.create(OS.prototype),{constructor:JD,load:function(t,e,n,r){const i=this,o=[],s=new zI,a=new YD(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let c=0;function l(l){a.load(t[l],(function(t){const n=i.parse(t,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(s.minFilter=Kc),s.image=o,s.format=n.format,s.needsUpdate=!0,e&&e(s))}),n,r)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)l(e);else a.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){o[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)o[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),o[e].format=n.format,o[e].width=n.width,o[e].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=Kc),s.format=n.format,s.needsUpdate=!0,e&&e(s)}),n,r);return s}}),$D.prototype=Object.assign(Object.create(OS.prototype),{constructor:$D,load:function(t,e,n,r){const i=new JR,o=new NS(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(t[n],(function(t){i.images[n]=t,s++,6===s&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return i}}),KD.prototype=Object.assign(Object.create(OS.prototype),{constructor:KD,load:function(t,e,n,r){const i=this,o=new IR,s=new YD(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(t,(function(t){const n=i.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:Wc,o.wrapT=void 0!==n.wrapT?n.wrapT:Wc,o.magFilter=void 0!==n.magFilter?n.magFilter:Kc,o.minFilter=void 0!==n.minFilter?n.minFilter:Kc,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=el),1===n.mipmapCount&&(o.minFilter=Kc),o.needsUpdate=!0,e&&e(o,n))}),n,r),o}}),QD.prototype=Object.assign(Object.create(pN.prototype),{constructor:QD,isHemisphereLight:!0,copy:function(t){return pN.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),tF.prototype=Object.assign(Object.create(bN.prototype),{constructor:tF,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*Ao.RAD2DEG*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),bN.prototype.updateMatrices.call(this,t)}}),eF.prototype=Object.assign(Object.create(pN.prototype),{constructor:eF,isSpotLight:!0,copy:function(t){return pN.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),nF.prototype=Object.assign(Object.create(pN.prototype),{constructor:nF,isRectAreaLight:!0,copy:function(t){return pN.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=pN.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});class rF{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Lo)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}function iF(t,e){pN.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new rF}function oF(t){OS.call(this,t),this.textures={}}iF.prototype=Object.assign(Object.create(pN.prototype),{constructor:iF,isLightProbe:!0,copy:function(t){return pN.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=pN.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),oF.prototype=Object.assign(Object.create(OS.prototype),{constructor:oF,load:function(t,e,n,r){const i=this,o=new YD(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new a[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new Mh).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(r.uniforms[e]={},i.type){case"t":r.uniforms[e].value=n(i.value);break;case"c":r.uniforms[e].value=(new Mh).setHex(i.value);break;case"v2":r.uniforms[e].value=(new gh).fromArray(i.value);break;case"v3":r.uniforms[e].value=(new Lo).fromArray(i.value);break;case"v4":r.uniforms[e].value=(new Hd).fromArray(i.value);break;case"m3":r.uniforms[e].value=(new Wo).fromArray(i.value);break;case"m4":r.uniforms[e].value=(new Oo).fromArray(i.value);break;default:r.uniforms[e].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new gh).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new gh).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r},setTextures:function(t){return this.textures=t,this}});const sF={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function aF(){dp.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function cF(t,e,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Vd.call(this,t,e,n),this.meshPerAttribute=r||1}function lF(t){OS.call(this,t)}aF.prototype=Object.assign(Object.create(dp.prototype),{constructor:aF,isInstancedBufferGeometry:!0,copy:function(t){return dp.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=dp.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),cF.prototype=Object.assign(Object.create(Vd.prototype),{constructor:cF,isInstancedBufferAttribute:!0,copy:function(t){return Vd.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=Vd.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),lF.prototype=Object.assign(Object.create(OS.prototype),{constructor:lF,load:function(t,e,n,r){const i=this,o=new YD(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const i=t.interleavedBuffers[r],o=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),s=new WN(ip(i.type,o),i.stride);return s.uuid=i.uuid,e[r]=s,s}const i=t.isInstancedBufferGeometry?new aF:new dp,o=t.data.index;if(void 0!==o){const t=ip(o.type,o.array);i.setIndex(new Vd(t,1))}const s=t.data.attributes;for(const e in s){const n=s[e];let o;if(n.isInterleavedBufferAttribute){o=new XN(r(t.data,n.data),n.itemSize,n.offset,n.normalized)}else{const t=ip(n.type,n.array);o=new(n.isInstancedBufferAttribute?cF:Vd)(t,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),i.setAttribute(e,o)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],o=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];let s;if(i.isInterleavedBufferAttribute){s=new XN(r(t.data,i.data),i.itemSize,i.offset,i.normalized)}else{s=new Vd(ip(i.type,i.array),i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[e]=o}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let t=0,e=c.length;t!==e;++t){const e=c[t];i.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;if(void 0!==l){const t=new Lo;void 0!==l.center&&t.fromArray(l.center),i.boundingSphere=new Dd(t,l.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}});class uF extends OS{constructor(t){super(t)}load(t,e,n,r){const i=this,o=""===this.path?sF.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const s=new YD(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){let o=null;try{o=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)}parse(t,e){const n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),o=this.parseImages(t.images,(function(){void 0!==e&&e(c)})),s=this.parseTextures(t.textures,o),a=this.parseMaterials(t.materials,s),c=this.parseObject(t.object,i,a,n),l=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,l),void 0!==e){let t=!1;for(const e in o)if(o[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(c)}return c}parseShapes(t){const e={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=(new NE).fromJSON(t[n]);e[r.uuid]=r}return e}parseSkeletons(t,e){const n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let e=0,i=t.length;e<i;e++){const i=(new wI).fromJSON(t[e],r);n[i.uuid]=i}return n}parseGeometries(t,e){const n={};let r;if(void 0!==t){const i=new lF;for(let a=0,c=t.length;a<c;a++){let c;const l=t[a];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":c=new s[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":c=new s[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":c=new s[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":c=new s[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":c=new s[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":c=new s[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":c=new s[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":c=new s[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":c=new s[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":c=new s[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"TubeGeometry":case"TubeBufferGeometry":c=new s[l.type]((new o[l.path.type]).fromJSON(l.path),l.tubularSegments,l.radius,l.radialSegments,l.closed);break;case"LatheGeometry":case"LatheBufferGeometry":c=new s[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":c=new s[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":r=[];for(let t=0,n=l.shapes.length;t<n;t++){const n=e[l.shapes[t]];r.push(n)}c=new s[l.type](r,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":r=[];for(let t=0,n=l.shapes.length;t<n;t++){const n=e[l.shapes[t]];r.push(n)}const t=l.options.extrudePath;void 0!==t&&(l.options.extrudePath=(new o[t.type]).fromJSON(t)),c=new s[l.type](r,l.options);break;case"BufferGeometry":case"InstancedBufferGeometry":c=i.parse(l);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}c.uuid=l.uuid,void 0!==l.name&&(c.name=l.name),!0===c.isBufferGeometry&&void 0!==l.userData&&(c.userData=l.userData),n[l.uuid]=c}}return n}parseMaterials(t,e){const n={},r={};if(void 0!==t){const i=new oF;i.setTextures(e);for(let e=0,o=t.length;e<o;e++){const o=t[e];if("MultiMaterial"===o.type){const t=[];for(let e=0;e<o.materials.length;e++){const r=o.materials[e];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),t.push(n[r.uuid])}r[o.uuid]=t}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const r=t[n],i=WD.parse(r);e[i.uuid]=i}return e}parseImages(t,e){const n=this,r={};let i;function o(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),i.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:ip(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new CS(e);i=new NS(n),i.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let t=0,e=i.length;t<e;t++){const e=o(i[t]);null!==e&&(e instanceof HTMLImageElement?r[n.uuid].push(e):r[n.uuid].push(new IR(e.data,e.width,e.height)))}}else{const t=o(n.url);null!==t&&(r[n.uuid]=t)}}}return r}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,o=t.length;i<o;i++){const o=t[i];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===e[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=e[o.image];Array.isArray(a)?(s=new JR(a),6===a.length&&(s.needsUpdate=!0)):(s=a&&a.data?new IR(a.data,a.width,a.height):new US(a),a&&(s.needsUpdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,hF)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],dF),s.wrapT=n(o.wrap[1],dF)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,pF)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,pF)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),r[o.uuid]=s}return r}parseObject(t,e,n,r){let i,o,s;function a(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(n[i])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new wA,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new Mh(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new OR(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new NR(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new bR(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new YC(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new vN(t.color,t.intensity);break;case"DirectionalLight":i=new TN(t.color,t.intensity);break;case"PointLight":i=new _N(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new nF(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new eF(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new QD(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new iF).fromJSON(t);break;case"SkinnedMesh":o=a(t.geometry),s=c(t.material),i=new yI(o,s),void 0!==t.bindMode&&(i.bindMode=t.bindMode),void 0!==t.bindMatrix&&i.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(i.skeleton=t.skeleton);break;case"Mesh":o=a(t.geometry),s=c(t.material),i=new nf(o,s);break;case"InstancedMesh":o=a(t.geometry),s=c(t.material);const e=t.count,n=t.instanceMatrix;i=new AI(o,s,e),i.instanceMatrix=new Vd(new Float32Array(n.array),16);break;case"LOD":i=new dI;break;case"Line":i=new II(a(t.geometry),c(t.material));break;case"LineLoop":i=new BI(a(t.geometry),c(t.material));break;case"LineSegments":i=new UI(a(t.geometry),c(t.material));break;case"PointCloud":case"Points":i=new ff(a(t.geometry),c(t.material));break;case"Sprite":i=new cI(c(t.material));break;case"Group":i=new jC;break;case"Bone":i=new bI;break;default:i=new os}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)i.add(this.parseObject(o[t],e,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];i.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const hF={UVMapping:Uc,CubeReflectionMapping:Bc,CubeRefractionMapping:kc,EquirectangularReflectionMapping:zc,EquirectangularRefractionMapping:Hc,CubeUVReflectionMapping:Gc,CubeUVRefractionMapping:jc},dF={RepeatWrapping:Vc,ClampToEdgeWrapping:Wc,MirroredRepeatWrapping:qc},pF={NearestFilter:Xc,NearestMipmapNearestFilter:Yc,NearestMipmapLinearFilter:Jc,LinearFilter:Kc,LinearMipmapNearestFilter:Qc,LinearMipmapLinearFilter:el};function fF(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),OS.call(this,t),this.options={premultiplyAlpha:"none"}}function mF(){this.type="ShapePath",this.color=new Mh,this.subPaths=[],this.currentPath=null}function gF(t){this.type="Font",this.data=t}function vF(t,e,n,r,i){const o=i.glyphs[t]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");const s=new mF;let a,c,l,u,h,d,p,f;if(o.o){const t=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=t.length;i<o;){switch(t[i++]){case"m":a=t[i++]*e+n,c=t[i++]*e+r,s.moveTo(a,c);break;case"l":a=t[i++]*e+n,c=t[i++]*e+r,s.lineTo(a,c);break;case"q":l=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,s.quadraticCurveTo(h,d,l,u);break;case"b":l=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,p=t[i++]*e+n,f=t[i++]*e+r,s.bezierCurveTo(h,d,p,f,l,u)}}}return{offsetX:o.ha*e,path:s}}function yF(t){OS.call(this,t)}let bF;fF.prototype=Object.assign(Object.create(OS.prototype),{constructor:fF,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=LS.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,s).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,i.options)})).then((function(n){LS.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(mF.prototype,{moveTo:function(t,e){return this.currentPath=new OE,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new NE;i.curves=r.curves,e.push(i)}return e}function r(t,e){const n=e.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=e[i],s=e[o],a=s.x-n.x,c=s.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=e[o],a=-a,s=e[i],c=-c),t.y<n.y||t.y>s.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=c*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(s.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=s.x)return!0}}return r}const i=oS.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);let s,a,c;const l=[];if(1===o.length)return a=o[0],c=new NE,c.curves=a.curves,l.push(c),l;let u=!i(o[0].getPoints());u=t?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,n=o.length;e<n;e++)a=o[e],p=a.getPoints(),s=i(p),s=t?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new NE,p:p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)h[t]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<d.length;i++)r(s.p,d[i].p)&&(n!==i&&e.push({froms:n,tos:i,hole:o}),a?(a=!1,h[i].push(s)):t=!0);a&&h[n].push(s)}}e.length>0&&(t||(m=h))}for(let t=0,e=d.length;t<e;t++){c=d[t].s,l.push(c),f=m[t];for(let t=0,e=f.length;t<e;t++)c.holes.push(f[t].h)}return l}}),Object.assign(gF.prototype,{isFont:!0,generateShapes:function(t,e=100){const n=[],r=function(t,e,n){const r=Array.from?Array.from(t):String(t).split(""),i=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[];let a=0,c=0;for(let t=0;t<r.length;t++){const e=r[t];if("\n"===e)a=0,c-=o;else{const t=vF(e,i,a,c,n);a+=t.offsetX,s.push(t.path)}}return s}(t,e,this.data);for(let t=0,e=r.length;t<e;t++)Array.prototype.push.apply(n,r[t].toShapes());return n}}),yF.prototype=Object.assign(Object.create(OS.prototype),{constructor:yF,load:function(t,e,n,r){const i=this,o=new YD(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const r=i.parse(n);e&&e(r)}),n,r)},parse:function(t){return new gF(t)}});const xF={getContext:function(){return void 0===bF&&(bF=new(window.AudioContext||window.webkitAudioContext)),bF},setContext:function(t){bF=t}};function _F(t){OS.call(this,t)}function wF(t,e,n){iF.call(this,void 0,n);const r=(new Mh).set(t),i=(new Mh).set(e),o=new Lo(r.r,r.g,r.b),s=new Lo(i.r,i.g,i.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}function MF(t,e){iF.call(this,void 0,e);const n=(new Mh).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}_F.prototype=Object.assign(Object.create(OS.prototype),{constructor:_F,load:function(t,e,n,r){const i=this,o=new YD(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{const t=n.slice(0);xF.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}}),wF.prototype=Object.assign(Object.create(iF.prototype),{constructor:wF,isHemisphereLightProbe:!0,copy:function(t){return iF.prototype.copy.call(this,t),this},toJSON:function(t){return iF.prototype.toJSON.call(this,t)}}),MF.prototype=Object.assign(Object.create(iF.prototype),{constructor:MF,isAmbientLightProbe:!0,copy:function(t){return iF.prototype.copy.call(this,t),this},toJSON:function(t){return iF.prototype.toJSON.call(this,t)}});const EF=new Oo,SF=new Oo;function TF(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new bR,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new bR,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(TF.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,o=e.near*Math.tan(Ao.DEG2RAD*e.fov*.5)/e.zoom;let s,a;SF.elements[12]=-r,EF.elements[12]=r,s=-o*e.aspect+i,a=o*e.aspect+i,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*e.aspect-i,a=o*e.aspect-i,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(SF),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(EF)}});class AF{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=RF(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=RF();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function RF(){return("undefined"==typeof performance?Date:performance).now()}const LF=new Lo,CF=new Ro,PF=new Lo,OF=new Lo;class NF extends os{constructor(){super(),this.type="AudioListener",this.context=xF.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new AF}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(LF,CF,PF),OF.set(0,0,-1).applyQuaternion(CF),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(LF.x,t),e.positionY.linearRampToValueAtTime(LF.y,t),e.positionZ.linearRampToValueAtTime(LF.z,t),e.forwardX.linearRampToValueAtTime(OF.x,t),e.forwardY.linearRampToValueAtTime(OF.y,t),e.forwardZ.linearRampToValueAtTime(OF.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(LF.x,LF.y,LF.z),e.setOrientation(OF.x,OF.y,OF.z,n.x,n.y,n.z)}}class IF extends os{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const DF=new Lo,FF=new Ro,UF=new Lo,BF=new Lo;class kF extends IF{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(DF,FF,UF),BF.set(0,0,1).applyQuaternion(FF);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(DF.x,t),e.positionY.linearRampToValueAtTime(DF.y,t),e.positionZ.linearRampToValueAtTime(DF.z,t),e.orientationX.linearRampToValueAtTime(BF.x,t),e.orientationY.linearRampToValueAtTime(BF.y,t),e.orientationZ.linearRampToValueAtTime(BF.z,t)}else e.setPosition(DF.x,DF.y,DF.z),e.setOrientation(BF.x,BF.y,BF.z)}}class zF{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}function HF(t,e,n){let r,i,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(HF.prototype,{accumulate:function(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==r;++t)n[i+t]=n[t];o=e}else{o+=e;const t=e/o;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=o},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){s.setValue(n,r);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]},_slerp:function(t,e,n,r){Ro.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,i){const o=this._workIndex*i;Ro.multiplyQuaternionsFlat(t,o,t,e,t,n),Ro.slerpFlat(t,e,t,e,t,o,r)},_lerp:function(t,e,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=e+s;t[i]=t[i]*o+t[n+s]*r}},_lerpAdditive:function(t,e,n,r,i){for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]+t[n+o]*r}}});const GF=new RegExp("[\\[\\]\\.:\\/]","g"),jF="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",VF=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),WF=/(WCOD+)?/.source.replace("WCOD",jF),qF=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),XF=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),YF=new RegExp("^"+VF+WF+qF+XF+"$"),ZF=["material","materials","bones"];function JF(t,e,n){const r=n||$F.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function $F(t,e,n){this.path=e,this.parsedPath=n||$F.parseTrackName(e),this.node=$F.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function KF(){this.uuid=Ao.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(JF.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign($F,{Composite:JF,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new $F.Composite(t,e,n):new $F(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(GF,"")},parseTrackName:function(t){const e=YF.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==ZF.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const o=n(i.children);if(o)return o}return null},r=n(t.children);if(r)return r}return null}}),Object.assign($F.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=$F.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const o=t[r];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let s=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign($F.prototype,{_getValue_unbound:$F.prototype.getValue,_setValue_unbound:$F.prototype.setValue}),Object.assign(KF.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s=void 0,a=t.length,c=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const u=arguments[l],h=u.uuid;let d=e[h];if(void 0===d){d=a++,e[h]=d,t.push(u);for(let t=0,e=o;t!==e;++t)i[t].push(new $F(u,n[t],r[t]))}else if(d<c){s=t[d];const a=--c,l=t[a];e[l.uuid]=d,t[d]=l,e[h]=a,t[a]=u;for(let t=0,e=o;t!==e;++t){const e=i[t],o=e[a];let s=e[d];e[d]=o,void 0===s&&(s=new $F(u,n[t],r[t])),e[a]=s}}else t[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=e[a];if(void 0!==c&&c>=i){const o=i++,l=t[o];e[l.uuid]=c,t[c]=l,e[a]=o,t[o]=s;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[c];e[c]=r,e[o]=i}}}this.nCachedObjects_=i},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=t.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=e[a];if(void 0!==c)if(delete e[a],c<i){const s=--i,a=t[s],l=--o,u=t[l];e[a.uuid]=c,t[c]=a,e[u.uuid]=s,t[s]=u,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[s],i=e[l];e[c]=r,e[s]=i,e.pop()}}else{const i=--o,s=t[i];i>0&&(e[s.uuid]=c),t[c]=s,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[c]=e[i],e.pop()}}}this.nCachedObjects_=i},subscribe_:function(t,e){const n=this._bindingsIndicesByPath;let r=n[t];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,u=new Array(c);r=i.length,n[t]=r,o.push(t),s.push(e),i.push(u);for(let n=l,r=a.length;n!==r;++n){const r=a[n];u[n]=new $F(r,t,e)}return u},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];e[t[s]]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}});class QF{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,o=i.length,s=new Array(o),a={endingStart:_u,endingEnd:_u};for(let t=0;t!==o;++t){const e=i[t].createInterpolant(null);s[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=gu,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,o=n/r;t.warp(1,i,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+n,c[0]=t/o,c[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const o=this._updateTime(e),s=this._updateWeight(t);if(s>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case Su:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulateAdditive(s);break;case Eu:default:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulate(r,s)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const o=n===vu;if(0===t)return-1===i?r:o&&1==(1&i)?e-r:r;if(n===mu){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=wu,r.endingEnd=wu):(r.endingStart=t?this.zeroSlopeAtStart?wu:_u:Mu,r.endingEnd=e?this.zeroSlopeAtEnd?wu:_u:Mu)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=e,s[1]=i+t,a[1]=n,this}}function tU(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}tU.prototype=Object.assign(Object.create(zo.prototype),{constructor:tU,_bindAction:function(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,s=t._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let t=0;t!==i;++t){const i=r[t],c=i.name;let u=l[c];if(void 0!==u)o[t]=u;else{if(u=o[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,c));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;u=new HF($F.create(n,c,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,c),o[t]=u}s[t].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const r=this._actions,i=this._actionsByClip;let o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,c=a[a.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),t._byClipCacheIndex=null;delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new DD(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const r=e||this._root,i=r.uuid;let o="string"==typeof t?WD.findByName(r,t):t;const s=null!==o?o.uuid:t,a=this._actionsByClip[s];let c=null;if(void 0===n&&(n=null!==o?o.blendMode:Eu),void 0!==a){const t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const l=new QF(this,o,e,n);return this._bindAction(l,c),this._addInactiveAction(l,s,i),l},existingAction:function(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?WD.findByName(n,t):t,o=i?i.uuid:t,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1;for(let s=0;s!==n;++s){e[s]._update(r,t,i,o)}const s=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)s[t].apply(o);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,o=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,e[i]=o,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class eU{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new eU(void 0===this.value.clone?this.value:this.value.clone())}}function nU(t,e,n){WN.call(this,t,e),this.meshPerAttribute=n||1}function rU(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function iU(t,e,n,r){this.ray=new wp(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new Vo,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function oU(t,e){return t.distance-e.distance}function sU(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)sU(r[t],e,n,!0)}}nU.prototype=Object.assign(Object.create(WN.prototype),{constructor:nU,isInstancedInterleavedBuffer:!0,copy:function(t){return WN.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=WN.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=WN.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(rU.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(rU.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(iU.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(t,e,n){const r=n||[];return sU(t,this,r,e),r.sort(oU),r},intersectObjects:function(t,e,n){const r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=t.length;n<i;n++)sU(t[n],this,r,e);return r.sort(oU),r}});class aU{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Ao.clamp(e/this.radius,-1,1))),this}}class cU{constructor(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}}const lU=new gh;class uU{constructor(t,e){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new gh(1/0,1/0),this.max=void 0!==e?e:new gh(-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=lU.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new gh),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new gh),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new gh),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new gh),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return lU.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const hU=new Lo,dU=new Lo;class pU{constructor(t,e){this.start=void 0!==t?t:new Lo,this.end=void 0!==e?e:new Lo}set(t,e){return this.start.copy(t),this.end.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Lo),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Lo),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Lo),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){hU.subVectors(t,this.start),dU.subVectors(this.end,this.start);const n=dU.dot(dU);let r=dU.dot(hU)/n;return e&&(r=Ao.clamp(r,0,1)),r}closestPointToPoint(t,e,n){const r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Lo),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function fU(t){os.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}fU.prototype=Object.create(os.prototype),fU.prototype.constructor=fU,fU.prototype.isImmediateRenderObject=!0;const mU=new Lo;class gU extends os{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new dp,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const i=t/n*Math.PI*2,o=e/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new Qd(r,3));const i=new RI({fog:!1,toneMapped:!1});this.cone=new UI(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),mU.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(mU),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const vU=new Lo,yU=new Oo,bU=new Oo;class xU extends UI{constructor(t){const e=function t(e){const n=[];e&&e.isBone&&n.push(e);for(let r=0;r<e.children.length;r++)n.push.apply(n,t(e.children[r]));return n}(t),n=new dp,r=[],i=[],o=new Mh(0,0,1),s=new Mh(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new Qd(r,3)),n.setAttribute("color",new Qd(i,3));super(n,new RI({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");bU.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(yU.multiplyMatrices(bU,i.matrixWorld),vU.setFromMatrixPosition(yU),r.setXYZ(n,vU.x,vU.y,vU.z),yU.multiplyMatrices(bU,i.parent.matrixWorld),vU.setFromMatrixPosition(yU),r.setXYZ(n+1,vU.x,vU.y,vU.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}class _U extends nf{constructor(t,e,n){super(new xS(e,4,2),new Bp({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const wU=new Lo,MU=new Mh,EU=new Mh;class SU extends os{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new aD(e);r.rotateY(.5*Math.PI),this.material=new Bp({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new Vd(o,3)),this.add(new nf(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");MU.copy(this.light.color),EU.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const r=t<n/2?MU:EU;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(wU.setFromMatrixPosition(this.light.matrixWorld).negate())}}class TU extends UI{constructor(t=10,e=10,n=4473924,r=8947848){n=new Mh(n),r=new Mh(r);const i=e/2,o=t/e,s=t/2,a=[],c=[];for(let t=0,l=0,u=-s;t<=e;t++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const e=t===i?n:r;e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3}const l=new dp;l.setAttribute("position",new Qd(a,3)),l.setAttribute("color",new Qd(c,3));super(l,new RI({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class AU extends UI{constructor(t=10,e=16,n=8,r=64,i=4473924,o=8947848){i=new Mh(i),o=new Mh(o);const s=[],a=[];for(let n=0;n<=e;n++){const r=n/e*(2*Math.PI),c=Math.sin(r)*t,l=Math.cos(r)*t;s.push(0,0,0),s.push(c,0,l);const u=1&n?i:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let e=0;e<=n;e++){const c=1&e?i:o,l=t-t/n*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),n=Math.sin(e)*l,i=Math.cos(e)*l;s.push(n,0,i),a.push(c.r,c.g,c.b),e=(t+1)/r*(2*Math.PI),n=Math.sin(e)*l,i=Math.cos(e)*l,s.push(n,0,i),a.push(c.r,c.g,c.b)}}const c=new dp;c.setAttribute("position",new Qd(s,3)),c.setAttribute("color",new Qd(a,3));super(c,new RI({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const RU=new Lo,LU=new Lo,CU=new Lo;class PU extends os{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let r=new dp;r.setAttribute("position",new Qd([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new RI({fog:!1,toneMapped:!1});this.lightPlane=new II(r,i),this.add(this.lightPlane),r=new dp,r.setAttribute("position",new Qd([0,0,0,0,0,1],3)),this.targetLine=new II(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){RU.setFromMatrixPosition(this.light.matrixWorld),LU.setFromMatrixPosition(this.light.target.matrixWorld),CU.subVectors(LU,RU),this.lightPlane.lookAt(LU),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(LU),this.targetLine.scale.z=CU.length()}}const OU=new Lo,NU=new yR;class IU extends UI{constructor(t){const e=new dp,n=new RI({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},s=new Mh(16755200),a=new Mh(16711680),c=new Mh(43775),l=new Mh(16777215),u=new Mh(3355443);function h(t,e,n){d(t,n),d(e,n)}function d(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(r.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",l),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.setAttribute("position",new Qd(r,3)),e.setAttribute("color",new Qd(i,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const t=this.geometry,e=this.pointMap;NU.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),DU("c",e,t,NU,0,0,-1),DU("t",e,t,NU,0,0,1),DU("n1",e,t,NU,-1,-1,-1),DU("n2",e,t,NU,1,-1,-1),DU("n3",e,t,NU,-1,1,-1),DU("n4",e,t,NU,1,1,-1),DU("f1",e,t,NU,-1,-1,1),DU("f2",e,t,NU,1,-1,1),DU("f3",e,t,NU,-1,1,1),DU("f4",e,t,NU,1,1,1),DU("u1",e,t,NU,.7,1.1,-1),DU("u2",e,t,NU,-.7,1.1,-1),DU("u3",e,t,NU,0,2,-1),DU("cf1",e,t,NU,-1,0,1),DU("cf2",e,t,NU,1,0,1),DU("cf3",e,t,NU,0,-1,1),DU("cf4",e,t,NU,0,1,1),DU("cn1",e,t,NU,-1,0,-1),DU("cn2",e,t,NU,1,0,-1),DU("cn3",e,t,NU,0,-1,-1),DU("cn4",e,t,NU,0,1,-1),t.getAttribute("position").needsUpdate=!0}}function DU(t,e,n,r,i,o,s){OU.set(i,o,s).unproject(r);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],OU.x,OU.y,OU.z)}}const FU=new bd;class UU extends UI{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new dp;i.setIndex(new Vd(n,1)),i.setAttribute("position",new Vd(r,3)),super(i,new RI({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&FU.setFromObject(this.object),FU.isEmpty())return;const e=FU.min,n=FU.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return UI.prototype.copy.call(this,t),this.object=t.object,this}}class BU extends UI{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new dp;r.setIndex(new Vd(n,1)),r.setAttribute("position",new Qd([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new RI({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class kU extends II{constructor(t,e=1,n=16776960){const r=n,i=new dp;i.setAttribute("position",new Qd([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new RI({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const o=new dp;o.setAttribute("position",new Qd([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new nf(o,new Bp({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?Ya:Xa,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const zU=new Lo;let HU,GU;class jU extends os{constructor(t,e,n,r,i,o){super(),this.type="ArrowHelper",void 0===t&&(t=new Lo(0,0,1)),void 0===e&&(e=new Lo(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===HU&&(HU=new dp,HU.setAttribute("position",new Qd([0,0,0,0,1,0],3)),GU=new WI(0,.5,1,5,1),GU.translate(0,-.5,0)),this.position.copy(e),this.line=new II(HU,new RI({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new nf(GU,new Bp({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,o)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{zU.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(zU,e)}}setLength(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class VU extends UI{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new dp;n.setAttribute("position",new Qd(e,3)),n.setAttribute("color",new Qd([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new RI({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const WU=new Float32Array(1),qU=new Int32Array(WU.buffer),XU={toHalfFloat:function(t){WU[0]=t;const e=qU[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}};function YU(t,e,n,r,i,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new yd(t,e,n,i,o,s)}const ZU=0,JU=1,$U=0,KU=1,QU=2;function tB(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function eB(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function nB(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new ff(t,e)}function rB(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new cI(t)}function iB(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new ff(t,e)}function oB(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new lf(t)}function sB(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new lf(t)}function aB(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new lf(t)}function cB(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Lo(t,e,n)}function lB(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Vd(t,e).setUsage(ih)}function uB(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Wd(t,e)}function hB(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new qd(t,e)}function dB(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Xd(t,e)}function pB(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Yd(t,e)}function fB(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Zd(t,e)}function mB(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Jd(t,e)}function gB(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new $d(t,e)}function vB(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Qd(t,e)}function yB(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new tp(t,e)}function bB(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xE.call(this,t),this.type="catmullrom",this.closed=!0}function xB(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xE.call(this,t),this.type="catmullrom"}function _B(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),xE.call(this,t),this.type="catmullrom"}function wB(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new VU(t)}function MB(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new UU(t,e)}function EB(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new UI(new nD(t.geometry),new RI({color:void 0!==e?e:16777215}))}function SB(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new UI(new ED(t.geometry),new RI({color:void 0!==e?e:16777215}))}function TB(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new YD(t)}function AB(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new KD(t)}function RB(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new $R(t,n)}dE.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(dE.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(PE.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new zd;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.vertices.push(new Lo(r.x,r.y,r.z||0))}return e}}),Object.assign(OE.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),bB.prototype=Object.create(xE.prototype),xB.prototype=Object.create(xE.prototype),_B.prototype=Object.create(xE.prototype),Object.assign(_B.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),TU.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},xU.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(OS.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),sF.extractUrlBase(t)}}),OS.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(uU.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(bd.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Dd.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),UR.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},pU.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Ao,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Ao.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Ao.ceilPowerOfTwo(t)}}),Object.assign(Wo.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(Oo.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Lo).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Tp.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Object.assign(Ro.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(wp.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Up.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Up,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Up.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Up.getNormal(t,e,n,r)}}),Object.assign(NE.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new uS(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new dS(this,t)}}),Object.assign(gh.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Lo.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Hd.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(zd.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(os.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(os.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(nf.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(nf.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Tu},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(dI.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(wI.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),yI.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(dE.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),bR.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(pN.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Vd.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===ih},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(ih)}}}),Object.assign(Vd.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?ih:rh),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(dp.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Vd(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(dp.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(aF.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(iU.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(WN.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===ih},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(WN.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?ih:rh),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(cS.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(wA.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(eU.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(mh.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Mh}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===Ja}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Eh.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(AD.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(rT.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(XC.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(XC.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Cu:Lu}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(BC.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(YR.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(IF.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new _F).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),zF.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ZR.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},ZR.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)};const LB={merge:function(t,e,n){let r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function CB(){console.error("THREE.CanvasRenderer has been removed")}function PB(){console.error("THREE.JSONLoader has been removed.")}DS.crossOrigin=void 0,DS.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new kS;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},DS.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new $D;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},DS.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},DS.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const OB={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function NB(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Fa}}));var IB=function(t,e){var n,r,i,o,s,a;void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new Qf,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Pf,MIDDLE:Of,RIGHT:Nf},this.touches={ONE:If,TWO:Ff},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(l),c.update(),p=d.NONE},this.update=(n=new Qf,r=(new Kf).setFromUnitVectors(t.up,new Qf(0,1,0)),i=r.clone().invert(),o=new Qf,s=new Kf,a=2*Math.PI,function(){var t=c.object.position;n.copy(t).sub(c.target),n.applyQuaternion(r),m.setFromVector3(n),c.autoRotate&&p===d.NONE&&C(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(m.theta+=g.theta*c.dampingFactor,m.phi+=g.phi*c.dampingFactor):(m.theta+=g.theta,m.phi+=g.phi);var e=c.minAzimuthAngle,u=c.maxAzimuthAngle;return isFinite(e)&&isFinite(u)&&(e<-Math.PI?e+=a:e>Math.PI&&(e-=a),u<-Math.PI?u+=a:u>Math.PI&&(u-=a),m.theta=e<=u?Math.max(e,Math.min(u,m.theta)):m.theta>(e+u)/2?Math.max(e,m.theta):Math.min(u,m.theta)),m.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=v,m.radius=Math.max(c.minDistance,Math.min(c.maxDistance,m.radius)),!0===c.enableDamping?c.target.addScaledVector(y,c.dampingFactor):c.target.add(y),n.setFromSpherical(m),n.applyQuaternion(i),t.copy(c.target).add(n),c.object.lookAt(c.target),!0===c.enableDamping?(g.theta*=1-c.dampingFactor,g.phi*=1-c.dampingFactor,y.multiplyScalar(1-c.dampingFactor)):(g.set(0,0,0),y.set(0,0,0)),v=1,!!(b||o.distanceToSquared(c.object.position)>f||8*(1-s.dot(c.object.quaternion))>f)&&(c.dispatchEvent(l),o.copy(c.object.position),s.copy(c.object.quaternion),b=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",tt,!1),c.domElement.removeEventListener("pointerdown",q,!1),c.domElement.removeEventListener("wheel",Z,!1),c.domElement.removeEventListener("touchstart",$,!1),c.domElement.removeEventListener("touchend",Q,!1),c.domElement.removeEventListener("touchmove",K,!1),c.domElement.ownerDocument.removeEventListener("pointermove",X,!1),c.domElement.ownerDocument.removeEventListener("pointerup",Y,!1),c.domElement.removeEventListener("keydown",J,!1)};var c=this,l={type:"change"},u={type:"start"},h={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=d.NONE,f=1e-6,m=new DM,g=new DM,v=1,y=new Qf,b=!1,x=new Gf,_=new Gf,w=new Gf,M=new Gf,E=new Gf,S=new Gf,T=new Gf,A=new Gf,R=new Gf;function L(){return Math.pow(.95,c.zoomSpeed)}function C(t){g.theta-=t}function P(t){g.phi-=t}var O,N=(O=new Qf,function(t,e){O.setFromMatrixColumn(e,0),O.multiplyScalar(-t),y.add(O)}),I=function(){var t=new Qf;return function(e,n){!0===c.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(c.object.up,t)),t.multiplyScalar(e),y.add(t)}}(),D=function(){var t=new Qf;return function(e,n){var r=c.domElement;if(c.object.isPerspectiveCamera){var i=c.object.position;t.copy(i).sub(c.target);var o=t.length();o*=Math.tan(c.object.fov/2*Math.PI/180),N(2*e*o/r.clientHeight,c.object.matrix),I(2*n*o/r.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(N(e*(c.object.right-c.object.left)/c.object.zoom/r.clientWidth,c.object.matrix),I(n*(c.object.top-c.object.bottom)/c.object.zoom/r.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function F(t){c.object.isPerspectiveCamera?v/=t:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*t)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function U(t){c.object.isPerspectiveCamera?v*=t:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/t)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function B(t){x.set(t.clientX,t.clientY)}function k(t){M.set(t.clientX,t.clientY)}function z(t){if(1==t.touches.length)x.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);x.set(e,n)}}function H(t){if(1==t.touches.length)M.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);M.set(e,n)}}function G(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);T.set(0,r)}function j(t){if(1==t.touches.length)_.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);_.set(e,n)}w.subVectors(_,x).multiplyScalar(c.rotateSpeed);var r=c.domElement;C(2*Math.PI*w.x/r.clientHeight),P(2*Math.PI*w.y/r.clientHeight),x.copy(_)}function V(t){if(1==t.touches.length)E.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);E.set(e,n)}S.subVectors(E,M).multiplyScalar(c.panSpeed),D(S.x,S.y),M.copy(E)}function W(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);A.set(0,r),R.set(0,Math.pow(A.y/T.y,c.zoomSpeed)),F(R.y),T.copy(A)}function q(t){if(!1!==c.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){var e;switch(t.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),t.button){case 0:e=c.mouseButtons.LEFT;break;case 1:e=c.mouseButtons.MIDDLE;break;case 2:e=c.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Of:if(!1===c.enableZoom)return;!function(t){T.set(t.clientX,t.clientY)}(t),p=d.DOLLY;break;case Pf:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===c.enablePan)return;k(t),p=d.PAN}else{if(!1===c.enableRotate)return;B(t),p=d.ROTATE}break;case Nf:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===c.enableRotate)return;B(t),p=d.ROTATE}else{if(!1===c.enablePan)return;k(t),p=d.PAN}break;default:p=d.NONE}p!==d.NONE&&(c.domElement.ownerDocument.addEventListener("pointermove",X,!1),c.domElement.ownerDocument.addEventListener("pointerup",Y,!1),c.dispatchEvent(u))}(t)}}function X(t){if(!1!==c.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){if(!1===c.enabled)return;switch(t.preventDefault(),p){case d.ROTATE:if(!1===c.enableRotate)return;!function(t){_.set(t.clientX,t.clientY),w.subVectors(_,x).multiplyScalar(c.rotateSpeed);var e=c.domElement;C(2*Math.PI*w.x/e.clientHeight),P(2*Math.PI*w.y/e.clientHeight),x.copy(_),c.update()}(t);break;case d.DOLLY:if(!1===c.enableZoom)return;!function(t){A.set(t.clientX,t.clientY),R.subVectors(A,T),R.y>0?F(L()):R.y<0&&U(L()),T.copy(A),c.update()}(t);break;case d.PAN:if(!1===c.enablePan)return;!function(t){E.set(t.clientX,t.clientY),S.subVectors(E,M).multiplyScalar(c.panSpeed),D(S.x,S.y),M.copy(E),c.update()}(t)}}(t)}}function Y(t){switch(t.pointerType){case"mouse":case"pen":!function(t){if(c.domElement.ownerDocument.removeEventListener("pointermove",X,!1),c.domElement.ownerDocument.removeEventListener("pointerup",Y,!1),!1===c.enabled)return;c.dispatchEvent(h),p=d.NONE}()}}function Z(t){!1===c.enabled||!1===c.enableZoom||p!==d.NONE&&p!==d.ROTATE||(t.preventDefault(),t.stopPropagation(),c.dispatchEvent(u),function(t){t.deltaY<0?U(L()):t.deltaY>0&&F(L()),c.update()}(t),c.dispatchEvent(h))}function J(t){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(t){var e=!1;switch(t.keyCode){case c.keys.UP:D(0,c.keyPanSpeed),e=!0;break;case c.keys.BOTTOM:D(0,-c.keyPanSpeed),e=!0;break;case c.keys.LEFT:D(c.keyPanSpeed,0),e=!0;break;case c.keys.RIGHT:D(-c.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),c.update())}(t)}function $(t){if(!1!==c.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(c.touches.ONE){case If:if(!1===c.enableRotate)return;z(t),p=d.TOUCH_ROTATE;break;case Df:if(!1===c.enablePan)return;H(t),p=d.TOUCH_PAN;break;default:p=d.NONE}break;case 2:switch(c.touches.TWO){case Ff:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(t){c.enableZoom&&G(t),c.enablePan&&H(t)}(t),p=d.TOUCH_DOLLY_PAN;break;case Uf:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(t){c.enableZoom&&G(t),c.enableRotate&&z(t)}(t),p=d.TOUCH_DOLLY_ROTATE;break;default:p=d.NONE}break;default:p=d.NONE}p!==d.NONE&&c.dispatchEvent(u)}}function K(t){if(!1!==c.enabled)switch(t.preventDefault(),t.stopPropagation(),p){case d.TOUCH_ROTATE:if(!1===c.enableRotate)return;j(t),c.update();break;case d.TOUCH_PAN:if(!1===c.enablePan)return;V(t),c.update();break;case d.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(t){c.enableZoom&&W(t),c.enablePan&&V(t)}(t),c.update();break;case d.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(t){c.enableZoom&&W(t),c.enableRotate&&j(t)}(t),c.update();break;default:p=d.NONE}}function Q(t){!1!==c.enabled&&(c.dispatchEvent(h),p=d.NONE)}function tt(t){!1!==c.enabled&&t.preventDefault()}c.domElement.addEventListener("contextmenu",tt,!1),c.domElement.addEventListener("pointerdown",q,!1),c.domElement.addEventListener("wheel",Z,!1),c.domElement.addEventListener("touchstart",$,!1),c.domElement.addEventListener("touchend",Q,!1),c.domElement.addEventListener("touchmove",K,!1),c.domElement.addEventListener("keydown",J,!1),this.update()};(IB.prototype=Object.create(Bf.prototype)).constructor=IB;var DB=function(t,e){IB.call(this,t,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Nf,this.mouseButtons.RIGHT=Pf,this.touches.ONE=Df,this.touches.TWO=Uf};(DB.prototype=Object.create(Bf.prototype)).constructor=DB;const FB={...c,OrbitControls:IB},UB="0.3.0-alpha.3"}]);
//# sourceMappingURL=global.js.map
                    